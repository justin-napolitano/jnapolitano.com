

<!DOCTYPE html>
<html lang="en-us">
<head><meta charset="UTF-8">
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta http-equiv="X-UA-Compatible" content="ie=edge"><meta name="robots" content="index, follow">
<meta name="revisit-after" content="15 days"><link rel="author" href="/jnapolitano.com/humans.txt">
<link rel="apple-touch-icon" sizes="180x180" href="/jnapolitano.com/apple-touch-icon.png"><link rel="icon" href="/jnapolitano.com/favicon.ico" type="image/x-icon"><link rel="icon" type="image/png" sizes="32x32" href="/jnapolitano.com/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="/jnapolitano.com/favicon-16x16.png">
<link rel="manifest" href="/jnapolitano.com/site.webmanifest">
<meta name="msapplication-TileImage" content="/jnapolitano.com/mstile-144x144.png">
<meta name="theme-color" content="#494f5c">
<meta name="msapplication-TileColor" content="#494f5c">
<link rel="mask-icon" href="/jnapolitano.com/safari-pinned-tab.svg" color="#494f5c"><meta name="author" content="Justin Napolitano"><meta name="description" content="Integrate JSON data from a rest API into your Neo4j Stack">
<meta itemprop="name" content="Conduct Legal Research with AI: Part 1">
<meta itemprop="description" content="Integrate JSON data from a rest API into your Neo4j Stack"><meta itemprop="datePublished" content="2022-05-16T14:40:32+00:00" />
<meta itemprop="dateModified" content="2024-07-13T13:30:59-05:00" />
<meta itemprop="wordCount" content="3760"><meta itemprop="image" content="jnapolitano.com/featured-justices.jpeg">
<meta itemprop="keywords" content="python,legal,json,scotus,automation," /><meta property="og:title" content="Conduct Legal Research with AI: Part 1" />
<meta property="og:description" content="Integrate JSON data from a rest API into your Neo4j Stack" />
<meta property="og:type" content="article" />
<meta property="og:url" content="jnapolitano.com/posts/legal-research-part-1/" /><meta property="og:image" content="jnapolitano.com/featured-justices.jpeg" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2022-05-16T14:40:32+00:00" />
<meta property="article:modified_time" content="2024-07-13T13:30:59-05:00" />

<meta name="twitter:card" content="summary_large_image"/>
<meta name="twitter:image" content="jnapolitano.com/featured-justices.jpeg"/>

<meta name="twitter:title" content="Conduct Legal Research with AI: Part 1"/>
<meta name="twitter:description" content="Integrate JSON data from a rest API into your Neo4j Stack"/>
<title>Conduct Legal Research with AI: Part 1</title>
<link rel="stylesheet dns-prefetch preconnect preload prefetch" as="style" href="/jnapolitano.com/css/style.min.e0b1c1b8d997f495fcb6256067ff9553b62e50837603056ab2905cd59b0b5e73.css" integrity="sha256-4LHBuNmX9JX8tiVgZ/+VU7YuUIN2AwVqspBc1ZsLXnM=" crossorigin="anonymous">
	<style>.bg-img {background-image: url('jnapolitano.com/featured-justices.jpeg');}</style></head>
<body id="page">
	<header id="site-header" class="animated slideInUp">
		<div class="hdr-wrapper section-inner">
			<div class="hdr-left">
				<div class="site-branding">
					<a href="jnapolitano.com">Justin Napolitano</a>
				</div>
				<nav class="site-nav hide-in-mobile"><a href="jnapolitano.com/posts/">POSTS</a><a href="https://jnapolitano.com/en/categories/projects/">PROJECTS</a><a href="https://jnapolitano.com/en/categories/adventures/">ADVENTURES</a><a href="https://jnapolitano.com/resume.pdf">RESUME</a></nav>
			</div>
			<div class="hdr-right hdr-icons">
				<button id="img-btn" class="hdr-btn" title=""><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-image"><rect x="3" y="3" width="18" height="18" rx="2" ry="2"></rect><circle cx="8.5" cy="8.5" r="1.5"></circle><polyline points="21 15 16 10 5 21"></polyline></svg></button><span class="hdr-social hide-in-mobile"><a href="https://github.com/justin-napolitano" target="_blank" rel="noopener me" title="Github"><svg xmlns="http://www.w3.org/2000/svg" class="feather" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M9 19c-5 1.5-5-2.5-7-3m14 6v-3.87a3.37 3.37 0 0 0-.94-2.61c3.14-.35 6.44-1.54 6.44-7A5.44 5.44 0 0 0 20 4.77 5.07 5.07 0 0 0 19.91 1S18.73.65 16 2.48a13.38 13.38 0 0 0-7 0C6.27.65 5.09 1 5.09 1A5.07 5.07 0 0 0 5 4.77a5.44 5.44 0 0 0-1.5 3.78c0 5.42 3.3 6.61 6.44 7A3.37 3.37 0 0 0 9 18.13V22"></path></svg></a><a href="https://www.linkedin.com/in/justin-napolitano/" target="_blank" rel="noopener me" title="Linkedin"><svg xmlns="http://www.w3.org/2000/svg" class="feather" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M16 8a6 6 0 0 1 6 6v7h-4v-7a2 2 0 0 0-2-2 2 2 0 0 0-2 2v7h-4v-7a6 6 0 0 1 6-6z"></path><rect x="2" y="9" width="4" height="12"></rect><circle cx="4" cy="4" r="2"></circle></svg></a><a href="mailto:personal.jnapolitano@gmail.com" target="_blank" rel="noopener me" title="Email"><svg xmlns="http://www.w3.org/2000/svg" class="feather" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M4 4h16c1.1 0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1 0-2-.9-2-2V6c0-1.1.9-2 2-2z"></path><polyline points="22,6 12,13 2,6"></polyline></svg></a><a href="https://instagram.com/jay_burdie" target="_blank" rel="noopener me" title="Instagram"><svg xmlns="http://www.w3.org/2000/svg" class="feather" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="2" y="2" width="20" height="20" rx="5" ry="5"></rect><path d="M16 11.37A4 4 0 1 1 12.63 8 4 4 0 0 1 16 11.37z"></path><line x1="17.5" y1="6.5" x2="17.5" y2="6.5"></line></svg></a><a href="https://mastodon.social/@jnapolitano" target="_blank" rel="noopener me" title="Mastodon"><svg xmlns="http://www.w3.org/2000/svg" class="feather" width="24" height="24" fill="none" stroke="currentColor" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="m 21.474,13.998 c -0.296,1.526 -2.655,3.194 -5.365,3.519 -1.413,0.168 -2.804,0.323 -4.287,0.255 -2.426,-0.111 -4.34,-0.579 -4.34,-0.579 0,0.236 0.015,0.461 0.044,0.672 0.316,2.394 2.373,2.537 4.323,2.604 1.968,0.067 3.721,-0.486 3.721,-0.486 l 0.081,1.779 c 0,0 -1.377,0.739 -3.829,0.875 -1.352,0.075 -3.031,-0.034 -4.987,-0.551 C 2.594,20.963 1.865,16.442 1.752,11.855 1.719,10.493 1.741,9.209 1.741,8.134 1.741,3.443 4.814,2.069 4.814,2.069 6.363,1.356 9.022,1.056 11.787,1.035 h 0.067 c 2.764,0.022 5.426,0.322 6.975,1.033 0,0 3.073,1.375 3.073,6.066 0,0 0.039,3.461 -0.428,5.864"/><path d="M 6.464,13.231 V 7.973 c 0,-1.002 0.549,-2.613 2.613,-2.613 2.064,0 2.741,1.793 2.741,3.484 0,1.692 0,2.23 0,2.23"/><path d="M 17.173,13.231 V 7.973 c 0,-1.002 -0.549,-2.613 -2.613,-2.613 -2.064,0 -2.741,1.793 -2.741,3.484 0,1.692 -0,2.23 -0,2.23"/></svg></a><a href="https://x.com/jayburdybird" target="_blank" rel="noopener me" title="X"><svg xmlns="http://www.w3.org/2000/svg" class="feather" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path class="st0" d="m21.3 21.1 -11.4 -18.2h-7.2l11.4 18.2zm-18.6 0 7.2 -6.6m4.2 -5 7.2 -6.6"/></svg></a></span><button id="share-btn" class="hdr-btn" title=""><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-share-2"><circle cx="18" cy="5" r="3"></circle><circle cx="6" cy="12" r="3"></circle><circle cx="18" cy="19" r="3"></circle><line x1="8.59" y1="13.51" x2="15.42" y2="17.49"></line><line x1="15.41" y1="6.51" x2="8.59" y2="10.49"></line></svg></button>
 
<div id="share-links" class="animated fast">
    
    
    
    
    <ul>
        <li>
            <a href="https://twitter.com/intent/tweet?hashtags=hermit2&amp;url=jnapolitano.com%2fposts%2flegal-research-part-1%2f&amp;text=Conduct%20Legal%20Research%20with%20AI%3a%20Part%201" target="_blank" rel="noopener" aria-label="Share on X"><svg xmlns="http://www.w3.org/2000/svg" class="feather" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path class="st0" d="m21.3 21.1 -11.4 -18.2h-7.2l11.4 18.2zm-18.6 0 7.2 -6.6m4.2 -5 7.2 -6.6"/></svg></a>
        </li>
        <li>
            <a href="https://facebook.com/sharer/sharer.php?u=jnapolitano.com%2fposts%2flegal-research-part-1%2f" target="_blank" rel="noopener" aria-label="Share on Facebook"><svg xmlns="http://www.w3.org/2000/svg" class="feather" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M18 2h-3a5 5 0 0 0-5 5v3H7v4h3v8h4v-8h3l1-4h-4V7a1 1 0 0 1 1-1h3z"></path></svg></a>
        </li>
        <li>
            <a href="mailto:?subject=Conduct%20Legal%20Research%20with%20AI%3a%20Part%201&amp;body=jnapolitano.com%2fposts%2flegal-research-part-1%2f" target="_self" rel="noopener" aria-label="Share on Email"><svg xmlns="http://www.w3.org/2000/svg" class="feather" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M4 4h16c1.1 0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1 0-2-.9-2-2V6c0-1.1.9-2 2-2z"></path><polyline points="22,6 12,13 2,6"></polyline></svg></a>
        </li>
        <li>
            <a href="https://www.linkedin.com/shareArticle?mini=true&amp;url=jnapolitano.com%2fposts%2flegal-research-part-1%2f&amp;source=jnapolitano.com&amp;title=Conduct%20Legal%20Research%20with%20AI%3a%20Part%201&amp;summary=Conduct%20Legal%20Research%20with%20AI%3a%20Part%201%2c%20by%20Justin%20Napolitano%0a%0aIntegrate%20JSON%20data%20from%20a%20rest%20API%20into%20your%20Neo4j%20Stack%0a" target="_blank" rel="noopener" aria-label="Share on LinkedIn"><svg xmlns="http://www.w3.org/2000/svg" class="feather" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M16 8a6 6 0 0 1 6 6v7h-4v-7a2 2 0 0 0-2-2 2 2 0 0 0-2 2v7h-4v-7a6 6 0 0 1 6-6z"></path><rect x="2" y="9" width="4" height="12"></rect><circle cx="4" cy="4" r="2"></circle></svg></a>
        </li>
        <li>
            <a href="#" onclick="linkShare(&#34;Conduct Legal Research with AI: Part 1&#34;,&#34;jnapolitano.com/posts/legal-research-part-1/&#34;,&#34;Conduct Legal Research with AI: Part 1, by Justin Napolitano\n\nIntegrate JSON data from a rest API into your Neo4j Stack\n&#34;); return false;" target="_self" rel="noopener" aria-label="Copy Link"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-copy"><rect x="9" y="9" width="13" height="13" rx="2" ry="2"></rect><path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"></path></svg></a>
        </li>
    </ul>
</div><button id="menu-btn" class="hdr-btn" title=""><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-menu"><line x1="3" y1="12" x2="21" y2="12"></line><line x1="3" y1="6" x2="21" y2="6"></line><line x1="3" y1="18" x2="21" y2="18"></line></svg></button>
			</div>
		</div>
	</header>
	<div id="mobile-menu" class="animated fast">
		<ul>
			<li><a href="jnapolitano.com/posts/">POSTS</a></li>
			<li><a href="https://jnapolitano.com/en/categories/projects/">PROJECTS</a></li>
			<li><a href="https://jnapolitano.com/en/categories/adventures/">ADVENTURES</a></li>
			<li><a href="https://jnapolitano.com/resume.pdf">RESUME</a></li>
		</ul>
	</div>


	<div class="bg-img"></div>
	<main class="site-main section-inner animated fadeIn faster"><article class="thin">
			<header class="post-header">
				<div class="post-meta"><span>May 16, 2022</span></div>
				<h1>Conduct Legal Research with AI: Part 1</h1>
			</header>
			<div class="post-info"><p>Integrate JSON data from a rest API into your Neo4j Stack</p><p><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-feather"><path d="M20.24 12.24a6 6 0 0 0-8.49-8.49L5 10.5V19h8.5z"></path><line x1="16" y1="8" x2="2" y2="22"></line><line x1="17.5" y1="15" x2="9" y2="15"></line></svg><a href="" target="_blank">Justin Napolitano</a></p>
<p><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-tag meta-icon"><path d="M20.59 13.41l-7.17 7.17a2 2 0 0 1-2.83 0L2 12V2h10l8.59 8.59a2 2 0 0 1 0 2.82z"></path><line x1="7" y1="7" x2="7" y2="7"></line></svg><span class="tag"><a href="jnapolitano.com/tags/python">python</a></span><span class="tag"><a href="jnapolitano.com/tags/legal">legal</a></span><span class="tag"><a href="jnapolitano.com/tags/json">json</a></span><span class="tag"><a href="jnapolitano.com/tags/scotus">scotus</a></span><span class="tag"><a href="jnapolitano.com/tags/automation">automation</a></span></p>
<p><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-folder"><path d="M22 19a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h5l2 3h9a2 2 0 0 1 2 2z"></path></svg><span class="category"><a href="jnapolitano.com/categories/projects">projects</a></span></p>
<p><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-file-text"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path><polyline points="14 2 14 8 20 8"></polyline><line x1="16" y1="13" x2="8" y2="13"></line><line x1="16" y1="17" x2="8" y2="17"></line><polyline points="10 9 9 9 8 9"></polyline></svg>
    
    
    
    
    17 Minutes, 5 Seconds</p>
<p><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-calendar"><rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect><line x1="16" y1="2" x2="16" y2="6"></line><line x1="8" y1="2" x2="8" y2="6"></line><line x1="3" y1="10" x2="21" y2="10"></line></svg>2022-05-16 09:40 -0500</p></div>
			<hr class="post-end">
			<div class="content">
				<h2 id="introduction">Introduction<a href="#introduction" class="anchor" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M15 7h3a5 5 0 0 1 5 5 5 5 0 0 1-5 5h-3m-6 0H6a5 5 0 0 1-5-5 5 5 0 0 1 5-5h3"></path><line x1="8" y1="12" x2="16" y2="12"></line></svg></a></h2>
<p>In a previous <a href="https://blog.jnapolitano.io/loc_crawler/">post</a>, I detailed the process of crawling the Library of Congress API to generate json files that could be intergrated into you DB of choice.</p>
<p>In this discussion, we will integrate JSON data into a Neo4j graph database.</p>
<h2 id="overview">Overview<a href="#overview" class="anchor" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M15 7h3a5 5 0 0 1 5 5 5 5 0 0 1-5 5h-3m-6 0H6a5 5 0 0 1-5-5 5 5 0 0 1 5-5h3"></path><line x1="8" y1="12" x2="16" y2="12"></line></svg></a></h2>
<p>The process is fairly straightforward.  The most difficult part is wrangling your json data into the right format for integration.</p>
<p>The main function first instantiates the database config informormation.  It then gets the cwd from a context manager.  We then import the files to be integrated.  A master subject table is created to record only unique subjects to avoid duplicates.  Finally, a json pipeline extracts the data from json, transforms it to integrate into neo4j, and finally we upload using the neomodels api.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&#34;__main__&#34;</span><span class="p">:</span>
    <span class="n">neo_applified</span> <span class="o">=</span> <span class="n">instantiate_neo_model_api</span><span class="p">()</span>
    <span class="n">cwd</span> <span class="o">=</span> <span class="n">get_cwd</span><span class="p">()</span>
    <span class="n">file_list</span> <span class="o">=</span> <span class="n">get_files</span><span class="p">(</span><span class="n">cwd</span> <span class="o">=</span> <span class="n">cwd</span><span class="p">)</span>
    <span class="n">master_subject_table</span> <span class="o">=</span> <span class="n">create_master_subject_table</span><span class="p">()</span>
    <span class="n">json_pipeline</span><span class="p">(</span><span class="n">file_list</span><span class="o">=</span><span class="n">file_list</span><span class="p">,</span> <span class="n">master_subject_table</span><span class="o">=</span><span class="n">master_subject_table</span><span class="p">)</span>
</code></pre></div><h2 id="instantiate-neo-model-api">Instantiate Neo Model Api<a href="#instantiate-neo-model-api" class="anchor" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M15 7h3a5 5 0 0 1 5 5 5 5 0 0 1-5 5h-3m-6 0H6a5 5 0 0 1-5-5 5 5 0 0 1 5-5h3"></path><line x1="8" y1="12" x2="16" y2="12"></line></svg></a></h2>
<p>I extended the neo model api with a few helper functions.  The repo is found at <a href="https://github.com/justin-napolitano/neo4jAPI">https://github.com/justin-napolitano/neo4jAPI</a>.</p>
<p>You can also review the snapshot below.</p>
<p>We will be calling the initation function to set the config information, update, create Case, and Create Subject classes during this review.</p>
<p>create subject calls the custom subject class and returns an object that can later be integrated into the db with the .save() function.</p>
<p>Create case does exactly the same.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="kn">from</span> <span class="nn">dataclasses</span> <span class="kn">import</span> <span class="n">dataclass</span>
<span class="kn">from</span> <span class="nn">datetime</span> <span class="kn">import</span> <span class="n">date</span>
<span class="kn">from</span> <span class="nn">shelve</span> <span class="kn">import</span> <span class="n">Shelf</span>
<span class="kn">from</span> <span class="nn">neomodel</span> <span class="kn">import</span> <span class="p">(</span><span class="n">config</span><span class="p">,</span> <span class="n">StructuredNode</span><span class="p">,</span> <span class="n">StringProperty</span><span class="p">,</span> <span class="n">IntegerProperty</span><span class="p">,</span>
    <span class="n">UniqueIdProperty</span><span class="p">,</span> <span class="n">RelationshipTo</span><span class="p">,</span> <span class="n">BooleanProperty</span><span class="p">,</span> <span class="n">EmailProperty</span><span class="p">,</span> <span class="n">Relationship</span><span class="p">,</span> <span class="n">db</span><span class="p">)</span>
<span class="kn">from</span> <span class="nn">pprint</span> <span class="kn">import</span> <span class="n">pprint</span>

<span class="k">class</span> <span class="nc">neoAPI</span><span class="p">():</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">uri</span><span class="p">,</span><span class="n">user</span><span class="p">,</span><span class="n">psw</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">db_init</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">instantiate_neo_model_session</span><span class="p">(</span><span class="n">uri</span><span class="p">,</span><span class="n">user</span><span class="p">,</span><span class="n">psw</span><span class="p">)</span>    
        
    
    <span class="k">def</span> <span class="nf">instantiate_neo_model_session</span><span class="p">(</span><span class="n">uri</span><span class="p">,</span><span class="n">user</span><span class="p">,</span><span class="n">psw</span><span class="p">):</span>
        
        <span class="c1">#config.DATABASE_URL = &#39;neo4j+s://{}:{}@{}&#39;.format(user, psw, uri)</span>
        <span class="n">config</span><span class="o">.</span><span class="n">DATABASE_URL</span> <span class="o">=</span><span class="s1">&#39;bolt://neo4j:beautiful@localhost:7687&#39;</span>
        <span class="c1">#config.DATABASE_URL = uri</span>
        <span class="k">return</span> <span class="kc">True</span>


    <span class="k">def</span> <span class="nf">standard_query</span><span class="p">():</span>
        <span class="n">results</span><span class="p">,</span> <span class="n">meta</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">cypher_query</span><span class="p">(</span><span class="n">query</span><span class="p">,</span> <span class="n">params</span><span class="p">)</span>
        <span class="n">people</span> <span class="o">=</span> <span class="p">[</span><span class="n">Person</span><span class="o">.</span><span class="n">inflate</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">results</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">create_case_node</span><span class="p">(</span><span class="n">date</span><span class="p">,</span> <span class="n">dates</span><span class="p">,</span> <span class="n">group</span><span class="p">,</span><span class="n">name</span><span class="p">,</span> <span class="n">pdf</span><span class="p">,</span> <span class="n">shelf_id</span><span class="p">,</span> <span class="n">subject</span><span class="p">,</span> <span class="n">title</span><span class="p">,</span> <span class="n">url</span><span class="p">,</span> <span class="n">subject_relationship</span> <span class="o">=</span> <span class="kc">True</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">Case</span><span class="p">(</span><span class="n">date</span><span class="o">=</span><span class="n">date</span><span class="p">,</span> <span class="n">dates</span><span class="o">=</span><span class="n">dates</span><span class="p">,</span> <span class="n">group</span><span class="o">=</span><span class="n">group</span><span class="p">,</span><span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">,</span> <span class="n">pdf</span><span class="o">=</span><span class="n">pdf</span><span class="p">,</span> <span class="n">shelf_id</span><span class="o">=</span><span class="n">shelf_id</span><span class="p">,</span> <span class="n">subject</span><span class="o">=</span><span class="n">subject</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="n">title</span><span class="p">,</span> <span class="n">url</span><span class="o">=</span><span class="n">url</span><span class="p">)</span>


    <span class="k">def</span> <span class="nf">create_city_node</span><span class="p">(</span><span class="n">name</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">City</span><span class="p">(</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span><span class="p">)</span>
        
    <span class="k">def</span> <span class="nf">create_country_node</span><span class="p">(</span><span class="n">code</span><span class="p">,</span><span class="n">name</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">Country</span><span class="p">(</span><span class="n">code</span> <span class="o">=</span> <span class="n">code</span><span class="p">,</span> <span class="n">name</span> <span class="o">=</span> <span class="n">name</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">create_state_node</span><span class="p">(</span><span class="n">code</span><span class="p">,</span><span class="n">name</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">State</span><span class="p">(</span><span class="n">code</span> <span class="o">=</span> <span class="n">code</span><span class="p">,</span> <span class="n">name</span> <span class="o">=</span> <span class="n">name</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">create_realtor_search_url_node</span><span class="p">(</span><span class="n">url</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">Realtor_Search_URL</span><span class="p">(</span><span class="n">url</span> <span class="o">=</span> <span class="n">url</span><span class="p">,</span> <span class="n">is_root</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="n">is_sibling</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="n">is_parent</span><span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">is_child</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">searched</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span>
    
    <span class="k">def</span> <span class="nf">create_root_node</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">name</span> <span class="o">=</span> <span class="s1">&#39;realtor.com&#39;</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">Root</span><span class="p">(</span><span class="n">is_root</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span><span class="p">,</span><span class="n">is_parent</span> <span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">is_sibling</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">is_child</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">url</span> <span class="o">=</span> <span class="n">url</span><span class="p">)</span>
        <span class="n">uid</span> <span class="o">=</span> <span class="n">UniqueIdProperty</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">create_child_node</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">name</span> <span class="o">=</span> <span class="s1">&#39;realtor.com&#39;</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">Child</span><span class="p">(</span><span class="n">is_root</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span><span class="p">,</span><span class="n">is_parent</span> <span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">is_sibling</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">is_child</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">url</span> <span class="o">=</span> <span class="n">url</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">create_parent_node</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">name</span> <span class="o">=</span> <span class="s1">&#39;realtor.com&#39;</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">Parent</span><span class="p">(</span><span class="n">is_root</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span><span class="p">,</span><span class="n">is_parent</span> <span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">is_sibling</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">is_child</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">url</span> <span class="o">=</span> <span class="n">url</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">create_sibling_node</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">name</span> <span class="o">=</span> <span class="s1">&#39;realtor.com&#39;</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">Sibling</span><span class="p">(</span><span class="n">is_root</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span><span class="p">,</span><span class="n">is_parent</span> <span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">is_sibling</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">is_child</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">url</span> <span class="o">=</span> <span class="n">url</span><span class="p">)</span>
    
    <span class="k">def</span> <span class="nf">create_relationship</span><span class="p">(</span><span class="n">source</span><span class="p">,</span><span class="n">target</span><span class="p">):</span>
      
        
        <span class="n">rel</span> <span class="o">=</span> <span class="n">source</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">target</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">rel</span>

        <span class="c1">#print(&#34;{}&#34;+&#34;.connect&#34; + &#34;{}&#34;.format(source,target))</span>
        
    <span class="k">def</span> <span class="nf">create_subject_node</span><span class="p">(</span><span class="n">name</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,):</span>
        <span class="k">return</span> <span class="n">Subject</span><span class="p">(</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">update</span><span class="p">(</span><span class="n">obj</span><span class="p">):</span>
        <span class="k">with</span> <span class="n">db</span><span class="o">.</span><span class="n">transaction</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">obj</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>

<span class="k">class</span> <span class="nc">Subject</span><span class="p">(</span><span class="n">StructuredNode</span><span class="p">):</span>
    <span class="n">uuid</span> <span class="o">=</span> <span class="n">UniqueIdProperty</span><span class="p">()</span>
    <span class="n">name</span> <span class="o">=</span> <span class="n">StringProperty</span><span class="p">(</span><span class="n">unique_index</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">required</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">Case</span><span class="p">(</span><span class="n">StructuredNode</span><span class="p">):</span>
    <span class="n">uid</span> <span class="o">=</span> <span class="n">UniqueIdProperty</span><span class="p">()</span>
    <span class="n">date</span> <span class="o">=</span> <span class="n">StringProperty</span><span class="p">(</span><span class="n">unique_index</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">required</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">dates</span> <span class="o">=</span> <span class="n">StringProperty</span><span class="p">(</span><span class="n">unique_index</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">required</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">group</span> <span class="o">=</span> <span class="n">StringProperty</span><span class="p">(</span><span class="n">unique_index</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">required</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">name</span> <span class="o">=</span> <span class="n">StringProperty</span><span class="p">(</span><span class="n">unique_index</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">required</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">pdf</span> <span class="o">=</span> <span class="n">StringProperty</span><span class="p">(</span><span class="n">unique_index</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">required</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span> 
    <span class="n">shelf_id</span> <span class="o">=</span> <span class="n">StringProperty</span><span class="p">(</span><span class="n">unique_index</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">required</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">subject</span> <span class="o">=</span> <span class="n">StringProperty</span><span class="p">(</span><span class="n">unique_index</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">required</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="c1">#primary_topic = StringProperty(unique_index=True, required=True)</span>
    <span class="n">title</span> <span class="o">=</span> <span class="n">StringProperty</span><span class="p">(</span><span class="n">unique_index</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">required</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">url</span> <span class="o">=</span> <span class="n">StringProperty</span><span class="p">(</span><span class="n">unique_index</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">required</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">subject_relationship</span> <span class="o">=</span> <span class="n">Relationship</span><span class="p">(</span><span class="s2">&#34;Subject&#34;</span><span class="p">,</span> <span class="s2">&#34;IS_SUBJECT&#34;</span><span class="p">)</span>

<span class="k">class</span> <span class="nc">Processed</span><span class="p">(</span><span class="n">StructuredNode</span><span class="p">):</span>
    <span class="n">uid</span> <span class="o">=</span> <span class="n">UniqueIdProperty</span><span class="p">()</span>

<span class="k">class</span> <span class="nc">NotProcessed</span><span class="p">(</span><span class="n">StructuredNode</span><span class="p">):</span>
    <span class="n">uid</span> <span class="o">=</span> <span class="n">UniqueIdProperty</span><span class="p">()</span>
    

<span class="k">class</span> <span class="nc">City</span><span class="p">(</span><span class="n">StructuredNode</span><span class="p">):</span>
    <span class="n">uid</span> <span class="o">=</span> <span class="n">UniqueIdProperty</span><span class="p">()</span>
    <span class="n">name</span> <span class="o">=</span> <span class="n">StringProperty</span><span class="p">(</span><span class="n">unique_index</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">required</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">state</span> <span class="o">=</span> <span class="n">Relationship</span><span class="p">(</span><span class="s1">&#39;State&#39;</span><span class="p">,</span> <span class="s1">&#39;IS_STATE_OF&#39;</span><span class="p">)</span>
    <span class="n">country</span> <span class="o">=</span> <span class="n">Relationship</span><span class="p">(</span><span class="s1">&#39;Country&#39;</span><span class="p">,</span> <span class="s1">&#39;IS_COUNTRY_OF&#39;</span><span class="p">)</span>
    
    
<span class="k">class</span> <span class="nc">Country</span><span class="p">(</span><span class="n">StructuredNode</span><span class="p">):</span>
    <span class="n">uid</span> <span class="o">=</span> <span class="n">UniqueIdProperty</span><span class="p">()</span>
    <span class="n">code</span> <span class="o">=</span> <span class="n">StringProperty</span><span class="p">(</span><span class="n">unique_index</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">required</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">name</span> <span class="o">=</span> <span class="n">StringProperty</span><span class="p">(</span><span class="n">unique_index</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">required</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    

<span class="k">class</span> <span class="nc">State</span><span class="p">(</span><span class="n">StructuredNode</span><span class="p">):</span>
    <span class="n">uid</span> <span class="o">=</span> <span class="n">UniqueIdProperty</span><span class="p">()</span>
    <span class="n">code</span> <span class="o">=</span> <span class="n">StringProperty</span><span class="p">(</span><span class="n">unique_index</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">required</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">name</span> <span class="o">=</span> <span class="n">StringProperty</span><span class="p">(</span><span class="n">unique_index</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">required</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">country</span> <span class="o">=</span> <span class="n">Relationship</span><span class="p">(</span><span class="s1">&#39;Country&#39;</span><span class="p">,</span> <span class="s1">&#39;IS_COUNTRY_OF&#39;</span><span class="p">)</span>

<span class="k">class</span> <span class="nc">Root</span><span class="p">(</span><span class="n">StructuredNode</span><span class="p">):</span>
    <span class="n">uid</span> <span class="o">=</span> <span class="n">UniqueIdProperty</span><span class="p">()</span>
    <span class="n">is_root</span> <span class="o">=</span> <span class="n">BooleanProperty</span><span class="p">(</span><span class="n">unique_index</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="n">required</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>
    <span class="n">is_parent</span> <span class="o">=</span> <span class="n">BooleanProperty</span><span class="p">(</span><span class="n">unique_index</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="n">required</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>
    <span class="n">is_sibling</span> <span class="o">=</span> <span class="n">BooleanProperty</span><span class="p">(</span><span class="n">unique_index</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="n">required</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>
    <span class="n">is_child</span> <span class="o">=</span> <span class="n">BooleanProperty</span><span class="p">(</span><span class="n">unique_index</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="n">required</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>
    <span class="n">name</span> <span class="o">=</span> <span class="n">StringProperty</span><span class="p">(</span><span class="n">unique_index</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="n">required</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span>
    <span class="n">url</span> <span class="o">=</span> <span class="n">StringProperty</span><span class="p">()</span>
    <span class="n">processed</span> <span class="o">=</span> <span class="n">Relationship</span><span class="p">(</span><span class="s2">&#34;Processed&#34;</span><span class="p">,</span> <span class="s2">&#34;IS_PROCESSED&#34;</span><span class="p">)</span>
    <span class="n">NotProcessed</span> <span class="o">=</span> <span class="n">Relationship</span><span class="p">(</span><span class="s2">&#34;NotProcessed&#34;</span><span class="p">,</span> <span class="s2">&#34;NOT_PROCESSED&#34;</span><span class="p">)</span>
    <span class="n">sibling</span> <span class="o">=</span> <span class="n">Relationship</span><span class="p">(</span><span class="s2">&#34;Sibling&#34;</span><span class="p">,</span><span class="s2">&#34;IS_SIBLING&#34;</span><span class="p">)</span>
    <span class="n">child</span> <span class="o">=</span> <span class="n">Relationship</span><span class="p">(</span><span class="s2">&#34;Child&#34;</span><span class="p">,</span><span class="s2">&#34;IS_CHILD&#34;</span><span class="p">)</span>
    <span class="n">parent</span> <span class="o">=</span> <span class="n">Relationship</span><span class="p">(</span><span class="s2">&#34;Parent&#34;</span><span class="p">,</span><span class="s2">&#34;IS_PARENT&#34;</span><span class="p">)</span>
    <span class="n">root</span> <span class="o">=</span> <span class="n">Relationship</span><span class="p">(</span><span class="s2">&#34;Root&#34;</span><span class="p">,</span> <span class="s2">&#34;IS_ROOT&#34;</span><span class="p">)</span>

<span class="k">class</span> <span class="nc">Child</span><span class="p">(</span><span class="n">StructuredNode</span><span class="p">):</span>
    <span class="n">uid</span> <span class="o">=</span> <span class="n">UniqueIdProperty</span><span class="p">()</span>
    <span class="n">is_root</span> <span class="o">=</span> <span class="n">BooleanProperty</span><span class="p">(</span><span class="n">unique_index</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="n">required</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>
    <span class="n">is_parent</span> <span class="o">=</span> <span class="n">BooleanProperty</span><span class="p">(</span><span class="n">unique_index</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="n">required</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>
    <span class="n">is_sibling</span> <span class="o">=</span> <span class="n">BooleanProperty</span><span class="p">(</span><span class="n">unique_index</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="n">required</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>
    <span class="n">is_child</span> <span class="o">=</span> <span class="n">BooleanProperty</span><span class="p">(</span><span class="n">unique_index</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="n">required</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>
    <span class="n">name</span> <span class="o">=</span> <span class="n">StringProperty</span><span class="p">()</span>
    <span class="n">processed</span> <span class="o">=</span> <span class="n">Relationship</span><span class="p">(</span><span class="s2">&#34;Processed&#34;</span><span class="p">,</span> <span class="s2">&#34;IS_PROCESSED&#34;</span><span class="p">)</span>
    <span class="n">NotProcessed</span> <span class="o">=</span> <span class="n">Relationship</span><span class="p">(</span><span class="s2">&#34;NotProcessed&#34;</span><span class="p">,</span> <span class="s2">&#34;NOT_PROCESSED&#34;</span><span class="p">)</span>
    <span class="n">sibling</span> <span class="o">=</span> <span class="n">Relationship</span><span class="p">(</span><span class="s2">&#34;Sibling&#34;</span><span class="p">,</span><span class="s2">&#34;IS_SIBLING&#34;</span><span class="p">)</span>
    <span class="n">child</span> <span class="o">=</span> <span class="n">Relationship</span><span class="p">(</span><span class="s2">&#34;Child&#34;</span><span class="p">,</span><span class="s2">&#34;IS_CHILD&#34;</span><span class="p">)</span>
    <span class="n">parent</span> <span class="o">=</span> <span class="n">Relationship</span><span class="p">(</span><span class="s2">&#34;Parent&#34;</span><span class="p">,</span><span class="s2">&#34;IS_PARENT&#34;</span><span class="p">)</span>
    <span class="n">root</span> <span class="o">=</span> <span class="n">Relationship</span><span class="p">(</span><span class="s2">&#34;Root&#34;</span><span class="p">,</span> <span class="s2">&#34;IS_ROOT&#34;</span><span class="p">)</span>

<span class="k">class</span> <span class="nc">Parent</span><span class="p">(</span><span class="n">StructuredNode</span><span class="p">):</span>
    <span class="n">uid</span> <span class="o">=</span> <span class="n">UniqueIdProperty</span><span class="p">()</span>
    <span class="n">name</span> <span class="o">=</span> <span class="n">StringProperty</span><span class="p">()</span>
    <span class="n">is_root</span> <span class="o">=</span> <span class="n">BooleanProperty</span><span class="p">(</span><span class="n">unique_index</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="n">required</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>
    <span class="n">is_parent</span> <span class="o">=</span> <span class="n">BooleanProperty</span><span class="p">(</span><span class="n">unique_index</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="n">required</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>
    <span class="n">is_sibling</span> <span class="o">=</span> <span class="n">BooleanProperty</span><span class="p">(</span><span class="n">unique_index</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="n">required</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>
    <span class="n">is_child</span> <span class="o">=</span> <span class="n">BooleanProperty</span><span class="p">(</span><span class="n">unique_index</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="n">required</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>
    <span class="n">processed</span> <span class="o">=</span> <span class="n">Relationship</span><span class="p">(</span><span class="s2">&#34;Processed&#34;</span><span class="p">,</span> <span class="s2">&#34;IS_PROCESSED&#34;</span><span class="p">)</span>
    <span class="n">NotProcessed</span> <span class="o">=</span> <span class="n">Relationship</span><span class="p">(</span><span class="s2">&#34;NotProcessed&#34;</span><span class="p">,</span> <span class="s2">&#34;NOT_PROCESSED&#34;</span><span class="p">)</span>
    <span class="n">sibling</span> <span class="o">=</span> <span class="n">Relationship</span><span class="p">(</span><span class="s2">&#34;Sibling&#34;</span><span class="p">,</span><span class="s2">&#34;IS_SIBLING&#34;</span><span class="p">)</span>
    <span class="n">child</span> <span class="o">=</span> <span class="n">Relationship</span><span class="p">(</span><span class="s2">&#34;Child&#34;</span><span class="p">,</span><span class="s2">&#34;IS_CHILD&#34;</span><span class="p">)</span>
    <span class="n">parent</span> <span class="o">=</span> <span class="n">Relationship</span><span class="p">(</span><span class="s2">&#34;Parent&#34;</span><span class="p">,</span><span class="s2">&#34;IS_PARENT&#34;</span><span class="p">)</span>
    <span class="n">root</span> <span class="o">=</span> <span class="n">Relationship</span><span class="p">(</span><span class="s2">&#34;Root&#34;</span><span class="p">,</span> <span class="s2">&#34;IS_ROOT&#34;</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">Sibling</span><span class="p">(</span><span class="n">StructuredNode</span><span class="p">):</span>
    <span class="n">uid</span> <span class="o">=</span> <span class="n">UniqueIdProperty</span><span class="p">()</span>
    <span class="n">is_root</span> <span class="o">=</span> <span class="n">BooleanProperty</span><span class="p">(</span><span class="n">unique_index</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="n">required</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>
    <span class="n">is_parent</span> <span class="o">=</span> <span class="n">BooleanProperty</span><span class="p">(</span><span class="n">unique_index</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="n">required</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>
    <span class="n">is_sibling</span> <span class="o">=</span> <span class="n">BooleanProperty</span><span class="p">(</span><span class="n">unique_index</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="n">required</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>
    <span class="n">is_child</span> <span class="o">=</span> <span class="n">BooleanProperty</span><span class="p">(</span><span class="n">unique_index</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="n">required</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>
    <span class="n">name</span> <span class="o">=</span> <span class="n">StringProperty</span><span class="p">()</span>
    <span class="n">processed</span> <span class="o">=</span> <span class="n">Relationship</span><span class="p">(</span><span class="s2">&#34;Processed&#34;</span><span class="p">,</span> <span class="s2">&#34;IS_PROCESSED&#34;</span><span class="p">)</span>
    <span class="n">NotProcessed</span> <span class="o">=</span> <span class="n">Relationship</span><span class="p">(</span><span class="s2">&#34;NotProcessed&#34;</span><span class="p">,</span> <span class="s2">&#34;NOT_PROCESSED&#34;</span><span class="p">)</span>
    <span class="n">sibling</span> <span class="o">=</span> <span class="n">Relationship</span><span class="p">(</span><span class="s2">&#34;Sibling&#34;</span><span class="p">,</span><span class="s2">&#34;IS_SIBLING&#34;</span><span class="p">)</span>
    <span class="n">child</span> <span class="o">=</span> <span class="n">Relationship</span><span class="p">(</span><span class="s2">&#34;Child&#34;</span><span class="p">,</span><span class="s2">&#34;IS_CHILD&#34;</span><span class="p">)</span>
    <span class="n">parent</span> <span class="o">=</span> <span class="n">Relationship</span><span class="p">(</span><span class="s2">&#34;Parent&#34;</span><span class="p">,</span><span class="s2">&#34;IS_PARENT&#34;</span><span class="p">)</span>
    <span class="n">root</span> <span class="o">=</span> <span class="n">Relationship</span><span class="p">(</span><span class="s2">&#34;Root&#34;</span><span class="p">,</span> <span class="s2">&#34;IS_ROOT&#34;</span><span class="p">)</span>
    
<span class="k">class</span> <span class="nc">Realtor_com</span><span class="p">(</span><span class="n">StructuredNode</span><span class="p">):</span>
    <span class="n">uid</span> <span class="o">=</span> <span class="n">UniqueIdProperty</span><span class="p">()</span>
    <span class="n">is_realtor_com</span> <span class="o">=</span> <span class="n">BooleanProperty</span><span class="p">(</span><span class="n">unique_index</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="n">required</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>
    <span class="n">name</span> <span class="o">=</span> <span class="n">StringProperty</span><span class="p">()</span>

<span class="k">class</span> <span class="nc">Realtor_Search_URL</span><span class="p">(</span><span class="n">StructuredNode</span><span class="p">):</span>
    <span class="n">uid</span> <span class="o">=</span> <span class="n">UniqueIdProperty</span><span class="p">()</span>
    <span class="n">url</span> <span class="o">=</span> <span class="n">StringProperty</span><span class="p">(</span><span class="n">unique_index</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">required</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">searched</span> <span class="o">=</span> <span class="n">BooleanProperty</span><span class="p">(</span><span class="n">unique_index</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="n">required</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>
    <span class="n">is_root</span> <span class="o">=</span> <span class="n">BooleanProperty</span><span class="p">(</span><span class="n">unique_index</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="n">required</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>
    <span class="n">is_child</span> <span class="o">=</span> <span class="n">BooleanProperty</span><span class="p">(</span><span class="n">unique_index</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="n">required</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>
    <span class="n">is_parent</span> <span class="o">=</span> <span class="n">BooleanProperty</span><span class="p">(</span><span class="n">unique_index</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="n">required</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>
    <span class="n">is_sibling</span> <span class="o">=</span> <span class="n">BooleanProperty</span><span class="p">(</span><span class="n">unique_index</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="n">required</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>
    <span class="c1">#state = Relationship(&#39;State&#39;, &#39;OF&#39;)</span>
    <span class="n">state</span> <span class="o">=</span> <span class="n">Relationship</span><span class="p">(</span><span class="s1">&#39;State&#39;</span><span class="p">,</span> <span class="s1">&#39;IS_STATE_OF&#39;</span><span class="p">)</span>
    <span class="n">city</span> <span class="o">=</span> <span class="n">Relationship</span><span class="p">(</span><span class="s1">&#39;City&#39;</span><span class="p">,</span> <span class="s1">&#39;IS_CITY_OF&#39;</span><span class="p">)</span>
    <span class="n">root</span> <span class="o">=</span> <span class="n">Relationship</span><span class="p">(</span><span class="s1">&#39;Root&#39;</span><span class="p">,</span><span class="s1">&#39;IS_ROOT&#39;</span><span class="p">)</span>
    <span class="n">child</span> <span class="o">=</span> <span class="n">Relationship</span><span class="p">(</span><span class="s1">&#39;Child&#39;</span><span class="p">,</span><span class="s2">&#34;IS_CHILD&#34;</span><span class="p">)</span>
    <span class="n">parent</span> <span class="o">=</span> <span class="n">Relationship</span><span class="p">(</span><span class="s1">&#39;Parent&#39;</span><span class="p">,</span> <span class="s2">&#34;IS_PARENT&#34;</span><span class="p">)</span>
    <span class="n">sibling</span> <span class="o">=</span> <span class="n">Relationship</span><span class="p">(</span><span class="s1">&#39;Sibling&#39;</span><span class="p">,</span> <span class="s2">&#34;IS_SIBLING&#34;</span><span class="p">)</span>
    <span class="n">realtor_com</span> <span class="o">=</span> <span class="n">Relationship</span><span class="p">(</span><span class="s1">&#39;Realtor_com&#39;</span><span class="p">,</span> <span class="s2">&#34;IS_REALTOR.COM_URL&#34;</span><span class="p">)</span>
    <span class="n">processed</span> <span class="o">=</span> <span class="n">Relationship</span><span class="p">(</span><span class="s2">&#34;Processed&#34;</span><span class="p">,</span> <span class="s2">&#34;IS_PROCESSED&#34;</span><span class="p">)</span>
    <span class="n">NotProcessed</span> <span class="o">=</span> <span class="n">Relationship</span><span class="p">(</span><span class="s2">&#34;NotProcessed&#34;</span><span class="p">,</span> <span class="s2">&#34;NOT_PROCESSED&#34;</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">Person</span><span class="p">(</span><span class="n">StructuredNode</span><span class="p">):</span>
    <span class="n">uid</span> <span class="o">=</span> <span class="n">UniqueIdProperty</span><span class="p">()</span>
    <span class="n">full_name</span> <span class="o">=</span> <span class="n">StringProperty</span><span class="p">(</span><span class="n">required</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>
    <span class="n">email</span> <span class="o">=</span> <span class="n">EmailProperty</span><span class="p">()</span>
</code></pre></div><h2 id="get-files">Get Files<a href="#get-files" class="anchor" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M15 7h3a5 5 0 0 1 5 5 5 5 0 0 1-5 5h-3m-6 0H6a5 5 0 0 1-5-5 5 5 0 0 1 5-5h3"></path><line x1="8" y1="12" x2="16" y2="12"></line></svg></a></h2>
<p>The get_files function returns a list of files within the input directory.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python">
<span class="k">def</span> <span class="nf">get_files</span><span class="p">(</span><span class="n">cwd</span> <span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">(),</span> <span class="n">input_directory</span> <span class="o">=</span> <span class="s1">&#39;input&#39;</span><span class="p">):</span>
    
    <span class="n">path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">sep</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">cwd</span><span class="p">,</span><span class="n">input_directory</span><span class="p">])</span>
    <span class="n">file_list</span><span class="o">=</span> <span class="p">[</span><span class="n">f</span> <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">glob</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="n">path</span> <span class="o">+</span> <span class="s2">&#34;**/*.json&#34;</span><span class="p">,</span> <span class="n">recursive</span><span class="o">=</span><span class="kc">True</span><span class="p">)]</span>
  
    <span class="k">return</span> <span class="n">file_list</span>

</code></pre></div><h2 id="create-master-subject-file">Create Master Subject File<a href="#create-master-subject-file" class="anchor" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M15 7h3a5 5 0 0 1 5 5 5 5 0 0 1-5 5h-3m-6 0H6a5 5 0 0 1-5-5 5 5 0 0 1 5-5h3"></path><line x1="8" y1="12" x2="16" y2="12"></line></svg></a></h2>
<p>Create maseter subject table generates an empty dataframe that will record every unique subject experienced in the data.</p>
<p>I will improve upon this later, by uploading a master file that will be saved following each modification.  This would enable resuming the process following an error or fault.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python">
<span class="k">def</span> <span class="nf">create_master_subject_table</span><span class="p">():</span>
    <span class="n">table</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">()</span>
    <span class="n">table</span><span class="p">[</span><span class="s1">&#39;subject&#39;</span><span class="p">]</span><span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>
    <span class="n">table</span><span class="p">[</span><span class="s1">&#39;transaction&#39;</span><span class="p">]</span><span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>
    <span class="n">table</span><span class="p">[</span><span class="s1">&#39;submitted&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>
    <span class="k">return</span><span class="p">(</span><span class="n">table</span><span class="p">)</span>

</code></pre></div><h2 id="json-pipeline-function">Json Pipeline function<a href="#json-pipeline-function" class="anchor" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M15 7h3a5 5 0 0 1 5 5 5 5 0 0 1-5 5h-3m-6 0H6a5 5 0 0 1-5-5 5 5 0 0 1 5-5h3"></path><line x1="8" y1="12" x2="16" y2="12"></line></svg></a></h2>
<p>The json pipeline function is the runner for the etl job.  It loads each file into dataframe, manipulates the data accordingly, and updates the neo4j database.</p>
<p>When I refactor the code, I will most likely create an object that calls static functions to generate then desired output.</p>
<p>I may also seperate the case, subject, and relationship pipeline into seperate classes in order to avoid shadowing functions within functions.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="k">def</span> <span class="nf">json_pipeline</span><span class="p">(</span><span class="n">file_list</span><span class="p">,</span> <span class="n">master_subject_table</span><span class="p">):</span>
    <span class="n">case_counter</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">for</span> <span class="n">file</span> <span class="ow">in</span> <span class="n">file_list</span><span class="p">:</span>
        
        <span class="n">data</span> <span class="o">=</span> <span class="n">load_json_data</span><span class="p">(</span><span class="n">file</span><span class="o">=</span><span class="n">file</span><span class="p">)</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;results&#39;</span><span class="p">]</span>
        <span class="c1">#pprint(data)</span>
        <span class="c1">#pprint(data[0])</span>
        
        <span class="c1">#filtered_data = filter_json_data(json_data = data, filter = filter)</span>

        <span class="c1"># Creating the case nodes transaction nodes and df</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">clean_json_data</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
        <span class="n">case_data</span> <span class="o">=</span> <span class="n">stringify_json_values</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
        <span class="n">case_data</span> <span class="o">=</span> <span class="n">pandify_case_data</span><span class="p">(</span><span class="n">case_data</span><span class="p">)</span>
        <span class="n">case_data</span> <span class="o">=</span> <span class="n">nodify_case_data</span><span class="p">(</span><span class="n">case_data</span> <span class="o">=</span> <span class="n">case_data</span><span class="p">)</span>
        
        <span class="c1"># Creating the subject nodes transaction nodes and df</span>
        <span class="n">subject_list</span> <span class="o">=</span> <span class="n">slice_subject_data</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
        <span class="n">subject_list</span> <span class="o">=</span> <span class="n">identify_unique_subjects</span><span class="p">(</span><span class="n">subject_list</span><span class="p">)</span>
        <span class="n">subject_lookup_table</span> <span class="o">=</span> <span class="n">create_subject_lookup_table</span><span class="p">(</span><span class="n">subject_list</span><span class="p">)</span>
        <span class="n">master_subject_table</span> <span class="o">=</span> <span class="n">integrate_to_master_table</span><span class="p">(</span><span class="n">subject_lookup_table</span><span class="p">,</span><span class="n">master_subject_table</span><span class="p">)</span>
        <span class="c1">#pprint(master_subject_table.duplicated())</span>
        <span class="n">case_counter</span> <span class="o">=</span> <span class="n">case_counter</span> <span class="o">+</span> <span class="nb">len</span><span class="p">(</span><span class="n">case_data</span><span class="p">)</span>

        <span class="n">master_subject_table</span> <span class="o">=</span> <span class="n">nodify_subjects</span><span class="p">(</span><span class="n">master_subject_table</span><span class="p">)</span>

        <span class="c1">#pprint(case_data)</span>
        <span class="c1">#pprint(master_subject_table[&#39;transaction&#39;])</span>
        <span class="c1">#lets save data to the database</span>

        <span class="n">master_subject_table</span> <span class="o">=</span> <span class="n">submit_subjects_to_db</span><span class="p">(</span><span class="n">master_subject_table</span><span class="p">)</span>
        <span class="n">case_data</span> <span class="o">=</span> <span class="n">submit_cases_to_db</span><span class="p">(</span><span class="n">case_data</span> <span class="o">=</span> <span class="n">case_data</span><span class="p">)</span>

        <span class="c1"># Create Relationships</span>

        <span class="n">relationship_list</span><span class="o">=</span> <span class="n">create_relationship_table</span><span class="p">(</span><span class="n">case_data</span><span class="o">=</span><span class="n">case_data</span><span class="p">,</span> <span class="n">master_subject_table</span><span class="o">=</span><span class="n">master_subject_table</span><span class="p">)</span>
</code></pre></div><h3 id="case-pipeline">Case Pipeline<a href="#case-pipeline" class="anchor" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M15 7h3a5 5 0 0 1 5 5 5 5 0 0 1-5 5h-3m-6 0H6a5 5 0 0 1-5-5 5 5 0 0 1 5-5h3"></path><line x1="8" y1="12" x2="16" y2="12"></line></svg></a></h3>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="c1"># Creating the case nodes transaction nodes and df</span>
<span class="n">data</span> <span class="o">=</span> <span class="n">clean_json_data</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
<span class="n">case_data</span> <span class="o">=</span> <span class="n">stringify_json_values</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
<span class="n">case_data</span> <span class="o">=</span> <span class="n">pandify_case_data</span><span class="p">(</span><span class="n">case_data</span><span class="p">)</span>
<span class="n">case_data</span> <span class="o">=</span> <span class="n">nodify_case_data</span><span class="p">(</span><span class="n">case_data</span> <span class="o">=</span> <span class="n">case_data</span><span class="p">)</span>
</code></pre></div><p>To create the case nodes four functions are called.</p>
<h4 id="clean-json-data">Clean Json Data<a href="#clean-json-data" class="anchor" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M15 7h3a5 5 0 0 1 5 5 5 5 0 0 1-5 5h-3m-6 0H6a5 5 0 0 1-5-5 5 5 0 0 1 5-5h3"></path><line x1="8" y1="12" x2="16" y2="12"></line></svg></a></h4>
<p>The first is clean_json_data which is actually unnecessary.  The only operation that is required is moving the pdf froma list to a dicktionary key.  It should and will be refactored.  As it stands now, I am leaving iut as an artifact of a previous workflow.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python">
<span class="k">def</span> <span class="nf">clean_json_data</span><span class="p">(</span><span class="n">filtered_data</span><span class="p">):</span>
    <span class="c1"># Select the keys that I want from the dictionary</span>
    <span class="c1"># filter appropriatly into a df </span>
    <span class="c1"># write df to file</span>
    <span class="c1">#print(type(filtered_data))</span>
    <span class="c1">#pprint(filtered_data)</span>
    <span class="k">for</span> <span class="n">data</span> <span class="ow">in</span> <span class="n">filtered_data</span><span class="p">:</span>
        <span class="c1">#pprint(data)</span>
        <span class="c1">#creat a dictionary of columns and values for each row.  Combine them all into a df when we are done</span>
        <span class="c1"># each dictionary must be a row.... which makes perfect sense, but they can not be nested... </span>
        <span class="n">item</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;item&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="n">resources</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;resources&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="n">index</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;index&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="n">language</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;language&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="n">online_format</span><span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;online_format&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="n">original_format</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;original_format&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="n">kind</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;type&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="n">image_url</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;image_url&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="n">hassegments</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;hassegments&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="n">extract_timestamp</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;extract_timestamp&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="n">timestampe</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;timestamp&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="n">mimetype</span><span class="o">=</span><span class="n">data</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;mime_type&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">pdf</span> <span class="o">=</span> <span class="n">resources</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;pdf&#39;</span><span class="p">]</span>
        <span class="k">except</span><span class="p">:</span> 
            <span class="n">pdf</span> <span class="o">=</span> <span class="s2">&#34;noPdf&#34;</span>
        <span class="n">data</span><span class="p">[</span><span class="s2">&#34;pdf&#34;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pdf</span>
        <span class="n">data</span><span class="p">[</span><span class="s1">&#39;search_index&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">index</span>
    
</code></pre></div><h4 id="stringify-json-data">Stringify Json Data<a href="#stringify-json-data" class="anchor" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M15 7h3a5 5 0 0 1 5 5 5 5 0 0 1-5 5h-3m-6 0H6a5 5 0 0 1-5-5 5 5 0 0 1 5-5h3"></path><line x1="8" y1="12" x2="16" y2="12"></line></svg></a></h4>
<p>The Second is Stringify_json_data.  The imporatance of this function is that it creates strings from lists in order to properly integrate into the neo4j databse.  Iterables are permitted, however they can not be searched.  For my use case, I decided to create csv strings instead that can later be parsed if necessary.</p>
<p>This function also moves the subject list to a dedicated key in the dictionary.  This is important because it is used to generate the subject tables.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="k">def</span> <span class="nf">stringify_json_values</span><span class="p">(</span><span class="n">data</span><span class="p">):</span>
    <span class="k">for</span> <span class="nb">dict</span> <span class="ow">in</span> <span class="n">data</span><span class="p">:</span>
        <span class="n">subject_list</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">[</span><span class="s1">&#39;subject&#39;</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="nb">dict</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="nb">dict</span><span class="p">[</span><span class="n">key</span><span class="p">])</span> <span class="o">==</span> <span class="nb">list</span><span class="p">:</span>
                <span class="n">tmp_list</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="p">(</span><span class="nb">dict</span><span class="p">[</span><span class="n">key</span><span class="p">]):</span>
                    <span class="n">item</span> <span class="o">=</span> <span class="n">item</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&#34; &#34;</span><span class="p">,</span> <span class="s2">&#34;-&#34;</span><span class="p">)</span>
                    <span class="n">tmp_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>
                <span class="nb">dict</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">tmp_list</span>

                <span class="nb">dict</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&#34;,&#34;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">dict</span><span class="p">[</span><span class="n">key</span><span class="p">])</span>
        <span class="nb">dict</span><span class="p">[</span><span class="s1">&#39;subject_list&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">subject_list</span>

                
    <span class="k">return</span> <span class="n">data</span>
</code></pre></div><h4 id="pandify-case-data">Pandify Case Data<a href="#pandify-case-data" class="anchor" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M15 7h3a5 5 0 0 1 5 5 5 5 0 0 1-5 5h-3m-6 0H6a5 5 0 0 1-5-5 5 5 0 0 1 5-5h3"></path><line x1="8" y1="12" x2="16" y2="12"></line></svg></a></h4>
<p>The next function creates a pandas dataframe from a list of dictionaries.  Thankfully this is easy to accommplish.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="k">def</span> <span class="nf">pandify_case_data</span><span class="p">(</span><span class="n">data</span><span class="p">):</span>
    <span class="c1">#case_df = pd.concat(data, sort=False)</span>
    <span class="n">df</span><span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
    <span class="n">df</span><span class="p">[</span><span class="s1">&#39;submitted&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>
    <span class="k">return</span> <span class="n">df</span>
</code></pre></div><h4 id="nodify-case-data">Nodify Case Data<a href="#nodify-case-data" class="anchor" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M15 7h3a5 5 0 0 1 5 5 5 5 0 0 1-5 5h-3m-6 0H6a5 5 0 0 1-5-5 5 5 0 0 1 5-5h3"></path><line x1="8" y1="12" x2="16" y2="12"></line></svg></a></h4>
<p>Nodify creates transaction objects that can be saved to the neo4j databse.  I call the neomodel api to generate the results and save them into a dataframe that is used to apply the upload with a lambda function.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="k">def</span> <span class="nf">nodify_case_data</span><span class="p">(</span><span class="n">case_data</span><span class="p">):</span>
    <span class="c1">#non_submitted_nodes = case_data[case_data.notna()]</span>
    <span class="n">non_submitted_nodes</span> <span class="o">=</span> <span class="n">case_data</span><span class="p">[</span><span class="n">case_data</span><span class="o">.</span><span class="n">notna</span><span class="p">()</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)]</span>
    <span class="c1">#pprint(non_submitted_nodes)</span>
    <span class="n">case_nodes</span> <span class="o">=</span> <span class="n">non_submitted_nodes</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span> <span class="p">:</span><span class="n">neo</span><span class="o">.</span><span class="n">neoAPI</span><span class="o">.</span><span class="n">create_case_node</span><span class="p">(</span><span class="n">date</span> <span class="o">=</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;date&#39;</span><span class="p">],</span> <span class="n">dates</span><span class="o">=</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;dates&#39;</span><span class="p">],</span><span class="n">group</span> <span class="o">=</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;group&#39;</span><span class="p">],</span> <span class="n">name</span><span class="o">=</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">],</span> <span class="n">pdf</span><span class="o">=</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;pdf&#39;</span><span class="p">],</span> <span class="n">shelf_id</span> <span class="o">=</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;shelf_id&#39;</span><span class="p">],</span> <span class="n">subject</span><span class="o">=</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;subject&#39;</span><span class="p">],</span> <span class="n">title</span> <span class="o">=</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;title&#39;</span><span class="p">],</span> <span class="n">url</span> <span class="o">=</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;url&#39;</span><span class="p">],</span> <span class="n">subject_relationship</span><span class="o">=</span><span class="kc">True</span><span class="p">),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

    <span class="n">case_data</span><span class="p">[</span><span class="s1">&#39;transaction&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">case_nodes</span>
    <span class="k">return</span> <span class="n">case_data</span>

</code></pre></div><h3 id="the-subject-pipeline">The Subject Pipeline<a href="#the-subject-pipeline" class="anchor" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M15 7h3a5 5 0 0 1 5 5 5 5 0 0 1-5 5h-3m-6 0H6a5 5 0 0 1-5-5 5 5 0 0 1 5-5h3"></path><line x1="8" y1="12" x2="16" y2="12"></line></svg></a></h3>
<p>The subject pipeline slices the subject data from the current search result page.</p>
<p>It then identifies the unique subjects</p>
<p>The subject_lookup_table is a dataframe containing the subjects returned by subject list.  They are unique only to the result page.</p>
<p>The master_subject_table is then updated by the integrate_to_master_table function that identifes new subjects to integrate into the master table.</p>
<p>finally, the nodify subject function creates transaction objects to be uploaded to the neo4j db.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python">  <span class="c1"># Creating the subject nodes transaction nodes and df</span>
    <span class="n">subject_list</span> <span class="o">=</span> <span class="n">slice_subject_data</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
    <span class="n">subject_list</span> <span class="o">=</span> <span class="n">identify_unique_subjects</span><span class="p">(</span><span class="n">subject_list</span><span class="p">)</span>
    <span class="n">subject_lookup_table</span> <span class="o">=</span> <span class="n">create_subject_lookup_table</span><span class="p">(</span><span class="n">subject_list</span><span class="p">)</span>
    <span class="n">master_subject_table</span> <span class="o">=</span> <span class="n">integrate_to_master_table</span><span class="p">(</span><span class="n">subject_lookup_table</span><span class="p">,</span><span class="n">master_subject_table</span><span class="p">)</span>
    <span class="c1">#pprint(master_subject_table.duplicated())</span>

    <span class="n">master_subject_table</span> <span class="o">=</span> <span class="n">nodify_subjects</span><span class="p">(</span><span class="n">master_subject_table</span><span class="p">)</span>
    
</code></pre></div><h4 id="slice_subject_data">slice_subject_data<a href="#slice_subject_data" class="anchor" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M15 7h3a5 5 0 0 1 5 5 5 5 0 0 1-5 5h-3m-6 0H6a5 5 0 0 1-5-5 5 5 0 0 1 5-5h3"></path><line x1="8" y1="12" x2="16" y2="12"></line></svg></a></h4>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="k">def</span> <span class="nf">slice_subject_data</span><span class="p">(</span><span class="n">data</span><span class="p">):</span>
    <span class="n">subject_list</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">case</span> <span class="ow">in</span> <span class="n">data</span><span class="p">:</span>
        <span class="n">subject_list</span> <span class="o">=</span> <span class="n">subject_list</span> <span class="o">+</span> <span class="n">case</span><span class="p">[</span><span class="s1">&#39;subject_list&#39;</span><span class="p">]</span>
    <span class="c1">#pprint(subject_list)</span>
    <span class="k">return</span> <span class="n">subject_list</span>
</code></pre></div><h4 id="identify-unique-subjects">Identify Unique Subjects<a href="#identify-unique-subjects" class="anchor" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M15 7h3a5 5 0 0 1 5 5 5 5 0 0 1-5 5h-3m-6 0H6a5 5 0 0 1-5-5 5 5 0 0 1 5-5h3"></path><line x1="8" y1="12" x2="16" y2="12"></line></svg></a></h4>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="k">def</span> <span class="nf">identify_unique_subjects</span><span class="p">(</span><span class="n">subject_list</span><span class="p">):</span>
    
    <span class="c1"># insert the list to the set</span>
    <span class="n">list_set</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">subject_list</span><span class="p">)</span>
    <span class="c1"># convert the set to the list</span>
    <span class="n">unique_list</span> <span class="o">=</span> <span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">list_set</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">unique_list</span>

</code></pre></div><h4 id="create-subject-lookup-table">Create Subject Lookup Table<a href="#create-subject-lookup-table" class="anchor" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M15 7h3a5 5 0 0 1 5 5 5 5 0 0 1-5 5h-3m-6 0H6a5 5 0 0 1-5-5 5 5 0 0 1 5-5h3"></path><line x1="8" y1="12" x2="16" y2="12"></line></svg></a></h4>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="k">def</span> <span class="nf">create_subject_lookup_table</span><span class="p">(</span><span class="n">subject_list</span><span class="p">):</span>
    <span class="n">lookup_table</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">subject_list</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;subject&#39;</span><span class="p">])</span>
    <span class="n">lookup_table</span><span class="p">[</span><span class="s1">&#39;transaction&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>
    <span class="n">lookup_table</span><span class="p">[</span><span class="s1">&#39;submitted&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>
    <span class="k">return</span> <span class="n">lookup_table</span>
</code></pre></div><h4 id="nodify-subject">Nodify Subject<a href="#nodify-subject" class="anchor" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M15 7h3a5 5 0 0 1 5 5 5 5 0 0 1-5 5h-3m-6 0H6a5 5 0 0 1-5-5 5 5 0 0 1 5-5h3"></path><line x1="8" y1="12" x2="16" y2="12"></line></svg></a></h4>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="k">def</span> <span class="nf">nodify_subjects</span><span class="p">(</span><span class="n">master_subject_table</span><span class="p">):</span>
    <span class="n">non_submitted_nodes</span> <span class="o">=</span> <span class="n">master_subject_table</span><span class="p">[</span><span class="n">master_subject_table</span><span class="o">.</span><span class="n">isna</span><span class="p">()</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
    <span class="c1">#df[df.isna().any(axis=1)]</span>
    <span class="c1">#pprint(non_submitted_nodes)</span>
    <span class="n">non_submitted_nodes</span><span class="p">[</span><span class="s1">&#39;transaction&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">non_submitted_nodes</span><span class="p">[</span><span class="s1">&#39;subject&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span> <span class="p">:</span><span class="n">neo</span><span class="o">.</span><span class="n">neoAPI</span><span class="o">.</span><span class="n">create_subject_node</span><span class="p">(</span><span class="n">name</span> <span class="o">=</span> <span class="n">x</span><span class="p">))</span>
    <span class="n">master_subject_table</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">non_submitted_nodes</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">master_subject_table</span>
</code></pre></div><h3 id="uploading-case-and-subject-data">Uploading Case and Subject data<a href="#uploading-case-and-subject-data" class="anchor" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M15 7h3a5 5 0 0 1 5 5 5 5 0 0 1-5 5h-3m-6 0H6a5 5 0 0 1-5-5 5 5 0 0 1 5-5h3"></path><line x1="8" y1="12" x2="16" y2="12"></line></svg></a></h3>
<p>With the transaction object dataframes created, we can then update the data to the database.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="n">master_subject_table</span> <span class="o">=</span> <span class="n">submit_subjects_to_db</span><span class="p">(</span><span class="n">master_subject_table</span><span class="p">)</span>
<span class="n">case_data</span> <span class="o">=</span> <span class="n">submit_cases_to_db</span><span class="p">(</span><span class="n">case_data</span> <span class="o">=</span> <span class="n">case_data</span><span class="p">)</span>
</code></pre></div><h4 id="submit-subjects">Submit Subjects<a href="#submit-subjects" class="anchor" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M15 7h3a5 5 0 0 1 5 5 5 5 0 0 1-5 5h-3m-6 0H6a5 5 0 0 1-5-5 5 5 0 0 1 5-5h3"></path><line x1="8" y1="12" x2="16" y2="12"></line></svg></a></h4>
<p>This function selects the subject nodes from the master table that have not been uploaded to the neo4j database.</p>
<p>It identifies na in the submitted collumn in order to slice non-submitted nodes.</p>
<p>If that table can be created we upload all of the df with the update function from the neoapi.  It simply calls the db and calls save() on the object.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="k">def</span> <span class="nf">submit_subjects_to_db</span><span class="p">(</span><span class="n">master_subject_table</span><span class="p">):</span>
    <span class="c1">#unsubmitted = master_subject_table[master_subject_table.notna()]</span>
    <span class="c1">#pprint(master_subject_table)</span>
    <span class="c1">#non_submitted_nodes=master_subject_table[[master_subject_table[&#39;submitted&#39;] == np.nan]]</span>
    <span class="n">non_submitted_nodes</span> <span class="o">=</span> <span class="n">master_subject_table</span><span class="p">[</span><span class="n">master_subject_table</span><span class="p">[</span><span class="s1">&#39;submitted&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">isna</span><span class="p">()]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
    <span class="c1">#pprint(non_submitted_nodes)</span>
    <span class="k">if</span> <span class="n">non_submitted_nodes</span><span class="o">.</span><span class="n">empty</span><span class="p">:</span>   
        <span class="k">return</span> <span class="n">master_subject_table</span>
    <span class="k">else</span><span class="p">:</span>
         <span class="c1">#pprint(non_submitted_nodes)</span>
        <span class="n">non_submitted_nodes</span><span class="p">[</span><span class="s1">&#39;transaction&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">non_submitted_nodes</span><span class="p">[</span><span class="s1">&#39;transaction&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">neo</span><span class="o">.</span><span class="n">neoAPI</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">x</span><span class="p">))</span>
        <span class="n">non_submitted_nodes</span><span class="p">[</span><span class="s1">&#39;submitted&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
    
    <span class="c1">#test = non_submitted_nodes.iloc[32][&#39;transaction&#39;]</span>
    <span class="c1">#return_obj = neo.neoAPI.update(test)</span>
        <span class="n">master_subject_table</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">non_submitted_nodes</span><span class="p">)</span>
        <span class="c1">#pprint(master_subject_table)</span>
        <span class="k">return</span> <span class="n">master_subject_table</span>
</code></pre></div><h4 id="submit-cases">Submit Cases<a href="#submit-cases" class="anchor" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M15 7h3a5 5 0 0 1 5 5 5 5 0 0 1-5 5h-3m-6 0H6a5 5 0 0 1-5-5 5 5 0 0 1 5-5h3"></path><line x1="8" y1="12" x2="16" y2="12"></line></svg></a></h4>
<p>Initially i had copy and pasted the subject submission function. I realized that the checks were unnecessary.   I am assuming that each result is unique.  Therefore, every case is uploaded.  If it proves that there are duplicates in the database, the neo4j cypher language would permit me to prune those duplicate edges.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="k">def</span> <span class="nf">submit_cases_to_db</span><span class="p">(</span><span class="n">case_data</span><span class="p">):</span>
        <span class="c1">#unsubmitted = master_subject_table[master_subject_table.notna()]</span>

        <span class="c1">### in theory none of the cases wouldhave been submitted becasue i am pulling them from file.  There is no need to check.. Just submit</span>
    <span class="c1">#non_submitted_nodes = case_data[case_data[&#39;submitted&#39;].isna()].copy()</span>
    <span class="c1">#pprint(non_submitted_nodes)</span>
    <span class="c1">##pprint(non_submitted_nodes)</span>
    <span class="c1">#if non_submitted_nodes.empty:</span>
    <span class="c1">#    return case_data</span>
    <span class="c1">#else:</span>
    <span class="n">case_data</span><span class="p">[</span><span class="s1">&#39;transaction&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">case_data</span><span class="p">[</span><span class="s1">&#39;transaction&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">neo</span><span class="o">.</span><span class="n">neoAPI</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">x</span><span class="p">))</span>
    <span class="c1">#Assume all are submitted..</span>
    <span class="n">case_data</span><span class="p">[</span><span class="s1">&#39;submitted&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="c1">#test = non_submitted_nodes.iloc[32][&#39;transaction&#39;]</span>
    <span class="c1">#return_obj = neo.neoAPI.update(test)</span>
    <span class="c1">#case_data.update(non_submitted_nodes)</span>
    <span class="k">return</span> <span class="n">case_data</span>
</code></pre></div><h3 id="submit-the-relationships">Submit the Relationships<a href="#submit-the-relationships" class="anchor" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M15 7h3a5 5 0 0 1 5 5 5 5 0 0 1-5 5h-3m-6 0H6a5 5 0 0 1-5-5 5 5 0 0 1 5-5h3"></path><line x1="8" y1="12" x2="16" y2="12"></line></svg></a></h3>
<p>The final step is to relate the cases to the subject nodes.</p>
<pre tabindex="0"><code>relationship_list= create_relationship_table(case_data=case_data, master_subject_table=master_subject_table)
</code></pre><p>This is accomplished by calling the relationship function declared in the Case class declared in the neomodel api.</p>
<p>View the reference below:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="k">class</span> <span class="nc">Case</span><span class="p">(</span><span class="n">StructuredNode</span><span class="p">):</span>
    <span class="n">uid</span> <span class="o">=</span> <span class="n">UniqueIdProperty</span><span class="p">()</span>
    <span class="n">date</span> <span class="o">=</span> <span class="n">StringProperty</span><span class="p">(</span><span class="n">unique_index</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">required</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">dates</span> <span class="o">=</span> <span class="n">StringProperty</span><span class="p">(</span><span class="n">unique_index</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">required</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">group</span> <span class="o">=</span> <span class="n">StringProperty</span><span class="p">(</span><span class="n">unique_index</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">required</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">name</span> <span class="o">=</span> <span class="n">StringProperty</span><span class="p">(</span><span class="n">unique_index</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">required</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">pdf</span> <span class="o">=</span> <span class="n">StringProperty</span><span class="p">(</span><span class="n">unique_index</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">required</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span> 
    <span class="n">shelf_id</span> <span class="o">=</span> <span class="n">StringProperty</span><span class="p">(</span><span class="n">unique_index</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">required</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">subject</span> <span class="o">=</span> <span class="n">StringProperty</span><span class="p">(</span><span class="n">unique_index</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">required</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="c1">#primary_topic = StringProperty(unique_index=True, required=True)</span>
    <span class="n">title</span> <span class="o">=</span> <span class="n">StringProperty</span><span class="p">(</span><span class="n">unique_index</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">required</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">url</span> <span class="o">=</span> <span class="n">StringProperty</span><span class="p">(</span><span class="n">unique_index</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">required</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">subject_relationship</span> <span class="o">=</span> <span class="n">Relationship</span><span class="p">(</span><span class="s2">&#34;Subject&#34;</span><span class="p">,</span> <span class="s2">&#34;IS_SUBJECT&#34;</span><span class="p">)</span>
</code></pre></div><h4 id="create-relationship-table">Create Relationship Table<a href="#create-relationship-table" class="anchor" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M15 7h3a5 5 0 0 1 5 5 5 5 0 0 1-5 5h-3m-6 0H6a5 5 0 0 1-5-5 5 5 0 0 1 5-5h3"></path><line x1="8" y1="12" x2="16" y2="12"></line></svg></a></h4>
<p>To create the relationships the case_data and the master_subject_table are necessary.</p>
<p>for every case a relationship is created to every subject within its subject list.</p>
<p>It is important to note, that in order for this function to work correctly, the cases and subjects must first be submitted to the database.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python">
<span class="k">def</span> <span class="nf">create_relationship_table</span><span class="p">(</span><span class="n">case_data</span><span class="p">,</span> <span class="n">master_subject_table</span><span class="p">):</span>
    <span class="c1">#pprint(case_data[])</span>
        <span class="c1">#test = master_subject_table[&#39;subject&#39;]</span>
        <span class="c1"># select </span>
    <span class="n">relationship_list</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">case_data</span><span class="p">)):</span>
        <span class="n">unique_dataframe</span> <span class="o">=</span> <span class="p">(</span><span class="n">master_subject_table</span><span class="p">[</span><span class="n">master_subject_table</span><span class="p">[</span><span class="s1">&#39;subject&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">case_data</span><span class="p">[</span><span class="s1">&#39;subject_list&#39;</span><span class="p">][</span><span class="n">row</span><span class="p">])])</span>
        <span class="c1">#pprint(unique_dataframe)</span>
        <span class="k">for</span> <span class="n">subject_row</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">unique_dataframe</span><span class="p">)):</span>
            <span class="n">case</span> <span class="o">=</span> <span class="n">case_data</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">row</span><span class="p">][</span><span class="s1">&#39;transaction&#39;</span><span class="p">]</span>
            <span class="n">subject</span> <span class="o">=</span> <span class="n">unique_dataframe</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">subject_row</span><span class="p">][</span><span class="s1">&#39;transaction&#39;</span><span class="p">]</span>
            <span class="c1">#create relationship</span>
            <span class="c1">#pprint(case)</span>
            <span class="c1">#pprint(subject)</span>
            <span class="n">relationship</span> <span class="o">=</span> <span class="n">neo</span><span class="o">.</span><span class="n">neoAPI</span><span class="o">.</span><span class="n">create_relationship</span><span class="p">(</span><span class="n">case</span><span class="o">.</span><span class="n">subject_relationship</span><span class="p">,</span><span class="n">subject</span><span class="p">)</span>
            <span class="c1">#pprint(relationship)</span>
            <span class="n">relationship_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">relationship</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">relationship_list</span>
</code></pre></div><h2 id="putting-everything-together">Putting Everything Together<a href="#putting-everything-together" class="anchor" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M15 7h3a5 5 0 0 1 5 5 5 5 0 0 1-5 5h-3m-6 0H6a5 5 0 0 1-5-5 5 5 0 0 1 5-5h3"></path><line x1="8" y1="12" x2="16" y2="12"></line></svg></a></h2>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python">
<span class="c1">#realtor_graph.py</span>


<span class="c1">#from neo4j_connect_2 import NeoSandboxApp</span>
<span class="c1">#import neo4j_connect_2 as neo</span>
<span class="c1">#import GoogleServices as google</span>
<span class="c1">#from pyspark.sql import SparkSession</span>
<span class="c1">#from pyspark.sql.functions import struct</span>
<span class="kn">from</span> <span class="nn">cgitb</span> <span class="kn">import</span> <span class="n">lookup</span>
<span class="kn">import</span> <span class="nn">code</span>
<span class="kn">from</span> <span class="nn">dbm</span> <span class="kn">import</span> <span class="n">dumb</span>
<span class="kn">from</span> <span class="nn">doctest</span> <span class="kn">import</span> <span class="n">master</span>
<span class="kn">from</span> <span class="nn">hmac</span> <span class="kn">import</span> <span class="n">trans_36</span>
<span class="kn">import</span> <span class="nn">mimetypes</span>
<span class="kn">from</span> <span class="nn">platform</span> <span class="kn">import</span> <span class="n">node</span>
<span class="kn">from</span> <span class="nn">pprint</span> <span class="kn">import</span> <span class="n">pprint</span>
<span class="kn">from</span> <span class="nn">pty</span> <span class="kn">import</span> <span class="n">master_open</span>
<span class="kn">from</span> <span class="nn">re</span> <span class="kn">import</span> <span class="n">sub</span>
<span class="kn">from</span> <span class="nn">unittest.util</span> <span class="kn">import</span> <span class="n">unorderable_list_difference</span>
<span class="kn">from</span> <span class="nn">urllib.parse</span> <span class="kn">import</span> <span class="n">non_hierarchical</span>
<span class="kn">from</span> <span class="nn">neomodel</span> <span class="kn">import</span> <span class="p">(</span><span class="n">config</span><span class="p">,</span> <span class="n">StructuredNode</span><span class="p">,</span> <span class="n">StringProperty</span><span class="p">,</span> <span class="n">IntegerProperty</span><span class="p">,</span>
    <span class="n">UniqueIdProperty</span><span class="p">,</span> <span class="n">RelationshipTo</span><span class="p">,</span> <span class="n">BooleanProperty</span><span class="p">,</span> <span class="n">EmailProperty</span><span class="p">,</span> <span class="n">Relationship</span><span class="p">,</span><span class="n">db</span><span class="p">)</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="c1">#import NeoNodes as nn</span>
<span class="c1">#import GoogleServices</span>
<span class="kn">import</span> <span class="nn">neo4jClasses</span>
<span class="c1">#import sparkAPI as spark</span>
<span class="kn">import</span> <span class="nn">neoModelAPI</span> <span class="k">as</span> <span class="nn">neo</span>
<span class="kn">import</span> <span class="nn">glob</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">json</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="c1">#from neoModelAPI import NeoNodes as nn</span>


<span class="k">class</span> <span class="nc">DataUploadFunctions</span><span class="p">():</span>
    <span class="k">def</span> <span class="nf">upload_df</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">df</span><span class="p">):</span>
        <span class="c1">#df.apply(lambda x: pprint(str(x) + str(type(x))))</span>
        
        <span class="n">node_list</span> <span class="o">=</span>  <span class="n">df</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">neo</span><span class="o">.</span><span class="n">neoAPI</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">x</span><span class="p">))</span>
        <span class="c1">#pprint(node_list)</span>
        <span class="k">return</span>  <span class="n">node_list</span>
    
    <span class="k">def</span> <span class="nf">map_to_df</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">df1</span><span class="p">,</span><span class="n">df2</span><span class="p">,</span><span class="n">lookup_value</span> <span class="p">:</span><span class="nb">str</span><span class="p">,</span> <span class="n">lookup_key</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
        <span class="n">df1</span><span class="p">[</span><span class="n">lookup_value</span><span class="p">]</span> <span class="o">=</span> <span class="n">df1</span><span class="p">[</span><span class="n">lookup_key</span><span class="p">]</span>
        <span class="c1">#pprint(df1.columns)</span>
        <span class="c1">#pprint(df1)</span>
        
        <span class="n">val</span>  <span class="o">=</span> <span class="n">df1</span><span class="p">[</span><span class="n">lookup_value</span><span class="p">]</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="nb">dict</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">df2</span><span class="p">[</span><span class="n">lookup_key</span><span class="p">],</span>  <span class="n">df2</span><span class="p">[</span><span class="n">lookup_value</span><span class="p">])))</span>
        <span class="k">return</span> <span class="n">val</span>

    <span class="k">def</span> <span class="nf">set_relationships</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">source_node</span><span class="p">,</span> <span class="n">target_node</span><span class="p">):</span>
        <span class="c1">#pprint(self.df.columns)</span>
        <span class="c1">#pprint(source_node)</span>
        <span class="n">rel</span> <span class="o">=</span> <span class="n">neo</span><span class="o">.</span><span class="n">neoAPI</span><span class="o">.</span><span class="n">create_relationship</span><span class="p">(</span><span class="n">source</span> <span class="o">=</span> <span class="n">source_node</span> <span class="p">,</span><span class="n">target</span> <span class="o">=</span> <span class="n">target_node</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">rel</span>

<span class="k">class</span> <span class="nc">DataPipelineFunctions</span><span class="p">():</span>
    <span class="k">def</span> <span class="nf">write_df_to_csv</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">df</span><span class="p">,</span><span class="n">path</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
        <span class="n">cwd</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">()</span>
        <span class="n">path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">sep</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">cwd</span><span class="p">,</span><span class="n">path</span><span class="p">])</span>

        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">path</span><span class="p">,</span><span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="n">df</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">path</span>

    <span class="k">def</span> <span class="nf">create_city_nodes</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">df</span><span class="p">):</span>
        <span class="n">city_nodes</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;city_name&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span> <span class="p">:</span><span class="n">neo</span><span class="o">.</span><span class="n">neoAPI</span><span class="o">.</span><span class="n">create_city_node</span><span class="p">(</span><span class="n">name</span> <span class="o">=</span> <span class="n">x</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">city_nodes</span>

    <span class="k">def</span> <span class="nf">create_url_nodes</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">df</span><span class="p">):</span>
        <span class="n">url_nodes</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;root_realtor_url&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span> <span class="p">:</span><span class="n">neo</span><span class="o">.</span><span class="n">neoAPI</span><span class="o">.</span><span class="n">create_realtor_search_url_node</span><span class="p">(</span><span class="n">url</span><span class="o">=</span> <span class="n">x</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">url_nodes</span>
    
    <span class="k">def</span> <span class="nf">create_root_nodes</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">df</span><span class="p">):</span>
        <span class="n">root_nodes</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;root_realtor_url&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span> <span class="p">:</span><span class="n">neo</span><span class="o">.</span><span class="n">neoAPI</span><span class="o">.</span><span class="n">create_root_node</span><span class="p">(</span><span class="n">url</span><span class="o">=</span> <span class="n">x</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">root_nodes</span>

    <span class="k">def</span> <span class="nf">create_country_nodes</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">df</span><span class="p">):</span>
        <span class="n">country_nodes</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span> <span class="p">:</span><span class="n">neo</span><span class="o">.</span><span class="n">neoAPI</span><span class="o">.</span><span class="n">create_country_node</span><span class="p">(</span><span class="n">code</span> <span class="o">=</span> <span class="n">x</span><span class="o">.</span><span class="n">country_code</span><span class="p">,</span> <span class="n">name</span> <span class="o">=</span> <span class="n">x</span><span class="o">.</span><span class="n">country_name</span><span class="p">),</span><span class="n">axis</span> <span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">country_nodes</span>
        

    <span class="k">def</span> <span class="nf">return_unique_country_df</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">df</span><span class="p">):</span>
        <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">drop_duplicates</span><span class="p">(</span><span class="n">subset</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;country_name&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="n">df</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">difference</span><span class="p">([</span><span class="s1">&#39;country_node&#39;</span><span class="p">,</span><span class="s1">&#39;state_node&#39;</span><span class="p">,</span><span class="s1">&#39;country_name&#39;</span><span class="p">,</span> <span class="s1">&#39;country_code&#39;</span><span class="p">,</span><span class="s1">&#39;state_name&#39;</span><span class="p">]),</span> <span class="mi">1</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="c1">#pprint(df)</span>
        <span class="k">return</span> <span class="n">df</span>


    <span class="k">def</span> <span class="nf">create_state_nodes</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">df</span><span class="p">):</span>
        <span class="n">state_nodes</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span> <span class="p">:</span><span class="n">neo</span><span class="o">.</span><span class="n">neoAPI</span><span class="o">.</span><span class="n">create_state_node</span><span class="p">(</span><span class="n">code</span> <span class="o">=</span> <span class="n">x</span><span class="o">.</span><span class="n">state_code</span><span class="p">,</span> <span class="n">name</span> <span class="o">=</span> <span class="n">x</span><span class="o">.</span><span class="n">state_name</span><span class="p">),</span><span class="n">axis</span> <span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">state_nodes</span>    

    <span class="k">def</span> <span class="nf">return_unique_state_df</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">df</span><span class="p">):</span>
        <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">drop_duplicates</span><span class="p">(</span><span class="n">subset</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;state_name&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="n">df</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">difference</span><span class="p">([</span><span class="s1">&#39;state_node&#39;</span><span class="p">,</span><span class="s1">&#39;country_node&#39;</span><span class="p">,</span><span class="s1">&#39;country_code&#39;</span><span class="p">,</span><span class="s1">&#39;state_name&#39;</span><span class="p">,</span><span class="s1">&#39;country_name&#39;</span><span class="p">,</span><span class="s1">&#39;state_code&#39;</span><span class="p">]),</span> <span class="mi">1</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="c1">#pprint(df)</span>

        <span class="k">return</span> <span class="n">df</span>

    <span class="k">def</span> <span class="nf">rename_columns</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">df</span><span class="p">,</span> <span class="n">mapper</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;city&#39;</span><span class="p">:</span> <span class="s1">&#39;city_name&#39;</span><span class="p">,</span> <span class="s1">&#39;state&#39;</span><span class="p">:</span> <span class="s1">&#39;state_code&#39;</span><span class="p">,</span><span class="s1">&#39;realtor_url&#39;</span><span class="p">:</span> <span class="s1">&#39;root_realtor_url&#39;</span><span class="p">}):</span>
        <span class="k">return</span> <span class="n">df</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span> <span class="o">=</span> <span class="n">mapper</span><span class="p">)</span>


    <span class="k">def</span> <span class="nf">add_country_code</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">country_code</span> <span class="o">=</span> <span class="s2">&#34;USA&#34;</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">country_code</span>

    <span class="k">def</span> <span class="nf">add_country_name</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">country_name</span> <span class="o">=</span> <span class="s2">&#34;United States of America&#34;</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">country_name</span>

    <span class="k">def</span> <span class="nf">upload_df</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">df</span><span class="p">):</span>
        <span class="c1">#df.apply(lambda x: pprint(str(x) + str(type(x))))</span>
        
        <span class="n">node_list</span> <span class="o">=</span>  <span class="n">df</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">neo</span><span class="o">.</span><span class="n">neoAPI</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">x</span><span class="p">))</span>
        <span class="n">pprint</span><span class="p">(</span><span class="n">node_list</span><span class="p">)</span>
        <span class="k">return</span>  <span class="n">node_list</span>
        <span class="c1">#df[&#39;server_node&#39;] =  node_list</span>
        <span class="c1">#pprint(df)</span>
        
        


    <span class="k">def</span> <span class="nf">set_url_relationships</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1">#pprint(self.df.columns)</span>
        <span class="n">update_list</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">neo</span><span class="o">.</span><span class="n">neoAPI</span><span class="o">.</span><span class="n">create_relationship</span><span class="p">(</span><span class="n">source</span> <span class="o">=</span> <span class="n">x</span><span class="o">.</span><span class="n">url_node</span><span class="o">.</span><span class="n">city</span><span class="p">,</span><span class="n">target</span> <span class="o">=</span> <span class="n">x</span><span class="o">.</span><span class="n">city_node</span><span class="p">),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">pprint</span><span class="p">(</span><span class="n">update_list</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">update_list</span>
        <span class="c1">#rel = self.df.url.connect(self.df.city)</span>

    <span class="k">def</span> <span class="nf">set_city_relationships</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1">#pprint(self.df.columns)</span>
        <span class="n">update_list</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">neo</span><span class="o">.</span><span class="n">neoAPI</span><span class="o">.</span><span class="n">create_relationship</span><span class="p">(</span><span class="n">source</span> <span class="o">=</span> <span class="n">x</span><span class="o">.</span><span class="n">city_node</span><span class="o">.</span><span class="n">country</span><span class="p">,</span><span class="n">target</span> <span class="o">=</span> <span class="n">x</span><span class="o">.</span><span class="n">country_node</span><span class="p">),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">update_list</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">neo</span><span class="o">.</span><span class="n">neoAPI</span><span class="o">.</span><span class="n">create_relationship</span><span class="p">(</span><span class="n">source</span> <span class="o">=</span> <span class="n">x</span><span class="o">.</span><span class="n">city_node</span><span class="o">.</span><span class="n">state</span><span class="p">,</span><span class="n">target</span> <span class="o">=</span> <span class="n">x</span><span class="o">.</span><span class="n">state_node</span><span class="p">),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">pprint</span><span class="p">(</span><span class="n">update_list</span><span class="p">)</span>
        <span class="c1">#rel = self.df.url.connect(self.df.city)</span>

    <span class="k">def</span> <span class="nf">set_state_relationships</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1">#pprint(self.df.columns)</span>
        <span class="n">neo</span><span class="o">.</span><span class="n">neoAPI</span><span class="o">.</span><span class="n">create_relationship</span><span class="p">(</span><span class="n">source</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">unique_state_nodes</span><span class="o">.</span><span class="n">state_node</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">country</span><span class="p">,</span><span class="n">target</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">unique_state_nodes</span><span class="o">.</span><span class="n">country_node</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="c1">#update_list = self.unique_state_nodes.apply(lambda x: neo.neoAPI.create_relationship(source = x.state_node.country,target = x.country_node.name), axis=1)</span>
        <span class="c1">#pprint(update_list)</span>
        <span class="c1">#rel = self.df.url.connect(self.df.city)</span>




    <span class="k">def</span> <span class="nf">group_by_state</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">grouped</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="n">by</span> <span class="o">=</span> <span class="s2">&#34;state_name&#34;</span><span class="p">)</span>
        
    <span class="k">def</span> <span class="nf">load_data_to_pandas_df</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">file_path</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">file_path</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">:</span>

            <span class="k">with</span> <span class="nb">open</span> <span class="p">(</span><span class="n">file_path</span><span class="p">)</span> <span class="k">as</span> <span class="n">file</span><span class="p">:</span>
                <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_json</span><span class="p">(</span><span class="n">file</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">df</span>
    
    <span class="k">def</span> <span class="nf">nodify_city_column</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;city_node&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;city&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span> <span class="p">:</span> <span class="n">neo</span><span class="o">.</span><span class="n">neoAPI</span><span class="o">.</span><span class="n">create_city_node</span><span class="p">(</span><span class="n">name</span> <span class="o">=</span> <span class="n">x</span><span class="p">))</span>
        
        
        <span class="c1">#pprint(df.city_nodes)</span>



    <span class="k">def</span> <span class="nf">nodify_states_column</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="n">unique_states</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="o">.</span><span class="n">drop_duplicates</span><span class="p">(</span><span class="n">subset</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;state&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="c1">#pprint(state_dict)</span>

        <span class="n">unique_states</span><span class="p">[</span><span class="s1">&#39;state_node&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">unique_states</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">neo</span><span class="o">.</span><span class="n">neoAPI</span><span class="o">.</span><span class="n">create_state_node</span><span class="p">(</span><span class="n">name</span> <span class="o">=</span> <span class="n">x</span><span class="o">.</span><span class="n">state_name</span><span class="p">,</span> <span class="n">code</span> <span class="o">=</span> <span class="n">x</span><span class="o">.</span><span class="n">state</span><span class="p">),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="c1">#pprint(unique_states)</span>
        <span class="c1">#self.df[&#39;state_nodes&#39;] = unique_states[&#39;state_nodes&#39;] where unique_states[state_name] = self.df_stateName</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="p">[</span><span class="s2">&#34;state_node&#34;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;state_name&#39;</span><span class="p">]</span>
        <span class="c1">#self.df[&#39;state_node&#39;] =</span>
        <span class="c1">#pprint(self.df[&#39;state_name&#39;].map(unique_states))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;state_node&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;state_node&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="nb">dict</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">unique_states</span><span class="o">.</span><span class="n">state_name</span><span class="p">,</span>  <span class="n">unique_states</span><span class="o">.</span><span class="n">state_node</span><span class="p">)))</span>
        <span class="c1">#pprint(self.df)</span>

        
     
        <span class="c1">#mask = dfd[&#39;a&#39;].str.startswith(&#39;o&#39;)</span>
        
        
        <span class="c1">#self.df[&#39;state_nodes&#39;] = self.df.apply(lambda x: neo.create_state_node(name = x.state_name, code = x.state) if x not in states_dict else states_dict[x], axis=1)</span>
        
    <span class="k">def</span> <span class="nf">nodify_url_column</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;url_node&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;realtor_url&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span> <span class="p">:</span> <span class="n">neo</span><span class="o">.</span><span class="n">neoAPI</span><span class="o">.</span><span class="n">create_url_node</span><span class="p">(</span><span class="n">url</span> <span class="o">=</span> <span class="n">x</span><span class="p">,</span> <span class="n">searched</span><span class="o">=</span> <span class="kc">False</span><span class="p">))</span>


    

<span class="k">def</span> <span class="nf">get_cwd</span><span class="p">():</span>
    <span class="n">cwd</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">cwd</span>

<span class="k">def</span> <span class="nf">get_files</span><span class="p">(</span><span class="n">cwd</span> <span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">(),</span> <span class="n">input_directory</span> <span class="o">=</span> <span class="s1">&#39;input&#39;</span><span class="p">):</span>
    
    <span class="n">path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">sep</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">cwd</span><span class="p">,</span><span class="n">input_directory</span><span class="p">])</span>
    <span class="n">file_list</span><span class="o">=</span> <span class="p">[</span><span class="n">f</span> <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">glob</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="n">path</span> <span class="o">+</span> <span class="s2">&#34;**/*.json&#34;</span><span class="p">,</span> <span class="n">recursive</span><span class="o">=</span><span class="kc">True</span><span class="p">)]</span>
  
    <span class="k">return</span> <span class="n">file_list</span>

<span class="k">def</span> <span class="nf">instantiate_neo_model_api</span><span class="p">():</span>
    <span class="n">uri</span> <span class="o">=</span> <span class="s2">&#34;7a92f171.databases.neo4j.io&#34;</span>
    <span class="n">user</span> <span class="o">=</span> <span class="s2">&#34;neo4j&#34;</span>
    <span class="n">psw</span> <span class="o">=</span> <span class="s1">&#39;RF4Gr2IJTNhHlW6HOrLDqz_I2E2Upyh7o8paTwfnCxg&#39;</span>
    <span class="k">return</span> <span class="n">neo</span><span class="o">.</span><span class="n">neoAPI</span><span class="o">.</span><span class="n">instantiate_neo_model_session</span><span class="p">(</span><span class="n">uri</span><span class="o">=</span><span class="n">uri</span><span class="p">,</span><span class="n">user</span><span class="o">=</span><span class="n">user</span><span class="p">,</span><span class="n">psw</span><span class="o">=</span><span class="n">psw</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">prepare_data_pipeline</span><span class="p">():</span>
    <span class="n">pipeline_functions</span> <span class="o">=</span> <span class="n">DataPipelineFunctions</span><span class="p">()</span>
    <span class="n">master_df</span> <span class="o">=</span> <span class="n">pipeline_functions</span><span class="o">.</span><span class="n">load_data_to_pandas_df</span><span class="p">()</span>
    <span class="n">master_df</span><span class="p">[</span><span class="s1">&#39;country_name&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pipeline_functions</span><span class="o">.</span><span class="n">add_country_name</span><span class="p">()</span>
    <span class="n">master_df</span><span class="p">[</span><span class="s1">&#39;country_code&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pipeline_functions</span><span class="o">.</span><span class="n">add_country_code</span><span class="p">()</span>
    <span class="n">master_df</span> <span class="o">=</span> <span class="n">pipeline_functions</span><span class="o">.</span><span class="n">rename_columns</span><span class="p">(</span><span class="n">master_df</span><span class="p">)</span>
    <span class="n">master_df</span><span class="p">[</span><span class="s1">&#39;city_node&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pipeline_functions</span><span class="o">.</span><span class="n">create_city_nodes</span><span class="p">(</span><span class="n">master_df</span><span class="p">)</span>
    <span class="n">master_df</span><span class="p">[</span><span class="s1">&#39;url_node&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pipeline_functions</span><span class="o">.</span><span class="n">create_url_nodes</span><span class="p">(</span><span class="n">master_df</span><span class="p">)</span>
    <span class="n">master_df</span><span class="p">[</span><span class="s1">&#39;root_node&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pipeline_functions</span><span class="o">.</span><span class="n">create_root_nodes</span><span class="p">(</span><span class="n">master_df</span><span class="p">)</span>

    
    <span class="n">master_df_path</span> <span class="o">=</span> <span class="n">pipeline_functions</span><span class="o">.</span><span class="n">write_df_to_csv</span><span class="p">(</span><span class="n">master_df</span><span class="p">,</span><span class="s1">&#39;master_df.csv&#39;</span><span class="p">)</span>

    

    
    <span class="n">state_df</span> <span class="o">=</span> <span class="n">pipeline_functions</span><span class="o">.</span><span class="n">return_unique_state_df</span><span class="p">(</span><span class="n">master_df</span><span class="p">)</span>
    <span class="n">state_df</span><span class="p">[</span><span class="s1">&#39;state_node&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pipeline_functions</span><span class="o">.</span><span class="n">create_state_nodes</span><span class="p">(</span><span class="n">state_df</span><span class="p">)</span>
    <span class="n">state_df_path</span> <span class="o">=</span> <span class="n">pipeline_functions</span><span class="o">.</span><span class="n">write_df_to_csv</span><span class="p">(</span><span class="n">state_df</span><span class="p">,</span><span class="s1">&#39;state_df.csv&#39;</span><span class="p">)</span>
    

    <span class="n">country_df</span> <span class="o">=</span> <span class="n">pipeline_functions</span><span class="o">.</span><span class="n">return_unique_country_df</span><span class="p">(</span><span class="n">master_df</span><span class="p">)</span>
    <span class="n">country_df</span><span class="p">[</span><span class="s1">&#39;country_node&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pipeline_functions</span><span class="o">.</span><span class="n">create_country_nodes</span><span class="p">(</span><span class="n">country_df</span><span class="p">)</span>
    <span class="n">country_df_path</span> <span class="o">=</span> <span class="n">pipeline_functions</span><span class="o">.</span><span class="n">write_df_to_csv</span><span class="p">(</span><span class="n">country_df</span><span class="p">,</span><span class="s1">&#39;country.csv&#39;</span><span class="p">)</span>


    



    <span class="c1">#upload nodes</span>
    
    <span class="k">return</span> <span class="p">{</span><span class="s2">&#34;master_df&#34;</span> <span class="p">:</span> <span class="n">master_df</span><span class="p">,</span> <span class="s1">&#39;state_df&#39;</span> <span class="p">:</span> <span class="n">state_df</span><span class="p">,</span> <span class="s1">&#39;country_df&#39;</span><span class="p">:</span> <span class="n">country_df</span><span class="p">}</span>



<span class="k">def</span> <span class="nf">load_json_data</span><span class="p">(</span><span class="n">file</span><span class="p">):</span>
    <span class="n">f</span> <span class="o">=</span> <span class="nb">open</span> <span class="p">(</span><span class="n">file</span><span class="p">,</span> <span class="s2">&#34;r&#34;</span><span class="p">)</span>
  
    <span class="c1"># Reading from file</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">())</span>
    <span class="k">return</span> <span class="n">data</span>


<span class="k">def</span> <span class="nf">json_pipeline</span><span class="p">(</span><span class="n">file_list</span><span class="p">,</span> <span class="n">master_subject_table</span><span class="p">):</span>
    <span class="n">case_counter</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">for</span> <span class="n">file</span> <span class="ow">in</span> <span class="n">file_list</span><span class="p">:</span>
        
        <span class="n">data</span> <span class="o">=</span> <span class="n">load_json_data</span><span class="p">(</span><span class="n">file</span><span class="o">=</span><span class="n">file</span><span class="p">)</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;results&#39;</span><span class="p">]</span>
        <span class="c1">#pprint(data)</span>
        <span class="c1">#pprint(data[0])</span>
        
        <span class="c1">#filtered_data = filter_json_data(json_data = data, filter = filter)</span>

        <span class="c1"># Creating the case nodes transaction nodes and df</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">clean_json_data</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
        <span class="n">case_data</span> <span class="o">=</span> <span class="n">stringify_json_values</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
        <span class="n">case_data</span> <span class="o">=</span> <span class="n">pandify_case_data</span><span class="p">(</span><span class="n">case_data</span><span class="p">)</span>
        <span class="n">case_data</span> <span class="o">=</span> <span class="n">nodify_case_data</span><span class="p">(</span><span class="n">case_data</span> <span class="o">=</span> <span class="n">case_data</span><span class="p">)</span>
        
        <span class="c1"># Creating the subject nodes transaction nodes and df</span>
        <span class="n">subject_list</span> <span class="o">=</span> <span class="n">slice_subject_data</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
        <span class="n">subject_list</span> <span class="o">=</span> <span class="n">identify_unique_subjects</span><span class="p">(</span><span class="n">subject_list</span><span class="p">)</span>
        <span class="n">subject_lookup_table</span> <span class="o">=</span> <span class="n">create_subject_lookup_table</span><span class="p">(</span><span class="n">subject_list</span><span class="p">)</span>
        <span class="n">master_subject_table</span> <span class="o">=</span> <span class="n">integrate_to_master_table</span><span class="p">(</span><span class="n">subject_lookup_table</span><span class="p">,</span><span class="n">master_subject_table</span><span class="p">)</span>
        <span class="c1">#pprint(master_subject_table.duplicated())</span>
        <span class="n">case_counter</span> <span class="o">=</span> <span class="n">case_counter</span> <span class="o">+</span> <span class="nb">len</span><span class="p">(</span><span class="n">case_data</span><span class="p">)</span>

        <span class="n">master_subject_table</span> <span class="o">=</span> <span class="n">nodify_subjects</span><span class="p">(</span><span class="n">master_subject_table</span><span class="p">)</span>

        <span class="c1">#pprint(case_data)</span>
        <span class="c1">#pprint(master_subject_table[&#39;transaction&#39;])</span>
        <span class="c1">#lets save data to the database</span>

        <span class="n">master_subject_table</span> <span class="o">=</span> <span class="n">submit_subjects_to_db</span><span class="p">(</span><span class="n">master_subject_table</span><span class="p">)</span>
        <span class="n">case_data</span> <span class="o">=</span> <span class="n">submit_cases_to_db</span><span class="p">(</span><span class="n">case_data</span> <span class="o">=</span> <span class="n">case_data</span><span class="p">)</span>

        <span class="c1"># Create Relationships</span>

        <span class="n">relationship_list</span><span class="o">=</span> <span class="n">create_relationship_table</span><span class="p">(</span><span class="n">case_data</span><span class="o">=</span><span class="n">case_data</span><span class="p">,</span> <span class="n">master_subject_table</span><span class="o">=</span><span class="n">master_subject_table</span><span class="p">)</span>
    




<span class="k">def</span> <span class="nf">submit_cases_to_db</span><span class="p">(</span><span class="n">case_data</span><span class="p">):</span>
        <span class="c1">#unsubmitted = master_subject_table[master_subject_table.notna()]</span>

        <span class="c1">### in theory none of the cases wouldhave been submitted becasue i am pulling them from file.  There is no need to check.. Just submit</span>
    <span class="c1">#non_submitted_nodes = case_data[case_data[&#39;submitted&#39;].isna()].copy()</span>
    <span class="c1">#pprint(non_submitted_nodes)</span>
    <span class="c1">##pprint(non_submitted_nodes)</span>
    <span class="c1">#if non_submitted_nodes.empty:</span>
    <span class="c1">#    return case_data</span>
    <span class="c1">#else:</span>
    <span class="n">case_data</span><span class="p">[</span><span class="s1">&#39;transaction&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">case_data</span><span class="p">[</span><span class="s1">&#39;transaction&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">neo</span><span class="o">.</span><span class="n">neoAPI</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">x</span><span class="p">))</span>
    <span class="c1">#Assume all are submitted..</span>
    <span class="n">case_data</span><span class="p">[</span><span class="s1">&#39;submitted&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="c1">#test = non_submitted_nodes.iloc[32][&#39;transaction&#39;]</span>
    <span class="c1">#return_obj = neo.neoAPI.update(test)</span>
    <span class="c1">#case_data.update(non_submitted_nodes)</span>
    <span class="k">return</span> <span class="n">case_data</span>

    <span class="c1">#Relationships must need to be created following saving to the df</span>
    <span class="c1">#relationships = create_relationship_table(case_data, master_subject_table)</span>

<span class="k">def</span> <span class="nf">submit_subjects_to_db</span><span class="p">(</span><span class="n">master_subject_table</span><span class="p">):</span>
    <span class="c1">#unsubmitted = master_subject_table[master_subject_table.notna()]</span>
    <span class="c1">#pprint(master_subject_table)</span>
    <span class="c1">#non_submitted_nodes=master_subject_table[[master_subject_table[&#39;submitted&#39;] == np.nan]]</span>
    <span class="n">non_submitted_nodes</span> <span class="o">=</span> <span class="n">master_subject_table</span><span class="p">[</span><span class="n">master_subject_table</span><span class="p">[</span><span class="s1">&#39;submitted&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">isna</span><span class="p">()]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
    <span class="c1">#pprint(non_submitted_nodes)</span>
    <span class="k">if</span> <span class="n">non_submitted_nodes</span><span class="o">.</span><span class="n">empty</span><span class="p">:</span>   
        <span class="k">return</span> <span class="n">master_subject_table</span>
    <span class="k">else</span><span class="p">:</span>
         <span class="c1">#pprint(non_submitted_nodes)</span>
        <span class="n">non_submitted_nodes</span><span class="p">[</span><span class="s1">&#39;transaction&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">non_submitted_nodes</span><span class="p">[</span><span class="s1">&#39;transaction&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">neo</span><span class="o">.</span><span class="n">neoAPI</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">x</span><span class="p">))</span>
        <span class="n">non_submitted_nodes</span><span class="p">[</span><span class="s1">&#39;submitted&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
    
    <span class="c1">#test = non_submitted_nodes.iloc[32][&#39;transaction&#39;]</span>
    <span class="c1">#return_obj = neo.neoAPI.update(test)</span>
        <span class="n">master_subject_table</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">non_submitted_nodes</span><span class="p">)</span>
        <span class="c1">#pprint(master_subject_table)</span>
        <span class="k">return</span> <span class="n">master_subject_table</span>

<span class="k">def</span> <span class="nf">tester</span><span class="p">():</span>
    <span class="k">return</span> <span class="s2">&#34;Hello Dolly&#34;</span>

<span class="k">def</span> <span class="nf">create_relationship_table</span><span class="p">(</span><span class="n">case_data</span><span class="p">,</span> <span class="n">master_subject_table</span><span class="p">):</span>
    <span class="c1">#pprint(case_data[])</span>
        <span class="c1">#test = master_subject_table[&#39;subject&#39;]</span>
        <span class="c1"># select </span>
    <span class="n">relationship_list</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">case_data</span><span class="p">)):</span>
        <span class="n">unique_dataframe</span> <span class="o">=</span> <span class="p">(</span><span class="n">master_subject_table</span><span class="p">[</span><span class="n">master_subject_table</span><span class="p">[</span><span class="s1">&#39;subject&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">case_data</span><span class="p">[</span><span class="s1">&#39;subject_list&#39;</span><span class="p">][</span><span class="n">row</span><span class="p">])])</span>
        <span class="c1">#pprint(unique_dataframe)</span>
        <span class="k">for</span> <span class="n">subject_row</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">unique_dataframe</span><span class="p">)):</span>
            <span class="n">case</span> <span class="o">=</span> <span class="n">case_data</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">row</span><span class="p">][</span><span class="s1">&#39;transaction&#39;</span><span class="p">]</span>
            <span class="n">subject</span> <span class="o">=</span> <span class="n">unique_dataframe</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">subject_row</span><span class="p">][</span><span class="s1">&#39;transaction&#39;</span><span class="p">]</span>
            <span class="c1">#create relationship</span>
            <span class="c1">#pprint(case)</span>
            <span class="c1">#pprint(subject)</span>
            <span class="n">relationship</span> <span class="o">=</span> <span class="n">neo</span><span class="o">.</span><span class="n">neoAPI</span><span class="o">.</span><span class="n">create_relationship</span><span class="p">(</span><span class="n">case</span><span class="o">.</span><span class="n">subject_relationship</span><span class="p">,</span><span class="n">subject</span><span class="p">)</span>
            <span class="c1">#pprint(relationship)</span>
            <span class="n">relationship_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">relationship</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">relationship_list</span>




        
    <span class="c1">#create relationship between the case and each uid in the unique_data_frame_transaction_list </span>
    <span class="n">pprint</span><span class="p">(</span><span class="n">unique_dataframe</span><span class="p">)</span>


    <span class="c1">## Creating the realation table</span>

    <span class="c1"># Thoughts</span>
    <span class="c1"># pass subject and case table</span>
    <span class="c1"># case_subject list collumn</span>
    <span class="c1"># where that list is in the master table</span>
        <span class="c1">#return  the subjects </span>
    <span class="c1"># make a connection to between each subject and the case in the returned tableuid in the table</span>
    <span class="c1"># return a transaction list </span>
    <span class="c1"># with the list commit a transaction for eachn </span>
    <span class="c1">#</span>

    <span class="c1">#case_data= filter_case_data(data)</span>
<span class="k">def</span> <span class="nf">nodify_case_data</span><span class="p">(</span><span class="n">case_data</span><span class="p">):</span>
    <span class="c1">#non_submitted_nodes = case_data[case_data.notna()]</span>
    <span class="n">non_submitted_nodes</span> <span class="o">=</span> <span class="n">case_data</span><span class="p">[</span><span class="n">case_data</span><span class="o">.</span><span class="n">notna</span><span class="p">()</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)]</span>
    <span class="c1">#pprint(non_submitted_nodes)</span>
    <span class="n">case_nodes</span> <span class="o">=</span> <span class="n">non_submitted_nodes</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span> <span class="p">:</span><span class="n">neo</span><span class="o">.</span><span class="n">neoAPI</span><span class="o">.</span><span class="n">create_case_node</span><span class="p">(</span><span class="n">date</span> <span class="o">=</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;date&#39;</span><span class="p">],</span> <span class="n">dates</span><span class="o">=</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;dates&#39;</span><span class="p">],</span><span class="n">group</span> <span class="o">=</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;group&#39;</span><span class="p">],</span> <span class="n">name</span><span class="o">=</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">],</span> <span class="n">pdf</span><span class="o">=</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;pdf&#39;</span><span class="p">],</span> <span class="n">shelf_id</span> <span class="o">=</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;shelf_id&#39;</span><span class="p">],</span> <span class="n">subject</span><span class="o">=</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;subject&#39;</span><span class="p">],</span> <span class="n">title</span> <span class="o">=</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;title&#39;</span><span class="p">],</span> <span class="n">url</span> <span class="o">=</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;url&#39;</span><span class="p">],</span> <span class="n">subject_relationship</span><span class="o">=</span><span class="kc">True</span><span class="p">),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

    <span class="n">case_data</span><span class="p">[</span><span class="s1">&#39;transaction&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">case_nodes</span>
    <span class="k">return</span> <span class="n">case_data</span>




<span class="k">def</span> <span class="nf">filter_case_data</span><span class="p">(</span><span class="n">data</span><span class="p">):</span>
    <span class="n">pprint</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>



<span class="k">def</span> <span class="nf">nodify_subjects</span><span class="p">(</span><span class="n">master_subject_table</span><span class="p">):</span>
    <span class="n">non_submitted_nodes</span> <span class="o">=</span> <span class="n">master_subject_table</span><span class="p">[</span><span class="n">master_subject_table</span><span class="o">.</span><span class="n">isna</span><span class="p">()</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
    <span class="c1">#df[df.isna().any(axis=1)]</span>
    <span class="c1">#pprint(non_submitted_nodes)</span>
    <span class="n">non_submitted_nodes</span><span class="p">[</span><span class="s1">&#39;transaction&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">non_submitted_nodes</span><span class="p">[</span><span class="s1">&#39;subject&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span> <span class="p">:</span><span class="n">neo</span><span class="o">.</span><span class="n">neoAPI</span><span class="o">.</span><span class="n">create_subject_node</span><span class="p">(</span><span class="n">name</span> <span class="o">=</span> <span class="n">x</span><span class="p">))</span>
    <span class="n">master_subject_table</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">non_submitted_nodes</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">master_subject_table</span>

<span class="k">def</span> <span class="nf">integrate_to_master_table</span><span class="p">(</span><span class="n">subject_lookup_table</span><span class="p">,</span> <span class="n">master_subject_table</span><span class="p">):</span>
    <span class="c1">#check_if subject in list is in subject of the table</span>
    <span class="c1"># if so drop it from the temp table</span>
    <span class="c1"># append what is left to the master table </span>
    <span class="c1">#pprint(subject_lookup_table)</span>
    <span class="n">test</span> <span class="o">=</span> <span class="n">master_subject_table</span><span class="p">[</span><span class="s1">&#39;subject&#39;</span><span class="p">]</span>
    <span class="n">unique_dataframe</span> <span class="o">=</span> <span class="p">(</span><span class="n">subject_lookup_table</span><span class="p">[</span><span class="o">~</span><span class="n">subject_lookup_table</span><span class="p">[</span><span class="s1">&#39;subject&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">test</span><span class="p">)])</span>
    <span class="c1">#pprint(unique_dataframe)</span>
    <span class="c1">#duplicate_list = (master_subject_table[~master_subject_table[&#39;subject&#39;].isin(subject_lookup_table[&#39;subject&#39;])])</span>
    <span class="n">master_subject_table</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">master_subject_table</span><span class="p">,</span><span class="n">unique_dataframe</span><span class="p">])</span>
    <span class="c1">#master_subject_table.update(unique_dataframe)</span>
    <span class="n">master_subject_table</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="c1">#pprint(master_subject_table)</span>
    <span class="c1">#pprint(master_subject_table.duplicated())</span>
    <span class="k">return</span> <span class="n">master_subject_table</span>

<span class="k">def</span> <span class="nf">create_subject_lookup_table</span><span class="p">(</span><span class="n">subject_list</span><span class="p">):</span>
    <span class="n">lookup_table</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">subject_list</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;subject&#39;</span><span class="p">])</span>
    <span class="n">lookup_table</span><span class="p">[</span><span class="s1">&#39;transaction&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>
    <span class="n">lookup_table</span><span class="p">[</span><span class="s1">&#39;submitted&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>
    <span class="k">return</span> <span class="n">lookup_table</span>

<span class="k">def</span> <span class="nf">identify_unique_subjects</span><span class="p">(</span><span class="n">subject_list</span><span class="p">):</span>
    
    <span class="c1"># insert the list to the set</span>
    <span class="n">list_set</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">subject_list</span><span class="p">)</span>
    <span class="c1"># convert the set to the list</span>
    <span class="n">unique_list</span> <span class="o">=</span> <span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">list_set</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">unique_list</span>

<span class="k">def</span> <span class="nf">slice_subject_data</span><span class="p">(</span><span class="n">data</span><span class="p">):</span>
    <span class="n">subject_list</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">case</span> <span class="ow">in</span> <span class="n">data</span><span class="p">:</span>
        <span class="n">subject_list</span> <span class="o">=</span> <span class="n">subject_list</span> <span class="o">+</span> <span class="n">case</span><span class="p">[</span><span class="s1">&#39;subject_list&#39;</span><span class="p">]</span>
    <span class="c1">#pprint(subject_list)</span>
    <span class="k">return</span> <span class="n">subject_list</span>

<span class="k">def</span> <span class="nf">pandify_case_data</span><span class="p">(</span><span class="n">data</span><span class="p">):</span>
    <span class="c1">#case_df = pd.concat(data, sort=False)</span>
    <span class="n">df</span><span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
    <span class="n">df</span><span class="p">[</span><span class="s1">&#39;submitted&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>
    <span class="k">return</span> <span class="n">df</span>
        
<span class="k">def</span> <span class="nf">stringify_json_values</span><span class="p">(</span><span class="n">data</span><span class="p">):</span>
    <span class="k">for</span> <span class="nb">dict</span> <span class="ow">in</span> <span class="n">data</span><span class="p">:</span>
        <span class="n">subject_list</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">[</span><span class="s1">&#39;subject&#39;</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="nb">dict</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="nb">dict</span><span class="p">[</span><span class="n">key</span><span class="p">])</span> <span class="o">==</span> <span class="nb">list</span><span class="p">:</span>
                <span class="n">tmp_list</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="p">(</span><span class="nb">dict</span><span class="p">[</span><span class="n">key</span><span class="p">]):</span>
                    <span class="n">item</span> <span class="o">=</span> <span class="n">item</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&#34; &#34;</span><span class="p">,</span> <span class="s2">&#34;-&#34;</span><span class="p">)</span>
                    <span class="n">tmp_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>
                <span class="nb">dict</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">tmp_list</span>

                <span class="nb">dict</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&#34;,&#34;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">dict</span><span class="p">[</span><span class="n">key</span><span class="p">])</span>
        <span class="nb">dict</span><span class="p">[</span><span class="s1">&#39;subject_list&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">subject_list</span>

                
    <span class="k">return</span> <span class="n">data</span>
                

    <span class="c1">#pprint(data)</span>

<span class="k">def</span> <span class="nf">clean_json_data</span><span class="p">(</span><span class="n">filtered_data</span><span class="p">):</span>
    <span class="c1"># Select the keys that I want from the dictionary</span>
    <span class="c1"># filter appropriatly into a df </span>
    <span class="c1"># write df to file</span>
    <span class="c1">#print(type(filtered_data))</span>
    <span class="c1">#pprint(filtered_data)</span>
    <span class="k">for</span> <span class="n">data</span> <span class="ow">in</span> <span class="n">filtered_data</span><span class="p">:</span>
        <span class="c1">#pprint(data)</span>
        <span class="c1">#creat a dictionary of columns and values for each row.  Combine them all into a df when we are done</span>
        <span class="c1"># each dictionary must be a row.... which makes perfect sense, but they can not be nested... </span>
        <span class="n">item</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;item&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="n">resources</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;resources&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="n">index</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;index&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="n">language</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;language&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="n">online_format</span><span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;online_format&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="n">original_format</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;original_format&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="n">kind</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;type&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="n">image_url</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;image_url&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="n">hassegments</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;hassegments&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="n">extract_timestamp</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;extract_timestamp&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="n">timestampe</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;timestamp&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="n">mimetype</span><span class="o">=</span><span class="n">data</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;mime_type&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">pdf</span> <span class="o">=</span> <span class="n">resources</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;pdf&#39;</span><span class="p">]</span>
        <span class="k">except</span><span class="p">:</span> 
            <span class="n">pdf</span> <span class="o">=</span> <span class="s2">&#34;noPdf&#34;</span>
        <span class="n">data</span><span class="p">[</span><span class="s2">&#34;pdf&#34;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pdf</span>
        <span class="n">data</span><span class="p">[</span><span class="s1">&#39;search_index&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">index</span>
    


    <span class="c1"># convert to strings maybe move into another function to be called.  Actually will definitely move to a nother function </span>

    <span class="k">return</span> <span class="n">filtered_data</span>
    <span class="c1">#uid = UniqueIdProperty()</span>
    <span class="c1">##date = date</span>
    <span class="c1">#dates = dates</span>
    <span class="c1">#group = group</span>
    <span class="c1">#id = id </span>
    <span class="c1">#pdf = pdf </span>
    <span class="c1">#shelf_id = shelf_id</span>
    <span class="c1">#subject = subject</span>
    <span class="c1">#primary_topic = primary_topic</span>
    <span class="c1">#title = title</span>
    <span class="c1">#url = url</span>
    <span class="c1">#description = description</span>
    <span class="c1">#source_collection = source_collection</span>




<span class="k">def</span> <span class="nf">filter_json_data</span><span class="p">(</span><span class="n">json_data</span><span class="p">,</span> <span class="nb">filter</span><span class="p">):</span>
    <span class="c1"># Using dict()</span>
    <span class="c1"># Extracting specific keys from dictionary</span>

    <span class="nb">filter</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;contributor&#39;</span><span class="p">,</span><span class="s1">&#39;date&#39;</span><span class="p">,</span> <span class="s1">&#39;dates&#39;</span><span class="p">,</span> <span class="s1">&#39;digitized&#39;</span><span class="p">]</span>
    <span class="n">res</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">((</span><span class="n">k</span><span class="p">,</span> <span class="n">json_data</span><span class="p">[</span><span class="n">k</span><span class="p">])</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">filter</span> <span class="k">if</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">json_data</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">res</span>

<span class="k">def</span> <span class="nf">create_master_subject_table</span><span class="p">():</span>
    <span class="n">table</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">()</span>
    <span class="n">table</span><span class="p">[</span><span class="s1">&#39;subject&#39;</span><span class="p">]</span><span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>
    <span class="n">table</span><span class="p">[</span><span class="s1">&#39;transaction&#39;</span><span class="p">]</span><span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>
    <span class="n">table</span><span class="p">[</span><span class="s1">&#39;submitted&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>
    <span class="k">return</span><span class="p">(</span><span class="n">table</span><span class="p">)</span>

<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&#34;__main__&#34;</span><span class="p">:</span>
    <span class="n">neo_applified</span> <span class="o">=</span> <span class="n">instantiate_neo_model_api</span><span class="p">()</span>
    <span class="n">cwd</span> <span class="o">=</span> <span class="n">get_cwd</span><span class="p">()</span>
    <span class="n">file_list</span> <span class="o">=</span> <span class="n">get_files</span><span class="p">(</span><span class="n">cwd</span> <span class="o">=</span> <span class="n">cwd</span><span class="p">)</span>
    <span class="n">master_subject_table</span> <span class="o">=</span> <span class="n">create_master_subject_table</span><span class="p">()</span>
    <span class="n">json_pipeline</span><span class="p">(</span><span class="n">file_list</span><span class="o">=</span><span class="n">file_list</span><span class="p">,</span> <span class="n">master_subject_table</span><span class="o">=</span><span class="n">master_subject_table</span><span class="p">)</span>
    
    <span class="c1">#neo_sandbox_app = instantiate_neo_sandbox_app()</span>
    <span class="c1">#google_creds = load_google_creds()</span>
    <span class="c1">#sheets_app = instantiate_sheets_app(google_creds.credentials)</span>
    <span class="c1">#drive_app = instantiate_drive_app(google_creds.credentials)</span>
    <span class="c1">#googleAPI = instantiate_google_API()</span>
    <span class="c1">#sparkAPI = instantiate_spark_API()</span>
    <span class="c1">#neoAPI = NeoAPI()</span>
    <span class="c1">#nodified_df = pandas_functions.nodify_dataframe()</span>
    <span class="c1">#test()</span>
    <span class="c1">#google_api = googleServices.GoogleAPI()</span>
    <span class="c1">###neo_model_api = instantiate_neo_model_api()</span>
    <span class="c1">###df_pipeline_dictionary = prepare_data_pipeline()</span>
    <span class="c1">#final_df_dictionary = upload_data_pipeline_to_neo(df_pipeline_dictionary)</span>
    <span class="c1">#for k,v in final_df_dictionary.items():</span>
    <span class="c1">#    cwd = os.getcwd()</span>
    <span class="c1">#    path = str(k) +&#34;Final&#34;</span>
    <span class="c1">#    path = os.sep.join([cwd,path])</span>

     <span class="c1">#   with open(path, &#34;w&#34;) as file:</span>
     <span class="c1">#       v.to_csv(path, index=False)</span>

    <span class="c1">#prepared_dfs = prepare_pandas_df()</span>
    <span class="c1">#pprint(prepared_df)</span>
    <span class="c1">#upload_df_to_db(df = prepared_df, neo_model_api = neo_model_api)</span>

</code></pre></div>
			</div>

<div class="related-posts thin">
	<h2></h2>
	<ul>
	
	<li><a href="jnapolitano.com/posts/legal-research-part-0/">Conduct Legal Research with AI: Part 0</a></li>
	
	<li><a href="jnapolitano.com/posts/feasibility_study_shipping_carbon/">Feasibility of Transatlantic Carbon Shipping</a></li>
	
	<li><a href="jnapolitano.com/posts/carbon-shipping-projections/">Monte Carlo Projection of the Annual Cost of Shipping Carbon from Europe to the United States</a></li>
	
	<li><a href="jnapolitano.com/posts/wells-near-ports/">Potential Carbon and Hydrogen Storage Facilities Near Import/Export Ports</a></li>
	
	<li><a href="jnapolitano.com/posts/wells-near-pipelines/">Potential Carbon and Hydrogen Storage Wells Near Pipelines</a></li>
	
	</ul>
</div>

		</article>
		<div class="post-nav thin">
			<a class="next-post" href="jnapolitano.com/posts/legal-reserch-part-2/">
				<span class="post-nav-label"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-arrow-left"><line x1="19" y1="12" x2="5" y2="12"></line><polyline points="12 19 5 12 12 5"></polyline></svg>&nbsp;</span><br><span>Conduct Legal Research with AI: Part 2</span>
			</a>
			<a class="prev-post" href="jnapolitano.com/posts/legal-research-part-0/">
				<span class="post-nav-label">&nbsp;<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-arrow-right"><line x1="5" y1="12" x2="19" y2="12"></line><polyline points="12 5 19 12 12 19"></polyline></svg></span><br><span>Conduct Legal Research with AI: Part 0</span>
			</a>
		</div>
		<div id="comments" class="thin"></div>
	</main>

<footer id="site-footer" class="section-inner thin animated fadeIn faster">
	<p>
		&copy; 2024 <a href="jnapolitano.com">Justin Napolitano</a>
		&#183; JAYBURDINDUSTRIES
		&#183; Made with <a href="https://gohugo.io/" target="_blank" rel="noopener">Hugo</a>
		&#183; Theme <a href="https://github.com/1bl4z3r/hermit-V2" target="_blank" rel="noopener">Hermit-V2</a></p>

</footer>
<script async src="/jnapolitano.com/js/bundle.min.5034a061023fdc1bbf821910f95d3bda81bc68ba039a2c1202f0d7027638e80f.js" integrity="sha256-UDSgYQI/3Bu/ghkQ+V072oG8aLoDmiwSAvDXAnY46A8=" crossorigin="anonymous"></script><script async src="/jnapolitano.com/js/link-share.min.20ddc5b895a2cb52c811efd9bcf38168838be5cb8671b12ae2997bf38c34f9f0.js" integrity="sha256-IN3FuJWiy1LIEe/ZvPOBaIOL5cuGcbEq4pl784w0+fA=" crossorigin="anonymous"></script>
</body>

</html>
