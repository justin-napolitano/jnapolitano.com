<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom">
	<channel>
		<title>Posts on Justin Napolitano</title>
		<link>jnapolitano.com/posts/</link>
		<description>Recent content in Posts on Justin Napolitano</description>
		<generator>Hugo -- gohugo.io</generator>
		<language>en-us</language>
		<managingEditor>personal.jnapolitano@gmail.com (Justin Napolitano)</managingEditor>
		<webMaster>personal.jnapolitano@gmail.com (Justin Napolitano)</webMaster>
		<copyright>jayburdindustries</copyright>
		<lastBuildDate>Wed, 24 Apr 2024 17:23:50 -0500</lastBuildDate>
		<atom:link href="jnapolitano.com/posts/index.xml" rel="self" type="application/rss+xml" />
		
		<item>
			<title>Love is Hard</title>
			<link>jnapolitano.com/posts/love-is-hard/</link>
			<pubDate>Thu, 04 Jul 2024 00:00:00 +0000</pubDate>
			<guid>jnapolitano.com/posts/love-is-hard/</guid>
			<description><![CDATA[To will the good in the other while pretending like my feelings do not matter]]></description>
			<content type="html"><![CDATA[<h1 id="to-will-the-good-in-the-other">To Will The Good In The Other</h1>
<p>I watched a youtube video once about &ldquo;what is love?&rdquo;. I listened to a Roman Catholic Bishop discuss St. Thomas Acquinas' understanding of love. To will the good in the other.. to let go of oneself in order to will for good in the person that one loves. This is hard.</p>
<h2 id="love-is-hard">Love is Hard</h2>
<p>I am living through one of those periods in my life where I have to overcome myself in order to meet the demands of reality.  I think to me this means that what I want is not necessarily what God will give. It sucks.</p>
<h2 id="connection">Connection</h2>
<p>I want more than just a connection. I want to feel fullfilled. I want more from life than consumption, fucking, and instagram stories. Maybe there is nothing more? I do not know anymore.</p>
<h2 id="a-family">A family</h2>
<p>I would love a family. I have wanted my own.. I have had my own.  I am a fool for running away from it.. but I am a fool with sense of self respect. I might just be trying to rationalize my behavior here. Self respect might just be arrogance in disguise.</p>
<h2 id="cancer">Cancer</h2>
<p>I do feel condemned. I want a wife.. I want children.. I want a family.. Moreso than anyting in my life.. I want a family. A family that will inherit my condemnation.  It feels wrong.</p>
<h2 id="peace">Peace</h2>
<p>There might be a sense of peace I can find in myself if I forgo a family. If I forgo chasing a dream that is not meant to be, I might find some peace. I fear however I will die alone.. Fuck I will die again.. this time without my mother by my side.</p>
<h2 id="and-so-it-goes">And So It Goes</h2>
<p>And what am I to do? Life is hard.. Love is hard.. God is cold.. We all die alone.. Even if surrounded by the ones we love. So accept things as they are.. smile.. and put another foot in front of the other. Be thankful for those two feet.</p>
]]></content>
			<postid> 6324226c8692e88c753e638723e24865</postid>
			<author>Justin Napolitano</author>
			<author_name>Justin Napolitano</author_name>
			<author_email>personal.jnapolitano@gmail.com</author_email>
			<author_id>87654367b2fca109e7dc9d3ea8a1ebbaf0bfe374773b148c2c20d278479add99</author_id>			
		</item>
		
		<item>
			<title>Automate Posting Hugo Blog to Social Sites (with a db)</title>
			<link>jnapolitano.com/posts/hugo-rss-mysql-update/</link>
			<pubDate>Sun, 30 Jun 2024 00:00:00 +0000</pubDate>
			<guid>jnapolitano.com/posts/hugo-rss-mysql-update/</guid>
			<description><![CDATA[How To automate posting to social sites]]></description>
			<content type="html"><![CDATA[<h2 id="background">Background</h2>
<p>In the previous few posts I detailed my progress in automating a site.  I am going about this by using an rss scraper to post new posts to social.</p>
<p>I had initally thought about doing this really naively, but I want a database. It doesn&rsquo;t feel right without using one. I am somewhat upset with myself, because I am basically just recreating wordpress&hellip; but so it goes.</p>
<h3 id="previous-posts-in-this-series">Previous posts in this series</h3>
<ol>
<li><a href="https://jnapolitano.com/en/posts/hugo-social-publisher/">part 1</a></li>
<li><a href="https://jnapolitano.com/en/posts/python-rss-reader/">part 2</a></li>
<li><a href="https://jnapolitano.com/en/posts/mysql-install-buntu/">part 3</a></li>
<li><a href="https://jnapolitano.com/en/posts/mysql-config/">part 4</a></li>
<li><a href="https://jnapolitano.com/en/posts/hugo-rss-setup/">part 5</a></li>
</ol>
<h3 id="expand-a-previous-script">Expand a previous script</h3>
<p>In <a href="https://jnapolitano.com/en/posts/python-rss-reader/">a previous post</a> I wrote about how to scan an rss feed on my personal site. In this post I will expand upon that to update some tables in a mysql database that I generated in <a href="https://jnapolitano.com/en/posts/mysql-config/">this post</a></p>
<h2 id="add-support-for-mysql">Add support for mysql</h2>
<h3 id="mysql-python-connector-manual">MySQL python connector manual</h3>
<ul>
<li><a href="https://dev.mysql.com/doc/connector-python/en/connector-python-introduction.html">https://dev.mysql.com/doc/connector-python/en/connector-python-introduction.html</a></li>
</ul>
<h3 id="instal-connector-with-pip">Instal connector with pip</h3>
<p>I created a virtual enviornment prior to starting this exercise. Review the <a href="https://virtualenv.pypa.io/en/latest/">virtualenv documentation</a> for more information.  The source below is my path to thevirtualenviornment&rsquo;s bin.</p>
<p>I am install the connector and the xdev extensions. TBH I do not know what the extensions are but i&rsquo;m just going to go ahead and install them now before i write a script that ends up needing those extra libs.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash">
<span class="nb">source</span> ~/venvs/feedparser/bin/activate <span class="o">&amp;&amp;</span> pip install mysql-connector-python <span class="o">&amp;&amp;</span> pip install mysqlx-connector-python

</code></pre></div><h3 id="install-python-dotenv-with-pip">Install python-dotenv with pip</h3>
<p>I plan to containerize this later. Using .env files formt he start will be a good way of making this portable later.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash">
pip install python-dotenv

</code></pre></div><h3 id="create-a-env-file-with-your-environmental-variables">Create a .env file with your environmental variables</h3>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash">touch .env
</code></pre></div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash">vim .env
</code></pre></div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-vim" data-lang="vim"><span class="err">
</span><span class="err"></span><span class="nx">DB_USER</span><span class="p">=</span><span class="nx">cobra</span> <span class="err">
</span><span class="err"></span><span class="nx">DB_PASSWORD</span><span class="p">=</span><span class="nx">password</span><span class="err">
</span><span class="err"></span><span class="nx">DB_HOST</span><span class="p">=</span><span class="m">127</span>.<span class="m">0</span>.<span class="m">0</span>.<span class="m">1</span><span class="err">
</span><span class="err"></span><span class="nx">DB_NAME</span><span class="p">=</span><span class="nx">posts</span><span class="err">
</span><span class="err">
</span></code></pre></div><h3 id="create-a-utility-class-to-be-able-to-reuse-this-code">Create a utility class to be able to reuse this code</h3>
<h4 id="connector-method-reference">connector method reference</h4>
<p><code>https://dev.mysql.com/doc/connector-python/en/connector-python-api-mysqlconnection.html</code></p>
<p>Something like below is a good way to get started.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="kn">import</span> <span class="nn">mysql.connector</span>
<span class="kn">from</span> <span class="nn">mysql.connector</span> <span class="kn">import</span> <span class="n">Error</span>
<span class="kn">from</span> <span class="nn">dotenv</span> <span class="kn">import</span> <span class="n">load_dotenv</span>
<span class="kn">import</span> <span class="nn">os</span>

<span class="k">class</span> <span class="nc">MySQLConnector</span><span class="p">:</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">user</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span><span class="s1">&#39;DB_USER&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">password</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span><span class="s1">&#39;DB_PASSWORD&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">host</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span><span class="s1">&#39;DB_HOST&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">database</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span><span class="s1">&#39;DB_NAME&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connection</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="k">def</span> <span class="nf">connect</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">connection</span> <span class="o">=</span> <span class="n">mysql</span><span class="o">.</span><span class="n">connector</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span>
                <span class="n">user</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">user</span><span class="p">,</span>
                <span class="n">password</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">password</span><span class="p">,</span>
                <span class="n">host</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">host</span><span class="p">,</span>
                <span class="n">database</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">database</span>
            <span class="p">)</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">connection</span><span class="o">.</span><span class="n">is_connected</span><span class="p">():</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&#34;Connected to MySQL database&#34;</span><span class="p">)</span>
        <span class="k">except</span> <span class="n">Error</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&#34;Error while connecting to MySQL: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&#34;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">disconnect</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">connection</span><span class="o">.</span><span class="n">is_connected</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">connection</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&#34;MySQL connection is closed&#34;</span><span class="p">)</span>

<span class="c1"># Usage example</span>
<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&#34;__main__&#34;</span><span class="p">:</span>
    <span class="n">load_dotenv</span><span class="p">()</span>  <span class="c1"># Load environment variables from .env file</span>
    <span class="n">db</span> <span class="o">=</span> <span class="n">MySQLConnector</span><span class="p">()</span>
    <span class="n">db</span><span class="o">.</span><span class="n">connect</span><span class="p">()</span>
    <span class="n">db</span><span class="o">.</span><span class="n">disconnect</span><span class="p">()</span>

</code></pre></div><h3 id="verify-that-your-server-is-running">Verify that your server is running</h3>
<p>run..on most *nix-ish systems</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash">
systemctl status mysql

</code></pre></div><h3 id="run-your-test-program">Run your test program</h3>
<blockquote>
<blockquote>
<p>Note do not call your class mysql.py&hellip; it will overwride the library and fail to import.</p>
</blockquote>
</blockquote>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash">
python db-connector.py

</code></pre></div><h4 id="output">Output</h4>
<p>The output should look somethign like this&hellip;</p>
<p><img src="./images/test-output.png" alt="successful-test"></p>
]]></content>
			<postid> 57263d501cf48daefc0c643dc4793a48</postid>
			<author>Justin Napolitano</author>
			<author_name>Justin Napolitano</author_name>
			<author_email>personal.jnapolitano@gmail.com</author_email>
			<author_id>87654367b2fca109e7dc9d3ea8a1ebbaf0bfe374773b148c2c20d278479add99</author_id>			
		</item>
		
		<item>
			<title>Everything Matters</title>
			<link>jnapolitano.com/posts/todo_es_sacre/</link>
			<pubDate>Sun, 30 Jun 2024 00:00:00 +0000</pubDate>
			<guid>jnapolitano.com/posts/todo_es_sacre/</guid>
			<description><![CDATA[Every action matters]]></description>
			<content type="html"><![CDATA[<h2 id="why-am-i-writing-this">Why am I writing this</h2>
<p>I think that everything&hellip; literally every detail is important.</p>
<h3 id="everything-matters">Everything Matters</h3>
<p>I do not know if this a radical idea. From my experience, I recall people saying to me&hellip; &ldquo;it is fine&rdquo;, &ldquo;it is good enough&rdquo;, &ldquo;that doesn&rsquo;t matter&rdquo;&hellip; I disagree.  To me, every individual detail matters. The context of a situation or the state of an environment at any given state in time influences my mind.. and the mind of others subject to that state.</p>
<h3 id="everything-is-sacred">Everything is Sacred</h3>
<p>Taking this one step further&hellip; there is something to treating every single detail as sacred.  I was raised as a catholic.  I think back to the reverence to the host (until recently I had thought this to be absurd) I experienced as a child.  I truly believed that the body of god was present in that bread. I think in a way it truly is.</p>
<p>No I do not mean that the body and blood is physically transmutated&hellip; but by believing that it does might be enough.</p>
<p>I do not know what I mean by god. I cannot rationalize anthropomorphic god. I cannot imagine a being with will&hellip; but I think there is something out there. I want to claim god is the eternal reason of the universe&hellip; but I do not mean this. I really do not know what is god.</p>
<p>Anyways, due to the influence of others I forwent that reverence. I let myself approach the world in a way that treats objects as meaningless. That removes the blood and the toil required construct a glass bottle&hellip; to build and design a computer&hellip; I treat these things as disposable&hellip; In truth I think that a bit of our soul.. our lifeblood.. whatever it is imprinted upon everything. It is unlikely that god has willed that to be. That we really possess a soul&hellip; but if I take one step away from religion.. the structures and systems that permit society and life to function are real.  A glass bottle for instance exists because of countless technological advances, social organization, toil, and the consumption of energy. Those interactions are just as real as the bottle itself. To separate the two is I think wrong.</p>
<p>Building upon this, all of the information exchanged to permit this bottle to exist at this moment in time is real. It still exists. That energy has passed elsewhere sure, but it exists in some way. There is a memory of it somewhere along the supply line.  There is some memory of a machine operator removing the silica from the earth.  I would like to eliminate these externalities from the being of the bottle.. but I do not think that is fair.</p>
<p>So back to treating it as sacred. Why? I think the way I treat this inanimate object will reflect upon how I treat human beings, the environment, and animals.  I want to treat things as gifts to me. As sacred in a way. Yeah, I understand that there are things that are meant to be disposable&hellip; that change and entropy are constants that I cannot control.. Fair, but that said so are consequences. There is a consequence to treating things poorly. There is a consequence to treating people poorly.  There is a consequence to treating the environment poorly.</p>
<p>I do not know what means good nor evil. I do not even want to start down that path&hellip;. I think in simple terms what I am trying to convey is that there are consequences to every action</p>
]]></content>
			<postid> 7af589f26cc6db6efdb10392ee3fc7e6</postid>
			<author>Justin Napolitano</author>
			<author_name>Justin Napolitano</author_name>
			<author_email>personal.jnapolitano@gmail.com</author_email>
			<author_id>87654367b2fca109e7dc9d3ea8a1ebbaf0bfe374773b148c2c20d278479add99</author_id>			
		</item>
		
		<item>
			<title>Smoking Cigarettes... Again</title>
			<link>jnapolitano.com/posts/cigarettes_again/</link>
			<pubDate>Sun, 30 Jun 2024 00:00:00 +0000</pubDate>
			<guid>jnapolitano.com/posts/cigarettes_again/</guid>
			<description><![CDATA[Another cigarrette before I hit the road]]></description>
			<content type="html"><![CDATA[<h1 id="smoking-cigarettes-again">Smoking Cigarettes&hellip; Again</h1>
<p>Yesterday <a href="https://jnapolitano.com/en/posts/cigarettes/">I wrote about smoking cigarettes and going out</a>. I had told myself I was over it&hellip;.</p>
<h2 id="a-date-before-i-leave-town">A Date Before I Leave Town</h2>
<p>I had coffee with someone that I am interested before taking off on a road trip to Colorado.  At the root of it I think I am attracted to her. I can come up with a number of reasons why.. but I do not really know.</p>
<h2 id="coffee">Coffee</h2>
<p>I had a few cups of coffee during the date&hellip; actually as I write this I am drinking another espresso&hellip;  I like stimulants.  I am addicted already to caffeine. Anything stronger I feel will ruin me.</p>
<h2 id="what-do-i-want">What Do I Want</h2>
<p>You know&hellip; I do not know.  I think about what I want to do and only regurgitate what I think I should do. I want to act more authentically but I do not know if there really is an authentic self to satisfy. I might.. just might have the agency to create myself through my actions.. but really I am subject to my biology and my social setting. I am a product of factors beyond my control. I do not know if it is possible to really satisfy  myself.. my self may not really exist.</p>
<h2 id="cigarettes-again">Cigarettes&hellip; again</h2>
<p>So here I am&hellip;. listening to the man in black sing about the down and out&hellip; the poor without anything to eat&hellip; the usual. Is it a worthy pursuit to represent those that cannot represent themselves? I like the idea of justice. I hate the fact that people take advantage of others..</p>
<p>A cigarette down. The cigarettes I left on the parking barrier last night&hellip; hoping a vagabond (idk the correct terminology now) would pick them up. They did not. I found them. I smoked a cig&hellip; I feel like a clown&hellip; I considered the executives in Winston Salem smirking because I bought the propaganda they put out to help me justify smoking this brand&hellip; Regardless I hit it again and again&hellip; I took it to the filter&hellip;</p>
]]></content>
			<postid> e45477e43187b6b33ba110dad55b8f71</postid>
			<author>Justin Napolitano</author>
			<author_name>Justin Napolitano</author_name>
			<author_email>personal.jnapolitano@gmail.com</author_email>
			<author_id>87654367b2fca109e7dc9d3ea8a1ebbaf0bfe374773b148c2c20d278479add99</author_id>			
		</item>
		
		<item>
			<title>Eating Raising Canes</title>
			<link>jnapolitano.com/posts/raising_canes/</link>
			<pubDate>Sat, 29 Jun 2024 00:00:00 +0000</pubDate>
			<guid>jnapolitano.com/posts/raising_canes/</guid>
			<description><![CDATA[Raising canes is disgusting]]></description>
			<content type="html"><![CDATA[<h2 id="why-am-i-writing-this">Why am I writing this</h2>
<p>Tonight, I mistreated my body.  I had raising Canes. I feel disgusting.</p>
<h3 id="food-review">Food review</h3>
<p>I tried the combo box - a massive amount of french fries served with coleslaw, some bread, and some chicken tenders.</p>
<h4 id="the-fries">The Fries</h4>
<p>They were fries - the crinkle cut variety- fried up in old grease.  They tasted like typical fries, but the oil was so old that the fries tasted like the grease underneath the lunch room tables you&rsquo;d find a public high school.  I ate them.  I was hungry. God forgive me,</p>
<h4 id="the-bread">The Bread</h4>
<p>The bread wasn&rsquo;t bad. I do not know what they put on it, but it wasn&rsquo;t bad.</p>
<h4 id="the-slaw">The Slaw</h4>
<p>I skipped it. I had already eaten too much food and felt disgusted with myself for it.</p>
<h4 id="the-tenders">The Tenders</h4>
<p>The tenders were very plain and very dry. I am trying to be fair, but I could have gotten much better tenders from Costco for a fraction of the cost in the frozen food section.</p>
<h4 id="the-caines-sauce">The Caine&rsquo;s Sauce</h4>
<p>It is just mayo and ketchup.</p>
<h3 id="how-i-feel">How I feel</h3>
<p>I feel disgusted with myself&hellip; but atop of that I feel scammed. The food I ate was overpriced, disgusting, and unhealthy.  I feel as if the company is exploiting and poisoning people.  I feel exploited. I did not need to go this place to eat.  I failed to plan and ended up there.  Many people just eat this type of food. God help them.</p>
<h2 id="next-time">Next time</h2>
<p>I always say, &ldquo;next time I will plan better..&rdquo; We shall see if that actually happens.  I need to stock up on nuts and easy to store grains.  I cannot eat this type of garbage.  Recently I have been eating McDonalds and fast food because I am not in my own home.  I will brake this pattern before it becomes a habit.  These establishments horrifically exploit people.  I no longer want to be subject to the scam. I do not want to empower them further. I do not want to give them my energy.</p>
]]></content>
			<postid> 02b536a635738571fb2c7c4849661ff1</postid>
			<author>Justin Napolitano</author>
			<author_name>Justin Napolitano</author_name>
			<author_email>personal.jnapolitano@gmail.com</author_email>
			<author_id>87654367b2fca109e7dc9d3ea8a1ebbaf0bfe374773b148c2c20d278479add99</author_id>			
		</item>
		
		<item>
			<title>Configure Hugo XML Output for RSS Feed</title>
			<link>jnapolitano.com/posts/hugo-rss-setup/</link>
			<pubDate>Fri, 28 Jun 2024 00:00:00 +0000</pubDate>
			<guid>jnapolitano.com/posts/hugo-rss-setup/</guid>
			<description><![CDATA[Hugo Custom RSS for my reader]]></description>
			<content type="html"><![CDATA[<h2 id="why">Why</h2>
<p>I have a mysql db that will be used to store values read from the rss feed of my hugo site. I need some add some keys to help with organization</p>
<h3 id="parts-of-this-series">Parts of this series</h3>
<ol>
<li><a href="https://jnapolitano.com/en/posts/hugo-social-publisher/">part 1</a></li>
<li><a href="https://jnapolitano.com/en/posts/python-rss-reader/">part 2</a></li>
<li><a href="https://jnapolitano.com/en/posts/mysql-install-buntu/">part 3</a></li>
<li><a href="https://jnapolitano.com/en/posts/mysql-config/">part 4</a></li>
</ol>
<h2 id="resources">Resources</h2>
<ul>
<li><a href="https://gohugo.io/content-management/page-resources/">Hugo Page Resources</a></li>
<li><a href="https://gohugo.io/methods/page/params/">Hugo Page Params</a></li>
<li><a href="https://gohugo.io/templates/rss/">Hugo RSS Templates</a></li>
</ul>
<h2 id="rss-config">RSS Config</h2>
<h3 id="copy-over-the-postsrssxml-file-from-your-theme">Copy over the posts/rss.xml file from your theme</h3>
<p>From hugo root you would do something like&hellip;</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash">
mkdir layouts <span class="o">&amp;&amp;</span> mkdir layouts/posts <span class="o">&amp;&amp;</span> cp themes/<span class="o">[</span>theme<span class="o">]</span>/layouts/posts/index.xml

</code></pre></div><h3 id="modify-the-rssxml-file">Modify the rss.xml file</h3>
<h4 id="add-post-id">Add post id</h4>
<p>Hugo supports a hash of the files path. It is not always unique&hellip; but for my purposes it will likely be good enough.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-xml" data-lang="xml"><span class="nt">&lt;postid&gt;</span> {{ .File.UniqueID }}<span class="nt">&lt;/postid&gt;</span>
</code></pre></div><h4 id="add-the-authors-name-when-defined">Add the author&rsquo;s name when defined</h4>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-xml" data-lang="xml">{{ with .Site.Params.author.name }}<span class="nt">&lt;author_name&gt;</span>{{.}}<span class="nt">&lt;/author_name&gt;</span>{{end}}
</code></pre></div><h4 id="add-the-author-email-when-defined">Add the author email when defined</h4>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-xml" data-lang="xml">
      {{ with .Site.Params.author.email }}<span class="nt">&lt;author_email&gt;</span>{{.}}<span class="nt">&lt;/author_email&gt;</span>{{end}}
</code></pre></div><h4 id="add-a-hash-of-the-author-email-when-defined">Add a hash of the author email when defined</h4>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-xml" data-lang="xml">{{ with .Site.Params.author.email }}<span class="nt">&lt;author_id&gt;</span>{{sha256 .}}<span class="nt">&lt;/author_id&gt;</span>{{end}}
</code></pre></div><h4 id="the-entire-file">The entire file</h4>
<p>The most up to date rss file is found at <a href="https://github.com/justin-napolitano/jnapolitano.com/blob/main/layouts/posts/rss.xml">this github link</a></p>
]]></content>
			<postid> 919e738a843baf19044479d6451528eb</postid>
			<author></author>
			<author_name>Justin Napolitano</author_name>
			<author_email>personal.jnapolitano@gmail.com</author_email>
			<author_id>87654367b2fca109e7dc9d3ea8a1ebbaf0bfe374773b148c2c20d278479add99</author_id>			
		</item>
		
		<item>
			<title>Embrace Mundanity</title>
			<link>jnapolitano.com/posts/embrace_mundanity/</link>
			<pubDate>Fri, 28 Jun 2024 00:00:00 +0000</pubDate>
			<guid>jnapolitano.com/posts/embrace_mundanity/</guid>
			<description><![CDATA[or how to stop fearing and love the bs]]></description>
			<content type="html"><![CDATA[<h2 id="why">Why</h2>
<p>Life is hard enough. Do not chase glory.</p>
<h3 id="what-do-i-mean">What do I mean</h3>
<p>Life is hard enough. Every single act within my daily life is incredibly difficult.  I am nearly 30 years old and still have to force myself to brush my teath every day, to shower, to eat a few square meals a day.  These little daily tasks that are truly important to our health and wellbeing are by far the most difficult and sometimes the least prioritized.</p>
<h3 id="what-should-i-do">What should I do</h3>
<p>I don&rsquo;t know. I always say this, but I really do not know. I do not think I can define simple maxim to follow in every situation. I would love for life to be that simple&hellip; but I know in reality that there are many externalities often beyond my control&hellip; but what can I can control?</p>
<h3 id="my-daily-tasks">My daily tasks</h3>
<h4 id="morning-routine">Morning routine</h4>
<h5 id="what-is-my-actual-routine">What is my actual routine</h5>
<ol>
<li>I check my phone for the time</li>
<li>I stop myself from reading messages</li>
<li>I close my eyes again</li>
<li>I wake up an hour later</li>
<li>I use the restroom</li>
<li>I wash my face</li>
<li>I brush my teeth</li>
<li>I make my hair</li>
<li>I down a cup a coffee</li>
<li>I catch up on messages</li>
<li>I read the news</li>
<li>I start tackling the tasks I have to do to maintain my quality of life</li>
</ol>
<h5 id="what-would-i-like-my-routine-to-be">What would I like my routine to be</h5>
<ol>
<li>I jump out of bed at the crack of dawn.</li>
<li>I drop and do 100 pushups</li>
<li>I do 100 squats</li>
<li>I run 2 miles.</li>
<li>I shower.</li>
<li>I do the usual washing and tidying routine.</li>
</ol>
<h5 id="why-do-i-not-accomplis-my-ideal">Why do I not accomplis my ideal</h5>
<p>I&rsquo;ve become accustomed to my lazy routine. I have accepted it. I like it.</p>
<h5 id="can-i-change-my-moring-routine">Can I change my moring routine</h5>
<p>Yeah&hellip; BUt how.</p>
<p>Well, I have a cat that keeps me from sleeping well. I should go to bed around 9 or 10 so I can wake up earlier when the cat starts playing.  This works, but I want to spend my evenings with friends which conflicts with going to bed early. I gotta choose which is more important to me.</p>
<p>I can put my phone away and use a watch or an old school alarm clock. Thats probably it. I have to move my phone. It just sucks out the soul.</p>
<p>Without the phone the rest will fall in line. Reading the news is a horrible habit that just feeds that part of my brain that loves gossip. That is all the news is. What can i really do about it?</p>
<h4 id="daily-routine">Daily routine</h4>
<p>I keep lists of tasks that need to be completed. I write notes to help me finsih them and keep up to date with their status. It works pretty well actually, but I do find myself acting without mindfulness throughout the day. I try to just knock out my tasks, but do not really approach them with a clear mind.  I need to work on this.</p>
<h5 id="how-do-i-change-this-up">How do I change this up</h5>
<p>I think I really need to pin point the things I do often and improve upon them. I need to drill the technique of getting in/out of a car&hellip; I need to drill how I sit in public. I need to drill how enter/exit my home. These little things, these mundane tasks can be optimized to improve my quality of life and to decrease my stress. I do not really do this, because well I am set in my ways. I need to stop and try. I hate to try, but it must be done.</p>
<h2 id="what-is-the-point-of-writing-this">What is the point of writing this</h2>
<p>Well, there is no point really. I am at a coffee shop trying to kill some time. I am reflecting on my day. On the little stressful moments throughout the day. Most of them are my fault. I truly act according the example of the people who tutored me. I still feel anxiety when I write notes because I imagine Sister Dorothy chastising me for writing above the line&hellip; and of course I write above that line.  I feel like my uncle telling me not to be a fag (this is a direct quote I do not wish to offend) when drinking from a straw.  I feel anxious in crowds.. I feel a need to prove myself to random people.  I am afraid of being hit by most men.. These little things that my parents and family and tutors impressed upon me cause incredible amounts of stress in my daily life.</p>
<p>I do not want to feel that stress. I think I am going to make a point to analyze myself in order to relieve some of the stress I feel when trying to perform basic &ndash;I mean really basic- things.</p>
<p>What was written above is a precursor to more things to come&hellip;. to posts actually reviewing the mundane thigns that I need to focus on in order to improve my wellbeing.</p>
]]></content>
			<postid> 9c81eb822442dc1117e1b56cd0ecbeaa</postid>
			<author>Justin Napolitano</author>
			<author_name>Justin Napolitano</author_name>
			<author_email>personal.jnapolitano@gmail.com</author_email>
			<author_id>87654367b2fca109e7dc9d3ea8a1ebbaf0bfe374773b148c2c20d278479add99</author_id>			
		</item>
		
		<item>
			<title>Install MySQL Server on Ubuntu</title>
			<link>jnapolitano.com/posts/mysql-install-buntu/</link>
			<pubDate>Fri, 28 Jun 2024 00:00:00 +0000</pubDate>
			<guid>jnapolitano.com/posts/mysql-install-buntu/</guid>
			<description><![CDATA[MYSQL buntu]]></description>
			<content type="html"><![CDATA[<h2 id="why">Why</h2>
<ol>
<li>I am working on an autoposting tool for social sites.</li>
<li>in order to complete that i want a db to log the metadata of my posts</li>
</ol>
<h3 id="parts-of-this-series">Parts of this series</h3>
<ol>
<li><a href="https://jnapolitano.com/en/posts/hugo-social-publisher/">part 1</a></li>
<li><a href="https://jnapolitano.com/en/posts/python-rss-reader/">part 2</a></li>
</ol>
<h2 id="mysql-resources">MYSQL Resources</h2>
<ul>
<li><a href="https://dev.mysql.com/doc/mysql-apt-repo-quick-guide/en/">APT install guide</a></li>
<li><a href="https://dev.mysql.com/doc/mysql-getting-started/en/#mysql-getting-started-installing">MYSQL config guide</a></li>
<li><a href="https://dev.mysql.com/doc/refman/8.4/en/postinstallation.html">Post Install configuration</a></li>
</ul>
<h2 id="install">Install</h2>
<h3 id="download-the-config-files">Download the config files</h3>
<p>go to this link and download the script.</p>
<p><code>https://dev.mysql.com/downloads/repo/apt/</code></p>
<h3 id="install-the-release-package-with-dpkg">Install the release package with dpkg</h3>
<blockquote>
<p>note that the w.x.y.z will change according to the release package</p>
</blockquote>
<p>run</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash">
sudo dpkg -i mysql-apt-config_w.x.y-z_all.deb
</code></pre></div><p>in my case i ran</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash">
sudo dpkg -i mysql-apt-config_0.8.30-1_all.deb 

</code></pre></div><h3 id="update-apt-and-install">Update apt and install</h3>
<p>so the package above just added the mysql repository to the apt package manager. to actually install we will run</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash">sudo apt-get update <span class="o">&amp;&amp;</span>  sudo apt-get install mysql-server
</code></pre></div><h3 id="start-mysql">Start mysql</h3>
<p>mysql will likely alrady be running post install. Check the status by running</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash">
systemctl status mysql

</code></pre></div>]]></content>
			<postid> 450ccef4af7ea020c1c1307e54be206d</postid>
			<author>Justin Napolitano</author>
			<author_name>Justin Napolitano</author_name>
			<author_email>personal.jnapolitano@gmail.com</author_email>
			<author_id>87654367b2fca109e7dc9d3ea8a1ebbaf0bfe374773b148c2c20d278479add99</author_id>			
		</item>
		
		<item>
			<title>Smoking Cigarettes</title>
			<link>jnapolitano.com/posts/cigarettes/</link>
			<pubDate>Fri, 28 Jun 2024 00:00:00 +0000</pubDate>
			<guid>jnapolitano.com/posts/cigarettes/</guid>
			<description><![CDATA[Feeling like an old lecher while trying to be a saint]]></description>
			<content type="html"><![CDATA[<h1 id="smoking-cigarettes">Smoking Cigarettes</h1>
<p>I used to smoke when I went out with friends.  That was years ago. I left that behind me as one of those things I did in college.</p>
<h2 id="tonight">Tonight</h2>
<p>I went out with someone I met recently at a cafe.  A friend of a friend.  We had an okay time, but I did not feel the chemistry I had hoped for.  We went to a restaurant that was okay.. I do not think we have the same palette. Later we met up with some of her friends for drinks and cigarettes. I felt out of place. Like an old man spending time with kids.  I know I am not really that old, but I felt as if I was acting up&hellip;</p>
<h2 id="anxiety">Anxiety</h2>
<p>I felt anxious.  Not necessarily like uncomfortable in my skin&hellip; but the kind of anxious where I was questioning my actions.  Like why was I taking someone out? Like what are my intentions? What is the point?</p>
<h2 id="fun">Fun?</h2>
<p>I do not know if I really had a good time.  Can I not just do things for fun? Maybe, but really what is the point? I could have spent my time cleaning my home.. or exercising.. or just doing things that really bring me joy. Instead, I did this little posturing dance.. that felt disingenuous.</p>
<h2 id="cigarettes">Cigarettes</h2>
<p>And here I am smoking a cigarette in a parking lot listening to Johnny Cash&hellip; completely alone and somewhat depressed making a fool of myself.</p>
<p>This is behavior I thought I was over.. I think I am over&hellip; but I do on these rare occasions want to prove that I still am a man &ndash; or maybe that I still am that man.  The man of my youth.</p>
<h2 id="the-bar-scene">The Bar Scene</h2>
<p>The crowd at this bar tonight was very attractive, but also very sad. I felt like we were doing this little tango&hellip; We were all sizing up one another. I mean this is a bar so we are looking for partners, but what kind of partner can I expect to meet at a bar?</p>
<h2 id="treating-my-body-with-disrespect">Treating my Body with Disrespect</h2>
<p>I had a drink and maybe a half.. They were okay.. but I know these are not good for my body. I also had two cigarettes. I admit that I really liked those&hellip; but I know&hellip; God I know what they do to the body.</p>
<h2 id="rationalizing-bad-behavior">Rationalizing Bad Behavior</h2>
<p>I tell myself&hellip; oh it is just one cigarette. It is just one drink&hellip; and maybe that is kind of true.. but just practicing that type of behavior imprints upon the body that is okay to drink.. to smoke.. to do these ridiculous things.</p>
<h2 id="do-it-again">Do it again?</h2>
<p>Nah.. simply nah. That scene is not for me. I am ready to move on. I experienced it again.. for the first time in 5 years. I had enough. I would rather go for a run.</p>
]]></content>
			<postid> b2362fc107d651d735add0adc7d2c479</postid>
			<author>Justin Napolitano</author>
			<author_name>Justin Napolitano</author_name>
			<author_email>personal.jnapolitano@gmail.com</author_email>
			<author_id>87654367b2fca109e7dc9d3ea8a1ebbaf0bfe374773b148c2c20d278479add99</author_id>			
		</item>
		
		<item>
			<title>Using GitHub Template Repositories to Automate Script Deployment</title>
			<link>jnapolitano.com/posts/create_a_github_template_repo/</link>
			<pubDate>Thu, 27 Jun 2024 12:00:00 +0000</pubDate>
			<guid>jnapolitano.com/posts/create_a_github_template_repo/</guid>
			<description><![CDATA[%!s(<nil>)]]></description>
			<content type="html"><![CDATA[<h1 id="using-github-template-repositories-to-automate-script-deployment">Using GitHub Template Repositories to Automate Script Deployment</h1>
<p>Managing multiple repositories can be a challenge, especially when you need to ensure that each one includes certain common scripts or configurations. GitHub&rsquo;s template repositories feature can help streamline this process. In this post, we&rsquo;ll walk through how to use a template repository to automatically include a <code>gh_submodule_sync.sh</code> script in every new repository you create.</p>
<h2 id="prerequisites">Prerequisites</h2>
<ul>
<li><strong>GitHub CLI</strong>: Ensure you have the GitHub CLI installed. You can find installation instructions <a href="https://cli.github.com/">here</a>.</li>
<li><strong>Existing Repository</strong>: We&rsquo;ll use an existing repository <code>gh_submodule_sync</code> as the template.</li>
</ul>
<h2 id="step-1-clone-the-repository">Step 1: Clone the Repository</h2>
<p>First, clone your existing repository:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh">git clone https://github.com/justin-napolitano/gh_submodule_sync.git
<span class="nb">cd</span> gh_submodule_sync
</code></pre></div><h2 id="step-2-mark-the-repository-as-a-template">Step 2: Mark the Repository as a Template</h2>
<p>Next, mark your repository as a template using the GitHub CLI:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh">gh api -X PATCH /repos/justin-napolitano/gh_submodule_sync -f <span class="nv">is_template</span><span class="o">=</span><span class="nb">true</span>
</code></pre></div><p>This command sets the <code>is_template</code> flag to <code>true</code>, designating your repository as a template.</p>
<h2 id="step-3-create-new-repositories-from-the-template">Step 3: Create New Repositories from the Template</h2>
<p>You can now create new repositories using your template. Here&rsquo;s how to do it:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh">gh repo create new-repo --template<span class="o">=</span>justin-napolitano/gh_submodule_sync --public --confirm
</code></pre></div><p>Replace <code>new-repo</code> with the name of your new repository. This command creates a new repository based on your template.</p>
<h2 id="step-4-clone-the-new-repository">Step 4: Clone the New Repository</h2>
<p>Finally, clone your new repository to your local machine:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh">git clone https://github.com/justin-napolitano/new-repo.git
<span class="nb">cd</span> new-repo
</code></pre></div><p>Your new repository will include all the contents of the template repository, including the <code>gh_submodule_sync.sh</code> script.</p>
]]></content>
			<postid> 963e3fd9d74000e9b1c2c33f3ed7ce56</postid>
			<author></author>
			<author_name>Justin Napolitano</author_name>
			<author_email>personal.jnapolitano@gmail.com</author_email>
			<author_id>87654367b2fca109e7dc9d3ea8a1ebbaf0bfe374773b148c2c20d278479add99</author_id>			
		</item>
		
		<item>
			<title>Configure mysql server on ubuntu</title>
			<link>jnapolitano.com/posts/mysql-config/</link>
			<pubDate>Thu, 27 Jun 2024 00:00:00 +0000</pubDate>
			<guid>jnapolitano.com/posts/mysql-config/</guid>
			<description><![CDATA[MYSQL config buntu]]></description>
			<content type="html"><![CDATA[<h2 id="why">Why</h2>
<p>I installed mysql in the previous post. Now I need to setup users, create a db, and create a table.</p>
<h3 id="parts-of-this-series">Parts of this series</h3>
<ol>
<li><a href="https://jnapolitano.com/en/posts/hugo-social-publisher/">part 1</a></li>
<li><a href="https://jnapolitano.com/en/posts/python-rss-reader/">part 2</a></li>
<li><a href="https://jnapolitano.com/en/posts/mysql-install-buntu/">part 3</a></li>
</ol>
<h2 id="mysql-resources">MYSQL Resources</h2>
<ul>
<li><a href="https://dev.mysql.com/doc/mysql-apt-repo-quick-guide/en/">APT install guide</a></li>
<li><a href="https://dev.mysql.com/doc/mysql-getting-started/en/#mysql-getting-started-installing">MYSQL config guide</a></li>
</ul>
<h2 id="create-a-new-user">Create a new user</h2>
<h3 id="login-as-root">Login as Root</h3>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash">
mysql -u root -p

</code></pre></div><h3 id="create-some-users">Create some users</h3>
<p>In my case I will create 4 users accounts.</p>
<ol>
<li>Cobra@localhost</li>
<li><a href="mailto:Cobra@jnapolitano.com">Cobra@jnapolitano.com</a></li>
<li>admin@localhost</li>
<li>dummy@localhost</li>
</ol>
<p><code>dummy is just used to test service connection and has not access grants or writes</code></p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="w">
</span><span class="w"></span><span class="k">CREATE</span><span class="w"> </span><span class="k">USER</span><span class="w"> </span><span class="s1">&#39;cobra&#39;</span><span class="o">@</span><span class="s1">&#39;localhost&#39;</span><span class="w">
</span><span class="w">  </span><span class="n">IDENTIFIED</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="s1">&#39;password&#39;</span><span class="p">;</span><span class="w">
</span><span class="w"></span><span class="k">GRANT</span><span class="w"> </span><span class="k">ALL</span><span class="w">
</span><span class="w">  </span><span class="k">ON</span><span class="w"> </span><span class="o">*</span><span class="p">.</span><span class="o">*</span><span class="w">
</span><span class="w">  </span><span class="k">TO</span><span class="w"> </span><span class="s1">&#39;cobra&#39;</span><span class="o">@</span><span class="s1">&#39;localhost&#39;</span><span class="w">
</span><span class="w">  </span><span class="k">WITH</span><span class="w"> </span><span class="k">GRANT</span><span class="w"> </span><span class="k">OPTION</span><span class="p">;</span><span class="w">
</span><span class="w">
</span><span class="w"> 
</span><span class="w">
</span><span class="w"></span><span class="k">CREATE</span><span class="w"> </span><span class="k">USER</span><span class="w"> </span><span class="s1">&#39;admin&#39;</span><span class="o">@</span><span class="s1">&#39;localhost&#39;</span><span class="w">
</span><span class="w">  </span><span class="n">IDENTIFIED</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="s1">&#39;password&#39;</span><span class="p">;</span><span class="w">
</span><span class="w"></span><span class="k">GRANT</span><span class="w"> </span><span class="n">RELOAD</span><span class="p">,</span><span class="n">PROCESS</span><span class="w">
</span><span class="w">  </span><span class="k">ON</span><span class="w"> </span><span class="o">*</span><span class="p">.</span><span class="o">*</span><span class="w">
</span><span class="w">  </span><span class="k">TO</span><span class="w"> </span><span class="s1">&#39;admin&#39;</span><span class="o">@</span><span class="s1">&#39;localhost&#39;</span><span class="p">;</span><span class="w">
</span><span class="w">
</span><span class="w"></span><span class="k">CREATE</span><span class="w"> </span><span class="k">USER</span><span class="w"> </span><span class="s1">&#39;dummy&#39;</span><span class="o">@</span><span class="s1">&#39;localhost&#39;</span><span class="p">;</span><span class="w">
</span><span class="w">
</span></code></pre></div><blockquote>
<p>ACTUALLY enter a password above. Do not use password as the user password'</p>
</blockquote>
<h3 id="logout-of-root">Logout of root</h3>
<p>enter <code>EXIT</code> in terminal</p>
<h3 id="login-as-your-user">Login as your user</h3>
<p>In my case I pass <code>mysql -u cobra -p</code> back to the terminal.</p>
<h2 id="create-a-db">Create a DB</h2>
<p>I will create a db for my personal website. The first command to run is</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="w">
</span><span class="w"></span><span class="k">CREATE</span><span class="w"> </span><span class="k">DATABASE</span><span class="w"> </span><span class="n">jnapolitano</span><span class="p">;</span><span class="w">
</span><span class="w">
</span></code></pre></div><h3 id="use-your-new-db">Use your new db</h3>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="w">
</span><span class="w"></span><span class="n">USE</span><span class="w"> </span><span class="n">jnapolitano</span><span class="p">;</span><span class="w">
</span></code></pre></div><h3 id="create-the-posts-table">Create the posts table</h3>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="w">
</span><span class="w"></span><span class="k">CREATE</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="n">posts</span><span class="w">
</span><span class="w"></span><span class="p">(</span><span class="w">
</span><span class="w">  </span><span class="n">id</span><span class="w">                    </span><span class="nb">BINARY</span><span class="p">(</span><span class="mi">16</span><span class="p">)</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="w"> </span><span class="k">DEFAULT</span><span class="w"> </span><span class="p">(</span><span class="n">UUID_TO_BIN</span><span class="p">(</span><span class="n">UUID</span><span class="p">())),</span><span class="w">  </span><span class="o">#</span><span class="w"> </span><span class="k">Unique</span><span class="w"> </span><span class="n">ID</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">record</span><span class="p">.</span><span class="w"> </span><span class="n">This</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">smallish</span><span class="w"> </span><span class="k">and</span><span class="w"> </span><span class="k">not</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">very</span><span class="w"> </span><span class="n">high</span><span class="w"> </span><span class="n">performance</span><span class="w"> </span><span class="n">db</span><span class="w"> </span><span class="n">this</span><span class="w"> </span><span class="n">should</span><span class="w"> </span><span class="n">be</span><span class="w"> </span><span class="n">fine</span><span class="p">.</span><span class="w"> 
</span><span class="w">  </span><span class="n">author</span><span class="w">                </span><span class="nb">BINARY</span><span class="p">(</span><span class="mi">16</span><span class="p">),</span><span class="w">                                         </span><span class="o">#</span><span class="w"> </span><span class="n">id</span><span class="w"> </span><span class="k">of</span><span class="w"> </span><span class="n">author</span><span class="w">
</span><span class="w">  </span><span class="n">publish_date</span><span class="w">          </span><span class="nb">DATE</span><span class="p">,</span><span class="w">                                               </span><span class="o">#</span><span class="w"> </span><span class="n">publish</span><span class="w"> </span><span class="nb">date</span><span class="w">
</span><span class="w">  </span><span class="n">description</span><span class="w">           </span><span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">150</span><span class="p">),</span><span class="w">                                       </span><span class="o">#</span><span class="w"> </span><span class="n">post</span><span class="w"> </span><span class="n">description</span><span class="w">
</span><span class="w">  </span><span class="n">link</span><span class="w">                  </span><span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">150</span><span class="p">),</span><span class="w">                                       </span><span class="o">#</span><span class="w"> </span><span class="n">Link</span><span class="w"> </span><span class="k">to</span><span class="w"> </span><span class="n">post</span><span class="w">
</span><span class="w">  </span><span class="n">title</span><span class="w">                 </span><span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">150</span><span class="p">),</span><span class="w">                                       </span><span class="o">#</span><span class="w"> </span><span class="n">title</span><span class="w"> </span><span class="k">of</span><span class="w"> </span><span class="n">hte</span><span class="w"> </span><span class="n">post</span><span class="w">
</span><span class="w">  </span><span class="k">PRIMARY</span><span class="w"> </span><span class="k">KEY</span><span class="w">           </span><span class="p">(</span><span class="n">id</span><span class="p">)</span><span class="w">                                                </span><span class="o">#</span><span class="w"> </span><span class="n">Make</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">id</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="k">primary</span><span class="w"> </span><span class="k">key</span><span class="w">
</span><span class="w"></span><span class="p">);</span><span class="w">
</span><span class="w">
</span></code></pre></div><h3 id="create-the-authors-table">Create the authors table</h3>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="w">
</span><span class="w"></span><span class="k">CREATE</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="n">authors</span><span class="w">
</span><span class="w"></span><span class="p">(</span><span class="w">
</span><span class="w">  </span><span class="n">id</span><span class="w">                    </span><span class="nb">BINARY</span><span class="p">(</span><span class="mi">16</span><span class="p">)</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="w"> </span><span class="k">DEFAULT</span><span class="w"> </span><span class="p">(</span><span class="n">UUID_TO_BIN</span><span class="p">(</span><span class="n">UUID</span><span class="p">())),</span><span class="w">  </span><span class="o">#</span><span class="w"> </span><span class="k">Unique</span><span class="w"> </span><span class="n">ID</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">record</span><span class="p">.</span><span class="w"> </span><span class="n">This</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">smallish</span><span class="w"> </span><span class="k">and</span><span class="w"> </span><span class="k">not</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">very</span><span class="w"> </span><span class="n">high</span><span class="w"> </span><span class="n">performance</span><span class="w"> </span><span class="n">db</span><span class="w"> </span><span class="n">this</span><span class="w"> </span><span class="n">should</span><span class="w"> </span><span class="n">be</span><span class="w"> </span><span class="n">fine</span><span class="p">.</span><span class="w"> 
</span><span class="w">  </span><span class="n">name</span><span class="w">                  </span><span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">150</span><span class="p">),</span><span class="w">                                      </span><span class="o">#</span><span class="w"> </span><span class="n">name</span><span class="w"> </span><span class="k">of</span><span class="w"> </span><span class="n">author</span><span class="w">
</span><span class="w">  </span><span class="k">PRIMARY</span><span class="w"> </span><span class="k">KEY</span><span class="w">           </span><span class="p">(</span><span class="n">id</span><span class="p">)</span><span class="w">                                                </span><span class="o">#</span><span class="w"> </span><span class="n">Make</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">id</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="k">primary</span><span class="w"> </span><span class="k">key</span><span class="w">
</span><span class="w"></span><span class="p">);</span><span class="w">
</span><span class="w">
</span></code></pre></div><h3 id="create-the-mastodon-post-table">Create the mastodon post table</h3>
<p>I will be adding support for other systems. I am starting with mastodon.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="w">
</span><span class="w"></span><span class="k">CREATE</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="n">mastodon_posts</span><span class="w">
</span><span class="w"></span><span class="p">(</span><span class="w">
</span><span class="w">  </span><span class="n">id</span><span class="w">                    </span><span class="nb">BINARY</span><span class="p">(</span><span class="mi">16</span><span class="p">)</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="w"> </span><span class="k">DEFAULT</span><span class="w"> </span><span class="p">(</span><span class="n">UUID_TO_BIN</span><span class="p">(</span><span class="n">UUID</span><span class="p">())),</span><span class="w">  </span><span class="o">#</span><span class="w"> </span><span class="k">Unique</span><span class="w"> </span><span class="n">ID</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">record</span><span class="p">.</span><span class="w"> </span><span class="n">This</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">smallish</span><span class="w"> </span><span class="k">and</span><span class="w"> </span><span class="k">not</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">very</span><span class="w"> </span><span class="n">high</span><span class="w"> </span><span class="n">performance</span><span class="w"> </span><span class="n">db</span><span class="w"> </span><span class="n">this</span><span class="w"> </span><span class="n">should</span><span class="w"> </span><span class="n">be</span><span class="w"> </span><span class="n">fine</span><span class="p">.</span><span class="w"> 
</span><span class="w">  </span><span class="n">post_id</span><span class="w">               </span><span class="nb">BINARY</span><span class="p">(</span><span class="mi">16</span><span class="p">),</span><span class="w">                                         </span><span class="o">#</span><span class="w"> </span><span class="n">name</span><span class="w"> </span><span class="k">of</span><span class="w"> </span><span class="n">author</span><span class="w">
</span><span class="w">  </span><span class="n">mastodon_post</span><span class="w">         </span><span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">150</span><span class="p">),</span><span class="w">                                       </span><span class="o">#</span><span class="w"> </span><span class="n">THE</span><span class="w"> </span><span class="n">POST</span><span class="w"> </span><span class="n">ID</span><span class="p">..</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="n">it</span><span class="w"> </span><span class="k">returns</span><span class="w">
</span><span class="w">  </span><span class="k">PRIMARY</span><span class="w"> </span><span class="k">KEY</span><span class="w">           </span><span class="p">(</span><span class="n">id</span><span class="p">)</span><span class="w">                                                </span><span class="o">#</span><span class="w"> </span><span class="n">Make</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">id</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="k">primary</span><span class="w"> </span><span class="k">key</span><span class="w">
</span><span class="w"></span><span class="p">);</span><span class="w">
</span><span class="w">
</span></code></pre></div>]]></content>
			<postid> 6d2e65c78de495ec2761ef43463243d6</postid>
			<author></author>
			<author_name>Justin Napolitano</author_name>
			<author_email>personal.jnapolitano@gmail.com</author_email>
			<author_id>87654367b2fca109e7dc9d3ea8a1ebbaf0bfe374773b148c2c20d278479add99</author_id>			
		</item>
		
		<item>
			<title>Entering my Car</title>
			<link>jnapolitano.com/posts/enter_my_car/</link>
			<pubDate>Thu, 27 Jun 2024 00:00:00 +0000</pubDate>
			<guid>jnapolitano.com/posts/enter_my_car/</guid>
			<description><![CDATA[OCD and my vehicle]]></description>
			<content type="html"><![CDATA[<h2 id="why-am-i-writing-this">Why am I writing this</h2>
<p>I am trying to approach life from the perspective that every action throughout the day&hellip; no matter how mundane&hellip; defines in some way my character.  Each little action can either make life easier or more difficult for me. I do not know if it is possible for an action to be completely neutral.. I am thinking that through.</p>
<h3 id="entering-my-car">Entering my car</h3>
<p>How do I currently enter my car?</p>
<ol>
<li>I open the door (maybe this is another post)</li>
<li>I sit down</li>
<li>I close the door</li>
<li>I lock the doors</li>
<li>I turn on the car</li>
<li>I place my wallet on the instrument panel</li>
<li>I plug in my phone</li>
<li>I put on my sunglasses</li>
<li>I (usually) set up the gps to my destination</li>
<li>I start music from spotify</li>
<li>I place my phone into the dock</li>
<li>I drive off</li>
</ol>
<h3 id="is-there-anything-id-like-to-change">Is there anything I&rsquo;d like to change?</h3>
<ul>
<li>
<p>When I enter the car I find myself trying to sit down in a way that hurts my  knees.</p>
</li>
<li>
<p>I also often carry my backpack. I move just throw that to the passenger seat. I should find a place for it in the trunk</p>
</li>
<li>
<p>I carry a satchel as well. I do not take that off.  I that is okay.</p>
</li>
<li>
<p>I carry a water bottle across my shoulders.  This too can stay where it is.</p>
</li>
<li>
<p>When it rains I carry my umbrella. I need to find a dedicated spot for that in the backseat of my vehicle.</p>
</li>
<li>
<p>I need a checkist until I make this routine standard operatig procedure</p>
</li>
</ul>
<h4 id="enter-the-car-without-hurting-my-knees">Enter the car without hurting my knees</h4>
<p>My car is low to the ground.. That is okay.. I have plenty of mobility.. but i try to enter the car at an angle.  this is a mistake. In order to move without hurting myself&hellip; I need to sit on the chair at a 90 degree angle instead of a 45.  Just turning my back to the seat and turning will be sufficient.</p>
<p>Now that said, there is a makeshift seat cover on the driver&rsquo;s seat. It moves oddly when I sit on the seat without the 90 degree angle. Just sitting correctly will solve both problems.</p>
<h4 id="remove-my-backpack">Remove my backpack</h4>
<p><code>Problem</code></p>
<p>I would like to put my backpack into the trunk of the car.. Currently there are two limitations.</p>
<ol>
<li>My trunk is full to the brim</li>
<li>Even if the trunk were clear I would have to first open the driver&rsquo;s side door to access the lever that opens the trunk.</li>
</ol>
<p><code>Solution</code></p>
<p>I cannot empty my trunk at the moment because I am traveling. I can however order a new key that will allow me to remotely open the trunk. In the future this will solve my problem.</p>
<h5 id="stop-gap-solution">Stop-gap solution</h5>
<p>I will put my backpack behind the driver&rsquo;s seat. In order to do this, I will have to keep that area clean. I will also have to make sure my umbrella is not in the way and that there is no water remaining in the back seat.</p>
<h4 id="enter-with-an-umbrella">Enter with an umbrella</h4>
<p><code>Problem</code></p>
<p>When entering my car with an umbrella I usuall sit down while holding the umbrella between the gap of the roof and the door.  I then shake out the umbrella before closing it. I then either throw the umbrella into the passengers seat or into the back of my car somewhere. The problems are</p>
<ol>
<li>The umbrella can be damaged</li>
<li>The umbrell can be lost</li>
<li>The umbrell can drip water</li>
</ol>
<p><code>Solution</code></p>
<p>I need a pvc pipe holster that sits behind the passenger seat&hellip; or is attached to the driver&rsquo;s door.  Maybe a pipe cut open and affixed to the beam at the base of the door could do the trick.</p>
<p>I will need to account for water.. i think an open container at the base of door with a great amount of surface area exposed to air will be best to dry out the moisture. I might also be able to rig up a drainage system.  I need to think about this further.</p>
<h4 id="where-to-put-my-satchel">Where to put my satchel</h4>
<p><code>Problem</code></p>
<p>I usualy keep my satchel on my body. But when I am driving long distances I should remove it.</p>
<p><code>Solution</code></p>
<p>I will hang it from the passenger head rest</p>
<h4 id="where-to-put-my-water-bottle">Where to put my water bottle</h4>
<p><code>Problem</code></p>
<p>I wear my bottle across my shoulder in sling holder. I usually leave it on my body while driving.. but over large distances it would be better to move it to the cup holder</p>
<p><code>Solution</code></p>
<p>I will need to carry a bottle that fits in the holder.  I do not think that I have one. As a workaround I will try to hang this from a head rest. If this is sufficient and will permit me to drink from it while driving than I will stick with it. Otherwise I will need to revisit&hellip; or just buy a bottle that fits into the cup holders.</p>
<h2 id="the-checklist">The checklist</h2>
<p>Before I drive off I need to check that everything is in the correct location</p>
<ol>
<li>Wallet</li>
<li>Car Registration</li>
<li>Car Insurance</li>
<li>Lights set to auto</li>
<li>Mirrors set correctly</li>
<li>Seatbelt on</li>
<li>Sling bag in place</li>
<li>Water bottle in place</li>
<li>Umbrella in place</li>
<li>Sunglasses in place</li>
<li>Music Set</li>
<li>Direction on</li>
<li>Sun Screen In place</li>
</ol>
<h3 id="breaking-this-up">Breaking this up</h3>
<p>Personal Items</p>
<ol>
<li>Wallet</li>
<li>Sling bag</li>
<li>Backpack</li>
<li>Umbrella</li>
<li>Sun Glasses</li>
<li>Phone</li>
<li>Water bottle</li>
</ol>
<p>Music and Navigation</p>
<ol>
<li>Set the music</li>
<li>Set up navigation</li>
</ol>
<p>Car Checklist</p>
<ol>
<li>Sun Screen Removal</li>
<li>Mirror review</li>
<li>Seatbelt check</li>
<li>Lights set to auto</li>
<li>Car insurance check</li>
<li>Car registration check</li>
</ol>
<h3 id="procedure">Procedure</h3>
<h4 id="approach-the-vehicle">Approach the vehicle</h4>
<ol>
<li>Sling backpack to front of body</li>
<li>Check both sides of the car before entering</li>
<li>Unlock Vehicle</li>
</ol>
<h4 id="enter-the-vehicle">Enter the vehicle</h4>
<ol>
<li>Open Door</li>
<li>Sit correctly</li>
<li>Close door</li>
<li>Lock doors</li>
</ol>
<h4 id="place-personal-items">Place Personal Items</h4>
<ol>
<li>If raining place umbrella</li>
<li>Remove backpack and place behind passenger seat</li>
<li>Remove water bottle and place in cup holder</li>
<li>Remove phone from satchel and place in holder with power cable</li>
<li>Remove satchel and hang on passenger seat</li>
<li>Place wallet onto instrument cluster</li>
<li>Put on sunglasses</li>
</ol>
<h4 id="car-checklist">Car Checklist</h4>
<ol>
<li>Remove sunscreen from window. Place Behind passenger seat ( I need to improve upon this procedure)</li>
<li>Put on seatbelt</li>
<li>Check mirrors</li>
<li>Check lights are set to auto</li>
<li>Check that car insurance is in place</li>
<li>Check that car registration is in place</li>
</ol>
<h4 id="tech-checklist">Tech Checklist</h4>
<ol>
<li>Start music</li>
<li>Set navigation</li>
<li>Dash Cam</li>
</ol>
<h2 id="further-refine-the-checklist">Further Refine the Checklist</h2>
<p>Okay the checklist isn&rsquo;t bad but it is difficult to remember.</p>
<h3 id="d-r-i-v-e">D R I V E</h3>
<p>I came up with the acryonym drive to help me remember these categories.</p>
<h4 id="deliberate-approach">Deliberate Approach</h4>
<ul>
<li>Approach the vehicle</li>
<li>Sling backpack to front of body</li>
<li>Check both sides of the car before entering</li>
<li>Unlock Vehicle</li>
<li>Enter the vehicle</li>
</ul>
<h4 id="reinforce">Reinforce</h4>
<ul>
<li>Sit correctly</li>
<li>Close door</li>
<li>Lock doors</li>
</ul>
<h4 id="inventory">Inventory</h4>
<ul>
<li>If raining, place umbrella</li>
<li>Remove backpack and place behind passenger seat</li>
<li>Remove water bottle and place in cup holder</li>
<li>Remove phone from satchel and place in holder with power cable</li>
<li>Remove satchel and hang on passenger seat</li>
<li>Place wallet onto instrument cluster</li>
<li>Put on sunglasses</li>
<li>Remove sunscreen from window. Place behind passenger seat</li>
</ul>
<h4 id="verify">Verify</h4>
<ul>
<li>Put on seatbelt</li>
<li>Check mirrors</li>
<li>Check lights are set to auto</li>
<li>Check that car insurance is in place</li>
<li>Check that car registration is in place</li>
</ul>
<h4 id="electronics">Electronics</h4>
<ul>
<li>Start music</li>
<li>Set navigation</li>
<li>Dash Cam</li>
</ul>
<h3 id="cleanin-up-the-intermediary-steps">Cleanin up the intermediary Steps</h3>
<h4 id="deliberately-approach---dase">Deliberately Approach - DASE</h4>
<ul>
<li>Deliberate (Prepare items for quick entry)</li>
<li>Approach the vehicle cautiously</li>
<li>Scan both sides of the car</li>
<li>Enter</li>
</ul>
<h4 id="reinforce---seal">Reinforce - SEAL</h4>
<p><code>SEcure and Lock</code></p>
<ul>
<li>Secure Myself</li>
<li>Lock the doors</li>
</ul>
<h4 id="inventory---order">Inventory - ORDER</h4>
<ul>
<li>Organize My Things</li>
<li>Review Messages</li>
<li>Deploy Essentials</li>
<li>Equip Accessories</li>
<li>Ready Devices</li>
</ul>
<h4 id="verify-1">Verify</h4>
<ul>
<li>Mirrors</li>
<li></li>
<li>Lights</li>
<li>Documents</li>
</ul>
<h4 id="embark">Embark</h4>
<ul>
<li>Just Drive</li>
</ul>
<h2 id="still-to-do">Still to do</h2>
<ol>
<li>Buy a dashcam&hellip; Review</li>
<li>Figure out the umbrella situation&hellip; Likely a bag I will hang from the passenger seat</li>
<li>Print a copy of my car insurance</li>
<li>Figure out where to place the sun screen&hellip;.</li>
</ol>
]]></content>
			<postid> 903fdc51f4cd93da99018accfcf88fd6</postid>
			<author>Justin Napolitano</author>
			<author_name>Justin Napolitano</author_name>
			<author_email>personal.jnapolitano@gmail.com</author_email>
			<author_id>87654367b2fca109e7dc9d3ea8a1ebbaf0bfe374773b148c2c20d278479add99</author_id>			
		</item>
		
		<item>
			<title>Sync Gh Submodules Across a Super Project</title>
			<link>jnapolitano.com/posts/gh_submodule_sync/</link>
			<pubDate>Thu, 27 Jun 2024 00:00:00 +0000</pubDate>
			<guid>jnapolitano.com/posts/gh_submodule_sync/</guid>
			<description><![CDATA[Make documentation easier. Use modules for each script]]></description>
			<content type="html"><![CDATA[<!-- raw HTML omitted -->
<h2 id="overview">Overview</h2>
<p>This script is designed to initialize and update all submodules in a GitHub repository to the latest commits from their respective remote repositories. It ensures that all submodules, including nested submodules, are synchronized with their remote counterparts.</p>
<h2 id="prerequisites">Prerequisites</h2>
<ul>
<li>Ensure that you have Git installed on your system.</li>
<li>Ensure that you have cloned the repository containing the submodules.</li>
</ul>
<h2 id="usage">Usage</h2>
<ol>
<li>Save the script to a file, for example, <code>sync_submodules.sh</code>.</li>
<li>Make the script executable:
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh">chmod +x sync_submodules.sh
</code></pre></div></li>
<li>Run the script:
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh">./sync_submodules.sh
</code></pre></div></li>
</ol>
<h2 id="script-sync_submodulessh">Script: sync_submodules.sh</h2>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="cp">#!/bin/bash
</span><span class="cp"></span>
<span class="c1"># Script to initialize and update all submodules to the latest commits from their remote repositories</span>

<span class="c1"># Check if the script is run from the root of the repository</span>
<span class="k">if</span> <span class="o">[</span> ! -f .gitmodules <span class="o">]</span><span class="p">;</span> <span class="k">then</span>
  <span class="nb">echo</span> <span class="s2">&#34;Error: .gitmodules file not found. Please run this script from the root of your repository.&#34;</span>
  <span class="nb">exit</span> <span class="m">1</span>
<span class="k">fi</span>

<span class="c1"># Initialize submodules (if not already initialized)</span>
git submodule init

<span class="c1"># Update all submodules to the latest commits from their remote repositories</span>
git submodule update --init --recursive --remote

<span class="c1"># Check if the submodule update was successful</span>
<span class="k">if</span> <span class="o">[</span> <span class="nv">$?</span> -eq <span class="m">0</span> <span class="o">]</span><span class="p">;</span> <span class="k">then</span>
  <span class="nb">echo</span> <span class="s2">&#34;Submodules have been successfully updated.&#34;</span>
<span class="k">else</span>
  <span class="nb">echo</span> <span class="s2">&#34;Error: Failed to update submodules.&#34;</span>
  <span class="nb">exit</span> <span class="m">1</span>
<span class="k">fi</span>
</code></pre></div><h2 id="explanation">Explanation</h2>
<ul>
<li>
<p><strong>Initialization Check</strong>:</p>
<ul>
<li>The script first checks if it is being run from the root of the repository by verifying the existence of the <code>.gitmodules</code> file.</li>
<li>If the <code>.gitmodules</code> file is not found, the script exits with an error message.</li>
</ul>
</li>
<li>
<p><strong>Submodule Initialization</strong>:</p>
<ul>
<li>The <code>git submodule init</code> command initializes the submodules if they haven&rsquo;t been initialized yet.</li>
</ul>
</li>
<li>
<p><strong>Submodule Update</strong>:</p>
<ul>
<li>The <code>git submodule update --init --recursive --remote</code> command updates all submodules to the latest commits from their remote repositories.</li>
<li>The <code>--recursive</code> option ensures that any nested submodules are also updated.</li>
<li>The <code>--remote</code> option fetches the latest commits from the submodules' remote repositories.</li>
</ul>
</li>
<li>
<p><strong>Success/Failure Check</strong>:</p>
<ul>
<li>The script checks the exit status of the <code>git submodule update</code> command to determine if the update was successful.</li>
<li>If successful, a success message is displayed.</li>
<li>If the update fails, an error message is displayed, and the script exits with an error code.</li>
</ul>
</li>
</ul>
<h2 id="notes">Notes</h2>
<ul>
<li>This script should be run from the root directory of your Git repository.</li>
<li>Ensure you have the necessary permissions and network access to fetch updates from the remote repositories.</li>
</ul>
]]></content>
			<postid> c8d81718277290492cd6844b83dabeb6</postid>
			<author>Justin Napolitano</author>
			<author_name>Justin Napolitano</author_name>
			<author_email>personal.jnapolitano@gmail.com</author_email>
			<author_id>87654367b2fca109e7dc9d3ea8a1ebbaf0bfe374773b148c2c20d278479add99</author_id>			
		</item>
		
		<item>
			<title>Overtrain</title>
			<link>jnapolitano.com/posts/overtrain/</link>
			<pubDate>Tue, 18 Jun 2024 00:00:00 +0000</pubDate>
			<guid>jnapolitano.com/posts/overtrain/</guid>
			<description><![CDATA[Do not overtrain]]></description>
			<content type="html"><![CDATA[<h2 id="why">Why</h2>
<p>i like to exercise. i like to over-exercise. i do not listen to my body when it needs rest. i feel as if more movement is more better.</p>
<p>i am getting older. i do not recover quickly.</p>
<h2 id="running">Running</h2>
<p>when i feel stressed i run. it is a low cost way to move.</p>
<h3 id="running-too-far">Running too far</h3>
<p>when i run, i feel a need to prove to myself that i am a runner. i begin my jog planning a 5k&hellip; i hit my mark an push it further until i cannot stand&hellip; then i push it further to make it back home.</p>
<h3 id="injury">Injury</h3>
<p>today my knee hurts. my thinking is slow. i cannot focus. i pushed it too hard.  i had not too long ago been in the shape to handle a 10k and some calisthenics. i am not currently. my body more or less told me so, but i chose to ignore it to prove to myself that i am strong.</p>
<h3 id="foolishness">Foolishness</h3>
<p>i know my line of thinkiing is ridiculous. i know that it would serve me better to do a moderate amount of exercise daily rather than binge and encourage injury&hellip; but i like the feeling of pushing myself to the limit.</p>
]]></content>
			<postid> 28e361d2dcd3966b7528981414551aa8</postid>
			<author>Justin Napolitano</author>
			<author_name>Justin Napolitano</author_name>
			<author_email>personal.jnapolitano@gmail.com</author_email>
			<author_id>87654367b2fca109e7dc9d3ea8a1ebbaf0bfe374773b148c2c20d278479add99</author_id>			
		</item>
		
		<item>
			<title>Curate an EDC Pouch</title>
			<link>jnapolitano.com/posts/curate-an-edc-pouch/</link>
			<pubDate>Mon, 17 Jun 2024 15:42:34 -0500</pubDate>
			<guid>jnapolitano.com/posts/curate-an-edc-pouch/</guid>
			<description><![CDATA[Organizing your random tools into an edc pouch]]></description>
			<content type="html"><![CDATA[<h2 id="why">Why</h2>
<p>i have a bunch of random tools and pouches laying about. I don&rsquo;t like it. So to feel better i want to organize a pouch that i can throw into any of my bags so that i can deal with most things i face in day to day to life.</p>
<h2 id="guiding-principles">Guiding principles</h2>
<ul>
<li>I want tools that reduce the friction in my average day to day dealings</li>
<li>I want the pouch to be small enough to fit inside all of my bags</li>
<li>I want the tool set to be modular so that it can be used as the base of other kits.</li>
</ul>
<h2 id="audit-your-supplies">Audit your supplies</h2>
<p>in my case I have at my disposal. I&rsquo;d love to buy mores stuff, but if I am being honest with myself.. i think that i can take care of most of my needs with the things below. I will test it out and see if any new needs arise.</p>
<h3 id="supply-list">Supply list</h3>
<ol>
<li>A pouch.</li>
<li>Swiss army knife.</li>
<li>4 inch crescent wrench.</li>
<li>Some clorox wipes.</li>
<li>A bit of cash.</li>
<li>A note pad.</li>
<li>A pen.</li>
<li>Cell phone charging block.</li>
<li>USB C cable.</li>
<li>A first aid kit</li>
<li>Opinel no 7 Carbon Knife</li>
<li>Some latex gloves</li>
</ol>
<p><img src="./images/top-packed-vertical.jpg" alt="images-unpacked"></p>
<h3 id="determine-every-day-uses">Determine every day uses</h3>
<p>in order to carry this stuff around with me in my bag I have to justify the weiht and the space.</p>
<h4 id="justify-the-pouch">Justify the Pouch</h4>
<p>the pouch is just some nylon pouch i used in the past for a trauma kit. I dismantled that because i do not really have enough experience to justify patching up some seriously injured person&hellip; nor myself.  It is a pretty good size. It is small enough to fit in my sling bag and into my haversack.</p>
<h4 id="justify-the-swissie">Justify the Swissie</h4>
<p>the swiss army tinker is a great little tool. I use it pretty often to help me get out of binds and to reduce friction in my daily life.</p>
<p>It has&hellip;</p>
<ol>
<li>Main knife.</li>
<li>A backup knife.</li>
<li>A can opener.</li>
<li>A bottle opener.</li>
<li>A phillips head.</li>
<li>a flat head.</li>
<li>An awl.</li>
<li>A reamer.</li>
<li>A pry bar.</li>
<li>A tooth pick.</li>
<li>A pin.</li>
<li>Tweezers.</li>
</ol>
<h4 id="justify-the-crescent-wrench">Justify the crescent wrench</h4>
<p>the crescent is the only item that i purchased in this set. If I am being completely honest with myself i have yet to use it. I can foresee it being useful if i have to loosen a bolt or hold a locking nut.  That said, i do not know if it will prove to as useful as i would like it to be. The 4 inch is also really small. i wonder if i should have gone with the 6 inch.</p>
<h4 id="justify-the-clorox-wipes">Justify the clorox wipes</h4>
<p>i use the clorox wipes to clean off my tools and my utensils after use. i also find that many restaurants and public toilets are too dirty for me to comfortably use. the wipes are useful to me in thoe cases.</p>
<h4 id="justify-the-cash">Justify the cash</h4>
<p>a few dollars takes up no space and is useful in a bind. If it is easy to access i will use it. if it is not put away i will lose it.  Sometimes i forget my wallet or card at home. it is justified.</p>
<h4 id="justify-the-notepad">Justify the notepad</h4>
<p>being able to write something down to later add to note keeping application is really useful to me. Also, i like to brainstorm on paper and store digitally.  the advantage of this to me is that i can keep my digital life more organized and just throw away the fragile paper.</p>
<h4 id="the-pen">The pen</h4>
<p>this is justified. done.</p>
<h3 id="charging-block-and-usb-c">Charging block and usb c</h3>
<p>i try to only buy usb c electronics. Thankfully this is getting easier to do.  The charging block justifies itself. So does the cable that accompanies it.</p>
<h4 id="justify-the-first-aid-and-hygiene-kit">Justify the first aid and hygiene kit</h4>
<p>this is just a basic first aid kit to cover my bases. it is not meant to be a trauma kit&hellip; nor is it expected to be all encompasing.  every day needs require something that will help me to treat minor scrapes.</p>
<p>i think i could expand upon the hygiene kit. a toothbrush, hydrogen peroxide, tooth paste, and small cut of face soap might be good solutions to include. i&rsquo;ll write another post where i expand upon this.</p>
<p>the first aid/hygiene contains</p>
<ol>
<li>band-aids.</li>
<li>some gauze.</li>
<li>a tick remover.</li>
<li>a nail file.</li>
<li>nail clippers</li>
<li>immodium.</li>
<li>benadryl.</li>
</ol>
<h4 id="justify-the-opinel">Justify the opinel</h4>
<p>i like the opinel no 7. I think at the end of the day everything comes down to whether or not i want and like it&hellip; now trying to justify my liking it.. the opinel no 7 has a slightly larger blade than the main blade of the swissie tinker.  The opinel is also not threatening at all. I can use it cut an apple or eat at a restaurant without raising any eyebrows. it is also sharp enough to be capable of most &ldquo;survival&rdquo; tasks that i can throw at it if the occasion arises.</p>
<blockquote>
<p>the carbon steel felt like a good idea initially. it is cool, but it rusts in the houston moisture. the next one i buy will definitely be stainless. Unfortunately this knife will last me the rest of my life.</p>
</blockquote>
<h4 id="justify-the-latex-gloves">Justify the latex gloves</h4>
<p>I do not like making my hands dirty.  Nor do i like touching unsanitized things.  if either of those things could happen i pull on the gloves.</p>
<h2 id="put-it-all-together">Put it all together</h2>
<p>you know there really isn&rsquo;t much to this one. Just put everything in the pouch in a way that is organized and not messy.</p>
<p><img src="./images/top-packed-side.jpg" alt="packed-pouch"></p>
<h2 id="justify-missing-items">Justify missing items</h2>
<p>i think a few key tools are missing from this set.</p>
<p>i would like&hellip;</p>
<ol>
<li>small pliers like a mini knipex.</li>
<li>a lighter.</li>
<li>a couple of matches.</li>
<li>some soap to clean-up while out of the house.</li>
<li>iodine tablets or a small vile of disinfectant bleach for dirty water.</li>
</ol>
<h2 id="justify-my-justifications">Justify my justifications</h2>
<p>i hinted at this earlier&hellip; every rationalization i make comes down to the fact that each choice i made in this exercise was influenced by desire to possess the object.  i like being prepared. i like tools. i like ingenuity. i like it when people think that i am resourceful. my pouch is a reflection of these desires.</p>
]]></content>
			<postid> 4dd3b316e635b12974781cebf7fa5db8</postid>
			<author>Justin Napolitano</author>
			<author_name>Justin Napolitano</author_name>
			<author_email>personal.jnapolitano@gmail.com</author_email>
			<author_id>87654367b2fca109e7dc9d3ea8a1ebbaf0bfe374773b148c2c20d278479add99</author_id>			
		</item>
		
		<item>
			<title>Prepare Chicken Salad</title>
			<link>jnapolitano.com/posts/prepare-chicken-salad/</link>
			<pubDate>Sun, 16 Jun 2024 21:35:34 -0500</pubDate>
			<guid>jnapolitano.com/posts/prepare-chicken-salad/</guid>
			<description><![CDATA[Preparing chicken salad with some left-over supplies]]></description>
			<content type="html"><![CDATA[<p><img src="./images/dinner.jpg" alt="dinner"></p>
<h2 id="why">Why</h2>
<p>I am hungry. I have a bunch of ingredients. I have a left over rotisserie chicken. I do not want to waste.</p>
<h2 id="audit-your-supplies">Audit your supplies</h2>
<p>In my case I have at my disposal</p>
<ol>
<li>About half a rotisserie chicken.</li>
<li>Greek yogurt.</li>
<li>Coriander.</li>
<li>Grape tomatotes.</li>
<li>Honey.</li>
<li>Dates.</li>
</ol>
<h2 id="prepare-your-food">Prepare your food</h2>
<h3 id="cut-up-the-chicken-breast">Cut up the chicken breast</h3>
<p>Just remove chicken breast. Then cut it up into small chunks.</p>
<h3 id="cut-up-the-herbs">Cut up the herbs</h3>
<p>I am using left-over coriander leaves to add some vitamins and flavor to my dinner. I just chop and chop and chop until I find the consistency that I like.</p>
<h3 id="mix-the-chicken-and-herbs">Mix the chicken and herbs</h3>
<p>I wasn&rsquo;t sure what all I would add to this yet, so I mixed in the herbs and chicken into bowl.  I tried it and felt like it was missing something.</p>
<h3 id="mix-in-some-greek-yogurt">Mix in some greek yogurt</h3>
<p>So next I added some greek yogrut. I like the fage 5%. Use whichver you like, but this is right one.</p>
<h3 id="cut-up-some-tomatoes">Cut up some tomatoes</h3>
<p>The consistency of the mix with just the yogurt, chicken, and herbs wasn&rsquo;t bad actually&hellip; but it wasn&rsquo;t really what I wasn&rsquo;t looking for.  Maybe if I had wanted something savory i could have used the base i had as is&hellip; anyways&hellip; Next i cut up some grape tomatoes. i cut maybe 8 or 9 into quarters. I mixed that in and things tasted better.</p>
<h3 id="cut-up-some-dates">Cut up some dates</h3>
<p>I decided that i wanted something a bit more sweet to go with my millet rice.  I added about 6 dates to the mix cut into 6 pieces each. This was a good choice.</p>
<h3 id="add-some-honey">Add some honey</h3>
<p>The mix was really good, but i wanted something sweet. Not quite desert sweet, but i wanted something to cut through the tanginess of the yogurt and the planty-ness of the 1 day old herbs. I added honey. Just a bit. Another good choice</p>
<h3 id="serve-with-millet-rice">Serve with millet-rice</h3>
<p>One of my favorite ways to eat grains is a mixture of millet, quinoa, and rice.  I&rsquo;ll detail the mixture in another post, but the basic mixture is</p>
<ol>
<li>2 parts rice</li>
<li>1 part millet</li>
<li>1 part quinoa</li>
</ol>
<p>I am no expert but this seems like a pretty healthy mixture of grains for nutrition.</p>
<h2 id="enjoy-with-your-cat">Enjoy with your cat</h2>
<p>So if you&rsquo;re making and reading this&hellip; i would imagine that you are a cat person like me. Idk how we get to this point in our lives.. but thats where we are.  Here is my boy watching me eat</p>
<p><img src="./images/casesar.jpg" alt="caesar"></p>
]]></content>
			<postid> f91dbcafc91e75d08a6121d7e19a867e</postid>
			<author>Justin Napolitano</author>
			<author_name>Justin Napolitano</author_name>
			<author_email>personal.jnapolitano@gmail.com</author_email>
			<author_id>87654367b2fca109e7dc9d3ea8a1ebbaf0bfe374773b148c2c20d278479add99</author_id>			
		</item>
		
		<item>
			<title>Automate Posting Hugo Blog to Social Sites...Second Attempt</title>
			<link>jnapolitano.com/posts/python-rss-reader/</link>
			<pubDate>Sat, 15 Jun 2024 22:36:34 -0500</pubDate>
			<guid>jnapolitano.com/posts/python-rss-reader/</guid>
			<description><![CDATA[How To automate posting to social sites]]></description>
			<content type="html"><![CDATA[<h2 id="thoughts-on-this-second-pass">Thoughts on This Second Pass</h2>
<ol>
<li>I will create a script that parses the sites rss feed&hellip;</li>
<li>it will then traverse the xml tree entries&hellip;</li>
<li>if a date is newer than the last publish date&hellip;</li>
<li>publish that post&hellip;</li>
</ol>
<p>I am still thinking through how to publish. I will likely write a monolithic script here, but ideally I would write an api or a batch processor to handle this in some way. I am currently thinking.</p>
<h2 id="create-a-script-that-parses-my-sites-rss-feed">Create a Script that Parses my Sites RSS Feed</h2>
<p>Pull last run date from a local file.. or from a bucket if running on the cloud.. I&rsquo;ll update this later</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s2">&#34;last_run.txt&#34;</span><span class="p">,</span> <span class="s2">&#34;r&#34;</span><span class="p">)</span> <span class="k">as</span> <span class="n">fp</span><span class="p">:</span>
    <span class="n">epoch</span> <span class="o">=</span> <span class="n">fp</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>

<span class="c1"># convert to integer</span>
<span class="n">epoch</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">epoch</span><span class="p">)</span>

</code></pre></div><h3 id="parse-the-rss-feed">Parse the rss feed</h3>
<p>Something like&hellip;</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python">
<span class="kn">import</span> <span class="nn">feedparser</span>

<span class="k">try</span><span class="p">:</span>
    <span class="n">NewsFeed</span> <span class="o">=</span> <span class="n">feedparser</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="s2">&#34;https://jnapolitano.com/index.xml&#34;</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">entry</span> <span class="ow">in</span> <span class="n">NewsFeed</span><span class="o">.</span><span class="n">entries</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">entry</span><span class="o">.</span><span class="n">published</span><span class="p">)</span>
<span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span> <span class="p">:</span>
    <span class="k">raise</span> <span class="n">e</span>

<span class="c1"># entry is returned in the following format and needs to be parsed into epoch</span>
<span class="c1"># Wed, 12 Jun 2024 00:00:00 +0000</span>


</code></pre></div><h3 id="convert-the-returned-date-to-epoch">Convert the returned date to epoch</h3>
<p>the given format is
<code>Wed, 12 Jun 2024 00:00:00 +0000</code></p>
<p>I&rsquo;ll have to conver that to epoch for a point of comparison. Some code below&hellip;</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python">
<span class="kn">from</span> <span class="nn">datetime</span> <span class="kn">import</span> <span class="n">datetime</span>
<span class="kn">import</span> <span class="nn">time</span>



<span class="c1"># The given date string</span>
<span class="n">date_str</span> <span class="o">=</span> <span class="s2">&#34;Wed, 12 Jun 2024 00:00:00 +0000&#34;</span>

<span class="c1"># Define the format of the date string</span>
<span class="n">date_format</span> <span class="o">=</span> <span class="s2">&#34;</span><span class="si">%a</span><span class="s2">, </span><span class="si">%d</span><span class="s2"> %b %Y %H:%M:%S %z&#34;</span>

<span class="c1"># Convert the date string to a datetime object</span>
<span class="n">dt</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">strptime</span><span class="p">(</span><span class="n">date_str</span><span class="p">,</span> <span class="n">date_format</span><span class="p">)</span>

<span class="c1"># Convert the datetime object to a timestamp (epoch time)</span>
<span class="n">epoch_time</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">dt</span><span class="o">.</span><span class="n">timestamp</span><span class="p">())</span>

<span class="nb">print</span><span class="p">(</span><span class="n">epoch_time</span><span class="p">)</span>

</code></pre></div><h3 id="compare-the-returned-date-to-the-last-run-date">Compare the returned date to the last run date</h3>
<p>This is the really important step. I am currently just printing true&hellip; but in the next post i will write a script that actually publishes the information to socials.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python">
<span class="k">if</span> <span class="n">publish_date_epoch</span> <span class="o">&gt;</span> <span class="n">last_run_epoch</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
</code></pre></div><h3 id="write-latest-to-file-when-traversal-is-complete">Write latest to file when traversal is complete</h3>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="k">def</span> <span class="nf">write_current_dt_to_file</span><span class="p">(</span><span class="n">file_name</span> <span class="o">=</span> <span class="s2">&#34;last_run.txt&#34;</span><span class="p">):</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="c1"># Get the current epoch time</span>
        <span class="n">current_epoch_time</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">())</span>

        <span class="c1"># Write the current epoch time to the file</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">file_name</span><span class="p">,</span> <span class="s2">&#34;w&#34;</span><span class="p">)</span> <span class="k">as</span> <span class="n">file</span><span class="p">:</span>
            <span class="n">file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">current_epoch_time</span><span class="p">))</span>
        <span class="k">return</span> <span class="kc">True</span>
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">e</span>
</code></pre></div><h3 id="putting-it-all-together">Putting it all together</h3>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python">


<span class="kn">from</span> <span class="nn">datetime</span> <span class="kn">import</span> <span class="n">datetime</span>
<span class="kn">import</span> <span class="nn">time</span>


<span class="c1"># convert to integer</span>
<span class="k">def</span> <span class="nf">get_last_run</span><span class="p">():</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s2">&#34;last_run.txt&#34;</span><span class="p">,</span> <span class="s2">&#34;r&#34;</span><span class="p">)</span> <span class="k">as</span> <span class="n">fp</span><span class="p">:</span>
            <span class="n">epoch</span> <span class="o">=</span> <span class="n">fp</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>

        <span class="n">epoch</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">epoch</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">epoch</span>
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">e</span>

<span class="k">def</span> <span class="nf">get_news_feed</span><span class="p">():</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">NewsFeed</span> <span class="o">=</span> <span class="n">feedparser</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="s2">&#34;https://jnapolitano.com/index.xml&#34;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">NewsFeed</span>
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">e</span>


<span class="k">def</span> <span class="nf">convert_to_epoch</span><span class="p">(</span><span class="n">given</span><span class="p">):</span>

    <span class="k">try</span><span class="p">:</span> 
        <span class="c1"># The given date string</span>
        <span class="n">date_str</span> <span class="o">=</span> <span class="n">given</span>

        <span class="c1"># Define the format of the date string</span>
        <span class="n">date_format</span> <span class="o">=</span> <span class="s2">&#34;</span><span class="si">%a</span><span class="s2">, </span><span class="si">%d</span><span class="s2"> %b %Y %H:%M:%S %z&#34;</span>

        <span class="c1"># Convert the date string to a datetime object</span>
        <span class="n">dt</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">strptime</span><span class="p">(</span><span class="n">date_str</span><span class="p">,</span> <span class="n">date_format</span><span class="p">)</span>

        <span class="c1"># Convert the datetime object to a timestamp (epoch time)</span>
        <span class="n">epoch_time</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">dt</span><span class="o">.</span><span class="n">timestamp</span><span class="p">())</span>

        <span class="k">return</span> <span class="n">epoch_time</span>
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">e</span>

<span class="k">def</span> <span class="nf">write_current_dt_to_file</span><span class="p">(</span><span class="n">file_name</span> <span class="o">=</span> <span class="s2">&#34;last_run.txt&#34;</span><span class="p">):</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="c1"># Get the current epoch time</span>
        <span class="n">current_epoch_time</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">())</span>

        <span class="c1"># Write the current epoch time to the file</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">file_name</span><span class="p">,</span> <span class="s2">&#34;w&#34;</span><span class="p">)</span> <span class="k">as</span> <span class="n">file</span><span class="p">:</span>
            <span class="n">file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">current_epoch_time</span><span class="p">))</span>
        <span class="k">return</span> <span class="kc">True</span>
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">e</span>



<span class="k">try</span><span class="p">:</span>
    <span class="n">last_run_epoch</span> <span class="o">=</span> <span class="n">get_last_run</span><span class="p">()</span>
    <span class="n">NewsFeed</span> <span class="o">=</span> <span class="n">get_news_feed</span><span class="p">()</span>
   
    <span class="k">for</span> <span class="n">entry</span> <span class="ow">in</span> <span class="n">NewsFeed</span><span class="o">.</span><span class="n">entries</span><span class="p">:</span>
        <span class="n">given</span> <span class="o">=</span> <span class="n">entry</span><span class="o">.</span><span class="n">published</span>
        <span class="c1"># print(given)</span>
        <span class="c1"># print(convert_to_epoch(given))</span>
        <span class="n">publish_date_epoch</span> <span class="o">=</span> <span class="n">convert_to_epoch</span><span class="p">(</span><span class="n">given</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">publish_date_epoch</span> <span class="o">&gt;</span> <span class="n">last_run_epoch</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
            <span class="c1"># in the next pass this will run the social update workflow</span>
    
    <span class="c1"># run the write epoch to file function</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">write_current_dt_to_file</span><span class="p">()</span>


<span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span> <span class="p">:</span>
    <span class="k">raise</span> <span class="n">e</span>

</code></pre></div><h2 id="next-steps">Next Steps</h2>
<p>I need to write the publishing application. I haven&rsquo;t figure out how I&rsquo;ll do that yet. I want to do some cool things, but tbh it is probably overkill for my use case. I will think on it.</p>
]]></content>
			<postid> e96b7764cd0230e572e3fcffb07caf32</postid>
			<author>Justin Napolitano</author>
			<author_name>Justin Napolitano</author_name>
			<author_email>personal.jnapolitano@gmail.com</author_email>
			<author_id>87654367b2fca109e7dc9d3ea8a1ebbaf0bfe374773b148c2c20d278479add99</author_id>			
		</item>
		
		<item>
			<title>Automate Posting Hugo Blog to Social Sites... Failure</title>
			<link>jnapolitano.com/posts/hugo-social-publisher/</link>
			<pubDate>Sat, 15 Jun 2024 00:00:00 +0000</pubDate>
			<guid>jnapolitano.com/posts/hugo-social-publisher/</guid>
			<description><![CDATA[How not to automate posting to social sites]]></description>
			<content type="html"><![CDATA[<h2 id="why">Why</h2>
<p>I have a hugo blog that is a pian to share across my social feeds. I want to automate it.</p>
<h2 id="create-a-mockup">Create a mockup</h2>
<p>For this I quickly sketched out my thoughts onto a writing pad.  My thinking is that I will drop a yaml file into each post directory to be read by a a python application calling social apis.</p>
<h4 id="mockup">Mockup</h4>
<p>As you can see this is very rudimentary. I will traverse the posts directories looking for a publish.yaml file that will help a python program to auto-generate some arguments to pass to some apis.</p>
<p><img src="./images/auto-post-sketch.jpg" alt="mock-up"></p>
<h3 id="mockup-a-yaml-file">Mockup a yaml file</h3>
<p>So I&rsquo;m thinking that my file will have a pretty basic structure something like.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="nt">mastodon</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="w">
</span><span class="w"></span><span class="nt">x </span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="w">
</span><span class="w"></span><span class="nt">linkedin </span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="w">
</span></code></pre></div><h3 id="mockup-the-json-config-file">Mockup the json config file</h3>
<p>I do not know which arguments the apis will need but I&rsquo;m going to guess I&rsquo;ll need something like&hellip;</p>
<ul>
<li>Post body</li>
<li>Tags</li>
</ul>
<p>I might need some other open graph items, but I am hoping that these can be pulled from the rendered html.. we&rsquo;ll see.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-json" data-lang="json"><span class="p">{</span>
    <span class="nt">&#34;urls: [
</span><span class="nt">    {
</span><span class="nt">    &#34;</span><span class="err">post-url</span><span class="s2">&#34;: &#34;</span><span class="err">$GENERATED</span> <span class="err">BY</span> <span class="err">DIRECTORY</span><span class="s2">&#34;,
</span><span class="s2">    &#34;</span><span class="err">post-body</span><span class="s2">&#34;:&#34;</span><span class="err">GENERATED</span> <span class="err">BY</span> <span class="err">POST</span> <span class="err">DESCRIPTION</span><span class="s2">&#34;,
</span><span class="s2">    &#34;</span><span class="err">post-tags</span><span class="s2">&#34;: &#34;</span><span class="err">GENERATED</span> <span class="err">BY</span> <span class="err">POST</span> <span class="err">TAGS</span><span class="s2">&#34;,
</span><span class="s2">    &#34;</span><span class="err">mastodon</span><span class="s2">&#34; :{
</span><span class="s2">        &#34;</span><span class="err">publish</span><span class="s2">&#34;:true,
</span><span class="s2">        &#34;</span><span class="err">publish-date</span><span class="s2">&#34;:epoch_date,
</span><span class="s2">        &#34;</span><span class="err">publish-data&#34;</span><span class="p">:</span> <span class="err">Whatever</span> <span class="err">is</span> <span class="err">returned</span> <span class="err">by</span> <span class="err">the</span> <span class="err">api</span>
        <span class="p">}</span>
    <span class="err">}</span>
    <span class="err">]</span>
</code></pre></div><h3 id="mockup-the-python-publisher">Mockup the python publisher</h3>
<p>I am sure there is a better way to do this. Maybe a more dynamic way? I am just writing quickly to get this done. I&rsquo;ll 100% revisit this when I actually write the program and experiment.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python">

<span class="k">for</span> <span class="n">url</span> <span class="ow">in</span> <span class="n">urls</span><span class="p">:</span>
    <span class="n">args</span> <span class="o">=</span> <span class="s2">&#34;</span><span class="se">\n</span><span class="s2">&#34;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">url</span><span class="p">[</span><span class="s1">&#39;post-body&#39;</span><span class="p">],</span><span class="n">url</span><span class="p">[</span><span class="s1">&#39;post-url&#39;</span><span class="p">],</span><span class="s2">&#34;# &#34;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">url</span><span class="p">[</span><span class="s1">&#39;post-tags&#39;</span><span class="p">])])</span>
    <span class="k">if</span> <span class="n">url</span><span class="p">[</span><span class="s1">&#39;mastodon&#39;</span><span class="p">]][</span><span class="s2">&#34;publish&#34;</span><span class="p">]:</span>
        
        <span class="n">publish_mastodon_article</span><span class="p">(</span><span class="n">args</span><span class="o">=</span><span class="n">args</span><span class="p">)</span>

    <span class="k">elif</span> <span class="n">url</span><span class="p">[</span><span class="s1">&#39;facebook&#39;</span><span class="p">][</span><span class="s2">&#34;publish&#34;</span><span class="p">]:</span>
        <span class="n">publish_facebook_article</span><span class="p">(</span><span class="n">args</span><span class="o">=</span><span class="n">args</span><span class="p">)</span>

</code></pre></div><h3 id="mockup-the-python-directory-walker">Mockup the python directory walker</h3>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="kn">import</span> <span class="nn">os</span>

<span class="n">content_dirs</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&#34;content/posts&#34;</span><span class="p">]</span>
<span class="n">out</span><span class="o">-</span><span class="n">paths</span> <span class="o">=</span> <span class="p">[]</span>

<span class="k">for</span> <span class="nb">dir</span> <span class="ow">in</span> <span class="n">content_dirs</span><span class="p">:</span>
    <span class="k">for</span> <span class="n">root</span><span class="p">,</span> <span class="n">dirs</span><span class="p">,</span> <span class="n">files</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">walk</span><span class="p">(</span><span class="nb">dir</span><span class="p">,</span> <span class="n">topdown</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
    <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">files</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">root</span><span class="p">,</span> <span class="n">name</span><span class="p">))</span>
        <span class="n">files</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">root</span><span class="p">,</span><span class="n">name</span><span class="p">))</span>

<span class="k">for</span> <span class="n">path</span> <span class="ow">in</span> <span class="n">out_paths</span>
    <span class="n">generate_json_config</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
    <span class="c1"># for name in dirs:</span>
    <span class="c1">#     print(os.path.join(root, name))</span>
</code></pre></div><h3 id="mockup-the-yaml-reader">Mockup the yaml reader</h3>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="kn">import</span> <span class="nn">pyyaml</span>

<span class="k">def</span> <span class="nf">generate_json_config</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
    <span class="n">json_gibberish</span> <span class="o">=</span> <span class="p">{</span>
                <span class="s2">&#34;post-url&#34;</span><span class="p">:</span> <span class="s2">&#34;jnapolitano.com/en/&#34;</span> <span class="o">+</span> <span class="n">path</span><span class="p">,</span>
                <span class="s2">&#34;post-body&#34;</span><span class="p">:</span> <span class="n">null</span><span class="p">,</span>
                <span class="s2">&#34;post-tags&#34;</span><span class="p">:</span> <span class="n">null</span><span class="p">,</span>
                <span class="s2">&#34;mastodon&#34;</span> <span class="p">:{</span>
                    <span class="s2">&#34;publish&#34;</span><span class="p">:</span><span class="n">false</span><span class="p">,</span>
                    <span class="s2">&#34;publish-date&#34;</span><span class="p">:</span><span class="n">null</span><span class="p">,</span>
                    <span class="s2">&#34;publish-data&#34;</span><span class="p">:</span> <span class="n">null</span>
            <span class="p">}</span>
    <span class="p">}</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="n">yaml_path</span> <span class="o">=</span> <span class="n">path</span> <span class="o">+</span> <span class="n">publish</span><span class="o">.</span><span class="n">yaml</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">yaml_path</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">yaml_gibberish</span><span class="p">:</span>
            <span class="c1">#whatver the yaml code is insert here... basiclly just translate it over to json and return</span>
            <span class="n">yaml_json</span> <span class="o">-</span> <span class="n">yaml_gibberish</span><span class="o">.</span><span class="n">to_json</span><span class="p">()</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">json_gibberish</span><span class="p">[</span><span class="s1">&#39;mastodon&#39;</span><span class="p">][</span><span class="s2">&#34;publish&#34;</span><span class="p">]</span> <span class="o">=</span> <span class="n">yaml_json</span><span class="p">[</span><span class="s2">&#34;mastodon&#34;</span><span class="p">]</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&#34;No mastodon setting passing default to no&#34;</span><span class="p">)</span>
            <span class="n">json_gibberish</span><span class="p">[</span><span class="s1">&#39;mastodon&#39;</span><span class="p">][</span><span class="s2">&#34;publish&#34;</span><span class="p">]</span> <span class="o">=</span> <span class="n">false</span>
    
    <span class="k">return</span> <span class="n">json_gibberish</span>
</code></pre></div><h2 id="scrap-everything-and-change-course">Scrap Everything and Change Course</h2>
<p>So as I was writing the above, I came up with another solution. Writing out a mockup of the code made the entire thing feel to kludgy. I don&rsquo;t like writing to file&hellip; keeping configs up to date.. etc.  I will write an rss feed tracker that will just listen to the published site and then run the social jobs when the xml is updated.</p>
<h3 id="my-new-approach">My new approach</h3>
<p>My thinking is that I will add some options to the front matter of the posts that can easily be scraped from the rendered html.  The advantage of this approach is that it will permit me to always be up to date.  I will not add a republish feature&hellip; yet. I might but that will be another option.</p>
<h3 id="stay-tuned">Stay tuned</h3>
<p>I am breaking away from this post as I am changing direction. So in the mean time here is a photo of my cat.</p>
<p><img src="/images/featured-caesar.jpg" alt="&lsquo;caesar"></p>
]]></content>
			<postid> 38c3ecc9a62587a9ae67c0b4d7332487</postid>
			<author>Justin Napolitano</author>
			<author_name>Justin Napolitano</author_name>
			<author_email>personal.jnapolitano@gmail.com</author_email>
			<author_id>87654367b2fca109e7dc9d3ea8a1ebbaf0bfe374773b148c2c20d278479add99</author_id>			
		</item>
		
		<item>
			<title>JB &#39;Welding&#39; My Bumper</title>
			<link>jnapolitano.com/posts/accord-bumper-weld/</link>
			<pubDate>Fri, 14 Jun 2024 00:00:00 +0000</pubDate>
			<guid>jnapolitano.com/posts/accord-bumper-weld/</guid>
			<description><![CDATA[JB Welding a bumper]]></description>
			<content type="html"><![CDATA[<!-- raw HTML omitted -->
<p>So, I snagged my already hanging on by a thread bumper on a piece of rebar. I reversed thinking it was a small bump in the parking lot&hellip; I was wrong.</p>
<h2 id="why">Why</h2>
<p>Bumpers are expensive. I am looking at around $400.00 of bumper + paint if I try to do this on my own. Taking it to the shop&hellip; yeah I won&rsquo;t do that.  So, rather than trying to make the prettiest beater in the car lot, I am going to make it at least a functional beater.</p>
<h2 id="tools">Tools</h2>
<p>I don&rsquo;t really need much of anything for this one, but like always I have a razor blade, a flat head, and a phillips in my overall pockets.</p>
<h2 id="jb-weld">Jb Weld</h2>
<p>I used <a href="https://www.amazon.com/J-B-Weld-50176-KwikWeld-Reinforced/dp/B009EU5ZMA/ref=sr_1_9?crid=E7906IRBRALN&amp;dib=eyJ2IjoiMSJ9.H2AK46mHNlIUo4r-NYZbhYIKI4RetkiJACCrYWumMLNg1qa9S3ng3fxU427OaLfPN4ZODtnZCdNrvbpecLryLyHYMnFiVQbTdSto4IE5ypCvF6CwCm9Hq_E4h1WusqSuxUbdmB11XZ-gupPWJkgVGJpzYRNLmJ4e4mv5WNF3xFbEN9R7p5zP9ZKGvixdCfkxKPSs3MmMIVwEoTRSmKsbatGKPDz5gC_YAgdxIZqr-e8.lSvh4Kpw7vBPORArKFP3njWeNd_JkACbvUe8dsy4JMQ&amp;dib_tag=se&amp;keywords=jb+weld&amp;qid=1718407395&amp;sprefix=jb+weld%2Caps%2C107&amp;sr=8-9">this version of jb weld</a> because it was inexpensive and kinda matched the color of my car.</p>
<h2 id="fix-the-brackets">Fix the brackets</h2>
<p>So on my car there are two brackets underneath the wheel well that broke. On one side the plastic around the screw holding the bumper to the bracket cracked. On the other side the bracket that attaches to the impact bar snapped completely off.</p>
<h3 id="start-on-the-easier-side">Start on the easier side</h3>
<p>So the side with the broken attachment point is pretty easy to fix. My goal is not really to make it strong. My goal is only to hold the bumper to the mounting screw until I (if I ever do ) replace the bumper.  Yeah it is kind of annoying, but I&rsquo;ll rip that off and replace the screw when the time comes.</p>
<h4 id="weld-that-plastic-to-the-metal">Weld that plastic to the metal</h4>
<p><img src="./photos/ghetto-left.jpg" alt="ghetto-left"></p>
<h3 id="move-on-to-the-harder-side">Move on to the harder side</h3>
<p>The right side is a little bit more difficult because the bracket itself snapped off. IF it aligned perfectly with the plastic on the other side, it would be an easy fix&hellip; unfortunately it does not. So to fix this one I&rsquo;ll need to rig something up to hold the bumper in place as the resin sets.</p>
<p>I went with this beatiful set up below.  A trekking pole up against the mounting screw holds the mount against the bit of plastic behind it. The box containing a jack stand holds the bumper just far enough back to make sure that the &lsquo;rig&rsquo; does stays exactly where it needs to stay.</p>
<h4 id="the-stick-to-the-screw">The stick to the screw</h4>
<p><img src="./photos/ghetto-weld-idk.jpg" alt="ghetto-weld-idk"></p>
<h4 id="the-box-and-the-bumper">The box and the bumper</h4>
<p><img src="./photos/ghetto-weld-far.jpg" alt="ghetto-right-far"></p>
<h4 id="the-whole-thing-looking-great">The whole thing looking great</h4>
<p><img src="./photos/ghetto-far.jpg" alt="ghetto-far"></p>
]]></content>
			<postid> 91d7735107250b364d13f0bd2dbbe73d</postid>
			<author>Justin Napolitano</author>
			<author_name>Justin Napolitano</author_name>
			<author_email>personal.jnapolitano@gmail.com</author_email>
			<author_id>87654367b2fca109e7dc9d3ea8a1ebbaf0bfe374773b148c2c20d278479add99</author_id>			
		</item>
		
		<item>
			<title>Justin-ify a Car Headliner</title>
			<link>jnapolitano.com/posts/accord-headliner/</link>
			<pubDate>Fri, 14 Jun 2024 00:00:00 +0000</pubDate>
			<guid>jnapolitano.com/posts/accord-headliner/</guid>
			<description><![CDATA[Installing a suitable headliner]]></description>
			<content type="html"><![CDATA[<p>My beautiful 12 year old Honda has a bad headliner.  It was gross. I did not like it.</p>
<p><img src="./photos/my-baby-2.jpg" alt="my-baby"></p>
<h2 id="why">Why</h2>
<p>The foam holding it in place to the headliner board deteriorated. The car is too old to make it perfect so any headliner fabric will work.</p>
<h2 id="find-a-suitable-headliner-replacement-fabric">Find a suitable headliner replacement fabric</h2>
<p>I live in Texas and its hot. Really hot.  Without some insulation the heat from the sun would bake me inside my car.  I have an old quilt with some sort of poly batting that I will use for the headliner.</p>
<p><img src="./photos/quilt-1.jpg" alt="old quilt"></p>
<h2 id="use-some-mylar">Use some mylar</h2>
<p>I also have some old emergency blankets that I use for various projects and to build kits when I go out camping.  I plan to add a sheet or two to the top of the board to make sure to help reflect some of the summer heat away from the passenger compartment.</p>
<h2 id="remove-the-headliner">Remove the headliner</h2>
<p>The headliner is held together by just a few plastic rivets and the accessories in the the roof. Reference the video below</p>
<!-- raw HTML omitted -->

<div style="position: relative; padding-bottom: 56.25%; height: 0; overflow: hidden;">
  <iframe src="https://www.youtube.com/embed/jVpBV9uR7Z8" style="position: absolute; top: 0; left: 0; width: 100%; height: 100%; border:0;" allowfullscreen title="YouTube Video"></iframe>
</div>

<h3 id="peeling-off-the-headliner">Peeling off the headliner</h3>
<p>The foam on my headliner had completely deteriorated. I would recommend using a mask and safety glasses for this part of the job.</p>
<h3 id="remove-the-fabric">Remove the fabric</h3>
<p>The fabric is easy to peel off.  Just start by pulling it away.</p>
<h3 id="remove-the-excess-foam">Remove the excess foam</h3>
<p>I made a mistake when I first started by using a wet brush that only caused the adhesive to stick everywhere. Once I let the brush dry, I took it to the board and scrubbed as much of the old foam away as I could.  I then took used adhesive remover to remove the old glue. After the solvent did its work I rinsed the whole thing off with a slightly damp rag</p>
<h2 id="install-the-new-headliner">Install the new headliner</h2>
<h3 id="cut-the-new-headliner">Cut the new headliner</h3>
<p>First place the headliner material onto the board.  Then, put the accessories removed from the headliner in the previous steps into place.  With a razor cut holes in the board to fit the accessories. Place them through the headliner as if they were attached to the board.  When all are in place cut the excess headliner material around the board leaving about 2 inches or so to fold around the edges.</p>
<h3 id="glue-to-the-board">Glue to the board</h3>
<p>Use a headliner adhesive. I used a 3M headliner adhesive that seems to have worked well and is holding up in the summer heat.</p>
<p>I adhered the headliner in strips starting at the top of the board moving to the back. I went about a quarter of the board at a time and placed the accessories into their correct spots as I glued.</p>
<h3 id="wait-to-set">Wait to set</h3>
<p>The adhesive sets quickly, but I let it sit for about two hours prior to working with it again.</p>
<h2 id="install-the-mylar">Install the mylar</h2>
<p>On the back of the board I laid out a sheet of mylar and cut holes in it to allow the plastic rivets and accessories to connect to the sheet metal of the roof of the car. I then sprayed the whole thing down with adhesive.  This was an easy step and far more forgiving than the headliner because it is out of site.</p>
<h2 id="reinstalling-the-headliner-board">Reinstalling the headliner board</h2>
<h3 id="get-the-board-in-the-car">Get the board in the car</h3>
<p>To get the board back into the car, I had to remove the head supports from the the seats and move the seats as far back as possible. I then pushed the back of the board into the car first and slowly maneuvered the board into place.</p>
<h3 id="reattach-the-board">Reattach the board</h3>
<p>I just went in reverse from removal. It was a simple process.</p>
<h3 id="reattach-the-headliner-accessories">Reattach the headliner accessories</h3>
<p>Again go in reverse from what you had done previously.  If the accessories do not fit then some of the headliner material will likely need to be removed so the plastic can attach to the correct points in the sheet metal.</p>
<h2 id="finished-product">Finished product</h2>
<p>The finished headliner looks okay..I admit it looks kinda diy, but that is the thrill of doing things like this.  The quilt goes well enough with the car to not be annoying.  The mylar sheets work surprisingly well. I am considering going back and filling the empty space with aluminum foil clumps to improve the insulating power.</p>
<p><img src="./photos/roof_1.jpg" alt="headliner-1">
<img src="./photos/roof_2.jpg" alt="headliner-2">
<img src="./photos/roof_3.jpg" alt="headliner-3"></p>
]]></content>
			<postid> b87d44b2b2bd7dc3d130a2a172095e70</postid>
			<author>Justin Napolitano</author>
			<author_name>Justin Napolitano</author_name>
			<author_email>personal.jnapolitano@gmail.com</author_email>
			<author_id>87654367b2fca109e7dc9d3ea8a1ebbaf0bfe374773b148c2c20d278479add99</author_id>			
		</item>
		
		<item>
			<title>Hugo Build and Deploy GH Workflow</title>
			<link>jnapolitano.com/posts/gh-pages-workflow/</link>
			<pubDate>Tue, 11 Jun 2024 00:00:00 +0000</pubDate>
			<guid>jnapolitano.com/posts/gh-pages-workflow/</guid>
			<description><![CDATA[Hugo Build GH Workflow]]></description>
			<content type="html"><![CDATA[<h1 id="creating-a-gh-workflow-to-build-and-deploy-a-hugo-site-to-gh-pages">Creating a GH Workflow to Build and Deploy a hugo site to gh-pages</h1>
<h2 id="why">Why</h2>
<p>To simplify the build process.</p>
<h2 id="creating-the-workflow">Creating the Workflow</h2>
<h3 id="create-your-yaml-config-file">create your yaml config file</h3>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash">touch hugo.yaml
</code></pre></div><h3 id="set-the-trigger-and-the-environment-defaults">Set the trigger and the environment defaults</h3>
<p>The code below creates a trigger on push from the main and the gh-pages branches.  It also sets read and write permissions to permit executing code and building hugo.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="nt">on</span><span class="p">:</span><span class="w">
</span><span class="w">  </span><span class="c"># Runs on pushes targeting the default branch</span><span class="w">
</span><span class="w">  </span><span class="nt">push</span><span class="p">:</span><span class="w">
</span><span class="w">    </span><span class="nt">branches</span><span class="p">:</span><span class="w">
</span><span class="w">      </span>- <span class="l">main</span><span class="w">
</span><span class="w">      </span><span class="c"># - pit</span><span class="w">
</span><span class="w">      </span><span class="c"># - ghpages</span><span class="w">
</span><span class="w">      </span>- <span class="l">gh-pages</span><span class="w">
</span><span class="w">
</span><span class="w">  </span><span class="c"># Allows you to run this workflow manually from the Actions tab</span><span class="w">
</span><span class="w">  </span><span class="nt">workflow_dispatch</span><span class="p">:</span><span class="w">
</span><span class="w">
</span><span class="w"></span><span class="c"># Sets permissions of the GITHUB_TOKEN to allow deployment to GitHub Pages</span><span class="w">
</span><span class="w"></span><span class="nt">permissions</span><span class="p">:</span><span class="w">
</span><span class="w">  </span><span class="nt">contents</span><span class="p">:</span><span class="w"> </span><span class="l">read</span><span class="w">
</span><span class="w">  </span><span class="nt">pages</span><span class="p">:</span><span class="w"> </span><span class="l">write</span><span class="w">
</span><span class="w">  </span><span class="nt">id-token</span><span class="p">:</span><span class="w"> </span><span class="l">write</span><span class="w">
</span><span class="w">
</span><span class="w"></span><span class="c"># Allow only one concurrent deployment, skipping runs queued between the run in-progress and latest queued.</span><span class="w">
</span><span class="w"></span><span class="c"># However, do NOT cancel in-progress runs as we want to allow these production deployments to complete.</span><span class="w">
</span><span class="w"></span><span class="nt">concurrency</span><span class="p">:</span><span class="w">
</span><span class="w">  </span><span class="nt">group</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;pages&#34;</span><span class="w">
</span><span class="w">  </span><span class="nt">cancel-in-progress</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="w">
</span><span class="w">
</span><span class="w"></span><span class="c"># Default to bash</span><span class="w">
</span><span class="w"></span><span class="nt">defaults</span><span class="p">:</span><span class="w">
</span><span class="w">  </span><span class="nt">run</span><span class="p">:</span><span class="w">
</span><span class="w">    </span><span class="nt">shell</span><span class="p">:</span><span class="w"> </span><span class="l">bash</span><span class="w">
</span></code></pre></div><h3 id="define-the-jobs">Define the jobs</h3>
<p>There will be 2 jobs in this workflow</p>
<ul>
<li>The build job</li>
<li>The Deploy job</li>
</ul>
<h4 id="build-job">Build job</h4>
<ul>
<li>Runs an ubuntu vm</li>
<li>Install Hugo from scrip</li>
<li>installs dart sass</li>
<li>setsup pages</li>
<li>configures pages using the gh defaults flow</li>
<li>installs node.js dependencies to host and build js modules within most sites</li>
<li>hugo build to actually build the site</li>
<li>upload the artifact to gh pages for hosting</li>
</ul>
<h4 id="the-deploy-job">The Deploy job</h4>
<ul>
<li>Runs on an ubuntu vm</li>
<li>runs the gh deploy pages action <code>actions/deploy-pages@v4</code></li>
</ul>
<h4 id="code">Code</h4>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="nt">jobs</span><span class="p">:</span><span class="w">
</span><span class="w">  </span><span class="c"># Build job</span><span class="w">
</span><span class="w">  </span><span class="nt">build</span><span class="p">:</span><span class="w">
</span><span class="w">    </span><span class="nt">runs-on</span><span class="p">:</span><span class="w"> </span><span class="l">ubuntu-latest</span><span class="w">
</span><span class="w">    </span><span class="nt">env</span><span class="p">:</span><span class="w">
</span><span class="w">      </span><span class="nt">HUGO_VERSION</span><span class="p">:</span><span class="w"> </span><span class="m">0.124.0</span><span class="w">
</span><span class="w">    </span><span class="nt">steps</span><span class="p">:</span><span class="w">
</span><span class="w">      </span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">Install Hugo CLI</span><span class="w">
</span><span class="w">        </span><span class="nt">run</span><span class="p">:</span><span class="w"> </span><span class="p">|</span><span class="sd">
</span><span class="sd">          wget -O ${{ runner.temp }}/hugo.deb https://github.com/gohugoio/hugo/releases/download/v${HUGO_VERSION}/hugo_extended_${HUGO_VERSION}_linux-amd64.deb \
</span><span class="sd">          &amp;&amp; sudo dpkg -i ${{ runner.temp }}/hugo.deb          </span><span class="w">          
</span><span class="w">      </span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">Install Dart Sass</span><span class="w">
</span><span class="w">        </span><span class="nt">run</span><span class="p">:</span><span class="w"> </span><span class="l">sudo snap install dart-sass</span><span class="w">
</span><span class="w">      </span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">Checkout</span><span class="w">
</span><span class="w">        </span><span class="nt">uses</span><span class="p">:</span><span class="w"> </span><span class="l">actions/checkout@v4</span><span class="w">
</span><span class="w">        </span><span class="nt">with</span><span class="p">:</span><span class="w">
</span><span class="w">          </span><span class="nt">submodules</span><span class="p">:</span><span class="w"> </span><span class="l">recursive</span><span class="w">
</span><span class="w">          </span><span class="nt">fetch-depth</span><span class="p">:</span><span class="w"> </span><span class="m">0</span><span class="w">
</span><span class="w">      </span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">Setup Pages</span><span class="w">
</span><span class="w">        </span><span class="nt">id</span><span class="p">:</span><span class="w"> </span><span class="l">pages</span><span class="w">
</span><span class="w">        </span><span class="nt">uses</span><span class="p">:</span><span class="w"> </span><span class="l">actions/configure-pages@v4</span><span class="w">
</span><span class="w">      </span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">Install Node.js dependencies</span><span class="w">
</span><span class="w">        </span><span class="nt">run</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;[[ -f package-lock.json || -f npm-shrinkwrap.json ]] &amp;&amp; npm ci || true&#34;</span><span class="w">
</span><span class="w">      </span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">Build with Hugo</span><span class="w">
</span><span class="w">        </span><span class="nt">env</span><span class="p">:</span><span class="w">
</span><span class="w">          </span><span class="c"># For maximum backward compatibility with Hugo modules</span><span class="w">
</span><span class="w">          </span><span class="nt">HUGO_ENVIRONMENT</span><span class="p">:</span><span class="w"> </span><span class="l">production</span><span class="w">
</span><span class="w">          </span><span class="nt">HUGO_ENV</span><span class="p">:</span><span class="w"> </span><span class="l">production</span><span class="w">
</span><span class="w">        </span><span class="nt">run</span><span class="p">:</span><span class="w"> </span><span class="p">|</span><span class="sd">
</span><span class="sd">          hugo \
</span><span class="sd">            --gc \
</span><span class="sd">            --minify \
</span><span class="sd">            --baseURL &#34;${{ steps.pages.outputs.base_url }}/&#34;          </span><span class="w">          
</span><span class="w">      </span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">Upload artifact</span><span class="w">
</span><span class="w">        </span><span class="nt">uses</span><span class="p">:</span><span class="w"> </span><span class="l">actions/upload-pages-artifact@v3</span><span class="w">
</span><span class="w">        </span><span class="nt">with</span><span class="p">:</span><span class="w">
</span><span class="w">          </span><span class="nt">path</span><span class="p">:</span><span class="w"> </span><span class="l">./public</span><span class="w">
</span><span class="w">
</span><span class="w">  </span><span class="c"># Deployment job</span><span class="w">
</span><span class="w">  </span><span class="nt">deploy</span><span class="p">:</span><span class="w">
</span><span class="w">    </span><span class="nt">environment</span><span class="p">:</span><span class="w">
</span><span class="w">      </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">github-pages</span><span class="w">
</span><span class="w">      </span><span class="nt">url</span><span class="p">:</span><span class="w"> </span><span class="l">${{ steps.deployment.outputs.page_url }}</span><span class="w">
</span><span class="w">    </span><span class="nt">runs-on</span><span class="p">:</span><span class="w"> </span><span class="l">ubuntu-latest</span><span class="w">
</span><span class="w">    </span><span class="nt">needs</span><span class="p">:</span><span class="w"> </span><span class="l">build</span><span class="w">
</span><span class="w">    </span><span class="nt">steps</span><span class="p">:</span><span class="w">
</span><span class="w">      </span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">Deploy to GitHub Pages</span><span class="w">
</span><span class="w">        </span><span class="nt">id</span><span class="p">:</span><span class="w"> </span><span class="l">deployment</span><span class="w">
</span><span class="w">        </span><span class="nt">uses</span><span class="p">:</span><span class="w"> </span><span class="l">actions/deploy-pages@v4</span><span class="w">
</span></code></pre></div><h3 id="full-document">Full Document</h3>
<p>Find the most up to date file here <code>https://github.com/justin-napolitano/gh-pages-workflow.git</code></p>
<h2 id="integrating-the-hugo-build-jobs-into-your-workflow">Integrating the hugo build jobs into your workflow</h2>
<p>From your hugo project root</p>
<h3 id="initialize-a-git-repo-if-not-already-done">Initialize a git repo if not already done</h3>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash">git init <span class="o">&amp;&amp;</span> git add . <span class="o">&amp;&amp;</span> git commit -m <span class="s2">&#34;initialize&#39; 
</span><span class="s2">
</span></code></pre></div><h3 id="push-to-remote">Push to remote</h3>
<p>I use the gh cli.  Follow the official gh documentation to install <a href="%22https://cli.github.com/manual/">Official Documentation</a></p>
<p>Run the following and follow the prompts.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash">gh repo create
</code></pre></div><h3 id="make-the-workflow-directory">Make the workflow directory</h3>
<p>From the git root run the following.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash">mkdir .github/workflows
</code></pre></div><h3 id="copy-the-hugo-file-to-the-directory">Copy the hugo file to the directory</h3>
<p>In my case I will just download the file that have already created and maintain by running the following from repo root.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="nb">cd</span> .github/workflows <span class="o">&amp;&amp;</span> wget https://raw.githubusercontent.com/justin-napolitano/gh-pages-workflow/main/hugo.yaml <span class="o">&amp;&amp;</span> <span class="nb">cd</span> ../.. 
</code></pre></div><h3 id="push">Push</h3>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash">git add . <span class="o">&amp;&amp;</span> git commit -m <span class="s2">&#34;creating the hugo build workflow&#34;</span> <span class="o">&amp;&amp;</span> git push 
</code></pre></div>]]></content>
			<postid> 321d72486372f767f4353c3f330e781e</postid>
			<author>Justin Napolitano</author>
			<author_name>Justin Napolitano</author_name>
			<author_email>personal.jnapolitano@gmail.com</author_email>
			<author_id>87654367b2fca109e7dc9d3ea8a1ebbaf0bfe374773b148c2c20d278479add99</author_id>			
		</item>
		
		<item>
			<title>Creating a GCP Client Tool</title>
			<link>jnapolitano.com/posts/gcputils/</link>
			<pubDate>Sat, 27 Apr 2024 00:00:00 +0000</pubDate>
			<guid>jnapolitano.com/posts/gcputils/</guid>
			<description><![CDATA[GCP Submodules for repetitive tasks]]></description>
			<content type="html"><![CDATA[<h1 id="creating-a-gcp-client-tool-in-python">Creating a GCP Client Tool in Python</h1>
<h2 id="why">Why</h2>
<p>I often find myself reuuing the same bits of code when working with GCP. It is very important to avoid creating multiple development trees of the same classes. I have done this before for large projects. It will lead to a very difficult to maintain stack of tools that will spaghettify over time.</p>
<h2 id="creating-the-submodule">Creating the submodule</h2>
<h3 id="create-an-empty-directory">Create an empty directory</h3>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash">mkdir gcpuptils
</code></pre></div><h3 id="add-the-following-code-to-a-gcpclientpy-file">Add the following code to a gcpclient.py file</h3>
<p><a href="https://github.com/justin-napolitano/gcputils/blob/main/gcpclient.py">github link to latest file</a> is the link to the <code>gcpclient.py</code> file on GitHub.</p>
<h3 id="initialize-like-usual">Initialize like usual</h3>
<ol>
<li>Run <code>git init &amp;&amp; git add . &amp;&amp; git commit -m 'init'</code></li>
<li>run <code>gh repo create</code> and follow the prompts</li>
<li>run <code> git push</code> and follow the prompts</li>
</ol>
<h2 id="importing-into-your-project">Importing into your project</h2>
<p>In my example i created a repo at <code>https://github.com/justin-napolitano/gcputils.git</code></p>
<p>Run the following to import the latest repo into your current project.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash">git submodule add -b pit https://github.com/justin-napolitano/gcputils.git

</code></pre></div><p>The benefit of doing this is that the code can be reused across every project without having to worry about broken development tress.</p>
<h2 id="using-google-cloud-storage-for-python">Using Google Cloud Storage for Python</h2>
<p>Documentation Source: <code>https://cloud.google.com/python/docs/reference/storage/latest</code></p>
<h3 id="install-google-cloud-storage-for-python">Install Google Cloud Storage for Python</h3>
<p>Run the following</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash">pip install google-cloud-storage
</code></pre></div><h3 id="create-the-credentials-file-for-the-application">Create the Credentials File for the Application</h3>
<p>src = <code>https://cloud.google.com/storage/docs/reference/libraries#client-libraries-install-python</code></p>
<p>Run the following and follow the prompts</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash">gcloud auth application-default login
</code></pre></div><h2 id="initializing-a-client-and-creating-a-bucket-to-test">Initializing a client and creating a bucket to test</h2>
<p>Source : <code>https://cloud.google.com/python/docs/reference/storage/latest/google.cloud.storage.client.Client</code></p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="n">project_id</span> <span class="o">=</span> <span class="s1">&#39;{YOUR PROJECT}&#39;</span>
<span class="n">gcs</span> <span class="o">=</span> <span class="n">GCSClient</span><span class="p">(</span><span class="n">project_id</span><span class="p">,</span> <span class="n">credentials_path</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>

<span class="c1"># List buckets to test client authorization</span>
<span class="n">buckets</span> <span class="o">=</span> <span class="n">gcs</span><span class="o">.</span><span class="n">list_buckets</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&#34;Buckets:&#34;</span><span class="p">,</span> <span class="n">buckets</span><span class="p">)</span>

<span class="c1"># creating a new bucket if it doesn&#39;t exist</span>
<span class="n">bucket_name</span> <span class="o">=</span> <span class="s2">&#34;loc-scraper&#34;</span>

<span class="n">bucket</span> <span class="o">=</span> <span class="n">gcs</span><span class="o">.</span><span class="n">create_bucket</span><span class="p">(</span><span class="n">bucket_name</span><span class="o">=</span><span class="n">bucket_name</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">bucket</span><span class="p">)</span>
</code></pre></div>]]></content>
			<postid> 9da79aa2a6c916c2e433365b2b4b7d86</postid>
			<author>Justin Napolitano</author>
			<author_name>Justin Napolitano</author_name>
			<author_email>personal.jnapolitano@gmail.com</author_email>
			<author_id>87654367b2fca109e7dc9d3ea8a1ebbaf0bfe374773b148c2c20d278479add99</author_id>			
		</item>
		
		<item>
			<title>Model Design and Logistic Regression in Python</title>
			<link>jnapolitano.com/posts/logistic_regression_mockup/</link>
			<pubDate>Fri, 17 Jun 2022 13:20:32 +0000</pubDate>
			<guid>jnapolitano.com/posts/logistic_regression_mockup/</guid>
			<description><![CDATA[Designing a logistic regression model from randomized bioinformatics data.]]></description>
			<content type="html"><![CDATA[<h1 id="model-design-and-logistic-regression-in-python">Model Design and Logistic Regression in Python</h1>
<p>I recently modeled customer churn in Julia with logistic regression model.  It was interesting to be sure, but I want to extend my analysis skillset by modeling biostatistics data.  In this post, I design a logistic regression model of health predictors.</p>
<h2 id="imports">Imports</h2>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="c1"># load some default Python modules</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">seaborn</span> <span class="k">as</span> <span class="nn">sns</span>
<span class="n">plt</span><span class="o">.</span><span class="n">style</span><span class="o">.</span><span class="n">use</span><span class="p">(</span><span class="s1">&#39;seaborn-whitegrid&#39;</span><span class="p">)</span>
<span class="kn">from</span> <span class="nn">google.cloud</span> <span class="kn">import</span> <span class="n">bigquery</span>
<span class="kn">from</span> <span class="nn">pprint</span> <span class="kn">import</span> <span class="n">pprint</span>
<span class="kn">from</span> <span class="nn">datetime</span> <span class="kn">import</span> <span class="n">date</span><span class="p">,</span> <span class="n">datetime</span>
<span class="kn">import</span> <span class="nn">contextily</span> <span class="k">as</span> <span class="nn">cx</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">from</span> <span class="nn">sklearn.datasets</span> <span class="kn">import</span> <span class="n">load_digits</span>
<span class="kn">from</span> <span class="nn">sklearn.linear_model</span> <span class="kn">import</span> <span class="n">LogisticRegression</span>
<span class="kn">from</span> <span class="nn">sklearn.metrics</span> <span class="kn">import</span> <span class="n">classification_report</span><span class="p">,</span> <span class="n">confusion_matrix</span>
<span class="kn">from</span> <span class="nn">sklearn.model_selection</span> <span class="kn">import</span> <span class="n">train_test_split</span>
<span class="kn">from</span> <span class="nn">sklearn.preprocessing</span> <span class="kn">import</span> <span class="n">StandardScaler</span>

</code></pre></div><h2 id="data">Data</h2>
<h3 id="data--description">Data  Description</h3>
<p>Chinese Longitudinal Healthy Longevity Survey (CLHLS), Biomarkers Datasets, 2009, 2012, 2014 (ICPSR 37226)
Principal Investigator(s): Yi Zeng, Duke University, and Peking University; James W. Vaupel, Max Planck Institutes, and Duke University</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="n">filename</span> <span class="o">=</span> <span class="s2">&#34;/Users/jnapolitano/Projects/biostatistics/data/37226-0003-Data.tsv&#34;</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="s1">&#39;</span><span class="se">\t</span><span class="s1">&#39;</span><span class="p">)</span>
</code></pre></div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="c1"># read data in pandas dataframe</span>


<span class="c1"># list first few rows (datapoints)</span>
<span class="n">df</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</code></pre></div><!-- raw HTML omitted -->
<pre><code>.dataframe tbody tr th {
    vertical-align: top;
}

.dataframe thead th {
    text-align: right;
}
</code></pre>
<p><!-- raw HTML omitted --></p>
<!-- raw HTML omitted -->
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="n">df</span><span class="o">.</span><span class="n">describe</span><span class="p">()</span>
</code></pre></div><!-- raw HTML omitted -->
<pre><code>.dataframe tbody tr th {
    vertical-align: top;
}

.dataframe thead th {
    text-align: right;
}
</code></pre>
<p><!-- raw HTML omitted --></p>
<!-- raw HTML omitted -->
<p>The float collumns were not interpretted correctly by pandas. I&rsquo;ll fix that</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="n">df</span><span class="o">.</span><span class="n">columns</span>
</code></pre></div><pre><code>Index(['ID', 'TRUEAGE', 'A1', 'ALB', 'GLU', 'BUN', 'CREA', 'CHO', 'TG', 'GSP',
       'CRPHS', 'UA', 'HDLC', 'SOD', 'MDA', 'VD3', 'VITB12', 'UALB', 'UCR',
       'UALBBYUCR', 'WBC', 'LYMPH', 'LYMPH_A', 'RBC', 'HGB', 'HCT', 'MCV',
       'MCH', 'MCHC', 'PLT', 'MPV', 'PDW', 'PCT'],
      dtype='object')
</code></pre>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="c1"># check datatypesdf</span>
<span class="n">df</span><span class="o">.</span><span class="n">dtypes</span>
</code></pre></div><pre><code>ID            int64
TRUEAGE      object
A1           object
ALB          object
GLU          object
BUN          object
CREA         object
CHO          object
TG           object
GSP          object
CRPHS        object
UA           object
HDLC         object
SOD          object
MDA          object
VD3          object
VITB12       object
UALB         object
UCR          object
UALBBYUCR    object
WBC          object
LYMPH        object
LYMPH_A      object
RBC          object
HGB          object
HCT          object
MCV          object
MCH          object
MCHC         object
PLT          object
MPV          object
PDW          object
PCT          object
dtype: object
</code></pre>
<p>Everything was read an object.  I&rsquo;ll cast everything to numeric&hellip; Thank you numpy</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="c1"># replace empty space with na</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&#34; &#34;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">)</span>
</code></pre></div><p>just to be safe, I&rsquo;ll replace all blank spaces with np.nan.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="c1"># convert numeric objects to numeric data types.  I checked in the code book there will not be any false positives</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">to_numeric</span><span class="p">,</span> <span class="n">errors</span><span class="o">=</span><span class="s1">&#39;raise&#39;</span><span class="p">)</span>
</code></pre></div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="c1"># Recheck dictypes</span>
<span class="n">df</span><span class="o">.</span><span class="n">dtypes</span>
</code></pre></div><pre><code>ID             int64
TRUEAGE      float64
A1           float64
ALB          float64
GLU          float64
BUN          float64
CREA         float64
CHO          float64
TG           float64
GSP          float64
CRPHS        float64
UA           float64
HDLC         float64
SOD          float64
MDA          float64
VD3          float64
VITB12       float64
UALB         float64
UCR          float64
UALBBYUCR    float64
WBC          float64
LYMPH        float64
LYMPH_A      float64
RBC          float64
HGB          float64
HCT          float64
MCV          float64
MCH          float64
MCHC         float64
PLT          float64
MPV          float64
PDW          float64
PCT          float64
dtype: object
</code></pre>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="c1"># check statistics of the features</span>
<span class="n">df</span><span class="o">.</span><span class="n">describe</span><span class="p">()</span>
</code></pre></div><!-- raw HTML omitted -->
<pre><code>.dataframe tbody tr th {
    vertical-align: top;
}

.dataframe thead th {
    text-align: right;
}
</code></pre>
<p><!-- raw HTML omitted --></p>
<!-- raw HTML omitted -->
<p>It is kind of odd that there are greater counts for some rows. I&rsquo;ll remove all na.</p>
<p>Checking for negative values and anything else I missed from the initial sql clean:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">dropna</span><span class="p">()</span>
</code></pre></div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="n">df</span><span class="o">.</span><span class="n">describe</span><span class="p">()</span>
</code></pre></div><!-- raw HTML omitted -->
<pre><code>.dataframe tbody tr th {
    vertical-align: top;
}

.dataframe thead th {
    text-align: right;
}
</code></pre>
<p><!-- raw HTML omitted --></p>
<!-- raw HTML omitted -->
<p>We remove about 4/5 of our data.  The counts are now equivalent. Everything is in the correct data type.</p>
<h4 id="visualizing-age-distribution">Visualizing Age Distribution</h4>
<p>I am curious what the age spread looks like. An even spread could be used to determine health outcomes.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="c1"># plot histogram of fare</span>
<span class="n">df</span><span class="o">.</span><span class="n">TRUEAGE</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">14</span><span class="p">,</span><span class="mi">3</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Age&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Histogram&#39;</span><span class="p">);</span>
</code></pre></div><p><img src="logistic_regression_files/logistic_regression_24_0.png" alt="png"></p>
<p>Unfortunately, the spread is not evenly distributed.</p>
<h4 id="visualizing-age-to-triglyceride-levels">Visualizing Age to Triglyceride Levels</h4>
<p>A predictive model relating health factors to longevity is probably possible.   Certain factors must be met, but I&rsquo;ll assume they are for the sake of this mockup.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="c1">#idx = (df.trip_distance &lt; 3) &amp; (gdf.fare_amount &lt; 100)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">TRUEAGE</span><span class="p">,</span> <span class="n">df</span><span class="o">.</span><span class="n">TG</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;True Age&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Triglyceride, mmol/L&#39;</span><span class="p">)</span>

<span class="c1"># theta here is estimated by hand</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</code></pre></div><p><img src="logistic_regression_files/logistic_regression_26_0.png" alt="png"></p>
<h2 id="filter-examples">Filter Examples</h2>
<p>The data above doesn&rsquo;t really need to be filtered.  To demonstrate how it could be, I include some randomized columns that are then filtered according to specific conditions.</p>
<p>To fit the specificities of the conditions in the training video I&rsquo;ll add some randomized columns.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="n">n</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="n">lower_bound</span> <span class="o">=</span> <span class="mi">0</span> <span class="c1">#inclusive</span>
<span class="n">upper_bound</span> <span class="o">=</span> <span class="mi">2</span> <span class="c1"># exclusive</span>
<span class="n">emergency_department</span> <span class="o">=</span>  <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="n">low</span><span class="o">=</span><span class="n">lower_bound</span> <span class="p">,</span> <span class="n">high</span> <span class="o">=</span> <span class="n">upper_bound</span><span class="p">,</span> <span class="n">size</span> <span class="o">=</span> <span class="n">n</span><span class="p">)</span>
<span class="n">df</span><span class="p">[</span><span class="s2">&#34;EMERGENCY&#34;</span><span class="p">]</span> <span class="o">=</span> <span class="n">emergency_department</span>

</code></pre></div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="n">n</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="n">lower_bound</span> <span class="o">=</span> <span class="mi">0</span> <span class="c1">#inclusive</span>
<span class="n">upper_bound</span> <span class="o">=</span> <span class="mi">100</span> <span class="c1"># exclusive</span>
<span class="n">cancer_care</span> <span class="o">=</span>  <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="n">low</span><span class="o">=</span><span class="n">lower_bound</span> <span class="p">,</span> <span class="n">high</span> <span class="o">=</span> <span class="n">upper_bound</span><span class="p">,</span> <span class="n">size</span> <span class="o">=</span> <span class="n">n</span><span class="p">)</span>
<span class="n">df</span><span class="p">[</span><span class="s2">&#34;CANCER_TYPE&#34;</span><span class="p">]</span> <span class="o">=</span> <span class="n">cancer_care</span>
</code></pre></div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="n">n</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="n">lower_bound</span> <span class="o">=</span> <span class="mi">0</span> <span class="c1">#inclusive </span>
<span class="c1">#0 = no</span>
<span class="c1">#1 = ICPI</span>
<span class="c1"># 2 MONO </span>
<span class="n">upper_bound</span> <span class="o">=</span> <span class="mi">3</span> <span class="c1"># exclusive</span>
<span class="n">icpi_history</span> <span class="o">=</span>  <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="n">low</span><span class="o">=</span><span class="n">lower_bound</span> <span class="p">,</span> <span class="n">high</span> <span class="o">=</span> <span class="n">upper_bound</span><span class="p">,</span> <span class="n">size</span> <span class="o">=</span> <span class="n">n</span><span class="p">)</span>
<span class="n">df</span><span class="p">[</span><span class="s2">&#34;ICPI_HIST&#34;</span><span class="p">]</span> <span class="o">=</span> <span class="n">icpi_history</span>
</code></pre></div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="n">n</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="n">lower_bound</span> <span class="o">=</span> <span class="mi">0</span> <span class="c1">#inclusive</span>
<span class="n">upper_bound</span> <span class="o">=</span> <span class="mi">2</span><span class="c1"># exclusive</span>
<span class="c1"># Spanish = 0</span>
<span class="c1"># English = 1</span>
<span class="c1"># Arbitrarily chosen. </span>
<span class="n">language</span> <span class="o">=</span>  <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="n">low</span><span class="o">=</span><span class="n">lower_bound</span> <span class="p">,</span> <span class="n">high</span> <span class="o">=</span> <span class="n">upper_bound</span><span class="p">,</span> <span class="n">size</span> <span class="o">=</span> <span class="n">n</span><span class="p">)</span>
<span class="n">df</span><span class="p">[</span><span class="s2">&#34;LANG&#34;</span><span class="p">]</span> <span class="o">=</span> <span class="n">language</span>
</code></pre></div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="n">n</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="n">lower_bound</span> <span class="o">=</span> <span class="mi">0</span> <span class="c1">#inclusive</span>
<span class="n">upper_bound</span> <span class="o">=</span> <span class="mi">2</span> <span class="c1"># exclusive</span>
<span class="n">follow_up</span> <span class="o">=</span>  <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="n">low</span><span class="o">=</span><span class="n">lower_bound</span> <span class="p">,</span> <span class="n">high</span> <span class="o">=</span> <span class="n">upper_bound</span><span class="p">,</span> <span class="n">size</span> <span class="o">=</span> <span class="n">n</span><span class="p">)</span>
<span class="n">df</span><span class="p">[</span><span class="s2">&#34;FOLLOW_UP&#34;</span><span class="p">]</span> <span class="o">=</span> <span class="n">follow_up</span>
</code></pre></div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="n">n</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="n">lower_bound</span> <span class="o">=</span> <span class="mi">0</span> <span class="c1">#inclusive</span>
<span class="n">upper_bound</span> <span class="o">=</span> <span class="mi">2</span> <span class="c1"># exclusive</span>
<span class="c1"># 0 = no</span>
<span class="c1"># 1 = Yes</span>
<span class="n">cons</span> <span class="o">=</span>  <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="n">low</span><span class="o">=</span><span class="n">lower_bound</span> <span class="p">,</span> <span class="n">high</span> <span class="o">=</span> <span class="n">upper_bound</span><span class="p">,</span> <span class="n">size</span> <span class="o">=</span> <span class="n">n</span><span class="p">)</span>
<span class="n">df</span><span class="p">[</span><span class="s2">&#34;CONSENT&#34;</span><span class="p">]</span> <span class="o">=</span> <span class="n">cons</span>
</code></pre></div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="n">n</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="n">lower_bound</span> <span class="o">=</span> <span class="mi">0</span> <span class="c1">#inclusive</span>
<span class="n">upper_bound</span> <span class="o">=</span> <span class="mi">2</span> <span class="c1"># exclusive</span>
<span class="c1"># 0 = no</span>
<span class="c1"># 1 = Yes</span>
<span class="n">prego</span> <span class="o">=</span>  <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="n">low</span><span class="o">=</span><span class="n">lower_bound</span> <span class="p">,</span> <span class="n">high</span> <span class="o">=</span> <span class="n">upper_bound</span><span class="p">,</span> <span class="n">size</span> <span class="o">=</span> <span class="n">n</span><span class="p">)</span>
<span class="n">df</span><span class="p">[</span><span class="s2">&#34;PREGNANT&#34;</span><span class="p">]</span> <span class="o">=</span> <span class="n">prego</span>
</code></pre></div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="n">df</span>
</code></pre></div><!-- raw HTML omitted -->
<pre><code>.dataframe tbody tr th {
    vertical-align: top;
}

.dataframe thead th {
    text-align: right;
}
</code></pre>
<p><!-- raw HTML omitted --></p>
<!-- raw HTML omitted -->
<h3 id="writing-the-filter">Writing the Filter</h3>
<p>Writing a quick filter to ensure eligibiity.  This could, and probably should be written functionally, but so it goes.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="c1"># Greater than 18</span>
<span class="c1"># CANCER TYPE IS NOT equal to a non-malanoma skin cancer ie 5 arbitrarily chosen </span>
<span class="c1"># Patient Seeking care in emergency department is true</span>
<span class="c1"># History is not equal to 0. Ie not recieving either.  IDK how it would be provided.  It could also possibly be written as equal to 1 or 2</span>
<span class="c1"># Lang is either english or spanish</span>
<span class="c1"># Patient Agrees to Follow Up</span>
<span class="c1"># Patient Consents</span>
<span class="c1"># Patient is Not Pregnant</span>

<span class="n">idx_spanish</span> <span class="o">=</span> <span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">TRUEAGE</span> <span class="o">&gt;</span> <span class="mi">18</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">CANCER_TYPE</span> <span class="o">!=</span> <span class="mi">5</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">EMERGENCY</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span> <span class="o">&amp;</span> \
        <span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">ICPI_HIST</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">LANG</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">FOLLOW_UP</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">CONSENT</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">PREGNANT</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span>

<span class="c1"># Ideally the english and spanish speakers would have been filtered prior to this, but for the sake of exploration this will work. </span>
<span class="n">idx_english</span> <span class="o">=</span> <span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">TRUEAGE</span> <span class="o">&gt;</span> <span class="mi">18</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">CANCER_TYPE</span> <span class="o">!=</span> <span class="mi">5</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">EMERGENCY</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span> <span class="o">&amp;</span> \
        <span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">ICPI_HIST</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">LANG</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">FOLLOW_UP</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">CONSENT</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">PREGNANT</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span>

</code></pre></div><p>I created spanish and english dataframes for the sake of data manipulation.  It is not realy necessary, but it would permit modifying and recoding the data if it were formatted differently.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python">
<span class="n">filtered_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">df</span><span class="p">[</span><span class="n">idx_english</span><span class="p">],</span> <span class="n">df</span><span class="p">[</span><span class="n">idx_spanish</span><span class="p">]],</span> <span class="n">ignore_index</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</code></pre></div><p>the filtered df is a concattenation of the english and spanish filtered data.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="n">filtered_df</span><span class="o">.</span><span class="n">describe</span><span class="p">()</span>
</code></pre></div><!-- raw HTML omitted -->
<pre><code>.dataframe tbody tr th {
    vertical-align: top;
}

.dataframe thead th {
    text-align: right;
}
</code></pre>
<p><!-- raw HTML omitted --></p>
<!-- raw HTML omitted -->
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="n">filtered_df</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="c1">#only 33 left following the filter. </span>
</code></pre></div><pre><code>33
</code></pre>
<p>Following the filter only 35 data are left in the set.  A workflow similiar to this could be used to identify possible survey recruits from aggregated chart data.</p>
<h2 id="logistic-regression-sample">Logistic Regression Sample</h2>
<p>I am surpirsed by the low level of samples left following the filter.  To avoid a small n, I will use the initial dataset.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="n">filename</span> <span class="o">=</span> <span class="s2">&#34;/Users/jnapolitano/Projects/biostatistics/data/37226-0003-Data.tsv&#34;</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="s1">&#39;</span><span class="se">\t</span><span class="s1">&#39;</span><span class="p">)</span>

<span class="c1"># replace empty space with na</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&#34; &#34;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">)</span>

<span class="c1"># convert numeric objects to numeric data types.  I checked in the code book there will not be any false positives</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">to_numeric</span><span class="p">,</span> <span class="n">errors</span><span class="o">=</span><span class="s1">&#39;raise&#39;</span><span class="p">)</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">dropna</span><span class="p">()</span>
</code></pre></div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="n">df</span>
</code></pre></div><!-- raw HTML omitted -->
<pre><code>.dataframe tbody tr th {
    vertical-align: top;
}

.dataframe thead th {
    text-align: right;
}
</code></pre>
<p><!-- raw HTML omitted --></p>
<!-- raw HTML omitted -->
<h3 id="the-model">The Model</h3>
<p>There is strong suspicion that biomarkers can determine whether a patient should be admitted for emergency care.  In this simplified model, I will randomly distribute proper disposition across the dataset.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="n">n</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="n">lower_bound</span> <span class="o">=</span> <span class="mi">0</span> <span class="c1">#inclusive</span>
<span class="n">upper_bound</span> <span class="o">=</span> <span class="mi">2</span> <span class="c1"># exclusive</span>
<span class="c1"># 0 = no</span>
<span class="c1"># 1 = Yes</span>
<span class="n">tmp</span> <span class="o">=</span>  <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="n">low</span><span class="o">=</span><span class="n">lower_bound</span> <span class="p">,</span> <span class="n">high</span> <span class="o">=</span> <span class="n">upper_bound</span><span class="p">,</span> <span class="n">size</span> <span class="o">=</span> <span class="n">n</span><span class="p">)</span>
<span class="n">df</span><span class="p">[</span><span class="s2">&#34;PROP_DISPOSITION&#34;</span><span class="p">]</span> <span class="o">=</span> <span class="n">tmp</span>
</code></pre></div><h3 id="create-test-and-train-set">Create Test and Train Set</h3>
<p>This could be randomly sampled as well&hellip;</p>
<h4 id="random-sample">Random Sample</h4>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="c1"># copy in memory to avoid errors.  This could be done from files or in other ways if memory is limited.  </span>
<span class="n">master_table</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</code></pre></div><h3 id="test-sample-set-with-10000-randomly-selected-from-the-master-with-replacement">Test Sample Set with 10,000 Randomly Selected from the Master with Replacement</h3>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="n">test_sample</span> <span class="o">=</span> <span class="n">master_table</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="n">n</span><span class="o">=</span><span class="mi">20000</span><span class="p">,</span><span class="n">replace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

</code></pre></div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="n">targets</span> <span class="o">=</span> <span class="n">test_sample</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&#34;PROP_DISPOSITION&#34;</span><span class="p">)</span>
</code></pre></div><h4 id="seperate-train-and-test-sets">Seperate Train and Test Sets</h4>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="n">x_train</span><span class="p">,</span> <span class="n">x_test</span><span class="p">,</span> <span class="n">y_train</span><span class="p">,</span> <span class="n">y_test</span> <span class="o">=</span> <span class="n">train_test_split</span><span class="p">(</span><span class="n">test_sample</span><span class="p">,</span> <span class="n">targets</span><span class="p">,</span> <span class="n">test_size</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
</code></pre></div><h4 id="data-standardization">Data Standardization</h4>
<p>Calculate the mean and standard deviation for each column.
Subtract the corresponding mean from each element.
Divide the obtained difference by the corresponding standard deviation.</p>
<p>Thankfully this is built into SKLearn.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="n">scaler</span> <span class="o">=</span> <span class="n">StandardScaler</span><span class="p">()</span>
<span class="n">x_train</span> <span class="o">=</span> <span class="n">scaler</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">x_train</span><span class="p">)</span>
</code></pre></div><h3 id="create-the-model">Create the Model</h3>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="n">model</span> <span class="o">=</span> <span class="n">LogisticRegression</span><span class="p">(</span><span class="n">solver</span><span class="o">=</span><span class="s1">&#39;liblinear&#39;</span><span class="p">,</span> <span class="n">C</span><span class="o">=</span><span class="mf">0.05</span><span class="p">,</span> <span class="n">multi_class</span><span class="o">=</span><span class="s1">&#39;ovr&#39;</span><span class="p">,</span>
                           <span class="n">random_state</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="n">model</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">x_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">)</span>
</code></pre></div><pre><code>LogisticRegression(C=0.05, multi_class='ovr', random_state=0,
                   solver='liblinear')
</code></pre>
<h3 id="evaluate-model">Evaluate Model</h3>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="n">x_test</span> <span class="o">=</span> <span class="n">scaler</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">x_test</span><span class="p">)</span>
</code></pre></div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="n">y_pred</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">x_test</span><span class="p">)</span>
</code></pre></div><h3 id="model-scoring">Model Scoring</h3>
<p>With completely randomized values the score should be about 50%. If it is significantly greater than there is probably a problem with the model.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="n">model</span><span class="o">.</span><span class="n">score</span><span class="p">(</span><span class="n">x_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">)</span>

</code></pre></div><pre><code>0.5676875
</code></pre>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="n">model</span><span class="o">.</span><span class="n">score</span><span class="p">(</span><span class="n">x_test</span><span class="p">,</span> <span class="n">y_test</span><span class="p">)</span>
</code></pre></div><pre><code>0.55825
</code></pre>
<p>Results are expected</p>
<h3 id="confusion-matrix">Confusion matrix</h3>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="n">cm</span> <span class="o">=</span> <span class="n">confusion_matrix</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">)</span>
<span class="n">font_size</span> <span class="o">=</span> <span class="mi">10</span>

<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="mi">8</span><span class="p">))</span>
<span class="n">ax</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">cm</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Predicted outputs&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;purple&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Actual outputs&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;purple&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">ticks</span><span class="o">=</span><span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">cm</span><span class="p">)))</span>
<span class="n">ax</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">ticks</span><span class="o">=</span><span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">cm</span><span class="p">)))</span>
<span class="c1">#ax.set_ylim(0, 1)</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">cm</span><span class="p">)):</span>
    <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">cm</span><span class="p">)):</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="n">j</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="n">cm</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">],</span> <span class="n">ha</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">,</span> <span class="n">va</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;purple&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</code></pre></div><p><img src="logistic_regression_files/logistic_regression_71_0.png" alt="png"></p>
<p>Because the data is randomized it makes the model is accurate about 50% of the time.</p>
<h3 id="printing-the-classification-report">Printing the Classification Report</h3>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="nb">print</span><span class="p">(</span><span class="n">classification_report</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">))</span>
</code></pre></div><pre><code>              precision    recall  f1-score   support

           0       0.55      0.47      0.51      1927
           1       0.56      0.64      0.60      2073

    accuracy                           0.56      4000
   macro avg       0.56      0.56      0.55      4000
weighted avg       0.56      0.56      0.55      4000
</code></pre>
]]></content>
			<postid> 975ec172d2f9b34f351eb19096ee5c89</postid>
			<author>Justin Napolitano</author>
			<author_name>Justin Napolitano</author_name>
			<author_email>personal.jnapolitano@gmail.com</author_email>
			<author_id>87654367b2fca109e7dc9d3ea8a1ebbaf0bfe374773b148c2c20d278479add99</author_id>			
		</item>
		
		<item>
			<title>Annual Cost of Living Monte Carlo Models</title>
			<link>jnapolitano.com/posts/cost-of-living-projections/</link>
			<pubDate>Wed, 01 Jun 2022 15:24:32 +0000</pubDate>
			<guid>jnapolitano.com/posts/cost-of-living-projections/</guid>
			<description><![CDATA[Monte Carlo Model to determine the cost of living in your city.]]></description>
			<content type="html"><![CDATA[<h2 id="cost-of-living-projections">Cost of Living Projections</h2>
<h2 id="introduction">Introduction</h2>
<p>I do not like negotiating for salary. Especially, without valid projections to determine a range.</p>
<p>I prepared this report to estimate a salary expectation that will maintain my current standard of living.</p>
<p>I present two Monte Carlo models of Houston and NYC annual living costs.  The data is somewhat dated and &ndash;particularly in the case of houston&ndash; are high level estimates.</p>
<p>In order to produce a better report, I am currently scraping data from the internet for more accurate sample distributions.  I will be able to present that soon.</p>
<p>With that said, the model should not deviate by more than about 5-10 percent from what is presented in below.</p>
<h2 id="findings">Findings</h2>
<p>An annual salary of $90,000 would be sufficient to qualify for rent in Houston and most likely the median level income neighbors of NYC.</p>
<p>I came about this number by quantifying a confidence inverval of annual rent costs in boths cities across a normal distribution.  I then simply multiplied that number by 3 in order to meet the lease qualifications of most landlords.</p>
<h2 id="limitations-of-the-model">Limitations of the Model</h2>
<h3 id="old-nyc-data">Old Nyc Data</h3>
<p>The data I am using was sourced from 2018.   I will be updating it soon.</p>
<h3 id="houston-data">Houston Data</h3>
<p>The houston estimate is based an estimate to stay in the property I am currently staying in.  The rent is 2400 a month.  I estimated that it could raise at maximum to about 2600 in the next year.  If I were to move similiar housing goes for around 2200 to about 2600 a month. I used these as the bounds of my estimates</p>
<h2 id="houston-cost-of-living-expenses">Houston Cost of Living Expenses</h2>
<p>I intend to stay in Houston for the next year.  I would like to move to NY eventually to be nearer to a central office, but not in the near future.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="n">lower_bound</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="mi">2400</span><span class="p">)</span>
<span class="n">upper_bound</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="mi">2600</span><span class="p">)</span>

<span class="n">median</span> <span class="o">=</span> <span class="mi">2500</span>
<span class="n">standard_dev</span> <span class="o">=</span> <span class="mi">100</span>  <span class="c1">#file:///Users/jnapolitano/Downloads/LNG_Shipping_a_Descriptive_Analysis.pdf</span>

<span class="n">cap_range</span> <span class="o">=</span> <span class="nb">range</span><span class="p">(</span><span class="n">lower_bound</span><span class="p">,</span> <span class="n">upper_bound</span><span class="p">)</span>

<span class="n">rent_distribution</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">normal</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="n">median</span> <span class="p">,</span> <span class="n">scale</span><span class="o">=</span><span class="n">standard_dev</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">10000</span><span class="p">)</span>

<span class="n">rent_sample</span> <span class="o">=</span> <span class="n">choice</span><span class="p">(</span><span class="n">rent_distribution</span><span class="p">,</span><span class="mi">12</span><span class="p">)</span>
</code></pre></div><h3 id="houston-monthly-food-costs">Houston Monthly food costs</h3>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="n">lower_bound</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="mi">300</span><span class="p">)</span>
<span class="n">upper_bound</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="mi">500</span><span class="p">)</span>

<span class="n">median</span> <span class="o">=</span> <span class="mi">400</span>
<span class="n">standard_dev</span> <span class="o">=</span> <span class="mi">50</span> 

<span class="n">food_range</span> <span class="o">=</span> <span class="nb">range</span><span class="p">(</span><span class="n">lower_bound</span><span class="p">,</span> <span class="n">upper_bound</span><span class="p">)</span>

<span class="n">food_distribution</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">normal</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="n">median</span> <span class="p">,</span> <span class="n">scale</span><span class="o">=</span><span class="n">standard_dev</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">10000</span><span class="p">)</span>

<span class="n">food_sample</span> <span class="o">=</span> <span class="n">choice</span><span class="p">(</span><span class="n">food_distribution</span><span class="p">,</span> <span class="mi">12</span><span class="p">)</span>
</code></pre></div><h3 id="houston-insurance-costs">Houston Insurance Costs</h3>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="n">lower_bound</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="mi">200</span><span class="p">)</span>
<span class="n">upper_bound</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="mi">300</span><span class="p">)</span>

<span class="n">median</span> <span class="o">=</span> <span class="mi">250</span>
<span class="n">standard_dev</span> <span class="o">=</span> <span class="mi">25</span>

<span class="n">insurance_range</span> <span class="o">=</span> <span class="nb">range</span><span class="p">(</span><span class="n">lower_bound</span><span class="p">,</span> <span class="n">upper_bound</span><span class="p">)</span>

<span class="n">insurance_distribution</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">normal</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="n">median</span> <span class="p">,</span> <span class="n">scale</span><span class="o">=</span><span class="n">standard_dev</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">10000</span><span class="p">)</span>

</code></pre></div><h4 id="the-houston-cost-of-living-df">The Houston Cost of Living DF</h4>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="n">cost_of_living_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">()</span>
<span class="n">cost_of_living_df</span><span class="p">[</span><span class="s1">&#39;rent&#39;</span><span class="p">]</span><span class="o">=</span> <span class="n">choice</span><span class="p">(</span><span class="n">rent_distribution</span><span class="p">,</span><span class="mi">12</span><span class="p">)</span>
<span class="n">cost_of_living_df</span><span class="p">[</span><span class="s1">&#39;food&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">choice</span><span class="p">(</span><span class="n">food_distribution</span><span class="p">,</span> <span class="mi">12</span><span class="p">)</span>
<span class="n">cost_of_living_df</span><span class="p">[</span><span class="s1">&#39;insurance&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">choice</span><span class="p">(</span><span class="n">insurance_distribution</span><span class="p">,</span> <span class="mi">12</span><span class="p">)</span>
<span class="n">cost_of_living_df</span><span class="p">[</span><span class="s1">&#39;monthly_cost&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">cost_of_living_df</span><span class="o">.</span><span class="n">rent</span> <span class="o">+</span> <span class="n">cost_of_living_df</span><span class="o">.</span><span class="n">food</span> <span class="o">+</span> <span class="n">cost_of_living_df</span><span class="o">.</span><span class="n">insurance</span>
<span class="n">cost_of_living_df</span>
</code></pre></div><!-- raw HTML omitted -->
<pre><code>.dataframe tbody tr th {
    vertical-align: top;
}

.dataframe thead th {
    text-align: right;
}
</code></pre>
<p><!-- raw HTML omitted --></p>
<!-- raw HTML omitted -->
<h2 id="houston-costs-per-annum-algorithm">Houston Costs Per Annum Algorithm</h2>
<p>The algorithm below calculates the annual cost of rent, food, and insurance to determine total cost per year.  Rent, food, and insurance are set by random choice based on the distributions defined in the functions above.</p>
<p>I run the simulation 10,000 times which in theory corresponds to 10,000 random samples of annual costs.  The point in doing this is to create a random normal distribution to define convidence intervals of my total annual costs.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python">
<span class="n">years</span> <span class="o">=</span> <span class="mi">10000</span>
<span class="n">year_counter</span> <span class="o">=</span> <span class="mi">0</span>
<span class="c1">#carbon_total_millions_metric_tons = 300000000</span>
<span class="c1">#total_tons_shipped = 0</span>
<span class="n">total_price</span> <span class="o">=</span> <span class="mi">0</span>
<span class="n">cycle_price_samples</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">shape</span><span class="o">=</span><span class="n">years</span><span class="p">)</span>
<span class="n">cycle_rent_samples</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">shape</span><span class="o">=</span><span class="n">years</span><span class="p">)</span>
<span class="n">cycle_food_samples</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">shape</span><span class="o">=</span><span class="n">years</span><span class="p">)</span>
<span class="n">cycle_insurance_samples</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">shape</span><span class="o">=</span><span class="n">years</span><span class="p">)</span>
<span class="n">annual_cost</span> <span class="o">=</span> <span class="mi">0</span>


<span class="k">for</span> <span class="n">year</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">years</span><span class="p">):</span>
    <span class="c1"># Define a New DataFrame. It should fall out of scope with each iteration </span>
    <span class="n">cost_of_living_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">()</span>
    <span class="c1">#random choice of rent </span>
    <span class="n">cost_of_living_df</span><span class="p">[</span><span class="s1">&#39;rent&#39;</span><span class="p">]</span><span class="o">=</span> <span class="n">choice</span><span class="p">(</span><span class="n">rent_distribution</span><span class="p">,</span><span class="mi">12</span><span class="p">)</span>
    <span class="c1">#random choice of food</span>
    <span class="n">cost_of_living_df</span><span class="p">[</span><span class="s1">&#39;food&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">choice</span><span class="p">(</span><span class="n">food_distribution</span><span class="p">,</span> <span class="mi">12</span><span class="p">)</span>
    <span class="c1">#random Choice of Insurance</span>
    <span class="n">cost_of_living_df</span><span class="p">[</span><span class="s1">&#39;insurance&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">choice</span><span class="p">(</span><span class="n">insurance_distribution</span><span class="p">,</span> <span class="mi">12</span><span class="p">)</span>
    <span class="c1">#Random Choice of total annual cost</span>
    <span class="n">cost_of_living_df</span><span class="p">[</span><span class="s1">&#39;monthly_cost&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">cost_of_living_df</span><span class="o">.</span><span class="n">rent</span> <span class="o">+</span> <span class="n">cost_of_living_df</span><span class="o">.</span><span class="n">food</span> <span class="o">+</span> <span class="n">cost_of_living_df</span><span class="o">.</span><span class="n">insurance</span>
    <span class="c1"># must use apply to account for multiple 0 conditions.  If i simply vectorized the function across the dataframe in a single call i would assign the the same values each day </span>
    <span class="c1">#calculate cost per day for fun...</span>
    <span class="c1"># query all that are = o.  Summate the capacities deduct the total </span>
    <span class="n">annual_cost</span> <span class="o">=</span> <span class="n">cost_of_living_df</span><span class="p">[</span><span class="s1">&#39;monthly_cost&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
    <span class="n">annual_rent</span> <span class="o">=</span> <span class="n">cost_of_living_df</span><span class="o">.</span><span class="n">rent</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
    <span class="n">annual_food</span> <span class="o">=</span> <span class="n">cost_of_living_df</span><span class="o">.</span><span class="n">food</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
    <span class="n">annual_insurance</span> <span class="o">=</span> <span class="n">cost_of_living_df</span><span class="o">.</span><span class="n">insurance</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
    <span class="n">cycle_price_samples</span><span class="p">[</span><span class="n">year</span><span class="p">]</span> <span class="o">=</span> <span class="n">annual_cost</span>
    <span class="n">cycle_food_samples</span><span class="p">[</span><span class="n">year</span><span class="p">]</span> <span class="o">=</span> <span class="n">annual_food</span>
    <span class="n">cycle_insurance_samples</span><span class="p">[</span><span class="n">year</span><span class="p">]</span> <span class="o">=</span> <span class="n">annual_insurance</span>
    <span class="n">cycle_rent_samples</span><span class="p">[</span><span class="n">year</span><span class="p">]</span> <span class="o">=</span> <span class="n">annual_rent</span>
    <span class="c1">#print(carbon_total_millions_metric_tons)</span>
    <span class="n">year_counter</span> <span class="o">=</span> <span class="n">year_counter</span><span class="o">+</span><span class="mi">1</span>


</code></pre></div><h3 id="houston-prediction-df">Houston Prediction Df</h3>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="n">prediction_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">()</span>
<span class="n">prediction_df</span><span class="p">[</span><span class="s1">&#39;rent&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">cycle_rent_samples</span>
<span class="n">prediction_df</span><span class="p">[</span><span class="s1">&#39;food&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">cycle_food_samples</span>
<span class="n">prediction_df</span><span class="p">[</span><span class="s1">&#39;insurance&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">cycle_insurance_samples</span>
<span class="n">prediction_df</span><span class="p">[</span><span class="s1">&#39;total&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">cycle_price_samples</span>
</code></pre></div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="n">prediction_df</span><span class="o">.</span><span class="n">describe</span><span class="p">()</span>

</code></pre></div><!-- raw HTML omitted -->
<pre><code>.dataframe tbody tr th {
    vertical-align: top;
}

.dataframe thead th {
    text-align: right;
}
</code></pre>
<p><!-- raw HTML omitted --></p>
<!-- raw HTML omitted -->
<h3 id="houston-annual-cost-histogram">Houston Annual Cost Histogram</h3>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="n">prediction_df</span><span class="o">.</span><span class="n">total</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">grid</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">bins</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span> <span class="n">rwidth</span><span class="o">=</span><span class="mf">0.9</span><span class="p">,</span>
                   <span class="n">color</span><span class="o">=</span><span class="s1">&#39;#607c8e&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Annual Total Costs Price USD&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Frequency&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="s1">&#39;y&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.75</span><span class="p">)</span>
</code></pre></div><p><img src="cost_of_living_monte_carlo_files/cost_of_living_monte_carlo_17_0.png" alt="png"></p>
<h3 id="houston-calculating-the-confidence-interval-for-total-costs">Houston: Calculating the Confidence Interval For Total Costs</h3>
<p>The data is nearly normal. Greater samples sizes would produce a graph of nearly perfect normality</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python">
<span class="n">st</span><span class="o">.</span><span class="n">norm</span><span class="o">.</span><span class="n">interval</span><span class="p">(</span><span class="n">alpha</span><span class="o">=</span><span class="mf">0.90</span><span class="p">,</span> <span class="n">loc</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">prediction_df</span><span class="o">.</span><span class="n">total</span><span class="p">),</span> <span class="n">scale</span><span class="o">=</span><span class="n">st</span><span class="o">.</span><span class="n">sem</span><span class="p">(</span><span class="n">prediction_df</span><span class="o">.</span><span class="n">total</span><span class="p">))</span>
</code></pre></div><pre><code>(37795.2942543157, 37808.287836034055)
</code></pre>
<h3 id="houston-annual-rent-histogram">Houston Annual Rent Histogram</h3>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="c1">### Annual Cost Histogram Histogram</span>
<span class="n">prediction_df</span><span class="o">.</span><span class="n">rent</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">grid</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">bins</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span> <span class="n">rwidth</span><span class="o">=</span><span class="mf">0.9</span><span class="p">,</span>
                   <span class="n">color</span><span class="o">=</span><span class="s1">&#39;#607c8e&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Annual Rent Cost Distribution &#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Annual Rent Costs Price USD&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Frequency&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="s1">&#39;y&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.75</span><span class="p">)</span>
</code></pre></div><p><img src="cost_of_living_monte_carlo_files/cost_of_living_monte_carlo_21_0.png" alt="png"></p>
<h3 id="houston-calculating-the-confidence-interval-for-annual-rent">Houston: Calculating the Confidence Interval For Annual Rent</h3>
<p>The data is nearly normal. Greater samples sizes would produce a graph of nearly perfect normality</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python">
<span class="n">st</span><span class="o">.</span><span class="n">norm</span><span class="o">.</span><span class="n">interval</span><span class="p">(</span><span class="n">alpha</span><span class="o">=</span><span class="mf">0.95</span><span class="p">,</span> <span class="n">loc</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">prediction_df</span><span class="o">.</span><span class="n">rent</span><span class="p">),</span> <span class="n">scale</span><span class="o">=</span><span class="n">st</span><span class="o">.</span><span class="n">sem</span><span class="p">(</span><span class="n">prediction_df</span><span class="o">.</span><span class="n">rent</span><span class="p">))</span>
</code></pre></div><pre><code>(29996.264715447538, 30009.767827637417)
</code></pre>
<h2 id="new-york-cost-of-living-expenses">New York Cost of Living Expenses</h2>
<p>For the sake of comparison, the New York Expense distributions are calculated below.  I assume that everything but rent will be equivalent to Houston.  A more accurate model would account for insurance, food, and incidental differences.</p>
<p>I am assuming the rent of a two bedroom apartment.</p>
<p>The data i am using was scraped from craigslist in 2018.  I will redo it later for 2022 data to get a better model.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="n">nyc_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s2">&#34;/Users/jnapolitano/Projects/cost-of-living-projections/nyc-housing.csv&#34;</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s2">&#34;unicode-escape&#34;</span><span class="p">)</span>
</code></pre></div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="c1">#assuiming a two bedroom</span>
<span class="n">nyc_df</span> <span class="o">=</span> <span class="n">nyc_df</span><span class="p">[</span><span class="n">nyc_df</span><span class="p">[</span><span class="s1">&#39;Bedrooms&#39;</span><span class="p">]</span><span class="o">==</span> <span class="s1">&#39;2br&#39;</span><span class="p">]</span>
</code></pre></div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="n">nyc_df</span><span class="o">.</span><span class="n">describe</span><span class="p">()</span>
</code></pre></div><!-- raw HTML omitted -->
<pre><code>.dataframe tbody tr th {
    vertical-align: top;
}

.dataframe thead th {
    text-align: right;
}
</code></pre>
<p><!-- raw HTML omitted --></p>
<!-- raw HTML omitted -->
<p>The price is about 2800 with a std of 7,465.  Which is absurd.  To do a better analysis, I need to clean the data.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python">
<span class="n">idx</span> <span class="o">=</span> <span class="p">(</span><span class="n">nyc_df</span><span class="o">.</span><span class="n">Price</span> <span class="o">&gt;</span> <span class="mi">500</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">nyc_df</span><span class="o">.</span><span class="n">Price</span> <span class="o">&lt;</span> <span class="mi">4500</span><span class="p">)</span>
<span class="n">nyc_df</span> <span class="o">=</span> <span class="n">nyc_df</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span>
</code></pre></div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="n">nyc_df</span><span class="o">.</span><span class="n">describe</span><span class="p">()</span>
</code></pre></div><!-- raw HTML omitted -->
<pre><code>.dataframe tbody tr th {
    vertical-align: top;
}

.dataframe thead th {
    text-align: right;
}
</code></pre>
<p><!-- raw HTML omitted --></p>
<!-- raw HTML omitted -->
<p>When accounting for outliers the data is far more managable.  I&rsquo;m surprised by the mean price.  Again this data is old, but it is also does not accout for neighborhoods.  I will redo the analysis at a later data filtered by neighborhoods.</p>
<h3 id="creating-the-nyc-distributions">Creating the NYC Distributions</h3>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="n">lower_bound</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="mi">600</span><span class="p">)</span>
<span class="n">upper_bound</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="mi">4500</span><span class="p">)</span>

<span class="n">median</span> <span class="o">=</span> <span class="mi">2435</span>
<span class="n">standard_dev</span> <span class="o">=</span> <span class="mi">729</span> 

<span class="n">cap_range</span> <span class="o">=</span> <span class="nb">range</span><span class="p">(</span><span class="n">lower_bound</span><span class="p">,</span> <span class="n">upper_bound</span><span class="p">)</span>

<span class="n">rent_distribution</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">normal</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="n">median</span> <span class="p">,</span> <span class="n">scale</span><span class="o">=</span><span class="n">standard_dev</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">10000</span><span class="p">)</span>

<span class="n">rent_sample</span> <span class="o">=</span> <span class="n">choice</span><span class="p">(</span><span class="n">rent_distribution</span><span class="p">,</span><span class="mi">12</span><span class="p">)</span>
</code></pre></div><h3 id="nyc-monthly-food-costs">NYC Monthly food costs</h3>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="n">lower_bound</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="mi">300</span><span class="p">)</span>
<span class="n">upper_bound</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="mi">500</span><span class="p">)</span>

<span class="n">median</span> <span class="o">=</span> <span class="mi">400</span>
<span class="n">standard_dev</span> <span class="o">=</span> <span class="mi">50</span> 

<span class="n">food_range</span> <span class="o">=</span> <span class="nb">range</span><span class="p">(</span><span class="n">lower_bound</span><span class="p">,</span> <span class="n">upper_bound</span><span class="p">)</span>

<span class="n">food_distribution</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">normal</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="n">median</span> <span class="p">,</span> <span class="n">scale</span><span class="o">=</span><span class="n">standard_dev</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">10000</span><span class="p">)</span>

<span class="n">food_sample</span> <span class="o">=</span> <span class="n">choice</span><span class="p">(</span><span class="n">food_distribution</span><span class="p">,</span> <span class="mi">12</span><span class="p">)</span>
</code></pre></div><h3 id="nyc-insurance-costs">NYC Insurance Costs</h3>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="n">lower_bound</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="mi">200</span><span class="p">)</span>
<span class="n">upper_bound</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="mi">300</span><span class="p">)</span>

<span class="n">median</span> <span class="o">=</span> <span class="mi">250</span>
<span class="n">standard_dev</span> <span class="o">=</span> <span class="mi">25</span>

<span class="n">insurance_range</span> <span class="o">=</span> <span class="nb">range</span><span class="p">(</span><span class="n">lower_bound</span><span class="p">,</span> <span class="n">upper_bound</span><span class="p">)</span>

<span class="n">insurance_distribution</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">normal</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="n">median</span> <span class="p">,</span> <span class="n">scale</span><span class="o">=</span><span class="n">standard_dev</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">10000</span><span class="p">)</span>

</code></pre></div><h4 id="nyc-cost-of-living-distribution">NYC Cost of Living Distribution</h4>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="n">cost_of_living_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">()</span>
<span class="n">cost_of_living_df</span><span class="p">[</span><span class="s1">&#39;rent&#39;</span><span class="p">]</span><span class="o">=</span> <span class="n">choice</span><span class="p">(</span><span class="n">rent_distribution</span><span class="p">,</span><span class="mi">12</span><span class="p">)</span>
<span class="n">cost_of_living_df</span><span class="p">[</span><span class="s1">&#39;food&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">choice</span><span class="p">(</span><span class="n">food_distribution</span><span class="p">,</span> <span class="mi">12</span><span class="p">)</span>
<span class="n">cost_of_living_df</span><span class="p">[</span><span class="s1">&#39;insurance&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">choice</span><span class="p">(</span><span class="n">insurance_distribution</span><span class="p">,</span> <span class="mi">12</span><span class="p">)</span>
<span class="n">cost_of_living_df</span><span class="p">[</span><span class="s1">&#39;monthly_cost&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">cost_of_living_df</span><span class="o">.</span><span class="n">rent</span> <span class="o">+</span> <span class="n">cost_of_living_df</span><span class="o">.</span><span class="n">food</span> <span class="o">+</span> <span class="n">cost_of_living_df</span><span class="o">.</span><span class="n">insurance</span>
<span class="n">cost_of_living_df</span>
</code></pre></div><!-- raw HTML omitted -->
<pre><code>.dataframe tbody tr th {
    vertical-align: top;
}

.dataframe thead th {
    text-align: right;
}
</code></pre>
<p><!-- raw HTML omitted --></p>
<!-- raw HTML omitted -->
<h2 id="nyc-costs-per-annum-algorithm">NYC Costs Per Annum Algorithm</h2>
<p>The algorithm below calculates the annual cost of rent, food, and insurance to determine total cost per year.  Rent, food, and insurance are set by random choice based on the distributions defined in the functions above.</p>
<p>I run the simulation 10,000 times which in theory corresponds to 10,000 random samples of annual costs.  The point in doing this is to create a random normal distribution to define convidence intervals of my total annual costs.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python">
<span class="n">years</span> <span class="o">=</span> <span class="mi">10000</span>
<span class="n">year_counter</span> <span class="o">=</span> <span class="mi">0</span>
<span class="c1">#carbon_total_millions_metric_tons = 300000000</span>
<span class="c1">#total_tons_shipped = 0</span>
<span class="n">total_price</span> <span class="o">=</span> <span class="mi">0</span>
<span class="n">cycle_price_samples</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">shape</span><span class="o">=</span><span class="n">years</span><span class="p">)</span>
<span class="n">cycle_rent_samples</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">shape</span><span class="o">=</span><span class="n">years</span><span class="p">)</span>
<span class="n">cycle_food_samples</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">shape</span><span class="o">=</span><span class="n">years</span><span class="p">)</span>
<span class="n">cycle_insurance_samples</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">shape</span><span class="o">=</span><span class="n">years</span><span class="p">)</span>
<span class="n">annual_cost</span> <span class="o">=</span> <span class="mi">0</span>


<span class="k">for</span> <span class="n">year</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">years</span><span class="p">):</span>
    <span class="c1"># Define a New DataFrame. It should fall out of scope with each iteration </span>
    <span class="n">cost_of_living_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">()</span>
    <span class="c1">#random choice of rent </span>
    <span class="n">cost_of_living_df</span><span class="p">[</span><span class="s1">&#39;rent&#39;</span><span class="p">]</span><span class="o">=</span> <span class="n">choice</span><span class="p">(</span><span class="n">rent_distribution</span><span class="p">,</span><span class="mi">12</span><span class="p">)</span>
    <span class="c1">#random choice of food</span>
    <span class="n">cost_of_living_df</span><span class="p">[</span><span class="s1">&#39;food&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">choice</span><span class="p">(</span><span class="n">food_distribution</span><span class="p">,</span> <span class="mi">12</span><span class="p">)</span>
    <span class="c1">#random Choice of Insurance</span>
    <span class="n">cost_of_living_df</span><span class="p">[</span><span class="s1">&#39;insurance&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">choice</span><span class="p">(</span><span class="n">insurance_distribution</span><span class="p">,</span> <span class="mi">12</span><span class="p">)</span>
    <span class="c1">#Random Choice of total annual cost</span>
    <span class="n">cost_of_living_df</span><span class="p">[</span><span class="s1">&#39;monthly_cost&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">cost_of_living_df</span><span class="o">.</span><span class="n">rent</span> <span class="o">+</span> <span class="n">cost_of_living_df</span><span class="o">.</span><span class="n">food</span> <span class="o">+</span> <span class="n">cost_of_living_df</span><span class="o">.</span><span class="n">insurance</span>
    <span class="c1"># must use apply to account for multiple 0 conditions.  If i simply vectorized the function across the dataframe in a single call i would assign the the same values each day </span>
    <span class="c1">#calculate cost per day for fun...</span>
    <span class="c1"># query all that are = o.  Summate the capacities deduct the total </span>
    <span class="n">annual_cost</span> <span class="o">=</span> <span class="n">cost_of_living_df</span><span class="p">[</span><span class="s1">&#39;monthly_cost&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
    <span class="n">annual_rent</span> <span class="o">=</span> <span class="n">cost_of_living_df</span><span class="o">.</span><span class="n">rent</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
    <span class="n">annual_food</span> <span class="o">=</span> <span class="n">cost_of_living_df</span><span class="o">.</span><span class="n">food</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
    <span class="n">annual_insurance</span> <span class="o">=</span> <span class="n">cost_of_living_df</span><span class="o">.</span><span class="n">insurance</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
    <span class="n">cycle_price_samples</span><span class="p">[</span><span class="n">year</span><span class="p">]</span> <span class="o">=</span> <span class="n">annual_cost</span>
    <span class="n">cycle_food_samples</span><span class="p">[</span><span class="n">year</span><span class="p">]</span> <span class="o">=</span> <span class="n">annual_food</span>
    <span class="n">cycle_insurance_samples</span><span class="p">[</span><span class="n">year</span><span class="p">]</span> <span class="o">=</span> <span class="n">annual_insurance</span>
    <span class="n">cycle_rent_samples</span><span class="p">[</span><span class="n">year</span><span class="p">]</span> <span class="o">=</span> <span class="n">annual_rent</span>
    <span class="c1">#print(carbon_total_millions_metric_tons)</span>
    <span class="n">year_counter</span> <span class="o">=</span> <span class="n">year_counter</span><span class="o">+</span><span class="mi">1</span>


</code></pre></div><h3 id="nyc-prediction-df">NYC Prediction Df</h3>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="n">prediction_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">()</span>
<span class="n">prediction_df</span><span class="p">[</span><span class="s1">&#39;rent&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">cycle_rent_samples</span>
<span class="n">prediction_df</span><span class="p">[</span><span class="s1">&#39;food&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">cycle_food_samples</span>
<span class="n">prediction_df</span><span class="p">[</span><span class="s1">&#39;insurance&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">cycle_insurance_samples</span>
<span class="n">prediction_df</span><span class="p">[</span><span class="s1">&#39;total&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">cycle_price_samples</span>
</code></pre></div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="n">prediction_df</span><span class="o">.</span><span class="n">describe</span><span class="p">()</span>

</code></pre></div><!-- raw HTML omitted -->
<pre><code>.dataframe tbody tr th {
    vertical-align: top;
}

.dataframe thead th {
    text-align: right;
}
</code></pre>
<p><!-- raw HTML omitted --></p>
<!-- raw HTML omitted -->
<h3 id="nyc-annual-cost-histogram">NYC Annual Cost Histogram</h3>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="n">prediction_df</span><span class="o">.</span><span class="n">total</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">grid</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">bins</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span> <span class="n">rwidth</span><span class="o">=</span><span class="mf">0.9</span><span class="p">,</span>
                   <span class="n">color</span><span class="o">=</span><span class="s1">&#39;#607c8e&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Annual Total Costs Price USD&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Frequency&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="s1">&#39;y&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.75</span><span class="p">)</span>
</code></pre></div><p><img src="cost_of_living_monte_carlo_files/cost_of_living_monte_carlo_47_0.png" alt="png"></p>
<h3 id="nyc-calculating-the-confidence-interval-for-total-costs">NYC: Calculating the Confidence Interval For Total Costs</h3>
<p>The data is nearly normal. Greater samples sizes would produce a graph of nearly perfect normality</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python">
<span class="n">st</span><span class="o">.</span><span class="n">norm</span><span class="o">.</span><span class="n">interval</span><span class="p">(</span><span class="n">alpha</span><span class="o">=</span><span class="mf">0.90</span><span class="p">,</span> <span class="n">loc</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">prediction_df</span><span class="o">.</span><span class="n">total</span><span class="p">),</span> <span class="n">scale</span><span class="o">=</span><span class="n">st</span><span class="o">.</span><span class="n">sem</span><span class="p">(</span><span class="n">prediction_df</span><span class="o">.</span><span class="n">total</span><span class="p">))</span>
</code></pre></div><pre><code>(36979.727235126586, 37063.36039733022)
</code></pre>
<h3 id="nyc-annual-rent-histogram">NYC Annual Rent Histogram</h3>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="c1">### Annual Cost Histogram Histogram</span>
<span class="n">prediction_df</span><span class="o">.</span><span class="n">rent</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">grid</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">bins</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span> <span class="n">rwidth</span><span class="o">=</span><span class="mf">0.9</span><span class="p">,</span>
                   <span class="n">color</span><span class="o">=</span><span class="s1">&#39;#607c8e&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Annual Rent Cost Distribution &#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Annual Rent Costs Price USD&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Frequency&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="s1">&#39;y&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.75</span><span class="p">)</span>
</code></pre></div><p><img src="cost_of_living_monte_carlo_files/cost_of_living_monte_carlo_51_0.png" alt="png"></p>
<h3 id="calculating-the-confidence-interval-for-annual-rent">Calculating the Confidence Interval For Annual Rent</h3>
<p>The data is nearly normal. Greater samples sizes would produce a graph of nearly perfect normality</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python">
<span class="n">st</span><span class="o">.</span><span class="n">norm</span><span class="o">.</span><span class="n">interval</span><span class="p">(</span><span class="n">alpha</span><span class="o">=</span><span class="mf">0.95</span><span class="p">,</span> <span class="n">loc</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">prediction_df</span><span class="o">.</span><span class="n">rent</span><span class="p">),</span> <span class="n">scale</span><span class="o">=</span><span class="n">st</span><span class="o">.</span><span class="n">sem</span><span class="p">(</span><span class="n">prediction_df</span><span class="o">.</span><span class="n">rent</span><span class="p">))</span>
</code></pre></div><pre><code>(29169.877514702926, 29269.14186706609)
</code></pre>
<h2 id="nyc-closing-remarks">NYC Closing Remarks</h2>
<p>The rent distribution in NYC with 2018 data is actually nearly comparible to my houston estimate.  An annual salary of 90,000 would permit me to live at about the median level in the city.  I will be redoing this report soon as the data is old.  I am currently scraping data in houston and nyc to produce a better analysis.</p>
<h2 id="imports">Imports</h2>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">scipy.stats</span> <span class="k">as</span> <span class="nn">st</span>
<span class="kn">from</span> <span class="nn">shapely.geometry</span> <span class="kn">import</span> <span class="n">Point</span>
<span class="kn">from</span> <span class="nn">numpy.random</span> <span class="kn">import</span> <span class="n">choice</span>
<span class="kn">import</span> <span class="nn">warnings</span>

<span class="n">warnings</span><span class="o">.</span><span class="n">filterwarnings</span><span class="p">(</span><span class="s1">&#39;ignore&#39;</span><span class="p">)</span>

</code></pre></div>]]></content>
			<postid> 19d722a3367160b90fe1dcc2ee5c46ab</postid>
			<author>Justin Napolitano</author>
			<author_name>Justin Napolitano</author_name>
			<author_email>personal.jnapolitano@gmail.com</author_email>
			<author_id>87654367b2fca109e7dc9d3ea8a1ebbaf0bfe374773b148c2c20d278479add99</author_id>			
		</item>
		
		<item>
			<title>Spearman Rank in Standard Julia</title>
			<link>jnapolitano.com/posts/spearman_rank_julia/</link>
			<pubDate>Mon, 30 May 2022 20:20:32 +0000</pubDate>
			<guid>jnapolitano.com/posts/spearman_rank_julia/</guid>
			<description><![CDATA[Numerical Recipes in Julia.  Spearman Rank Correlation adapted to nearly standard Julia.]]></description>
			<content type="html"><![CDATA[<h2 id="spearman-rank-in-standard-julia">Spearman Rank in Standard Julia</h2>
<p>Well nearly, I did import the erfc function from the SpecialFunctions package.  I don&rsquo;t like it either.  I&rsquo;ll write my own soon to make up for it.</p>
<h2 id="special-thanks">Special Thanks</h2>
<p>I came across the text Numerical Recipes in C.  It was first published in 1988, by the Cambridge University Press.  The authors are William H. Press, Brian P. Flannery, Saul. A. Teukolsky, and William T. Veterling.</p>
<p>The book is beautiful.  You should try to find a copy.  It comes in Pascal and Fortran too!!!</p>
<p>I&rsquo;m having fun with it and will translate some of the recipes from my first love C to Julia.</p>
<p>I&rsquo;ll write up a review on the functions below in an upcoming edit.  I&rsquo;m so excited that it works that I had to publish.</p>
<h2 id="update-there-is-a-website">Update: There is a Website!!!</h2>
<p><a href="http://numerical.recipes/">numerical.recipes</a> is a website with all of the code and the ebook.  I thought it was open source at first, but they want some money.  I guess it&rsquo;s okay, but still.  Check it out there.</p>
<p><a href="https://www.amazon.com/Numerical-Recipes-Scientific-Computing-Second/dp/0521431085#:~:text=The%20product%20of%20a%20unique,to%20actual%20practical%20computer%20routines">The amazon book link is here</a></p>
<h2 id="update-again">Update Again:</h2>
<p>I found the PDF!  It is available via penn state university. Here&rsquo;s the <a href="https://citeseerx.ist.psu.edu/viewdoc/download?doi=10.1.1.129.5354&amp;rep=rep1&amp;type=pdf">download link</a></p>
<h2 id="using-specialfunctionserfc">Using SpecialFunctions:erfc</h2>
<p>I had to import the complementary error function.  I wanted to use just the standard library, but I had to test the code below first.  I&rsquo;ll write the compelemntary error function in pure julia next.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-julia" data-lang="julia">
<span class="k">using</span> <span class="n">SpecialFunctions</span><span class="o">:</span><span class="n">erfc</span>
</code></pre></div><h2 id="spearman-correlation-function">Spearman Correlation Function.</h2>
<p>It takes:</p>
<ul>
<li>two distributions</li>
<li>the sample size</li>
</ul>
<p>It returns a t score  The original, used pointers to return multiple variables.  I&rsquo;ll probably rewrite the function to calculate the copmlimentary variables in seperate methods.  Might as well take advantage of the multiple dispatch capability of the language.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-julia" data-lang="julia"><span class="k">function</span> <span class="n">spearman</span><span class="p">(</span><span class="n">data1</span><span class="p">,</span><span class="n">data2</span><span class="p">,</span><span class="n">n</span><span class="p">)</span>

    <span class="n">j</span> <span class="o">=</span><span class="mi">1</span> 
    
    <span class="n">wksp1m</span><span class="o">=</span> <span class="kt">Vector</span><span class="p">{</span><span class="kt">Float64</span><span class="p">}(</span><span class="mi">0</span><span class="o">:</span><span class="n">n</span><span class="p">)</span>
    <span class="n">wksp2m</span> <span class="o">=</span> <span class="kt">Vector</span><span class="p">{</span><span class="kt">Float64</span><span class="p">}(</span><span class="mi">0</span><span class="o">:</span><span class="n">n</span><span class="p">)</span>
    
    <span class="k">for</span> <span class="n">j</span> <span class="k">in</span> <span class="mi">1</span><span class="o">:</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>
        <span class="n">wksp1m</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="o">=</span><span class="n">data1</span><span class="p">[</span><span class="n">j</span><span class="p">]</span>
        <span class="n">wksp2m</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="o">=</span><span class="n">data2</span><span class="p">[</span><span class="n">j</span><span class="p">]</span>
    <span class="k">end</span>

    <span class="n">sort!</span><span class="p">(</span><span class="n">wksp1m</span><span class="p">)</span>
    <span class="n">sort!</span><span class="p">(</span><span class="n">wksp2m</span><span class="p">)</span>

    <span class="n">sf</span> <span class="o">=</span> <span class="n">crank</span><span class="p">(</span><span class="n">n</span><span class="p">,</span><span class="n">wksp1m</span><span class="p">)</span>
    <span class="n">sg</span> <span class="o">=</span> <span class="n">crank</span><span class="p">(</span><span class="n">n</span><span class="p">,</span><span class="n">wksp2m</span><span class="p">)</span>

    <span class="n">d</span> <span class="o">=</span> <span class="mi">0</span> 

    <span class="k">for</span> <span class="n">j</span> <span class="k">in</span> <span class="mi">1</span><span class="o">:</span><span class="n">n</span>
        <span class="n">d</span> <span class="o">+=</span> <span class="n">sqrt</span><span class="p">((</span><span class="kt">Complex</span><span class="p">(</span><span class="n">wksp1m</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="o">-</span><span class="n">wksp2m</span><span class="p">[</span><span class="n">j</span><span class="p">])))</span>
    <span class="k">end</span>
    
    <span class="n">en</span><span class="o">=</span><span class="n">n</span>
    <span class="n">en3n</span> <span class="o">=</span> <span class="p">(</span><span class="n">en</span><span class="o">*</span><span class="n">en</span><span class="o">*</span><span class="n">en</span><span class="p">)</span><span class="o">-</span><span class="n">en</span>
    <span class="n">aved</span><span class="o">=</span><span class="p">(</span><span class="n">en3n</span><span class="o">/</span><span class="mf">6.0</span><span class="p">)</span><span class="o">-</span><span class="p">((</span><span class="n">sf</span><span class="o">+</span><span class="n">sg</span><span class="p">)</span><span class="o">/</span><span class="mi">12</span><span class="p">)</span>
    <span class="n">fac</span><span class="o">=</span><span class="p">(</span><span class="mf">1.0</span><span class="o">-</span><span class="n">sf</span><span class="o">/</span><span class="n">en3n</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="mf">1.0</span><span class="o">-</span><span class="p">(</span><span class="n">sg</span><span class="o">/</span><span class="n">en3n</span><span class="p">))</span>
    <span class="n">vard</span> <span class="o">=</span><span class="p">((</span><span class="n">en</span><span class="o">-</span><span class="mf">1.0</span><span class="p">)</span><span class="o">*</span><span class="n">en</span><span class="o">*</span><span class="n">en</span><span class="o">*</span><span class="n">sqrt</span><span class="p">(</span><span class="n">en</span><span class="o">+</span><span class="mf">1.0</span><span class="p">)</span><span class="o">/</span><span class="mf">36.0</span><span class="p">)</span><span class="o">*</span><span class="n">fac</span>
    <span class="n">zd</span> <span class="o">=</span> <span class="p">(</span><span class="n">d</span><span class="o">-</span><span class="n">aved</span><span class="o">/</span><span class="n">sqrt</span><span class="p">(</span><span class="n">vard</span><span class="p">))</span>
    <span class="n">probd</span><span class="o">=</span><span class="n">erfc</span><span class="p">((</span><span class="n">abs</span><span class="p">(</span><span class="n">zd</span><span class="p">)</span><span class="o">/</span><span class="mf">1.4142136</span><span class="p">))</span>
    <span class="n">rs</span> <span class="o">=</span> <span class="p">(</span><span class="mf">1.0</span><span class="o">-</span><span class="p">(</span><span class="mf">6.0</span><span class="o">/</span><span class="n">en3n</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">d</span><span class="o">+</span><span class="mf">0.5</span><span class="o">*</span><span class="p">(</span><span class="n">sf</span><span class="o">+</span><span class="n">sg</span><span class="p">)))</span><span class="o">/</span><span class="n">fac</span>
    <span class="n">t</span><span class="o">=</span><span class="p">(</span><span class="n">rs</span><span class="p">)</span><span class="o">*</span><span class="n">sqrt</span><span class="p">((</span><span class="n">en</span><span class="o">-</span><span class="mf">2.0</span><span class="p">)</span><span class="o">/</span><span class="p">((</span><span class="n">rs</span><span class="o">+</span><span class="mf">1.0</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="mf">1.0</span><span class="o">-</span><span class="n">rs</span><span class="p">)))</span>
    <span class="k">return</span> <span class="n">t</span>
    
<span class="k">end</span>
    
</code></pre></div><pre><code>spearman (generic function with 2 methods)
</code></pre>
<h3 id="crank">Crank</h3>
<p>It ranks the distributions by modifying the original sorted array.  So very C.  I may play with this to return a new value, but I like that it modifies in place.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-julia" data-lang="julia"><span class="k">function</span> <span class="n">crank</span><span class="p">(</span><span class="n">n</span><span class="p">,</span><span class="n">w</span><span class="p">)</span>
    
    <span class="c">#w= Vector{Float64}(1:n)</span>
    <span class="n">c</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">j</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">s</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">for</span> <span class="n">j</span> <span class="k">in</span> <span class="mi">1</span><span class="o">:</span><span class="p">(</span><span class="n">n</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">w</span><span class="p">[</span><span class="n">j</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span> <span class="o">!=</span> <span class="n">w</span><span class="p">[</span><span class="n">j</span><span class="p">]</span>
            <span class="n">w</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">j</span>
        <span class="k">else</span>
            <span class="k">for</span> <span class="n">jt</span> <span class="k">in</span> <span class="mi">1</span><span class="o">:</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">w</span><span class="p">[</span><span class="n">jt</span><span class="p">]</span> <span class="o">!=</span> <span class="n">w</span><span class="p">[</span><span class="n">j</span><span class="p">])</span>
                    <span class="k">break</span>
                <span class="k">end</span>
            <span class="k">end</span>
            <span class="n">rank</span> <span class="o">=</span> <span class="mf">.5</span><span class="o">*</span><span class="p">(</span><span class="n">j</span><span class="o">+</span><span class="n">jt</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">ji</span> <span class="k">in</span> <span class="n">j</span><span class="o">:</span><span class="p">(</span><span class="n">jt</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
                <span class="n">w</span><span class="p">[</span><span class="n">ji</span><span class="p">]</span> <span class="o">=</span> <span class="n">rank</span>
            <span class="k">end</span>
            <span class="n">t</span> <span class="o">=</span> <span class="n">jt</span><span class="o">-</span><span class="n">j</span>
            <span class="n">s</span> <span class="o">+=</span> <span class="n">t</span><span class="o">*</span><span class="n">t</span><span class="o">*</span><span class="n">t</span><span class="o">-</span><span class="mi">1</span>
        <span class="k">end</span>
        <span class="n">c</span> <span class="o">=</span> <span class="n">j</span>
        <span class="n">j</span><span class="o">=</span><span class="n">j</span>
    <span class="k">end</span>
    <span class="k">if</span> <span class="n">c</span> <span class="o">==</span> <span class="n">n</span> 
        <span class="n">w</span><span class="p">[</span><span class="n">n</span><span class="p">]</span><span class="o">=</span><span class="n">n</span>
    <span class="k">end</span>
    <span class="k">return</span> <span class="n">s</span>
<span class="k">end</span>
</code></pre></div><pre><code>crank (generic function with 1 method)
</code></pre>
<h2 id="main">Main()</h2>
<p>Creates two random distributions and ranks tests them for correlation..</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-julia" data-lang="julia"><span class="k">function</span> <span class="n">main</span><span class="p">()</span>
    <span class="n">d1</span> <span class="o">=</span> <span class="p">[</span><span class="mi">5</span><span class="n">rand</span><span class="p">()</span><span class="o">+</span><span class="mi">2</span> <span class="k">for</span> <span class="n">i</span><span class="o">=</span><span class="mi">1</span><span class="o">:</span><span class="mi">50</span><span class="p">]</span>
    <span class="n">d2</span> <span class="o">=</span> <span class="p">[</span><span class="mi">3</span><span class="n">rand</span><span class="p">()</span><span class="o">+</span><span class="mi">2</span> <span class="k">for</span> <span class="n">i</span><span class="o">=</span><span class="mi">1</span><span class="o">:</span><span class="mi">50</span><span class="p">]</span>

    <span class="n">t</span> <span class="o">=</span><span class="n">spearman</span><span class="p">(</span><span class="n">d1</span><span class="p">,</span><span class="n">d2</span><span class="p">,</span><span class="mi">50</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">display</span><span class="p">(</span><span class="n">t</span><span class="p">)</span>
<span class="k">end</span>
</code></pre></div><pre><code>main (generic function with 1 method)
</code></pre>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-julia" data-lang="julia"><span class="n">main</span><span class="p">()</span>
</code></pre></div><pre><code>619.0719816953838 - 0.0im
</code></pre>
]]></content>
			<postid> ff8605f008dc9c93a61db7de1dfaba2d</postid>
			<author>Justin Napolitano</author>
			<author_name>Justin Napolitano</author_name>
			<author_email>personal.jnapolitano@gmail.com</author_email>
			<author_id>87654367b2fca109e7dc9d3ea8a1ebbaf0bfe374773b148c2c20d278479add99</author_id>			
		</item>
		
		<item>
			<title>Churn Modelling Marketing Data with Julia</title>
			<link>jnapolitano.com/posts/propensity_scoring/</link>
			<pubDate>Mon, 30 May 2022 13:30:32 +0000</pubDate>
			<guid>jnapolitano.com/posts/propensity_scoring/</guid>
			<description><![CDATA[Logistic Regression Propensity Models of Marketing Data with Julia.]]></description>
			<content type="html"><![CDATA[<h1 id="churn-modelling-marketing-data-with-julia">Churn Modelling Marketing Data with Julia</h1>
<h2 id="introduction">Introduction</h2>
<p>I prepared this analysis to learn the logistic regression in Julia. The work is fairly straightforward.  I am modelling if a customer will exit a website based on a number of sites.  I&rsquo;ll improve the model in an upcoming post.  As if, is not as interesting as asking when. That will be my next project</p>
<h3 id="imports">Imports</h3>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-julia" data-lang="julia"><span class="k">using</span> <span class="n">Pkg</span>
<span class="k">using</span> <span class="n">DataFrames</span>
<span class="k">using</span> <span class="n">CSV</span>
<span class="k">using</span> <span class="n">Plots</span>
<span class="k">using</span> <span class="n">GLM</span>
<span class="k">using</span> <span class="n">StatsBase</span>
<span class="k">using</span> <span class="n">Lathe</span>
<span class="k">using</span> <span class="n">MLBase</span>
<span class="k">using</span> <span class="n">ClassImbalance</span>
<span class="k">using</span> <span class="n">ROCAnalysis</span>
<span class="k">using</span> <span class="n">PyCall</span>
<span class="n">sklearn</span> <span class="o">=</span> <span class="n">pyimport</span><span class="p">(</span><span class="s">&#34;sklearn.metrics&#34;</span><span class="p">)</span>
</code></pre></div><pre><code>PyObject &lt;module 'sklearn.metrics' from '/Users/jnapolitano/venvs/finance/lib/python3.9/site-packages/sklearn/metrics/__init__.py'&gt;
</code></pre>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-julia" data-lang="julia"><span class="k">function</span> <span class="n">load_csv</span><span class="p">()</span> 

    <span class="n">df</span> <span class="o">=</span> <span class="n">DataFrame</span><span class="p">(</span><span class="n">CSV</span><span class="o">.</span><span class="n">File</span><span class="p">(</span><span class="s">&#34;./Churn_Modelling.csv&#34;</span><span class="p">))</span> 
    <span class="k">return</span> <span class="n">df</span> 
<span class="k">end</span>
</code></pre></div><pre><code>load_csv (generic function with 1 method)
</code></pre>
<h2 id="loading-data">Loading Data</h2>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-julia" data-lang="julia"><span class="n">marketing_df</span> <span class="o">=</span> <span class="n">load_csv</span><span class="p">()</span>
<span class="n">first</span><span class="p">(</span><span class="n">marketing_df</span><span class="p">,</span><span class="mi">5</span><span class="p">)</span>
</code></pre></div><!-- raw HTML omitted -->
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-julia" data-lang="julia"><span class="n">println</span><span class="p">(</span><span class="n">size</span><span class="p">(</span><span class="n">marketing_df</span><span class="p">))</span>
<span class="n">describe</span><span class="p">(</span><span class="n">marketing_df</span><span class="p">)</span>
</code></pre></div><pre><code>(10000, 14)
</code></pre>
<!-- raw HTML omitted -->
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-julia" data-lang="julia"><span class="c"># Check column names</span>
<span class="n">names</span><span class="p">(</span><span class="n">marketing_df</span><span class="p">)</span>
</code></pre></div><pre><code>14-element Vector{Symbol}:
 :RowNumber
 :CustomerId
 :Surname
 :CreditScore
 :Geography
 :Gender
 :Age
 :Tenure
 :Balance
 :NumOfProducts
 :HasCrCard
 :IsActiveMember
 :EstimatedSalary
 :Exited
</code></pre>
<h3 id="check-class-imbalance">Check Class Imbalance</h3>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-julia" data-lang="julia"><span class="c"># Count the classes</span>
<span class="n">countmap</span><span class="p">(</span><span class="n">marketing_df</span><span class="o">.</span><span class="n">Exited</span><span class="p">)</span>
</code></pre></div><pre><code>Dict{Int64, Int64} with 2 entries:
  0 =&gt; 7963
  1 =&gt; 2037
</code></pre>
<h2 id="data-preprocessing">Data Preprocessing</h2>
<h3 id="one-hot-encoding">One Hot Encoding</h3>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-julia" data-lang="julia"><span class="c"># One hot encoding</span>
<span class="n">Lathe</span><span class="o">.</span><span class="n">preprocess</span><span class="o">.</span><span class="n">OneHotEncode</span><span class="p">(</span><span class="n">marketing_df</span><span class="p">,</span><span class="ss">:Geography</span><span class="p">)</span>
<span class="n">Lathe</span><span class="o">.</span><span class="n">preprocess</span><span class="o">.</span><span class="n">OneHotEncode</span><span class="p">(</span><span class="n">marketing_df</span><span class="p">,</span><span class="ss">:Gender</span><span class="p">)</span>
<span class="n">select!</span><span class="p">(</span><span class="n">marketing_df</span><span class="p">,</span> <span class="n">Not</span><span class="p">([</span><span class="ss">:RowNumber</span><span class="p">,</span> <span class="ss">:CustomerId</span><span class="p">,</span><span class="ss">:Surname</span><span class="p">,</span><span class="ss">:Geography</span><span class="p">,</span><span class="ss">:Gender</span><span class="p">,</span><span class="ss">:Male</span><span class="p">]))</span>

</code></pre></div><!-- raw HTML omitted -->
<h3 id="split-trainand-test-data">Split Train/and Test Data</h3>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-julia" data-lang="julia"><span class="c"># Train test split</span>
<span class="k">using</span> <span class="n">Lathe</span><span class="o">.</span><span class="n">preprocess</span><span class="o">:</span> <span class="n">TrainTestSplit</span>
<span class="n">train</span><span class="p">,</span> <span class="n">test</span> <span class="o">=</span> <span class="n">TrainTestSplit</span><span class="p">(</span><span class="n">marketing_df</span><span class="p">,</span><span class="mf">.75</span><span class="p">);</span>
</code></pre></div><h2 id="build-model">Build Model</h2>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-julia" data-lang="julia"><span class="c"># Train logistic regression model</span>
<span class="n">fm</span> <span class="o">=</span> <span class="nd">@formula</span><span class="p">(</span><span class="n">Exited</span> <span class="o">~</span> <span class="n">CreditScore</span> <span class="o">+</span> <span class="n">Age</span> <span class="o">+</span> <span class="n">Tenure</span> <span class="o">+</span> <span class="n">Balance</span> <span class="o">+</span> <span class="n">NumOfProducts</span> <span class="o">+</span> <span class="n">HasCrCard</span> <span class="o">+</span> <span class="n">IsActiveMember</span> <span class="o">+</span> <span class="n">EstimatedSalary</span> <span class="o">+</span> <span class="n">Female</span> <span class="o">+</span> <span class="n">France</span> <span class="o">+</span> <span class="n">Spain</span><span class="p">)</span>
<span class="n">logit</span> <span class="o">=</span> <span class="n">glm</span><span class="p">(</span><span class="n">fm</span><span class="p">,</span> <span class="n">train</span><span class="p">,</span> <span class="n">Binomial</span><span class="p">(),</span> <span class="n">ProbitLink</span><span class="p">())</span>
</code></pre></div><pre><code>StatsModels.TableRegressionModel{GeneralizedLinearModel{GLM.GlmResp{Vector{Float64}, Binomial{Float64}, ProbitLink}, GLM.DensePredChol{Float64, LinearAlgebra.Cholesky{Float64, Matrix{Float64}}}}, Matrix{Float64}}

Exited ~ 1 + CreditScore + Age + Tenure + Balance + NumOfProducts + HasCrCard + IsActiveMember + EstimatedSalary + Female + France + Spain

Coefficients:
───────────────────────────────────────────────────────────────────────────────────────
                        Coef.   Std. Error       z  Pr(&gt;|z|)     Lower 95%    Upper 95%
───────────────────────────────────────────────────────────────────────────────────────
(Intercept)      -1.90933      0.165007     -11.57    &lt;1e-30  -2.23274      -1.58592
CreditScore      -0.000321917  0.000183184   -1.76    0.0789  -0.000680951   3.71172e-5
Age               0.040893     0.00165251    24.75    &lt;1e-99   0.0376541     0.0441318
Tenure           -0.008864     0.00611129    -1.45    0.1469  -0.0208419     0.0031139
Balance           1.65933e-6   3.30286e-7     5.02    &lt;1e-06   1.01198e-6    2.30668e-6
NumOfProducts    -0.040173     0.0309946     -1.30    0.1949  -0.100921      0.0205753
HasCrCard        -0.00442931   0.0386394     -0.11    0.9087  -0.0801612     0.0713026
IsActiveMember   -0.557894     0.0365213    -15.28    &lt;1e-51  -0.629475     -0.486314
EstimatedSalary   2.2925e-7    3.07604e-7     0.75    0.4561  -3.73644e-7    8.32143e-7
Female            0.301642     0.0354259      8.51    &lt;1e-16   0.232209      0.371076
France           -0.450226     0.0446176    -10.09    &lt;1e-23  -0.537674     -0.362777
Spain            -0.443184     0.051707      -8.57    &lt;1e-16  -0.544527     -0.34184
───────────────────────────────────────────────────────────────────────────────────────
</code></pre>
<h2 id="model-predictions-and-evaluation">Model Predictions and Evaluation</h2>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-julia" data-lang="julia"><span class="c"># Predict the target variable on test data </span>
<span class="n">prediction</span> <span class="o">=</span> <span class="n">predict</span><span class="p">(</span><span class="n">logit</span><span class="p">,</span><span class="n">test</span><span class="p">)</span>
</code></pre></div><pre><code>2406-element Vector{Union{Missing, Float64}}:
 0.24401107345293602
 0.1266535868551322
 0.031721959583257124
 0.11357816519004983
 0.24824114578495612
 0.024688755265128235
 0.14209354336141483
 0.18528877855991494
 0.15470097145575007
 0.25962439112051505
 0.15117890643161475
 0.2110682947689441
 0.06358192272871947
 ⋮
 0.24899439141513482
 0.23449577199293972
 0.13610439167926225
 0.1737934374110589
 0.1341643450975004
 0.5831068095078078
 0.2950497674661655
 0.04139159536998556
 0.06795785137729822
 0.017204995327274736
 0.12888818685657766
 0.15310112069144077
</code></pre>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-julia" data-lang="julia"><span class="c"># Convert probability score to class</span>
<span class="n">prediction_class</span> <span class="o">=</span> <span class="p">[</span><span class="k">if</span> <span class="n">x</span> <span class="o">&lt;</span> <span class="mf">0.5</span> <span class="mi">0</span> <span class="k">else</span> <span class="mi">1</span> <span class="k">end</span> <span class="k">for</span> <span class="n">x</span> <span class="k">in</span> <span class="n">prediction</span><span class="p">];</span>

<span class="n">prediction_df</span> <span class="o">=</span> <span class="n">DataFrame</span><span class="p">(</span><span class="n">y_actual</span> <span class="o">=</span> <span class="n">test</span><span class="o">.</span><span class="n">Exited</span><span class="p">,</span> <span class="n">y_predicted</span> <span class="o">=</span> <span class="n">prediction_class</span><span class="p">,</span> <span class="n">prob_predicted</span> <span class="o">=</span> <span class="n">prediction</span><span class="p">);</span>
<span class="n">prediction_df</span><span class="o">.</span><span class="n">correctly_classified</span> <span class="o">=</span> <span class="n">prediction_df</span><span class="o">.</span><span class="n">y_actual</span> <span class="o">.==</span> <span class="n">prediction_df</span><span class="o">.</span><span class="n">y_predicted</span>
</code></pre></div><pre><code>2406-element BitVector:
 0
 1
 1
 1
 1
 1
 1
 1
 1
 0
 1
 1
 1
 ⋮
 1
 1
 1
 1
 1
 1
 1
 1
 1
 1
 1
 1
</code></pre>
<h3 id="prediction-accuracy">Prediction Accuracy</h3>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-julia" data-lang="julia"><span class="n">accuracy</span> <span class="o">=</span> <span class="n">mean</span><span class="p">(</span><span class="n">prediction_df</span><span class="o">.</span><span class="n">correctly_classified</span><span class="p">)</span>
</code></pre></div><pre><code>0.8100581878636741
</code></pre>
<h3 id="confusion-matrix">Confusion Matrix</h3>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-julia" data-lang="julia"><span class="c"># confusion_matrix = confusmat(2,prediction_df.y_actual, prediction_df.y_predicted)</span>
<span class="n">confusion_matrix</span> <span class="o">=</span> <span class="n">MLBase</span><span class="o">.</span><span class="n">roc</span><span class="p">(</span><span class="n">prediction_df</span><span class="o">.</span><span class="n">y_actual</span><span class="p">,</span> <span class="n">prediction_df</span><span class="o">.</span><span class="n">y_predicted</span><span class="p">)</span>
</code></pre></div><pre><code>ROCNums{Int64}
  p = 510
  n = 1896
  tp = 105
  tn = 1844
  fp = 52
  fn = 405
</code></pre>
<h3 id="results">Results</h3>
<p>The model is estimating far to many exiting cases.  About 4 times the true value.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-julia" data-lang="julia"><span class="n">fpr</span><span class="p">,</span> <span class="n">tpr</span><span class="p">,</span> <span class="n">thresholds</span> <span class="o">=</span> <span class="n">sklearn</span><span class="o">.</span><span class="n">roc_curve</span><span class="p">(</span><span class="n">prediction_df</span><span class="o">.</span><span class="n">y_actual</span><span class="p">,</span> <span class="n">prediction_df</span><span class="o">.</span><span class="n">prob_predicted</span><span class="p">)</span>
</code></pre></div><pre><code>([0.0, 0.0, 0.0, 0.0005274261603375527, 0.0005274261603375527, 0.0010548523206751054, 0.0010548523206751054, 0.0015822784810126582, 0.0015822784810126582, 0.0026371308016877636  …  0.8829113924050633, 0.9066455696202531, 0.9066455696202531, 0.9193037974683544, 0.9193037974683544, 0.92457805907173, 0.92457805907173, 0.9725738396624473, 0.9725738396624473, 1.0], [0.0, 0.00196078431372549, 0.00392156862745098, 0.00392156862745098, 0.00784313725490196, 0.00784313725490196, 0.01568627450980392, 0.01568627450980392, 0.03137254901960784, 0.03137254901960784  …  0.9921568627450981, 0.9921568627450981, 0.9941176470588236, 0.9941176470588236, 0.996078431372549, 0.996078431372549, 0.9980392156862745, 0.9980392156862745, 1.0, 1.0], [1.8467335270755767, 0.8467335270755767, 0.8140811888019499, 0.8092555110984978, 0.7970873802691381, 0.79684704533007, 0.7719016175181805, 0.7709263202992206, 0.7060214606993195, 0.6994801619873218  …  0.04233143871590189, 0.03786940431261241, 0.037850945580692276, 0.035665362242897694, 0.03532968973176317, 0.03416668456674327, 0.03407543014692377, 0.020932892669754958, 0.020885871157504798, 0.00597005405256463])
</code></pre>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-julia" data-lang="julia"><span class="c"># Plot ROC curve</span>
<span class="n">plot</span><span class="p">(</span><span class="n">fpr</span><span class="p">,</span> <span class="n">tpr</span><span class="p">)</span>
<span class="n">title!</span><span class="p">(</span><span class="s">&#34;ROC curve&#34;</span><span class="p">)</span>
</code></pre></div><p><img src="propensity_scoring_files/propensity_scoring_24_0.svg" alt="svg"></p>
<h2 id="the-class-imbalance-problem">The Class Imbalance Problem</h2>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-julia" data-lang="julia"><span class="c"># Count the classes</span>
<span class="n">countmap</span><span class="p">(</span><span class="n">marketing_df</span><span class="o">.</span><span class="n">Exited</span><span class="p">)</span>
</code></pre></div><pre><code>Dict{Int64, Int64} with 2 entries:
  0 =&gt; 7963
  1 =&gt; 2037
</code></pre>
<h3 id="smote-to-fix-imbalance">Smote to fix imbalance</h3>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-julia" data-lang="julia"><span class="n">X2</span><span class="p">,</span> <span class="n">y2</span> <span class="o">=</span><span class="n">smote</span><span class="p">(</span><span class="n">marketing_df</span><span class="p">[</span><span class="o">!</span><span class="p">,[</span><span class="ss">:CreditScore</span><span class="p">,</span><span class="ss">:Age</span> <span class="p">,</span><span class="ss">:Tenure</span><span class="p">,</span> <span class="ss">:Balance</span><span class="p">,</span> <span class="ss">:NumOfProducts</span><span class="p">,</span> <span class="ss">:HasCrCard</span><span class="p">,</span> <span class="ss">:IsActiveMember</span><span class="p">,</span> <span class="ss">:EstimatedSalary</span><span class="p">,</span> <span class="ss">:Female</span> <span class="p">,</span> <span class="ss">:France</span><span class="p">,</span> <span class="ss">:Spain</span><span class="p">]],</span> <span class="n">marketing_df</span><span class="o">.</span><span class="n">Exited</span><span class="p">,</span> <span class="n">k</span> <span class="o">=</span> <span class="mi">5</span><span class="p">,</span> <span class="n">pct_under</span> <span class="o">=</span> <span class="mi">150</span><span class="p">,</span> <span class="n">pct_over</span> <span class="o">=</span> <span class="mi">200</span><span class="p">)</span>
<span class="n">df_balanced</span> <span class="o">=</span> <span class="n">X2</span>
<span class="n">df_balanced</span><span class="o">.</span><span class="n">Exited</span> <span class="o">=</span> <span class="n">y2</span><span class="p">;</span>

<span class="n">df</span> <span class="o">=</span> <span class="n">df_balanced</span><span class="p">;</span>

<span class="c"># Count the classes</span>
<span class="n">countmap</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">Exited</span><span class="p">)</span>
</code></pre></div><pre><code>Dict{Int64, Int64} with 2 entries:
  0 =&gt; 6111
  1 =&gt; 6111
</code></pre>
<h3 id="retest">Retest</h3>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-julia" data-lang="julia"><span class="c"># Train test split</span>
<span class="n">train</span><span class="p">,</span> <span class="n">test</span> <span class="o">=</span> <span class="n">TrainTestSplit</span><span class="p">(</span><span class="n">df</span><span class="p">,</span><span class="mf">.75</span><span class="p">);</span>

<span class="c"># Model Building</span>
<span class="n">fm</span> <span class="o">=</span> <span class="nd">@formula</span><span class="p">(</span><span class="n">Exited</span> <span class="o">~</span> <span class="n">CreditScore</span> <span class="o">+</span> <span class="n">Age</span> <span class="o">+</span> <span class="n">Tenure</span> <span class="o">+</span> <span class="n">Balance</span> <span class="o">+</span> <span class="n">NumOfProducts</span> <span class="o">+</span> <span class="n">HasCrCard</span> <span class="o">+</span> <span class="n">IsActiveMember</span> <span class="o">+</span> <span class="n">EstimatedSalary</span> <span class="o">+</span> <span class="n">Female</span> <span class="o">+</span> <span class="n">France</span> <span class="o">+</span> <span class="n">Spain</span><span class="p">)</span>
<span class="n">logit</span> <span class="o">=</span> <span class="n">glm</span><span class="p">(</span><span class="n">fm</span><span class="p">,</span> <span class="n">train</span><span class="p">,</span> <span class="n">Binomial</span><span class="p">(),</span> <span class="n">ProbitLink</span><span class="p">())</span>

<span class="c"># Predict the target variable on test data </span>
<span class="n">prediction</span> <span class="o">=</span> <span class="n">predict</span><span class="p">(</span><span class="n">logit</span><span class="p">,</span><span class="n">test</span><span class="p">)</span>

<span class="c"># Convert probability score to class</span>
<span class="n">prediction_class</span> <span class="o">=</span> <span class="p">[</span><span class="k">if</span> <span class="n">x</span> <span class="o">&lt;</span> <span class="mf">0.5</span> <span class="mi">0</span> <span class="k">else</span> <span class="mi">1</span> <span class="k">end</span> <span class="k">for</span> <span class="n">x</span> <span class="k">in</span> <span class="n">prediction</span><span class="p">];</span>

<span class="n">prediction_df</span> <span class="o">=</span> <span class="n">DataFrame</span><span class="p">(</span><span class="n">y_actual</span> <span class="o">=</span> <span class="n">test</span><span class="o">.</span><span class="n">Exited</span><span class="p">,</span> <span class="n">y_predicted</span> <span class="o">=</span> <span class="n">prediction_class</span><span class="p">,</span> <span class="n">prob_predicted</span> <span class="o">=</span> <span class="n">prediction</span><span class="p">);</span>
<span class="n">prediction_df</span><span class="o">.</span><span class="n">correctly_classified</span> <span class="o">=</span> <span class="n">prediction_df</span><span class="o">.</span><span class="n">y_actual</span> <span class="o">.==</span> <span class="n">prediction_df</span><span class="o">.</span><span class="n">y_predicted</span>


<span class="c"># Accuracy Score</span>
<span class="n">accuracy</span> <span class="o">=</span> <span class="n">mean</span><span class="p">(</span><span class="n">prediction_df</span><span class="o">.</span><span class="n">correctly_classified</span><span class="p">)</span>
<span class="n">print</span><span class="p">(</span><span class="s">&#34;Accuracy of the model is : &#34;</span><span class="p">,</span><span class="n">accuracy</span><span class="p">)</span>

<span class="c"># Confusion Matrix</span>
<span class="n">confusion_matrix</span> <span class="o">=</span> <span class="n">MLBase</span><span class="o">.</span><span class="n">roc</span><span class="p">(</span><span class="n">prediction_df</span><span class="o">.</span><span class="n">y_actual</span><span class="p">,</span> <span class="n">prediction_df</span><span class="o">.</span><span class="n">y_predicted</span><span class="p">)</span>
</code></pre></div><pre><code>Accuracy of the model is : 0.7169563791407019




ROCNums{Int64}
  p = 1550
  n = 1499
  tp = 1091
  tn = 1095
  fp = 404
  fn = 459
</code></pre>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-julia" data-lang="julia"><span class="n">fpr</span><span class="p">,</span> <span class="n">tpr</span><span class="p">,</span> <span class="n">thresholds</span> <span class="o">=</span> <span class="n">sklearn</span><span class="o">.</span><span class="n">roc_curve</span><span class="p">(</span><span class="n">prediction_df</span><span class="o">.</span><span class="n">y_actual</span><span class="p">,</span> <span class="n">prediction_df</span><span class="o">.</span><span class="n">prob_predicted</span><span class="p">)</span>
<span class="c"># Plot ROC curve</span>

</code></pre></div><pre><code>([0.0, 0.0, 0.0, 0.00066711140760507, 0.00066711140760507, 0.00133422281521014, 0.00133422281521014, 0.0020013342228152103, 0.0020013342228152103, 0.00266844563042028  …  0.9846564376250834, 0.9893262174783188, 0.9893262174783188, 0.9913275517011341, 0.9913275517011341, 0.9973315543695798, 0.9986657771847899, 0.9993328885923949, 0.9993328885923949, 1.0], [0.0, 0.0006451612903225806, 0.0025806451612903226, 0.0025806451612903226, 0.005161290322580645, 0.005161290322580645, 0.007741935483870968, 0.007741935483870968, 0.00903225806451613, 0.00903225806451613  …  0.9980645161290322, 0.9980645161290322, 0.9987096774193548, 0.9987096774193548, 0.9993548387096775, 0.9993548387096775, 0.9993548387096775, 0.9993548387096775, 1.0, 1.0], [1.9907624292252022, 0.9907624292252022, 0.983731024429679, 0.97951657298985, 0.9730082291507035, 0.9713532719467679, 0.9629327481173712, 0.9604203755106321, 0.9593444340323958, 0.9584649467140461  …  0.06923199350115271, 0.06553287523911823, 0.06469253560487893, 0.058594401854125504, 0.057872556108602216, 0.034170953161915506, 0.03357051125028141, 0.03297342671224324, 0.030937011626933943, 0.023743078872535135])
</code></pre>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-julia" data-lang="julia"><span class="n">plot</span><span class="p">(</span><span class="n">fpr</span><span class="p">,</span> <span class="n">tpr</span><span class="p">)</span>
<span class="n">title!</span><span class="p">(</span><span class="s">&#34;ROC curve&#34;</span><span class="p">)</span>
</code></pre></div><p><img src="propensity_scoring_files/propensity_scoring_32_0.svg" alt="svg"></p>
<h2 id="final-discussion">Final Discussion</h2>
<p>When accounting for class imbalance, the model accuracy is reduced to 71 percent from about 81 percent.</p>
<p>While this seems counterintutive, the second model is actually a better model overall.</p>
<p>The model with 81 percent accuracy is simply more accurate by chance.  The bin of exits to remains is far larger.  Thus, reported accuracy is higher.</p>
<p>When the classes are normalized, we see a prediction of about 71 percent.  Confidently, I can say that this model would scale appropriately.</p>
<p>The first model on the other hand would scale to about 25-30 percent accuracy.</p>
]]></content>
			<postid> 6a43f28a598460fe5a7c550c77e26b44</postid>
			<author>Justin Napolitano</author>
			<author_name>Justin Napolitano</author_name>
			<author_email>personal.jnapolitano@gmail.com</author_email>
			<author_id>87654367b2fca109e7dc9d3ea8a1ebbaf0bfe374773b148c2c20d278479add99</author_id>			
		</item>
		
		<item>
			<title>Markov Chains in Julia</title>
			<link>jnapolitano.com/posts/markov-models-julia/</link>
			<pubDate>Thu, 26 May 2022 01:30:32 +0000</pubDate>
			<guid>jnapolitano.com/posts/markov-models-julia/</guid>
			<description><![CDATA[Writing a Markov Simulation Problem the hard way.]]></description>
			<content type="html"><![CDATA[<h2 id="introduction">Introduction</h2>
<p>I am currently working on a <a href="https://blog.jnapolitano.io/series/legal-research-with-ai/">legal research series</a> where I perform statistical analysis and ml models to legal datasets.  My intention is to model the behavior of courts, determine the outcome of cases, and build a pipeline capable of identifying relevant case law by issue area.</p>
<p>That data set is nearly complete, but I have not decided which models to apply to it.  This is where Julia comes into play.</p>
<p>I plan to perform the statistical analysis and possible the ml workload with Julia.</p>
<p>In this post, I share an Algorithm to compute Markov Chains.</p>
<h2 id="markov-chains">Markov Chains</h2>
<p>I don&rsquo;t understand them completely.  I am grateful to <a href="https://julia.quantecon.org/tools_and_techniques/finite_markov.html">the text</a> for helping me to bettter grasp how they operate.</p>
<p>As far as my understanding goes they permit modeling the transition of states, possibly in infinite time, according to a probability distribution.  I recommend reading <a href="https://julia.quantecon.org/tools_and_techniques/finite_markov.html#markov-chains">this source</a> for authority.</p>
<h2 id="my-translation-of-markov-chains">My Translation of Markov Chains</h2>
<p>Lets start with a finite set of of elements that we call S.  In Cs terms think of this is as an array in the C Language.  It must be defined prior to an operation. <code>I think markov chains can be performed on unbounded sets as well but I'm not at that level yet</code>.</p>
<p>The set is called the set space.  Each value within it considered an individual state.</p>
<p>Markov Chains are sets that contain the Markov Property.  A markov property considers the probability of the model having a state within the space at a point in time.</p>
<p>Thus, the probability of going from x to y in one step of unit time can be computed.  If we consider the state changes within a stochastic matrix we can then determine the overall probabily of arriving at states within a system.</p>
<p>Review the <a href="https://julia.quantecon.org/tools_and_techniques/finite_markov.html#equation-mpp">formal definition</a>.</p>
<h2 id="application-to-my-work">Application to My Work</h2>
<p>I will be using this model to determine the probability of a justice transitioning from emotional states.  The central thesis of my understanding of judicial behavior is that the justices develop attitudinal states towards issue areas, legal provisions, states, religions, objects in general.  I will compute those states by first determining them.  I will then calculate the bayesian probability of state transition across time.  Finally, those distribution will be inputted in Markov Chain models.</p>
<h2 id="markov-simulation-the-hard-way">Markov Simulation the Hard Way</h2>
<p>The work below is not my own.  I attribute it to <a href="https://julia.quantecon.org/tools_and_techniques/finite_markov.html#equation-mpp">julia.quantecon.org/</a>.</p>
<p>The alogorithm takes a stochastic probability matrix(square in this case) and create a random distribution according to those probabilities.</p>
<p>The simulation then randomly selects values from the random distibution.  That discrete value is stored in the output.  As I understand it currently, the output is the Markov Chain.</p>
<p>The comments in the code are mine.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-Julia" data-lang="Julia">
<span class="k">using</span> <span class="n">LinearAlgebra</span><span class="p">,</span> <span class="n">Statistics</span>
<span class="k">using</span> <span class="n">Distributions</span><span class="p">,</span> <span class="n">Plots</span><span class="p">,</span> <span class="n">Printf</span><span class="p">,</span> <span class="n">QuantEcon</span><span class="p">,</span> <span class="n">Random</span>

<span class="k">function</span> <span class="n">mc_sample_path</span><span class="p">(</span><span class="n">P</span><span class="p">;</span> <span class="n">init</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">sample_size</span> <span class="o">=</span> <span class="mi">1000</span><span class="p">)</span>


    <span class="nd">@assert</span> <span class="n">size</span><span class="p">(</span><span class="n">P</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="n">size</span><span class="p">(</span><span class="n">P</span><span class="p">)[</span><span class="mi">2</span><span class="p">]</span> <span class="c"># square required</span>
    <span class="n">N</span> <span class="o">=</span> <span class="n">size</span><span class="p">(</span><span class="n">P</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span> <span class="c"># should be square # well it&#39;s been asserted</span>

    <span class="c"># create vector of discrete RVs for each row</span>
    <span class="c"># In human terminology. Create a Categorical distribution of length = the size of the row of the matrix.  </span>
    <span class="c">#IF that makes sense</span>
    <span class="n">dists</span> <span class="o">=</span> <span class="p">[</span><span class="n">Categorical</span><span class="p">(</span><span class="n">P</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="o">:</span><span class="p">])</span> <span class="k">for</span> <span class="n">i</span> <span class="k">in</span> <span class="mi">1</span><span class="o">:</span><span class="n">N</span><span class="p">]</span>

    <span class="c"># setup the simulation</span>
    <span class="n">X</span> <span class="o">=</span> <span class="n">fill</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">sample_size</span><span class="p">)</span> <span class="c"># allocate memory, or zeros(Int64, sample_size) # I love Julia.  Readable syntax and low level contro</span>
    <span class="n">X</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">init</span> <span class="c"># set the initial state Equal to 1 in this case.  </span>

    <span class="k">for</span> <span class="n">t</span> <span class="k">in</span> <span class="mi">2</span><span class="o">:</span><span class="n">sample_size</span> <span class="c"># start at position 2.  Work from t-1# This is a common technique.  Couldn&#39;t figure this out once in a technical interview.  I wrote an if else for the zero condition.... Not so smart</span>
        <span class="n">dist</span> <span class="o">=</span> <span class="n">dists</span><span class="p">[</span><span class="n">X</span><span class="p">[</span><span class="n">t</span><span class="o">-</span><span class="mi">1</span><span class="p">]]</span> <span class="c"># get discrete RV from last state&#39;s transition distribution</span>
        <span class="n">X</span><span class="p">[</span><span class="n">t</span><span class="p">]</span> <span class="o">=</span> <span class="n">rand</span><span class="p">(</span><span class="n">dist</span><span class="p">)</span> <span class="c"># draw new value</span>
    <span class="k">end</span>
    <span class="k">return</span> <span class="n">X</span>
<span class="k">end</span>
</code></pre></div><h2 id="markov-simulation-the-easier-way">Markov Simulation the Easier Way</h2>
<p>Given a stochastic probability matrix, the Markov Chain function will produce a chain.</p>
<p>The simulate method will then simulate the chain across a n steps.</p>
<p>We can then take the mean of the output to determine the average amount of time spent in a state.  In this case the average amount of time spent in state 1 which should correlate to unemployment.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-Julia" data-lang="Julia"><span class="k">using</span> <span class="n">LinearAlgebra</span><span class="p">,</span> <span class="n">Statistics</span>
<span class="k">using</span> <span class="n">Distributions</span><span class="p">,</span> <span class="n">Plots</span><span class="p">,</span> <span class="n">Printf</span><span class="p">,</span> <span class="n">QuantEcon</span><span class="p">,</span> <span class="n">Random</span>


<span class="k">function</span> <span class="n">easy_way</span><span class="p">()</span>
    <span class="n">P</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.4</span> <span class="mf">0.6</span><span class="p">;</span> <span class="mf">0.2</span> <span class="mf">0.8</span><span class="p">];</span>
    <span class="n">mc</span> <span class="o">=</span> <span class="n">MarkovChain</span><span class="p">(</span><span class="n">P</span><span class="p">)</span>
    <span class="n">X</span> <span class="o">=</span> <span class="n">simulate</span><span class="p">(</span><span class="n">mc</span><span class="p">,</span> <span class="mi">100_000</span><span class="p">);</span>
    <span class="n">μ_2</span> <span class="o">=</span> <span class="n">count</span><span class="p">(</span><span class="n">X</span> <span class="o">.==</span> <span class="mi">1</span><span class="p">)</span><span class="o">/</span><span class="n">length</span><span class="p">(</span><span class="n">X</span><span class="p">)</span> <span class="c"># or mean(x -&gt; x == 1, X)</span>
<span class="k">end</span>

<span class="sb">```julia</span></code></pre></div>]]></content>
			<postid> 30dbb45f9db9508988799d727fecded2</postid>
			<author>Justin Napolitano</author>
			<author_name>Justin Napolitano</author_name>
			<author_email>personal.jnapolitano@gmail.com</author_email>
			<author_id>87654367b2fca109e7dc9d3ea8a1ebbaf0bfe374773b148c2c20d278479add99</author_id>			
		</item>
		
		<item>
			<title>Quantitative Julia Problems</title>
			<link>jnapolitano.com/posts/pi-with-julia/</link>
			<pubDate>Tue, 24 May 2022 01:30:32 +0000</pubDate>
			<guid>jnapolitano.com/posts/pi-with-julia/</guid>
			<description><![CDATA[Testing your Julia Configuration with some numerical computing.]]></description>
			<content type="html"><![CDATA[<h2 id="introduction">Introduction</h2>
<p>In my <a href="https://blog.jnapolitano.io/posts/rocky-linux-8-julia/">previous post</a>, I demonstrated how to configure Rocky Linux and RHEL distributions for quantitative analysis.</p>
<p>In this post, I include a few sample programs to test your installation.</p>
<h2 id="how-to-run-the-programs">How to run the programs</h2>
<p>I saved them to a folder within the project directory.</p>
<h3 id="activate-the-project">Activate the Project</h3>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-julia" data-lang="julia">
<span class="k">using</span> <span class="n">Pkg</span>
<span class="n">Pkg</span><span class="o">.</span><span class="n">activate</span><span class="p">(</span><span class="s">&#34;.&#34;</span><span class="p">)</span>

<span class="c">#cd(&#34;&lt;sub-directory-containing-files&gt;) optional</span>

</code></pre></div><h3 id="run-a-program">Run a program</h3>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-Julia" data-lang="Julia">
<span class="n">include</span><span class="p">(</span><span class="s">&#34;path/to/script-name.jl&#34;</span><span class="p">)</span>

</code></pre></div><h2 id="estimate-the-value-of-pi">Estimate the Value of Pi</h2>
<p>Use the Monte Carlo method to estimate the value of pi.</p>
<h3 id="solution">Solution</h3>
<p>We estimate the area by sampling bivariate uniforms and looking at the fraction that fall into the unit circle.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-Julia" data-lang="Julia">
<span class="c"># Number of iterations</span>
<span class="n">n</span> <span class="o">=</span> <span class="mi">1000000</span>
<span class="c">#counter variable</span>
<span class="n">count</span> <span class="o">=</span> <span class="mi">0</span>
<span class="k">for</span> <span class="n">i</span> <span class="k">in</span> <span class="mi">1</span><span class="o">:</span><span class="n">n</span> <span class="c"># for i in the range of 1 to n</span>
    
    <span class="k">global</span> <span class="n">count</span>  <span class="c"># make count global to reference within the loop.  Otherwise the the variable will be understood to be a local within the for loop</span>
    <span class="c">#rand(2) Returns a two element vector.  </span>
    <span class="c">#Can be read as let u be equal to the first index of the vector and let v be equal to the second</span>
    <span class="n">u</span><span class="p">,</span> <span class="n">v</span> <span class="o">=</span> <span class="n">rand</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
    
    <span class="n">d</span> <span class="o">=</span> <span class="n">sqrt</span><span class="p">((</span><span class="n">u</span> <span class="o">-</span> <span class="mf">0.5</span><span class="p">)</span><span class="o">^</span><span class="mi">2</span> <span class="o">+</span> <span class="p">(</span><span class="n">v</span> <span class="o">-</span> <span class="mf">0.5</span><span class="p">)</span><span class="o">^</span><span class="mi">2</span><span class="p">)</span>  <span class="c"># distance from middle of square</span>
    <span class="k">if</span> <span class="n">d</span> <span class="o">&lt;</span> <span class="mf">0.5</span>
        <span class="n">count</span> <span class="o">+=</span> <span class="mi">1</span>
    <span class="k">end</span>
<span class="k">end</span>

<span class="n">area_estimate</span> <span class="o">=</span> <span class="n">count</span> <span class="o">/</span> <span class="n">n</span>

<span class="n">print</span><span class="p">(</span><span class="n">area_estimate</span> <span class="o">*</span> <span class="mi">4</span><span class="p">)</span>  <span class="c"># dividing by radius**2</span>

</code></pre></div><h2 id="use-quadgk-to-aproximate-an-integral">Use QuadGk to Aproximate an integral</h2>
<p>The trapezoidal rule can be used to aproximate an integral.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-Julia" data-lang="Julia">
<span class="k">using</span> <span class="n">QuadGK</span>

<span class="n">f</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">=</span> <span class="n">x</span><span class="o">^</span><span class="mi">8</span> <span class="c"># The Function</span>

<span class="n">value</span><span class="p">,</span> <span class="n">accuracy</span> <span class="o">=</span> <span class="n">quadgk</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">)</span> <span class="c"># pass the function, the lower bound and the upper bound</span>

</code></pre></div>]]></content>
			<postid> 6b4d2501f3e215b4ddec60d24e0a9057</postid>
			<author>Justin Napolitano</author>
			<author_name>Justin Napolitano</author_name>
			<author_email>personal.jnapolitano@gmail.com</author_email>
			<author_id>87654367b2fca109e7dc9d3ea8a1ebbaf0bfe374773b148c2c20d278479add99</author_id>			
		</item>
		
		<item>
			<title>Configuring Rocky Linux 8 for Quantitative Analysis in Julia</title>
			<link>jnapolitano.com/posts/rocky-linux-8-julia/</link>
			<pubDate>Tue, 24 May 2022 00:30:32 +0000</pubDate>
			<guid>jnapolitano.com/posts/rocky-linux-8-julia/</guid>
			<description><![CDATA[Configure Rocky Linux 8 for Julia development and quantitative analysis.]]></description>
			<content type="html"><![CDATA[<h2 id="install-jupyter">Install Jupyter</h2>
<p>Start with installing jupyter.  It will serve as our server for development.</p>
<h3 id="install-dependencies">Install Dependencies</h3>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash">sudo dnf install gcc python3-devel kernel-headers-<span class="k">$(</span>uname -r<span class="k">)</span>
</code></pre></div><h3 id="install-jupyter-via-pip">Install Jupyter Via Pip</h3>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash">pip3 install --user jupyter
</code></pre></div><h2 id="install-julia">Install Julia</h2>
<p>We will be installing from the official binaries.</p>
<p>Make a directory in user profile.  i simply ran <code>mkdir julia</code> in the <code>home</code> folder.  The <code>cd</code> to <code>julia</code>.</p>
<p>When in the folder run</p>
<h3 id="wget">Wget</h3>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash">wget https://julialang-s3.julialang.org/bin/linux/x64/1.7/julia-1.7.2-linux-x86_64.tar.gz

</code></pre></div><h3 id="unpack">Unpack</h3>
<p>Then unpack</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash">tar zxvf julia-1.7.2-linux-x86_64.tar.gz
</code></pre></div><h3 id="add-to-path">Add to Path</h3>
<p>In my case I added the following to my shell profile.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash">
<span class="nb">export</span> <span class="nv">PATH</span><span class="o">=</span><span class="s2">&#34;</span><span class="nv">$PATH</span><span class="s2">:/home/jnapolitano/julia/julia-1.7.2/bin/&#34;</span>

</code></pre></div><h2 id="downloading-the-quantecon-project">Downloading the QuantEcon Project</h2>
<p>I will be working through the QuantEcon textbook provided at <a href="https://julia.quantecon.org/">https://julia.quantecon.org/</a>.</p>
<h3 id="clone-the-repository">Clone the repository</h3>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash">
git clone https://github.com/quantecon/lecture-julia.notebooks

</code></pre></div><h2 id="activate-the-project">Activate the Project.</h2>
<p>Run a julia repl by typing <code>julia</code> into your terminal&hellip; if you added it to the path.  Otherwise navigate to the bin and activate julia.</p>
<h3 id="install-the-dependencies">Install the Dependencies</h3>
<p>Next run the following commands from the Julia REPL.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-julia" data-lang="julia">
<span class="k">using</span> <span class="n">Pkg</span>

<span class="n">Pkg</span><span class="o">.</span><span class="n">activate</span><span class="p">(</span><span class="s">&#34;.&#34;</span><span class="p">)</span>

<span class="n">Pkg</span><span class="o">.</span><span class="n">instantiate</span><span class="p">()</span>

<span class="sb">```
</span><span class="sb">
</span><span class="sb">IT will take some time to download and extract all of the packages give it time.  
</span><span class="sb">
</span><span class="sb">
</span></code></pre></div>]]></content>
			<postid> 8e234204207845c3c43e75b983a9cb01</postid>
			<author>Justin Napolitano</author>
			<author_name>Justin Napolitano</author_name>
			<author_email>personal.jnapolitano@gmail.com</author_email>
			<author_id>87654367b2fca109e7dc9d3ea8a1ebbaf0bfe374773b148c2c20d278479add99</author_id>			
		</item>
		
		<item>
			<title>Rice Paddy Methane Emissions Estimation: Part 2</title>
			<link>jnapolitano.com/posts/rice-paddy-emissions-2/</link>
			<pubDate>Mon, 23 May 2022 19:30:32 +0000</pubDate>
			<guid>jnapolitano.com/posts/rice-paddy-emissions-2/</guid>
			<description><![CDATA[Comparing 5 years of methane emissions to determine if Climate Trace forecasts greater emissions than UN FAOSTAT.]]></description>
			<content type="html"><![CDATA[<h1 id="methane-emissions-estimation-data-part-2-a-comparison-between-faostat-and-university-of-malaysia-estimates">Methane Emissions Estimation Data Part 2: A Comparison between FAOSTAT and University of Malaysia Estimates</h1>
<p>This post documents the data exploration phase of a project that determines whether global methane emissions produced by rice paddies are undercounted.</p>
<p>It is fairly code python and pandas heavy.</p>
<p>The code and data exploration follows the summary below.</p>
<h2 id="hypothesis-testing-the-university-of-malaysia-paper">Hypothesis Testing the University of Malaysia Paper</h2>
<h2 id="claims">Claims</h2>
<ul>
<li>That the distributions do not differ between 2020 and 2019</li>
<li>That the means do no differ between 2020 and 2019</li>
</ul>
<h2 id="what-will-be-tested">What will be Tested.</h2>
<ul>
<li>Shapiro-Wilk Test</li>
<li>Mann-Whitney U Test</li>
<li>Kruskal Wallis</li>
<li>Friedman</li>
</ul>
<h2 id="analysis">Analysis</h2>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">scipy.stats</span> <span class="k">as</span> <span class="nn">stats</span>

</code></pre></div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="n">filepath</span> <span class="o">=</span> <span class="s2">&#34;/Users/jnapolitano/Projects/wattime-takehome/wattime-takehome/data/ch4_2015-2021.xlsx&#34;</span>

<span class="n">hypothesis_testing_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_excel</span><span class="p">(</span><span class="n">filepath</span><span class="p">)</span>
</code></pre></div><h3 id="drop-total-row-from-the-data">Drop total row from the data</h3>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="n">hypothesis_testing_df</span> <span class="o">=</span> <span class="n">hypothesis_testing_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[(</span><span class="n">hypothesis_testing_df</span><span class="p">[</span><span class="s1">&#39;country_name&#39;</span><span class="p">]</span> <span class="o">!=</span> <span class="s2">&#34;Total&#34;</span><span class="p">)]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span> <span class="c1">#copying to avoid modifying slices in memory.  Old df should also drop from memory in production environment.</span>
</code></pre></div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="n">hypothesis_testing_df</span>
</code></pre></div><!-- raw HTML omitted -->
<pre><code>.dataframe tbody tr th {
    vertical-align: top;
}

.dataframe thead th {
    text-align: right;
}
</code></pre>
<p><!-- raw HTML omitted --></p>
<!-- raw HTML omitted -->
<h3 id="test-for-normality-shapiro-wilk">Test for Normality: Shapiro-Wilk</h3>
<h4 id="2019">2019</h4>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="c1">## Selecting Malaysia 2019 Data </span>
<span class="n">data_2019</span> <span class="o">=</span> <span class="n">hypothesis_testing_df</span><span class="p">[</span><span class="s1">&#39;tCH4_2019&#39;</span><span class="p">]</span>
<span class="n">data_2019</span>
</code></pre></div><pre><code>0     2.070985e+06
1     3.294713e+05
2     5.603352e+06
3     1.148324e+04
4     1.266668e+06
5     7.501556e+06
6     9.500199e+04
7     4.566914e+04
8     2.332056e+05
9     5.947277e+05
10    1.327782e+05
11    1.461058e+04
12    8.476088e+04
13    1.256888e+06
14    1.056287e+05
15    1.164235e+05
16    6.528548e+05
17    3.584550e+05
18    9.655062e+04
19    1.305046e+06
20    8.990870e+04
21    1.691351e+05
22    1.269751e+06
Name: tCH4_2019, dtype: float64
</code></pre>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="n">results</span> <span class="o">=</span> <span class="n">stats</span><span class="o">.</span><span class="n">shapiro</span><span class="p">(</span><span class="n">data_2019</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;stat=</span><span class="si">%.3f</span><span class="s1">, p=</span><span class="si">%.3f</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">results</span><span class="o">.</span><span class="n">statistic</span><span class="p">,</span> <span class="n">results</span><span class="o">.</span><span class="n">pvalue</span><span class="p">))</span>
<span class="k">if</span> <span class="n">results</span><span class="o">.</span><span class="n">pvalue</span> <span class="o">&gt;</span> <span class="mf">0.05</span><span class="p">:</span>
	<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Probably Gaussian&#39;</span><span class="p">)</span>
<span class="k">else</span><span class="p">:</span>
	<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Probably not Gaussian&#39;</span><span class="p">)</span>
</code></pre></div><pre><code>stat=0.567, p=0.000
Probably not Gaussian
</code></pre>
<h5 id="results">Results</h5>
<p>The distribution is not gausian so a non-paremtric test must be completed.  It is not necessary to perform this test on the 2020 data, but I will do so anyways for practice.</p>
<h4 id="2020">2020</h4>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="c1">## Selecting the Malaysia Data 2020</span>
<span class="n">data_2020</span> <span class="o">=</span> <span class="n">hypothesis_testing_df</span><span class="p">[</span><span class="s1">&#39;tCH4_2020&#39;</span><span class="p">]</span>
</code></pre></div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="n">results</span> <span class="o">=</span> <span class="n">stats</span><span class="o">.</span><span class="n">shapiro</span><span class="p">(</span><span class="n">data_2020</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;stat=</span><span class="si">%.3f</span><span class="s1">, p=</span><span class="si">%.3f</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">results</span><span class="o">.</span><span class="n">statistic</span><span class="p">,</span> <span class="n">results</span><span class="o">.</span><span class="n">pvalue</span><span class="p">))</span>
<span class="k">if</span> <span class="n">results</span><span class="o">.</span><span class="n">pvalue</span> <span class="o">&gt;</span> <span class="mf">0.05</span><span class="p">:</span>
	<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Probably Gaussian&#39;</span><span class="p">)</span>
<span class="k">else</span><span class="p">:</span>
	<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Probably not Gaussian&#39;</span><span class="p">)</span>
</code></pre></div><pre><code>stat=0.565, p=0.000
Probably not Gaussian
</code></pre>
<h5 id="results-1">Results</h5>
<p>The 2020 data is not gausian which verifies that we will need to perform a non parmetric test</p>
<h3 id="independence-of-samples">Independence of Samples.</h3>
<p>We have to assume that the samples are independent of each other as we know they are dependent on hecatares.<br>
Though the correlations are rather high this is due to the smiliarity of hectares per year.  Thus the amount of ch4 is similiar</p>
<h3 id="distribution-similiarity">Distribution Similiarity</h3>
<h4 id="mann-whitney-u-test">Mann-Whitney U Test</h4>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="c1"># Example of the Mann-Whitney U Test</span>

<span class="n">stat</span><span class="p">,</span> <span class="n">p</span> <span class="o">=</span> <span class="n">stats</span><span class="o">.</span><span class="n">mannwhitneyu</span><span class="p">(</span><span class="n">data_2019</span><span class="p">,</span> <span class="n">data_2020</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;stat=</span><span class="si">%.3f</span><span class="s1">, p=</span><span class="si">%.3f</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">stat</span><span class="p">,</span> <span class="n">p</span><span class="p">))</span>
<span class="k">if</span> <span class="n">p</span> <span class="o">&gt;</span> <span class="mf">0.05</span><span class="p">:</span>
	<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Probably the same distribution&#39;</span><span class="p">)</span>
<span class="k">else</span><span class="p">:</span>
	<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Probably different distributions&#39;</span><span class="p">)</span>
</code></pre></div><pre><code>stat=266.000, p=0.982
Probably the same distribution
</code></pre>
<h3 id="kruskal-wallis-test">Kruskal Wallis test</h3>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python">
<span class="n">stat</span><span class="p">,</span> <span class="n">p</span> <span class="o">=</span> <span class="n">stats</span><span class="o">.</span><span class="n">kruskal</span><span class="p">(</span><span class="n">data_2019</span><span class="p">,</span> <span class="n">data_2020</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;stat=</span><span class="si">%.3f</span><span class="s1">, p=</span><span class="si">%.3f</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">stat</span><span class="p">,</span> <span class="n">p</span><span class="p">))</span>
<span class="k">if</span> <span class="n">p</span> <span class="o">&gt;</span> <span class="mf">0.05</span><span class="p">:</span>
	<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Probably the same distribution&#39;</span><span class="p">)</span>
<span class="k">else</span><span class="p">:</span>
	<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Probably different distributions&#39;</span><span class="p">)</span>
</code></pre></div><pre><code>stat=0.001, p=0.974
Probably the same distribution
</code></pre>
<h3 id="friedman-test">Friedman Test</h3>
<p>Just for the sake of it I will compare data across all distributions</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="c1"># Example of the Friedman Test</span>
<span class="c1">#data_2014 = hypothesis_testing_df[&#39;tCH4_2014&#39;]</span>
<span class="n">data_2015</span> <span class="o">=</span> <span class="n">hypothesis_testing_df</span><span class="p">[</span><span class="s1">&#39;tCH4_2015&#39;</span><span class="p">]</span>
<span class="n">data_2016</span> <span class="o">=</span> <span class="n">hypothesis_testing_df</span><span class="p">[</span><span class="s1">&#39;tCH4_2016&#39;</span><span class="p">]</span>
<span class="n">data_2017</span> <span class="o">=</span> <span class="n">hypothesis_testing_df</span><span class="p">[</span><span class="s1">&#39;tCH4_2017&#39;</span><span class="p">]</span>
<span class="n">data_2018</span> <span class="o">=</span> <span class="n">hypothesis_testing_df</span><span class="p">[</span><span class="s1">&#39;tCH4_2018&#39;</span><span class="p">]</span>

<span class="n">stat</span><span class="p">,</span> <span class="n">p</span> <span class="o">=</span> <span class="n">stats</span><span class="o">.</span><span class="n">friedmanchisquare</span><span class="p">(</span><span class="n">data_2015</span><span class="p">,</span> <span class="n">data_2016</span><span class="p">,</span> <span class="n">data_2017</span><span class="p">,</span> <span class="n">data_2018</span><span class="p">,</span> <span class="n">data_2019</span><span class="p">,</span> <span class="n">data_2020</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;stat=</span><span class="si">%.3f</span><span class="s1">, p=</span><span class="si">%.3f</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">stat</span><span class="p">,</span> <span class="n">p</span><span class="p">))</span>
<span class="k">if</span> <span class="n">p</span> <span class="o">&gt;</span> <span class="mf">0.05</span><span class="p">:</span>
	<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Probably the same distribution&#39;</span><span class="p">)</span>
<span class="k">else</span><span class="p">:</span>
	<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Probably different distributions&#39;</span><span class="p">)</span>
</code></pre></div><pre><code>stat=11.472, p=0.043
Probably different distributions
</code></pre>
<h4 id="results-2">Results.</h4>
<p>Some distributions differ from one another.  Which those are have yet to be discovered.  For the sake of this analysis I will not attempt to identify them.</p>
<p>The statment that the distributions of the 2019 and 2020 data do not differ cannot differ.  That said we also cannot claim that the means are statistically equivalent as the data is not parametric.</p>
]]></content>
			<postid> 322d693892ecb0bfc2023d0a9099d0f5</postid>
			<author>Justin Napolitano</author>
			<author_name>Justin Napolitano</author_name>
			<author_email>personal.jnapolitano@gmail.com</author_email>
			<author_id>87654367b2fca109e7dc9d3ea8a1ebbaf0bfe374773b148c2c20d278479add99</author_id>			
		</item>
		
		<item>
			<title>Conduct Legal Research with AI Part 8: Case Nodes Sample Data</title>
			<link>jnapolitano.com/posts/legal-research-part-8/</link>
			<pubDate>Mon, 23 May 2022 16:30:32 +0000</pubDate>
			<guid>jnapolitano.com/posts/legal-research-part-8/</guid>
			<description><![CDATA[Merging Oyez and Library of Congress Data into a Comprehensive Data Set]]></description>
			<content type="html"><![CDATA[<h2 id="introduction">Introduction</h2>
<p>The legal Research with AI Series is expanding quickly. This is the 9th post related to it in someway.  Building this pipeline and integrating multiple datasets into nodes is proving to be verbose.</p>
<p>This post documents merging Oyez and Library of Congress of data structured json files that represent nodes and hierarchal relationships.</p>
<h2 id="main-function">Main Function</h2>
<p>The plan for this program is to:</p>
<ul>
<li>Read the prepared dataframe created in the <a href="https://blog.jnapolitano.io/posts/legal-research-part-7/">legal research part 7 post</a></li>
<li>for each row of the df load a dictionary from the the libary of congress path and the oyez path</li>
<li>Set keys on the Oyez dataset</li>
<li>Write the updated Oyez dataset to file</li>
</ul>
<p>Review the work below:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-Python" data-lang="Python"><span class="k">def</span> <span class="nf">main</span><span class="p">():</span>

    <span class="c1"># outpath fo the current file</span>
    <span class="n">inpath</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">sep</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">(),</span><span class="s2">&#34;case_files.csv&#34;</span><span class="p">])</span>
    <span class="n">outpath</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">sep</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">(),</span><span class="s2">&#34;nodes&#34;</span><span class="p">])</span>
    
    <span class="c1">#Create a df from the case_files.csv file</span>
    <span class="n">master_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">inpath</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">master_df</span><span class="o">.</span><span class="n">iterrows</span><span class="p">():</span>
            
        <span class="n">oyez_dict</span> <span class="o">=</span> <span class="n">read_json</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="s2">&#34;Path&#34;</span><span class="p">])</span>
        <span class="n">loc_dict</span> <span class="o">=</span> <span class="n">read_json</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="s1">&#39;Path_1&#39;</span><span class="p">])</span>
        <span class="n">oyez_dict</span><span class="p">[</span><span class="s1">&#39;loc_id&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">loc_dict</span><span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">]</span>
        <span class="n">oyez_dict</span><span class="p">[</span><span class="s1">&#39;loc_url&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">loc_dict</span><span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">]</span>
        <span class="n">oyez_dict</span><span class="p">[</span><span class="s1">&#39;simple_citation&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">loc_dict</span><span class="p">[</span><span class="s1">&#39;loc_id&#39;</span><span class="p">]</span>
        <span class="n">oyez_dict</span><span class="p">[</span><span class="s1">&#39;shelf_id&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">loc_dict</span><span class="p">[</span><span class="s1">&#39;shelf_id&#39;</span><span class="p">]</span>
        <span class="n">oyez_dict</span><span class="p">[</span><span class="s1">&#39;title&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">loc_dict</span><span class="p">[</span><span class="s1">&#39;title&#39;</span><span class="p">]</span>
        <span class="n">oyez_dict</span><span class="p">[</span><span class="s1">&#39;issues&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">nodify_list</span><span class="p">(</span><span class="n">loc_dict</span><span class="p">[</span><span class="s1">&#39;subject&#39;</span><span class="p">],</span><span class="s1">&#39;issue&#39;</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">oyez_dict</span><span class="p">[</span><span class="s1">&#39;major_topics&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">nodify_list</span><span class="p">(</span><span class="n">loc_dict</span><span class="p">[</span><span class="s1">&#39;subject_major_case_topic&#39;</span><span class="p">],</span> <span class="s1">&#39;major_topic&#39;</span><span class="p">)</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="n">oyez_dict</span><span class="p">[</span><span class="s1">&#39;major_topics&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&#34;&#34;</span><span class="p">]</span>
        <span class="n">oyez_dict</span><span class="p">[</span><span class="s1">&#39;loc_pdf&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">loc_dict</span><span class="p">[</span><span class="s1">&#39;resources&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;pdf&#39;</span><span class="p">]</span>

        <span class="n">outfile</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">sep</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">outpath</span><span class="p">,</span><span class="n">oyez_dict</span><span class="p">[</span><span class="s1">&#39;simple_citation&#39;</span><span class="p">]])</span>
        <span class="n">outfile</span> <span class="o">=</span> <span class="n">outfile</span> <span class="o">+</span> <span class="s2">&#34;.json&#34;</span>

        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">outfile</span><span class="p">,</span> <span class="s2">&#34;w&#34;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span> 
            <span class="n">json</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">outpath</span><span class="p">,</span><span class="n">f</span><span class="p">)</span>
</code></pre></div><h2 id="helper-functions">Helper Functions</h2>
<h3 id="read-json">Read Json</h3>
<p>read_json simply reads json into a dictionary with the json.loads method with a context manager.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-Python" data-lang="Python">
<span class="k">def</span> <span class="nf">read_json</span><span class="p">(</span><span class="n">file_path</span><span class="p">):</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">file_path</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span> 
        <span class="nb">dict</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
    <span class="k">return</span> <span class="nb">dict</span>

</code></pre></div><h3 id="nodify-list">Nodify List</h3>
<p>Some of the data in the Loc dataset is stored in lists.  I want them to be individual nodes in the final dataset.  To account for this, the nodify_list function returns a list of dictionaries containing keys that will be used to construct graph nodes.   I will most likely need to modify these as the graph schema expands with more data.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-Python" data-lang="Python">
    
<span class="k">def</span> <span class="nf">nodify_list</span><span class="p">(</span><span class="n">lst</span><span class="p">,</span><span class="n">node_name</span><span class="p">):</span>
    <span class="n">return_list</span><span class="o">=</span><span class="p">[]</span>
    <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">lst</span><span class="p">:</span> 
        <span class="nb">dict</span> <span class="o">=</span> <span class="p">{</span><span class="n">node_name</span><span class="p">:</span> <span class="n">item</span><span class="p">}</span>
        <span class="n">return_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">dict</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">return_list</span>
</code></pre></div><h2 id="the-complete-program">The Complete Program</h2>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python">
<span class="c1">#merging.python</span>
<span class="kn">from</span> <span class="nn">doctest</span> <span class="kn">import</span> <span class="n">master</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">from</span> <span class="nn">pprint</span> <span class="kn">import</span> <span class="n">pprint</span>
<span class="kn">import</span> <span class="nn">json</span>

<span class="k">def</span> <span class="nf">read_json</span><span class="p">(</span><span class="n">file_path</span><span class="p">):</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">file_path</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span> 
        <span class="nb">dict</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
    <span class="k">return</span> <span class="nb">dict</span>

    
<span class="k">def</span> <span class="nf">nodify_list</span><span class="p">(</span><span class="n">lst</span><span class="p">,</span><span class="n">node_name</span><span class="p">):</span>
    <span class="n">return_list</span><span class="o">=</span><span class="p">[]</span>
    <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">lst</span><span class="p">:</span> 
        <span class="nb">dict</span> <span class="o">=</span> <span class="p">{</span><span class="n">node_name</span><span class="p">:</span> <span class="n">item</span><span class="p">}</span>
        <span class="n">return_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">dict</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">return_list</span>

<span class="k">def</span> <span class="nf">main</span><span class="p">():</span>

    <span class="c1"># outpath fo the current file</span>
    <span class="n">inpath</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">sep</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">(),</span><span class="s2">&#34;case_files.csv&#34;</span><span class="p">])</span>
    <span class="n">outpath</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">sep</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">(),</span><span class="s2">&#34;nodes&#34;</span><span class="p">])</span>
    
    <span class="c1">#Create a df from the case_files.csv file</span>
    <span class="n">master_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">inpath</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">master_df</span><span class="o">.</span><span class="n">iterrows</span><span class="p">():</span>
            
        <span class="n">oyez_dict</span> <span class="o">=</span> <span class="n">read_json</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="s2">&#34;Path&#34;</span><span class="p">])</span>
        <span class="n">loc_dict</span> <span class="o">=</span> <span class="n">read_json</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="s1">&#39;Path_1&#39;</span><span class="p">])</span>
        <span class="n">oyez_dict</span><span class="p">[</span><span class="s1">&#39;loc_id&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">loc_dict</span><span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">]</span>
        <span class="n">oyez_dict</span><span class="p">[</span><span class="s1">&#39;loc_url&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">loc_dict</span><span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">]</span>
        <span class="n">oyez_dict</span><span class="p">[</span><span class="s1">&#39;simple_citation&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">loc_dict</span><span class="p">[</span><span class="s1">&#39;loc_id&#39;</span><span class="p">]</span>
        <span class="n">oyez_dict</span><span class="p">[</span><span class="s1">&#39;shelf_id&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">loc_dict</span><span class="p">[</span><span class="s1">&#39;shelf_id&#39;</span><span class="p">]</span>
        <span class="n">oyez_dict</span><span class="p">[</span><span class="s1">&#39;title&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">loc_dict</span><span class="p">[</span><span class="s1">&#39;title&#39;</span><span class="p">]</span>
        <span class="n">oyez_dict</span><span class="p">[</span><span class="s1">&#39;issues&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">nodify_list</span><span class="p">(</span><span class="n">loc_dict</span><span class="p">[</span><span class="s1">&#39;subject&#39;</span><span class="p">],</span><span class="s1">&#39;issue&#39;</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">oyez_dict</span><span class="p">[</span><span class="s1">&#39;major_topics&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">nodify_list</span><span class="p">(</span><span class="n">loc_dict</span><span class="p">[</span><span class="s1">&#39;subject_major_case_topic&#39;</span><span class="p">],</span> <span class="s1">&#39;major_topic&#39;</span><span class="p">)</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="n">oyez_dict</span><span class="p">[</span><span class="s1">&#39;major_topics&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&#34;&#34;</span><span class="p">]</span>
        <span class="n">oyez_dict</span><span class="p">[</span><span class="s1">&#39;loc_pdf&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">loc_dict</span><span class="p">[</span><span class="s1">&#39;resources&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;pdf&#39;</span><span class="p">]</span>

        <span class="n">outfile</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">sep</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">outpath</span><span class="p">,</span><span class="n">oyez_dict</span><span class="p">[</span><span class="s1">&#39;simple_citation&#39;</span><span class="p">]])</span>
        <span class="n">outfile</span> <span class="o">=</span> <span class="n">outfile</span> <span class="o">+</span> <span class="s2">&#34;.json&#34;</span>

        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">outfile</span><span class="p">,</span> <span class="s2">&#34;w&#34;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span> 
            <span class="n">json</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">oyez_dict</span><span class="p">,</span><span class="n">f</span><span class="p">,</span> <span class="n">indent</span> <span class="o">=</span> <span class="mi">6</span><span class="p">)</span>
        


    <span class="c1">#pprint(oyez_dict)</span>
<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&#34;__main__&#34;</span><span class="p">:</span>
    <span class="n">main</span><span class="p">()</span>
</code></pre></div><h2 id="sample-json-output">Sample Json Output</h2>
<p>Below is a sample of what the program outputs.  It is a single case.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-json" data-lang="json"><span class="p">{</span>
      <span class="nt">&#34;decisions&#34;</span><span class="p">:</span> <span class="p">[</span>
            <span class="p">{</span>
                  <span class="nt">&#34;href&#34;</span><span class="p">:</span> <span class="s2">&#34;https://api.oyez.org/case_decision/case_decision/16396&#34;</span><span class="p">,</span>
                  <span class="nt">&#34;votes&#34;</span><span class="p">:</span> <span class="p">[</span>
                        <span class="p">{</span>
                              <span class="nt">&#34;ideology&#34;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
                              <span class="nt">&#34;seniority&#34;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
                              <span class="nt">&#34;opinion_type&#34;</span><span class="p">:</span> <span class="s2">&#34;majority&#34;</span><span class="p">,</span>
                              <span class="nt">&#34;member&#34;</span><span class="p">:</span> <span class="p">{</span>
                                    <span class="nt">&#34;href&#34;</span><span class="p">:</span> <span class="s2">&#34;https://api.oyez.org/people/john_marshall&#34;</span><span class="p">,</span>
                                    <span class="nt">&#34;ID&#34;</span><span class="p">:</span> <span class="mi">15085</span><span class="p">,</span>
                                    <span class="nt">&#34;last_name&#34;</span><span class="p">:</span> <span class="s2">&#34;Marshall&#34;</span><span class="p">,</span>
                                    <span class="nt">&#34;thumbnail&#34;</span><span class="p">:</span> <span class="p">{</span>
                                          <span class="nt">&#34;size&#34;</span><span class="p">:</span> <span class="mi">53035</span><span class="p">,</span>
                                          <span class="nt">&#34;href&#34;</span><span class="p">:</span> <span class="s2">&#34;https://api.oyez.org/sites/default/files/images/people/john_marshall/john_marshall.thumb.png&#34;</span><span class="p">,</span>
                                          <span class="nt">&#34;id&#34;</span><span class="p">:</span> <span class="mi">32729</span><span class="p">,</span>
                                          <span class="nt">&#34;mime&#34;</span><span class="p">:</span> <span class="s2">&#34;image/png&#34;</span>
                                    <span class="p">},</span>
                                    <span class="nt">&#34;length_of_service&#34;</span><span class="p">:</span> <span class="mi">12570</span><span class="p">,</span>
                                    <span class="nt">&#34;view_count&#34;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
                                    <span class="nt">&#34;identifier&#34;</span><span class="p">:</span> <span class="s2">&#34;john_marshall&#34;</span><span class="p">,</span>
                                    <span class="nt">&#34;roles&#34;</span><span class="p">:</span> <span class="p">[</span>
                                          <span class="p">{</span>
                                                <span class="nt">&#34;appointing_president&#34;</span><span class="p">:</span> <span class="s2">&#34;John Adams&#34;</span><span class="p">,</span>
                                                <span class="nt">&#34;href&#34;</span><span class="p">:</span> <span class="s2">&#34;https://api.oyez.org/preson_role/scotus_justice/2729&#34;</span><span class="p">,</span>
                                                <span class="nt">&#34;role_title&#34;</span><span class="p">:</span> <span class="s2">&#34;Chief Justice of the United States&#34;</span><span class="p">,</span>
                                                <span class="nt">&#34;type&#34;</span><span class="p">:</span> <span class="s2">&#34;scotus_justice&#34;</span><span class="p">,</span>
                                                <span class="nt">&#34;date_end&#34;</span><span class="p">:</span> <span class="mi">-4244119200</span><span class="p">,</span>
                                                <span class="nt">&#34;id&#34;</span><span class="p">:</span> <span class="mi">2729</span><span class="p">,</span>
                                                <span class="nt">&#34;date_start&#34;</span><span class="p">:</span> <span class="mi">-5330167200</span><span class="p">,</span>
                                                <span class="nt">&#34;institution_name&#34;</span><span class="p">:</span> <span class="s2">&#34;Supreme Court of the United States&#34;</span>
                                          <span class="p">}</span>
                                    <span class="p">],</span>
                                    <span class="nt">&#34;name&#34;</span><span class="p">:</span> <span class="s2">&#34;John Marshall&#34;</span>
                              <span class="p">},</span>
                              <span class="nt">&#34;href&#34;</span><span class="p">:</span> <span class="s2">&#34;https://api.oyez.org/decision_vote/decision_vote/205605&#34;</span><span class="p">,</span>
                              <span class="nt">&#34;vote&#34;</span><span class="p">:</span> <span class="s2">&#34;majority&#34;</span><span class="p">,</span>
                              <span class="nt">&#34;joining&#34;</span><span class="p">:</span> <span class="kc">null</span>
                        <span class="p">},</span>
                        <span class="p">{</span>
                              <span class="nt">&#34;ideology&#34;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
                              <span class="nt">&#34;seniority&#34;</span><span class="p">:</span> <span class="mi">4</span><span class="p">,</span>
                              <span class="nt">&#34;opinion_type&#34;</span><span class="p">:</span> <span class="s2">&#34;none&#34;</span><span class="p">,</span>
                              <span class="nt">&#34;member&#34;</span><span class="p">:</span> <span class="p">{</span>
                                    <span class="nt">&#34;href&#34;</span><span class="p">:</span> <span class="s2">&#34;https://api.oyez.org/people/bushrod_washington&#34;</span><span class="p">,</span>
                                    <span class="nt">&#34;ID&#34;</span><span class="p">:</span> <span class="mi">15093</span><span class="p">,</span>
                                    <span class="nt">&#34;last_name&#34;</span><span class="p">:</span> <span class="s2">&#34;Washington&#34;</span><span class="p">,</span>
                                    <span class="nt">&#34;thumbnail&#34;</span><span class="p">:</span> <span class="p">{</span>
                                          <span class="nt">&#34;size&#34;</span><span class="p">:</span> <span class="mi">42759</span><span class="p">,</span>
                                          <span class="nt">&#34;href&#34;</span><span class="p">:</span> <span class="s2">&#34;https://api.oyez.org/sites/default/files/images/people/bushrod_washington/bushrod_washington.thumb.png&#34;</span><span class="p">,</span>
                                          <span class="nt">&#34;id&#34;</span><span class="p">:</span> <span class="mi">32698</span><span class="p">,</span>
                                          <span class="nt">&#34;mime&#34;</span><span class="p">:</span> <span class="s2">&#34;image/png&#34;</span>
                                    <span class="p">},</span>
                                    <span class="nt">&#34;length_of_service&#34;</span><span class="p">:</span> <span class="mi">11339</span><span class="p">,</span>
                                    <span class="nt">&#34;view_count&#34;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
                                    <span class="nt">&#34;identifier&#34;</span><span class="p">:</span> <span class="s2">&#34;bushrod_washington&#34;</span><span class="p">,</span>
                                    <span class="nt">&#34;roles&#34;</span><span class="p">:</span> <span class="p">[</span>
                                          <span class="p">{</span>
                                                <span class="nt">&#34;appointing_president&#34;</span><span class="p">:</span> <span class="s2">&#34;John Adams&#34;</span><span class="p">,</span>
                                                <span class="nt">&#34;href&#34;</span><span class="p">:</span> <span class="s2">&#34;https://api.oyez.org/preson_role/scotus_justice/2737&#34;</span><span class="p">,</span>
                                                <span class="nt">&#34;role_title&#34;</span><span class="p">:</span> <span class="s2">&#34;Associate Justice of the Supreme Court of the United States&#34;</span><span class="p">,</span>
                                                <span class="nt">&#34;type&#34;</span><span class="p">:</span> <span class="s2">&#34;scotus_justice&#34;</span><span class="p">,</span>
                                                <span class="nt">&#34;date_end&#34;</span><span class="p">:</span> <span class="mi">-4421066400</span><span class="p">,</span>
                                                <span class="nt">&#34;id&#34;</span><span class="p">:</span> <span class="mi">2737</span><span class="p">,</span>
                                                <span class="nt">&#34;date_start&#34;</span><span class="p">:</span> <span class="mi">-5400756000</span><span class="p">,</span>
                                                <span class="nt">&#34;institution_name&#34;</span><span class="p">:</span> <span class="s2">&#34;Supreme Court of the United States&#34;</span>
                                          <span class="p">}</span>
                                    <span class="p">],</span>
                                    <span class="nt">&#34;name&#34;</span><span class="p">:</span> <span class="s2">&#34;Bushrod Washington&#34;</span>
                              <span class="p">},</span>
                              <span class="nt">&#34;href&#34;</span><span class="p">:</span> <span class="s2">&#34;https://api.oyez.org/decision_vote/decision_vote/205606&#34;</span><span class="p">,</span>
                              <span class="nt">&#34;vote&#34;</span><span class="p">:</span> <span class="s2">&#34;majority&#34;</span><span class="p">,</span>
                              <span class="nt">&#34;joining&#34;</span><span class="p">:</span> <span class="p">[</span>
                                    <span class="p">{</span>
                                          <span class="nt">&#34;href&#34;</span><span class="p">:</span> <span class="s2">&#34;https://api.oyez.org/people/john_marshall&#34;</span><span class="p">,</span>
                                          <span class="nt">&#34;ID&#34;</span><span class="p">:</span> <span class="mi">15085</span><span class="p">,</span>
                                          <span class="nt">&#34;last_name&#34;</span><span class="p">:</span> <span class="s2">&#34;Marshall&#34;</span><span class="p">,</span>
                                          <span class="nt">&#34;thumbnail&#34;</span><span class="p">:</span> <span class="p">{</span>
                                                <span class="nt">&#34;size&#34;</span><span class="p">:</span> <span class="mi">53035</span><span class="p">,</span>
                                                <span class="nt">&#34;href&#34;</span><span class="p">:</span> <span class="s2">&#34;https://api.oyez.org/sites/default/files/images/people/john_marshall/john_marshall.thumb.png&#34;</span><span class="p">,</span>
                                                <span class="nt">&#34;id&#34;</span><span class="p">:</span> <span class="mi">32729</span><span class="p">,</span>
                                                <span class="nt">&#34;mime&#34;</span><span class="p">:</span> <span class="s2">&#34;image/png&#34;</span>
                                          <span class="p">},</span>
                                          <span class="nt">&#34;length_of_service&#34;</span><span class="p">:</span> <span class="mi">12570</span><span class="p">,</span>
                                          <span class="nt">&#34;view_count&#34;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
                                          <span class="nt">&#34;identifier&#34;</span><span class="p">:</span> <span class="s2">&#34;john_marshall&#34;</span><span class="p">,</span>
                                          <span class="nt">&#34;roles&#34;</span><span class="p">:</span> <span class="p">[</span>
                                                <span class="p">{</span>
                                                      <span class="nt">&#34;appointing_president&#34;</span><span class="p">:</span> <span class="s2">&#34;John Adams&#34;</span><span class="p">,</span>
                                                      <span class="nt">&#34;href&#34;</span><span class="p">:</span> <span class="s2">&#34;https://api.oyez.org/preson_role/scotus_justice/2729&#34;</span><span class="p">,</span>
                                                      <span class="nt">&#34;role_title&#34;</span><span class="p">:</span> <span class="s2">&#34;Chief Justice of the United States&#34;</span><span class="p">,</span>
                                                      <span class="nt">&#34;type&#34;</span><span class="p">:</span> <span class="s2">&#34;scotus_justice&#34;</span><span class="p">,</span>
                                                      <span class="nt">&#34;date_end&#34;</span><span class="p">:</span> <span class="mi">-4244119200</span><span class="p">,</span>
                                                      <span class="nt">&#34;id&#34;</span><span class="p">:</span> <span class="mi">2729</span><span class="p">,</span>
                                                      <span class="nt">&#34;date_start&#34;</span><span class="p">:</span> <span class="mi">-5330167200</span><span class="p">,</span>
                                                      <span class="nt">&#34;institution_name&#34;</span><span class="p">:</span> <span class="s2">&#34;Supreme Court of the United States&#34;</span>
                                                <span class="p">}</span>
                                          <span class="p">],</span>
                                          <span class="nt">&#34;name&#34;</span><span class="p">:</span> <span class="s2">&#34;John Marshall&#34;</span>
                                    <span class="p">}</span>
                              <span class="p">]</span>
                        <span class="p">},</span>
                        <span class="p">{</span>
                              <span class="nt">&#34;ideology&#34;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
                              <span class="nt">&#34;seniority&#34;</span><span class="p">:</span> <span class="mi">5</span><span class="p">,</span>
                              <span class="nt">&#34;opinion_type&#34;</span><span class="p">:</span> <span class="s2">&#34;concurrence&#34;</span><span class="p">,</span>
                              <span class="nt">&#34;member&#34;</span><span class="p">:</span> <span class="p">{</span>
                                    <span class="nt">&#34;href&#34;</span><span class="p">:</span> <span class="s2">&#34;https://api.oyez.org/people/william_johnson&#34;</span><span class="p">,</span>
                                    <span class="nt">&#34;ID&#34;</span><span class="p">:</span> <span class="mi">15059</span><span class="p">,</span>
                                    <span class="nt">&#34;last_name&#34;</span><span class="p">:</span> <span class="s2">&#34;Johnson&#34;</span><span class="p">,</span>
                                    <span class="nt">&#34;thumbnail&#34;</span><span class="p">:</span> <span class="p">{</span>
                                          <span class="nt">&#34;size&#34;</span><span class="p">:</span> <span class="mi">45940</span><span class="p">,</span>
                                          <span class="nt">&#34;href&#34;</span><span class="p">:</span> <span class="s2">&#34;https://api.oyez.org/sites/default/files/images/people/william_johnson/william_johnson.thumb.png&#34;</span><span class="p">,</span>
                                          <span class="nt">&#34;id&#34;</span><span class="p">:</span> <span class="mi">32779</span><span class="p">,</span>
                                          <span class="nt">&#34;mime&#34;</span><span class="p">:</span> <span class="s2">&#34;image/png&#34;</span>
                                    <span class="p">},</span>
                                    <span class="nt">&#34;length_of_service&#34;</span><span class="p">:</span> <span class="mi">11046</span><span class="p">,</span>
                                    <span class="nt">&#34;view_count&#34;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
                                    <span class="nt">&#34;identifier&#34;</span><span class="p">:</span> <span class="s2">&#34;william_johnson&#34;</span><span class="p">,</span>
                                    <span class="nt">&#34;roles&#34;</span><span class="p">:</span> <span class="p">[</span>
                                          <span class="p">{</span>
                                                <span class="nt">&#34;appointing_president&#34;</span><span class="p">:</span> <span class="s2">&#34;Thomas Jefferson&#34;</span><span class="p">,</span>
                                                <span class="nt">&#34;href&#34;</span><span class="p">:</span> <span class="s2">&#34;https://api.oyez.org/preson_role/scotus_justice/2703&#34;</span><span class="p">,</span>
                                                <span class="nt">&#34;role_title&#34;</span><span class="p">:</span> <span class="s2">&#34;Associate Justice of the Supreme Court of the United States&#34;</span><span class="p">,</span>
                                                <span class="nt">&#34;type&#34;</span><span class="p">:</span> <span class="s2">&#34;scotus_justice&#34;</span><span class="p">,</span>
                                                <span class="nt">&#34;date_end&#34;</span><span class="p">:</span> <span class="mi">-4273149600</span><span class="p">,</span>
                                                <span class="nt">&#34;id&#34;</span><span class="p">:</span> <span class="mi">2703</span><span class="p">,</span>
                                                <span class="nt">&#34;date_start&#34;</span><span class="p">:</span> <span class="mi">-5227524000</span><span class="p">,</span>
                                                <span class="nt">&#34;institution_name&#34;</span><span class="p">:</span> <span class="s2">&#34;Supreme Court of the United States&#34;</span>
                                          <span class="p">}</span>
                                    <span class="p">],</span>
                                    <span class="nt">&#34;name&#34;</span><span class="p">:</span> <span class="s2">&#34;William Johnson&#34;</span>
                              <span class="p">},</span>
                              <span class="nt">&#34;href&#34;</span><span class="p">:</span> <span class="s2">&#34;https://api.oyez.org/decision_vote/decision_vote/205607&#34;</span><span class="p">,</span>
                              <span class="nt">&#34;vote&#34;</span><span class="p">:</span> <span class="s2">&#34;majority&#34;</span><span class="p">,</span>
                              <span class="nt">&#34;joining&#34;</span><span class="p">:</span> <span class="p">[</span>
                                    <span class="p">{</span>
                                          <span class="nt">&#34;href&#34;</span><span class="p">:</span> <span class="s2">&#34;https://api.oyez.org/people/john_marshall&#34;</span><span class="p">,</span>
                                          <span class="nt">&#34;ID&#34;</span><span class="p">:</span> <span class="mi">15085</span><span class="p">,</span>
                                          <span class="nt">&#34;last_name&#34;</span><span class="p">:</span> <span class="s2">&#34;Marshall&#34;</span><span class="p">,</span>
                                          <span class="nt">&#34;thumbnail&#34;</span><span class="p">:</span> <span class="p">{</span>
                                                <span class="nt">&#34;size&#34;</span><span class="p">:</span> <span class="mi">53035</span><span class="p">,</span>
                                                <span class="nt">&#34;href&#34;</span><span class="p">:</span> <span class="s2">&#34;https://api.oyez.org/sites/default/files/images/people/john_marshall/john_marshall.thumb.png&#34;</span><span class="p">,</span>
                                                <span class="nt">&#34;id&#34;</span><span class="p">:</span> <span class="mi">32729</span><span class="p">,</span>
                                                <span class="nt">&#34;mime&#34;</span><span class="p">:</span> <span class="s2">&#34;image/png&#34;</span>
                                          <span class="p">},</span>
                                          <span class="nt">&#34;length_of_service&#34;</span><span class="p">:</span> <span class="mi">12570</span><span class="p">,</span>
                                          <span class="nt">&#34;view_count&#34;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
                                          <span class="nt">&#34;identifier&#34;</span><span class="p">:</span> <span class="s2">&#34;john_marshall&#34;</span><span class="p">,</span>
                                          <span class="nt">&#34;roles&#34;</span><span class="p">:</span> <span class="p">[</span>
                                                <span class="p">{</span>
                                                      <span class="nt">&#34;appointing_president&#34;</span><span class="p">:</span> <span class="s2">&#34;John Adams&#34;</span><span class="p">,</span>
                                                      <span class="nt">&#34;href&#34;</span><span class="p">:</span> <span class="s2">&#34;https://api.oyez.org/preson_role/scotus_justice/2729&#34;</span><span class="p">,</span>
                                                      <span class="nt">&#34;role_title&#34;</span><span class="p">:</span> <span class="s2">&#34;Chief Justice of the United States&#34;</span><span class="p">,</span>
                                                      <span class="nt">&#34;type&#34;</span><span class="p">:</span> <span class="s2">&#34;scotus_justice&#34;</span><span class="p">,</span>
                                                      <span class="nt">&#34;date_end&#34;</span><span class="p">:</span> <span class="mi">-4244119200</span><span class="p">,</span>
                                                      <span class="nt">&#34;id&#34;</span><span class="p">:</span> <span class="mi">2729</span><span class="p">,</span>
                                                      <span class="nt">&#34;date_start&#34;</span><span class="p">:</span> <span class="mi">-5330167200</span><span class="p">,</span>
                                                      <span class="nt">&#34;institution_name&#34;</span><span class="p">:</span> <span class="s2">&#34;Supreme Court of the United States&#34;</span>
                                                <span class="p">}</span>
                                          <span class="p">],</span>
                                          <span class="nt">&#34;name&#34;</span><span class="p">:</span> <span class="s2">&#34;John Marshall&#34;</span>
                                    <span class="p">}</span>
                              <span class="p">]</span>
                        <span class="p">},</span>
                        <span class="p">{</span>
                              <span class="nt">&#34;ideology&#34;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
                              <span class="nt">&#34;seniority&#34;</span><span class="p">:</span> <span class="mi">6</span><span class="p">,</span>
                              <span class="nt">&#34;opinion_type&#34;</span><span class="p">:</span> <span class="s2">&#34;none&#34;</span><span class="p">,</span>
                              <span class="nt">&#34;member&#34;</span><span class="p">:</span> <span class="p">{</span>
                                    <span class="nt">&#34;href&#34;</span><span class="p">:</span> <span class="s2">&#34;https://api.oyez.org/people/brockholst_livingston&#34;</span><span class="p">,</span>
                                    <span class="nt">&#34;ID&#34;</span><span class="p">:</span> <span class="mi">15111</span><span class="p">,</span>
                                    <span class="nt">&#34;last_name&#34;</span><span class="p">:</span> <span class="s2">&#34;Livingston&#34;</span><span class="p">,</span>
                                    <span class="nt">&#34;thumbnail&#34;</span><span class="p">:</span> <span class="p">{</span>
                                          <span class="nt">&#34;size&#34;</span><span class="p">:</span> <span class="mi">44786</span><span class="p">,</span>
                                          <span class="nt">&#34;href&#34;</span><span class="p">:</span> <span class="s2">&#34;https://api.oyez.org/sites/default/files/images/people/brockholst_livingston/brockholst_livingston.thumb.png&#34;</span><span class="p">,</span>
                                          <span class="nt">&#34;id&#34;</span><span class="p">:</span> <span class="mi">32714</span><span class="p">,</span>
                                          <span class="nt">&#34;mime&#34;</span><span class="p">:</span> <span class="s2">&#34;image/png&#34;</span>
                                    <span class="p">},</span>
                                    <span class="nt">&#34;length_of_service&#34;</span><span class="p">:</span> <span class="mi">5901</span><span class="p">,</span>
                                    <span class="nt">&#34;view_count&#34;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
                                    <span class="nt">&#34;identifier&#34;</span><span class="p">:</span> <span class="s2">&#34;brockholst_livingston&#34;</span><span class="p">,</span>
                                    <span class="nt">&#34;roles&#34;</span><span class="p">:</span> <span class="p">[</span>
                                          <span class="p">{</span>
                                                <span class="nt">&#34;appointing_president&#34;</span><span class="p">:</span> <span class="s2">&#34;Thomas Jefferson&#34;</span><span class="p">,</span>
                                                <span class="nt">&#34;href&#34;</span><span class="p">:</span> <span class="s2">&#34;https://api.oyez.org/preson_role/scotus_justice/2755&#34;</span><span class="p">,</span>
                                                <span class="nt">&#34;role_title&#34;</span><span class="p">:</span> <span class="s2">&#34;Associate Justice of the Supreme Court of the United States&#34;</span><span class="p">,</span>
                                                <span class="nt">&#34;type&#34;</span><span class="p">:</span> <span class="s2">&#34;scotus_justice&#34;</span><span class="p">,</span>
                                                <span class="nt">&#34;date_end&#34;</span><span class="p">:</span> <span class="mi">-4632314400</span><span class="p">,</span>
                                                <span class="nt">&#34;id&#34;</span><span class="p">:</span> <span class="mi">2755</span><span class="p">,</span>
                                                <span class="nt">&#34;date_start&#34;</span><span class="p">:</span> <span class="mi">-5142160800</span><span class="p">,</span>
                                                <span class="nt">&#34;institution_name&#34;</span><span class="p">:</span> <span class="s2">&#34;Supreme Court of the United States&#34;</span>
                                          <span class="p">}</span>
                                    <span class="p">],</span>
                                    <span class="nt">&#34;name&#34;</span><span class="p">:</span> <span class="s2">&#34;Henry Brockholst Livingston&#34;</span>
                              <span class="p">},</span>
                              <span class="nt">&#34;href&#34;</span><span class="p">:</span> <span class="s2">&#34;https://api.oyez.org/decision_vote/decision_vote/205608&#34;</span><span class="p">,</span>
                              <span class="nt">&#34;vote&#34;</span><span class="p">:</span> <span class="s2">&#34;majority&#34;</span><span class="p">,</span>
                              <span class="nt">&#34;joining&#34;</span><span class="p">:</span> <span class="p">[</span>
                                    <span class="p">{</span>
                                          <span class="nt">&#34;href&#34;</span><span class="p">:</span> <span class="s2">&#34;https://api.oyez.org/people/john_marshall&#34;</span><span class="p">,</span>
                                          <span class="nt">&#34;ID&#34;</span><span class="p">:</span> <span class="mi">15085</span><span class="p">,</span>
                                          <span class="nt">&#34;last_name&#34;</span><span class="p">:</span> <span class="s2">&#34;Marshall&#34;</span><span class="p">,</span>
                                          <span class="nt">&#34;thumbnail&#34;</span><span class="p">:</span> <span class="p">{</span>
                                                <span class="nt">&#34;size&#34;</span><span class="p">:</span> <span class="mi">53035</span><span class="p">,</span>
                                                <span class="nt">&#34;href&#34;</span><span class="p">:</span> <span class="s2">&#34;https://api.oyez.org/sites/default/files/images/people/john_marshall/john_marshall.thumb.png&#34;</span><span class="p">,</span>
                                                <span class="nt">&#34;id&#34;</span><span class="p">:</span> <span class="mi">32729</span><span class="p">,</span>
                                                <span class="nt">&#34;mime&#34;</span><span class="p">:</span> <span class="s2">&#34;image/png&#34;</span>
                                          <span class="p">},</span>
                                          <span class="nt">&#34;length_of_service&#34;</span><span class="p">:</span> <span class="mi">12570</span><span class="p">,</span>
                                          <span class="nt">&#34;view_count&#34;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
                                          <span class="nt">&#34;identifier&#34;</span><span class="p">:</span> <span class="s2">&#34;john_marshall&#34;</span><span class="p">,</span>
                                          <span class="nt">&#34;roles&#34;</span><span class="p">:</span> <span class="p">[</span>
                                                <span class="p">{</span>
                                                      <span class="nt">&#34;appointing_president&#34;</span><span class="p">:</span> <span class="s2">&#34;John Adams&#34;</span><span class="p">,</span>
                                                      <span class="nt">&#34;href&#34;</span><span class="p">:</span> <span class="s2">&#34;https://api.oyez.org/preson_role/scotus_justice/2729&#34;</span><span class="p">,</span>
                                                      <span class="nt">&#34;role_title&#34;</span><span class="p">:</span> <span class="s2">&#34;Chief Justice of the United States&#34;</span><span class="p">,</span>
                                                      <span class="nt">&#34;type&#34;</span><span class="p">:</span> <span class="s2">&#34;scotus_justice&#34;</span><span class="p">,</span>
                                                      <span class="nt">&#34;date_end&#34;</span><span class="p">:</span> <span class="mi">-4244119200</span><span class="p">,</span>
                                                      <span class="nt">&#34;id&#34;</span><span class="p">:</span> <span class="mi">2729</span><span class="p">,</span>
                                                      <span class="nt">&#34;date_start&#34;</span><span class="p">:</span> <span class="mi">-5330167200</span><span class="p">,</span>
                                                      <span class="nt">&#34;institution_name&#34;</span><span class="p">:</span> <span class="s2">&#34;Supreme Court of the United States&#34;</span>
                                                <span class="p">}</span>
                                          <span class="p">],</span>
                                          <span class="nt">&#34;name&#34;</span><span class="p">:</span> <span class="s2">&#34;John Marshall&#34;</span>
                                    <span class="p">}</span>
                              <span class="p">]</span>
                        <span class="p">},</span>
                        <span class="p">{</span>
                              <span class="nt">&#34;ideology&#34;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
                              <span class="nt">&#34;seniority&#34;</span><span class="p">:</span> <span class="mi">7</span><span class="p">,</span>
                              <span class="nt">&#34;opinion_type&#34;</span><span class="p">:</span> <span class="s2">&#34;none&#34;</span><span class="p">,</span>
                              <span class="nt">&#34;member&#34;</span><span class="p">:</span> <span class="p">{</span>
                                    <span class="nt">&#34;href&#34;</span><span class="p">:</span> <span class="s2">&#34;https://api.oyez.org/people/thomas_todd&#34;</span><span class="p">,</span>
                                    <span class="nt">&#34;ID&#34;</span><span class="p">:</span> <span class="mi">15039</span><span class="p">,</span>
                                    <span class="nt">&#34;last_name&#34;</span><span class="p">:</span> <span class="s2">&#34;Todd&#34;</span><span class="p">,</span>
                                    <span class="nt">&#34;thumbnail&#34;</span><span class="p">:</span> <span class="p">{</span>
                                          <span class="nt">&#34;size&#34;</span><span class="p">:</span> <span class="mi">41113</span><span class="p">,</span>
                                          <span class="nt">&#34;href&#34;</span><span class="p">:</span> <span class="s2">&#34;https://api.oyez.org/sites/default/files/images/people/thomas_todd/thomas_todd.thumb.png&#34;</span><span class="p">,</span>
                                          <span class="nt">&#34;id&#34;</span><span class="p">:</span> <span class="mi">32769</span><span class="p">,</span>
                                          <span class="nt">&#34;mime&#34;</span><span class="p">:</span> <span class="s2">&#34;image/png&#34;</span>
                                    <span class="p">},</span>
                                    <span class="nt">&#34;length_of_service&#34;</span><span class="p">:</span> <span class="mi">6854</span><span class="p">,</span>
                                    <span class="nt">&#34;view_count&#34;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
                                    <span class="nt">&#34;identifier&#34;</span><span class="p">:</span> <span class="s2">&#34;thomas_todd&#34;</span><span class="p">,</span>
                                    <span class="nt">&#34;roles&#34;</span><span class="p">:</span> <span class="p">[</span>
                                          <span class="p">{</span>
                                                <span class="nt">&#34;appointing_president&#34;</span><span class="p">:</span> <span class="s2">&#34;Thomas Jefferson&#34;</span><span class="p">,</span>
                                                <span class="nt">&#34;href&#34;</span><span class="p">:</span> <span class="s2">&#34;https://api.oyez.org/preson_role/scotus_justice/2683&#34;</span><span class="p">,</span>
                                                <span class="nt">&#34;role_title&#34;</span><span class="p">:</span> <span class="s2">&#34;Associate Justice of the Supreme Court of the United States&#34;</span><span class="p">,</span>
                                                <span class="nt">&#34;type&#34;</span><span class="p">:</span> <span class="s2">&#34;scotus_justice&#34;</span><span class="p">,</span>
                                                <span class="nt">&#34;date_end&#34;</span><span class="p">:</span> <span class="mi">-4540989600</span><span class="p">,</span>
                                                <span class="nt">&#34;id&#34;</span><span class="p">:</span> <span class="mi">2683</span><span class="p">,</span>
                                                <span class="nt">&#34;date_start&#34;</span><span class="p">:</span> <span class="mi">-5133175200</span><span class="p">,</span>
                                                <span class="nt">&#34;institution_name&#34;</span><span class="p">:</span> <span class="s2">&#34;Supreme Court of the United States&#34;</span>
                                          <span class="p">}</span>
                                    <span class="p">],</span>
                                    <span class="nt">&#34;name&#34;</span><span class="p">:</span> <span class="s2">&#34;Thomas Todd&#34;</span>
                              <span class="p">},</span>
                              <span class="nt">&#34;href&#34;</span><span class="p">:</span> <span class="s2">&#34;https://api.oyez.org/decision_vote/decision_vote/205609&#34;</span><span class="p">,</span>
                              <span class="nt">&#34;vote&#34;</span><span class="p">:</span> <span class="s2">&#34;majority&#34;</span><span class="p">,</span>
                              <span class="nt">&#34;joining&#34;</span><span class="p">:</span> <span class="p">[</span>
                                    <span class="p">{</span>
                                          <span class="nt">&#34;href&#34;</span><span class="p">:</span> <span class="s2">&#34;https://api.oyez.org/people/john_marshall&#34;</span><span class="p">,</span>
                                          <span class="nt">&#34;ID&#34;</span><span class="p">:</span> <span class="mi">15085</span><span class="p">,</span>
                                          <span class="nt">&#34;last_name&#34;</span><span class="p">:</span> <span class="s2">&#34;Marshall&#34;</span><span class="p">,</span>
                                          <span class="nt">&#34;thumbnail&#34;</span><span class="p">:</span> <span class="p">{</span>
                                                <span class="nt">&#34;size&#34;</span><span class="p">:</span> <span class="mi">53035</span><span class="p">,</span>
                                                <span class="nt">&#34;href&#34;</span><span class="p">:</span> <span class="s2">&#34;https://api.oyez.org/sites/default/files/images/people/john_marshall/john_marshall.thumb.png&#34;</span><span class="p">,</span>
                                                <span class="nt">&#34;id&#34;</span><span class="p">:</span> <span class="mi">32729</span><span class="p">,</span>
                                                <span class="nt">&#34;mime&#34;</span><span class="p">:</span> <span class="s2">&#34;image/png&#34;</span>
                                          <span class="p">},</span>
                                          <span class="nt">&#34;length_of_service&#34;</span><span class="p">:</span> <span class="mi">12570</span><span class="p">,</span>
                                          <span class="nt">&#34;view_count&#34;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
                                          <span class="nt">&#34;identifier&#34;</span><span class="p">:</span> <span class="s2">&#34;john_marshall&#34;</span><span class="p">,</span>
                                          <span class="nt">&#34;roles&#34;</span><span class="p">:</span> <span class="p">[</span>
                                                <span class="p">{</span>
                                                      <span class="nt">&#34;appointing_president&#34;</span><span class="p">:</span> <span class="s2">&#34;John Adams&#34;</span><span class="p">,</span>
                                                      <span class="nt">&#34;href&#34;</span><span class="p">:</span> <span class="s2">&#34;https://api.oyez.org/preson_role/scotus_justice/2729&#34;</span><span class="p">,</span>
                                                      <span class="nt">&#34;role_title&#34;</span><span class="p">:</span> <span class="s2">&#34;Chief Justice of the United States&#34;</span><span class="p">,</span>
                                                      <span class="nt">&#34;type&#34;</span><span class="p">:</span> <span class="s2">&#34;scotus_justice&#34;</span><span class="p">,</span>
                                                      <span class="nt">&#34;date_end&#34;</span><span class="p">:</span> <span class="mi">-4244119200</span><span class="p">,</span>
                                                      <span class="nt">&#34;id&#34;</span><span class="p">:</span> <span class="mi">2729</span><span class="p">,</span>
                                                      <span class="nt">&#34;date_start&#34;</span><span class="p">:</span> <span class="mi">-5330167200</span><span class="p">,</span>
                                                      <span class="nt">&#34;institution_name&#34;</span><span class="p">:</span> <span class="s2">&#34;Supreme Court of the United States&#34;</span>
                                                <span class="p">}</span>
                                          <span class="p">],</span>
                                          <span class="nt">&#34;name&#34;</span><span class="p">:</span> <span class="s2">&#34;John Marshall&#34;</span>
                                    <span class="p">}</span>
                              <span class="p">]</span>
                        <span class="p">},</span>
                        <span class="p">{</span>
                              <span class="nt">&#34;ideology&#34;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
                              <span class="nt">&#34;seniority&#34;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span>
                              <span class="nt">&#34;opinion_type&#34;</span><span class="p">:</span> <span class="s2">&#34;none&#34;</span><span class="p">,</span>
                              <span class="nt">&#34;member&#34;</span><span class="p">:</span> <span class="p">{</span>
                                    <span class="nt">&#34;href&#34;</span><span class="p">:</span> <span class="s2">&#34;https://api.oyez.org/people/william_cushing&#34;</span><span class="p">,</span>
                                    <span class="nt">&#34;ID&#34;</span><span class="p">:</span> <span class="mi">15077</span><span class="p">,</span>
                                    <span class="nt">&#34;last_name&#34;</span><span class="p">:</span> <span class="s2">&#34;Cushing&#34;</span><span class="p">,</span>
                                    <span class="nt">&#34;thumbnail&#34;</span><span class="p">:</span> <span class="p">{</span>
                                          <span class="nt">&#34;size&#34;</span><span class="p">:</span> <span class="mi">52796</span><span class="p">,</span>
                                          <span class="nt">&#34;href&#34;</span><span class="p">:</span> <span class="s2">&#34;https://api.oyez.org/sites/default/files/images/people/william_cushing/william_cushing.thumb.png&#34;</span><span class="p">,</span>
                                          <span class="nt">&#34;id&#34;</span><span class="p">:</span> <span class="mi">32776</span><span class="p">,</span>
                                          <span class="nt">&#34;mime&#34;</span><span class="p">:</span> <span class="s2">&#34;image/png&#34;</span>
                                    <span class="p">},</span>
                                    <span class="nt">&#34;length_of_service&#34;</span><span class="p">:</span> <span class="mi">7527</span><span class="p">,</span>
                                    <span class="nt">&#34;view_count&#34;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
                                    <span class="nt">&#34;identifier&#34;</span><span class="p">:</span> <span class="s2">&#34;william_cushing&#34;</span><span class="p">,</span>
                                    <span class="nt">&#34;roles&#34;</span><span class="p">:</span> <span class="p">[</span>
                                          <span class="p">{</span>
                                                <span class="nt">&#34;appointing_president&#34;</span><span class="p">:</span> <span class="s2">&#34;George Washington&#34;</span><span class="p">,</span>
                                                <span class="nt">&#34;href&#34;</span><span class="p">:</span> <span class="s2">&#34;https://api.oyez.org/preson_role/scotus_justice/2721&#34;</span><span class="p">,</span>
                                                <span class="nt">&#34;role_title&#34;</span><span class="p">:</span> <span class="s2">&#34;Associate Justice of the Supreme Court of the United States&#34;</span><span class="p">,</span>
                                                <span class="nt">&#34;type&#34;</span><span class="p">:</span> <span class="s2">&#34;scotus_justice&#34;</span><span class="p">,</span>
                                                <span class="nt">&#34;date_end&#34;</span><span class="p">:</span> <span class="mi">-5027076000</span><span class="p">,</span>
                                                <span class="nt">&#34;id&#34;</span><span class="p">:</span> <span class="mi">2721</span><span class="p">,</span>
                                                <span class="nt">&#34;date_start&#34;</span><span class="p">:</span> <span class="mi">-5677408800</span><span class="p">,</span>
                                                <span class="nt">&#34;institution_name&#34;</span><span class="p">:</span> <span class="s2">&#34;Supreme Court of the United States&#34;</span>
                                          <span class="p">}</span>
                                    <span class="p">],</span>
                                    <span class="nt">&#34;name&#34;</span><span class="p">:</span> <span class="s2">&#34;William Cushing&#34;</span>
                              <span class="p">},</span>
                              <span class="nt">&#34;href&#34;</span><span class="p">:</span> <span class="s2">&#34;https://api.oyez.org/decision_vote/decision_vote/205610&#34;</span><span class="p">,</span>
                              <span class="nt">&#34;vote&#34;</span><span class="p">:</span> <span class="s2">&#34;none&#34;</span><span class="p">,</span>
                              <span class="nt">&#34;joining&#34;</span><span class="p">:</span> <span class="kc">null</span>
                        <span class="p">},</span>
                        <span class="p">{</span>
                              <span class="nt">&#34;ideology&#34;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
                              <span class="nt">&#34;seniority&#34;</span><span class="p">:</span> <span class="mi">3</span><span class="p">,</span>
                              <span class="nt">&#34;opinion_type&#34;</span><span class="p">:</span> <span class="s2">&#34;none&#34;</span><span class="p">,</span>
                              <span class="nt">&#34;member&#34;</span><span class="p">:</span> <span class="p">{</span>
                                    <span class="nt">&#34;href&#34;</span><span class="p">:</span> <span class="s2">&#34;https://api.oyez.org/people/samuel_chase&#34;</span><span class="p">,</span>
                                    <span class="nt">&#34;ID&#34;</span><span class="p">:</span> <span class="mi">15105</span><span class="p">,</span>
                                    <span class="nt">&#34;last_name&#34;</span><span class="p">:</span> <span class="s2">&#34;Chase&#34;</span><span class="p">,</span>
                                    <span class="nt">&#34;thumbnail&#34;</span><span class="p">:</span> <span class="p">{</span>
                                          <span class="nt">&#34;size&#34;</span><span class="p">:</span> <span class="mi">52231</span><span class="p">,</span>
                                          <span class="nt">&#34;href&#34;</span><span class="p">:</span> <span class="s2">&#34;https://api.oyez.org/sites/default/files/images/people/samuel_chase/samuel_chase.thumb.png&#34;</span><span class="p">,</span>
                                          <span class="nt">&#34;id&#34;</span><span class="p">:</span> <span class="mi">32759</span><span class="p">,</span>
                                          <span class="nt">&#34;mime&#34;</span><span class="p">:</span> <span class="s2">&#34;image/png&#34;</span>
                                    <span class="p">},</span>
                                    <span class="nt">&#34;length_of_service&#34;</span><span class="p">:</span> <span class="mi">5613</span><span class="p">,</span>
                                    <span class="nt">&#34;view_count&#34;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
                                    <span class="nt">&#34;identifier&#34;</span><span class="p">:</span> <span class="s2">&#34;samuel_chase&#34;</span><span class="p">,</span>
                                    <span class="nt">&#34;roles&#34;</span><span class="p">:</span> <span class="p">[</span>
                                          <span class="p">{</span>
                                                <span class="nt">&#34;appointing_president&#34;</span><span class="p">:</span> <span class="s2">&#34;George Washington&#34;</span><span class="p">,</span>
                                                <span class="nt">&#34;href&#34;</span><span class="p">:</span> <span class="s2">&#34;https://api.oyez.org/preson_role/scotus_justice/2749&#34;</span><span class="p">,</span>
                                                <span class="nt">&#34;role_title&#34;</span><span class="p">:</span> <span class="s2">&#34;Associate Justice of the Supreme Court of the United States&#34;</span><span class="p">,</span>
                                                <span class="nt">&#34;type&#34;</span><span class="p">:</span> <span class="s2">&#34;scotus_justice&#34;</span><span class="p">,</span>
                                                <span class="nt">&#34;date_end&#34;</span><span class="p">:</span> <span class="mi">-5002970400</span><span class="p">,</span>
                                                <span class="nt">&#34;id&#34;</span><span class="p">:</span> <span class="mi">2749</span><span class="p">,</span>
                                                <span class="nt">&#34;date_start&#34;</span><span class="p">:</span> <span class="mi">-5487933600</span><span class="p">,</span>
                                                <span class="nt">&#34;institution_name&#34;</span><span class="p">:</span> <span class="s2">&#34;Supreme Court of the United States&#34;</span>
                                          <span class="p">}</span>
                                    <span class="p">],</span>
                                    <span class="nt">&#34;name&#34;</span><span class="p">:</span> <span class="s2">&#34;Samuel Chase&#34;</span>
                              <span class="p">},</span>
                              <span class="nt">&#34;href&#34;</span><span class="p">:</span> <span class="s2">&#34;https://api.oyez.org/decision_vote/decision_vote/205611&#34;</span><span class="p">,</span>
                              <span class="nt">&#34;vote&#34;</span><span class="p">:</span> <span class="s2">&#34;none&#34;</span><span class="p">,</span>
                              <span class="nt">&#34;joining&#34;</span><span class="p">:</span> <span class="kc">null</span>
                        <span class="p">}</span>
                  <span class="p">],</span>
                  <span class="nt">&#34;minority_vote&#34;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
                  <span class="nt">&#34;winning_party&#34;</span><span class="p">:</span> <span class="s2">&#34;Peck&#34;</span><span class="p">,</span>
                  <span class="nt">&#34;decision_type&#34;</span><span class="p">:</span> <span class="s2">&#34;majority opinion&#34;</span><span class="p">,</span>
                  <span class="nt">&#34;majority_vote&#34;</span><span class="p">:</span> <span class="mi">5</span><span class="p">,</span>
                  <span class="nt">&#34;description&#34;</span><span class="p">:</span> <span class="s2">&#34;Under the  Contracts Clause (Article 1, Section 10, Clause 1), states cannot rescind an agreement even if that agreement was reached illegally&#34;</span>
            <span class="p">}</span>
      <span class="p">],</span>
      <span class="nt">&#34;href&#34;</span><span class="p">:</span> <span class="s2">&#34;https://api.oyez.org/cases/1789-1850/10us87&#34;</span><span class="p">,</span>
      <span class="nt">&#34;second_party&#34;</span><span class="p">:</span> <span class="s2">&#34;John Peck&#34;</span><span class="p">,</span>
      <span class="nt">&#34;first_party&#34;</span><span class="p">:</span> <span class="s2">&#34;Robert Fletcher&#34;</span><span class="p">,</span>
      <span class="nt">&#34;advocates&#34;</span><span class="p">:</span> <span class="kc">null</span><span class="p">,</span>
      <span class="nt">&#34;description&#34;</span><span class="p">:</span> <span class="s2">&#34;A case in which the Court held that a contract is still binding and enforceable, even if secured illegally.&#34;</span><span class="p">,</span>
      <span class="nt">&#34;first_party_label&#34;</span><span class="p">:</span> <span class="s2">&#34;Petitioner&#34;</span><span class="p">,</span>
      <span class="nt">&#34;related_cases&#34;</span><span class="p">:</span> <span class="kc">null</span><span class="p">,</span>
      <span class="nt">&#34;conclusion&#34;</span><span class="p">:</span> <span class="s2">&#34;&lt;p&gt;In a unanimous opinion, the Court held that since the estate had been legally \&#34;passed into the hands of a purchaser for a valuable consideration,\&#34; the Georgia legislature could not take away the land or invalidate the contract. Noting that the Constitution did not permit bills of attainder or ex post facto laws, the Court held that laws annulling contracts or grants made by previous legislative acts were constitutionally impermissible.&lt;/p&gt;\n&#34;</span><span class="p">,</span>
      <span class="nt">&#34;facts_of_the_case&#34;</span><span class="p">:</span> <span class="s2">&#34;&lt;p&gt;In 1795, the Georgia state legislature passed a land grant awarding territory to four companies. The following year, however, the legislature voided the law and declared all rights and claims under it to be invalid. In 1800, John Peck acquired land that was part of the original legislative grant. He then sold the land to Robert Fletcher three years later, claiming that past sales of the land had been legitimate. Fletcher argued that since the original sale of the land had been declared invalid, Peck had no legal right to sell the land and thus committed a breach of contract.&lt;/p&gt;\n&#34;</span><span class="p">,</span>
      <span class="nt">&#34;timeline&#34;</span><span class="p">:</span> <span class="p">[</span>
            <span class="p">{</span>
                  <span class="nt">&#34;href&#34;</span><span class="p">:</span> <span class="s2">&#34;https://api.oyez.org/case_timeline/case_timeline/52829&#34;</span><span class="p">,</span>
                  <span class="nt">&#34;dates&#34;</span><span class="p">:</span> <span class="p">[</span>
                        <span class="mi">-5045220000</span><span class="p">,</span>
                        <span class="mi">-5075546400</span><span class="p">,</span>
                        <span class="mi">-5075460000</span><span class="p">,</span>
                        <span class="mi">-5075373600</span><span class="p">,</span>
                        <span class="mi">-5075287200</span>
                  <span class="p">],</span>
                  <span class="nt">&#34;event&#34;</span><span class="p">:</span> <span class="s2">&#34;Argued&#34;</span>
            <span class="p">},</span>
            <span class="p">{</span>
                  <span class="nt">&#34;href&#34;</span><span class="p">:</span> <span class="s2">&#34;https://api.oyez.org/case_timeline/case_timeline/52830&#34;</span><span class="p">,</span>
                  <span class="nt">&#34;dates&#34;</span><span class="p">:</span> <span class="p">[</span>
                        <span class="mi">-5042714400</span>
                  <span class="p">],</span>
                  <span class="nt">&#34;event&#34;</span><span class="p">:</span> <span class="s2">&#34;Decided&#34;</span>
            <span class="p">}</span>
      <span class="p">],</span>
      <span class="nt">&#34;opinion_announcement&#34;</span><span class="p">:</span> <span class="kc">null</span><span class="p">,</span>
      <span class="nt">&#34;second_party_label&#34;</span><span class="p">:</span> <span class="s2">&#34;Respondent&#34;</span><span class="p">,</span>
      <span class="nt">&#34;heard_by&#34;</span><span class="p">:</span> <span class="p">[</span>
            <span class="p">{</span>
                  <span class="nt">&#34;href&#34;</span><span class="p">:</span> <span class="s2">&#34;https://api.oyez.org/courts/marshall6&#34;</span><span class="p">,</span>
                  <span class="nt">&#34;ID&#34;</span><span class="p">:</span> <span class="mi">15247</span><span class="p">,</span>
                  <span class="nt">&#34;members&#34;</span><span class="p">:</span> <span class="p">[</span>
                        <span class="p">{</span>
                              <span class="nt">&#34;href&#34;</span><span class="p">:</span> <span class="s2">&#34;https://api.oyez.org/people/john_marshall&#34;</span><span class="p">,</span>
                              <span class="nt">&#34;ID&#34;</span><span class="p">:</span> <span class="mi">15085</span><span class="p">,</span>
                              <span class="nt">&#34;last_name&#34;</span><span class="p">:</span> <span class="s2">&#34;Marshall&#34;</span><span class="p">,</span>
                              <span class="nt">&#34;thumbnail&#34;</span><span class="p">:</span> <span class="p">{</span>
                                    <span class="nt">&#34;size&#34;</span><span class="p">:</span> <span class="mi">53035</span><span class="p">,</span>
                                    <span class="nt">&#34;href&#34;</span><span class="p">:</span> <span class="s2">&#34;https://api.oyez.org/sites/default/files/images/people/john_marshall/john_marshall.thumb.png&#34;</span><span class="p">,</span>
                                    <span class="nt">&#34;id&#34;</span><span class="p">:</span> <span class="mi">32729</span><span class="p">,</span>
                                    <span class="nt">&#34;mime&#34;</span><span class="p">:</span> <span class="s2">&#34;image/png&#34;</span>
                              <span class="p">},</span>
                              <span class="nt">&#34;length_of_service&#34;</span><span class="p">:</span> <span class="mi">12570</span><span class="p">,</span>
                              <span class="nt">&#34;view_count&#34;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
                              <span class="nt">&#34;identifier&#34;</span><span class="p">:</span> <span class="s2">&#34;john_marshall&#34;</span><span class="p">,</span>
                              <span class="nt">&#34;roles&#34;</span><span class="p">:</span> <span class="p">[</span>
                                    <span class="p">{</span>
                                          <span class="nt">&#34;appointing_president&#34;</span><span class="p">:</span> <span class="s2">&#34;John Adams&#34;</span><span class="p">,</span>
                                          <span class="nt">&#34;href&#34;</span><span class="p">:</span> <span class="s2">&#34;https://api.oyez.org/preson_role/scotus_justice/2729&#34;</span><span class="p">,</span>
                                          <span class="nt">&#34;role_title&#34;</span><span class="p">:</span> <span class="s2">&#34;Chief Justice of the United States&#34;</span><span class="p">,</span>
                                          <span class="nt">&#34;type&#34;</span><span class="p">:</span> <span class="s2">&#34;scotus_justice&#34;</span><span class="p">,</span>
                                          <span class="nt">&#34;date_end&#34;</span><span class="p">:</span> <span class="mi">-4244119200</span><span class="p">,</span>
                                          <span class="nt">&#34;id&#34;</span><span class="p">:</span> <span class="mi">2729</span><span class="p">,</span>
                                          <span class="nt">&#34;date_start&#34;</span><span class="p">:</span> <span class="mi">-5330167200</span><span class="p">,</span>
                                          <span class="nt">&#34;institution_name&#34;</span><span class="p">:</span> <span class="s2">&#34;Supreme Court of the United States&#34;</span>
                                    <span class="p">}</span>
                              <span class="p">],</span>
                              <span class="nt">&#34;name&#34;</span><span class="p">:</span> <span class="s2">&#34;John Marshall&#34;</span>
                        <span class="p">},</span>
                        <span class="p">{</span>
                              <span class="nt">&#34;href&#34;</span><span class="p">:</span> <span class="s2">&#34;https://api.oyez.org/people/william_cushing&#34;</span><span class="p">,</span>
                              <span class="nt">&#34;ID&#34;</span><span class="p">:</span> <span class="mi">15077</span><span class="p">,</span>
                              <span class="nt">&#34;last_name&#34;</span><span class="p">:</span> <span class="s2">&#34;Cushing&#34;</span><span class="p">,</span>
                              <span class="nt">&#34;thumbnail&#34;</span><span class="p">:</span> <span class="p">{</span>
                                    <span class="nt">&#34;size&#34;</span><span class="p">:</span> <span class="mi">52796</span><span class="p">,</span>
                                    <span class="nt">&#34;href&#34;</span><span class="p">:</span> <span class="s2">&#34;https://api.oyez.org/sites/default/files/images/people/william_cushing/william_cushing.thumb.png&#34;</span><span class="p">,</span>
                                    <span class="nt">&#34;id&#34;</span><span class="p">:</span> <span class="mi">32776</span><span class="p">,</span>
                                    <span class="nt">&#34;mime&#34;</span><span class="p">:</span> <span class="s2">&#34;image/png&#34;</span>
                              <span class="p">},</span>
                              <span class="nt">&#34;length_of_service&#34;</span><span class="p">:</span> <span class="mi">7527</span><span class="p">,</span>
                              <span class="nt">&#34;view_count&#34;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
                              <span class="nt">&#34;identifier&#34;</span><span class="p">:</span> <span class="s2">&#34;william_cushing&#34;</span><span class="p">,</span>
                              <span class="nt">&#34;roles&#34;</span><span class="p">:</span> <span class="p">[</span>
                                    <span class="p">{</span>
                                          <span class="nt">&#34;appointing_president&#34;</span><span class="p">:</span> <span class="s2">&#34;George Washington&#34;</span><span class="p">,</span>
                                          <span class="nt">&#34;href&#34;</span><span class="p">:</span> <span class="s2">&#34;https://api.oyez.org/preson_role/scotus_justice/2721&#34;</span><span class="p">,</span>
                                          <span class="nt">&#34;role_title&#34;</span><span class="p">:</span> <span class="s2">&#34;Associate Justice of the Supreme Court of the United States&#34;</span><span class="p">,</span>
                                          <span class="nt">&#34;type&#34;</span><span class="p">:</span> <span class="s2">&#34;scotus_justice&#34;</span><span class="p">,</span>
                                          <span class="nt">&#34;date_end&#34;</span><span class="p">:</span> <span class="mi">-5027076000</span><span class="p">,</span>
                                          <span class="nt">&#34;id&#34;</span><span class="p">:</span> <span class="mi">2721</span><span class="p">,</span>
                                          <span class="nt">&#34;date_start&#34;</span><span class="p">:</span> <span class="mi">-5677408800</span><span class="p">,</span>
                                          <span class="nt">&#34;institution_name&#34;</span><span class="p">:</span> <span class="s2">&#34;Supreme Court of the United States&#34;</span>
                                    <span class="p">}</span>
                              <span class="p">],</span>
                              <span class="nt">&#34;name&#34;</span><span class="p">:</span> <span class="s2">&#34;William Cushing&#34;</span>
                        <span class="p">},</span>
                        <span class="p">{</span>
                              <span class="nt">&#34;href&#34;</span><span class="p">:</span> <span class="s2">&#34;https://api.oyez.org/people/samuel_chase&#34;</span><span class="p">,</span>
                              <span class="nt">&#34;ID&#34;</span><span class="p">:</span> <span class="mi">15105</span><span class="p">,</span>
                              <span class="nt">&#34;last_name&#34;</span><span class="p">:</span> <span class="s2">&#34;Chase&#34;</span><span class="p">,</span>
                              <span class="nt">&#34;thumbnail&#34;</span><span class="p">:</span> <span class="p">{</span>
                                    <span class="nt">&#34;size&#34;</span><span class="p">:</span> <span class="mi">52231</span><span class="p">,</span>
                                    <span class="nt">&#34;href&#34;</span><span class="p">:</span> <span class="s2">&#34;https://api.oyez.org/sites/default/files/images/people/samuel_chase/samuel_chase.thumb.png&#34;</span><span class="p">,</span>
                                    <span class="nt">&#34;id&#34;</span><span class="p">:</span> <span class="mi">32759</span><span class="p">,</span>
                                    <span class="nt">&#34;mime&#34;</span><span class="p">:</span> <span class="s2">&#34;image/png&#34;</span>
                              <span class="p">},</span>
                              <span class="nt">&#34;length_of_service&#34;</span><span class="p">:</span> <span class="mi">5613</span><span class="p">,</span>
                              <span class="nt">&#34;view_count&#34;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
                              <span class="nt">&#34;identifier&#34;</span><span class="p">:</span> <span class="s2">&#34;samuel_chase&#34;</span><span class="p">,</span>
                              <span class="nt">&#34;roles&#34;</span><span class="p">:</span> <span class="p">[</span>
                                    <span class="p">{</span>
                                          <span class="nt">&#34;appointing_president&#34;</span><span class="p">:</span> <span class="s2">&#34;George Washington&#34;</span><span class="p">,</span>
                                          <span class="nt">&#34;href&#34;</span><span class="p">:</span> <span class="s2">&#34;https://api.oyez.org/preson_role/scotus_justice/2749&#34;</span><span class="p">,</span>
                                          <span class="nt">&#34;role_title&#34;</span><span class="p">:</span> <span class="s2">&#34;Associate Justice of the Supreme Court of the United States&#34;</span><span class="p">,</span>
                                          <span class="nt">&#34;type&#34;</span><span class="p">:</span> <span class="s2">&#34;scotus_justice&#34;</span><span class="p">,</span>
                                          <span class="nt">&#34;date_end&#34;</span><span class="p">:</span> <span class="mi">-5002970400</span><span class="p">,</span>
                                          <span class="nt">&#34;id&#34;</span><span class="p">:</span> <span class="mi">2749</span><span class="p">,</span>
                                          <span class="nt">&#34;date_start&#34;</span><span class="p">:</span> <span class="mi">-5487933600</span><span class="p">,</span>
                                          <span class="nt">&#34;institution_name&#34;</span><span class="p">:</span> <span class="s2">&#34;Supreme Court of the United States&#34;</span>
                                    <span class="p">}</span>
                              <span class="p">],</span>
                              <span class="nt">&#34;name&#34;</span><span class="p">:</span> <span class="s2">&#34;Samuel Chase&#34;</span>
                        <span class="p">},</span>
                        <span class="p">{</span>
                              <span class="nt">&#34;href&#34;</span><span class="p">:</span> <span class="s2">&#34;https://api.oyez.org/people/bushrod_washington&#34;</span><span class="p">,</span>
                              <span class="nt">&#34;ID&#34;</span><span class="p">:</span> <span class="mi">15093</span><span class="p">,</span>
                              <span class="nt">&#34;last_name&#34;</span><span class="p">:</span> <span class="s2">&#34;Washington&#34;</span><span class="p">,</span>
                              <span class="nt">&#34;thumbnail&#34;</span><span class="p">:</span> <span class="p">{</span>
                                    <span class="nt">&#34;size&#34;</span><span class="p">:</span> <span class="mi">42759</span><span class="p">,</span>
                                    <span class="nt">&#34;href&#34;</span><span class="p">:</span> <span class="s2">&#34;https://api.oyez.org/sites/default/files/images/people/bushrod_washington/bushrod_washington.thumb.png&#34;</span><span class="p">,</span>
                                    <span class="nt">&#34;id&#34;</span><span class="p">:</span> <span class="mi">32698</span><span class="p">,</span>
                                    <span class="nt">&#34;mime&#34;</span><span class="p">:</span> <span class="s2">&#34;image/png&#34;</span>
                              <span class="p">},</span>
                              <span class="nt">&#34;length_of_service&#34;</span><span class="p">:</span> <span class="mi">11339</span><span class="p">,</span>
                              <span class="nt">&#34;view_count&#34;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
                              <span class="nt">&#34;identifier&#34;</span><span class="p">:</span> <span class="s2">&#34;bushrod_washington&#34;</span><span class="p">,</span>
                              <span class="nt">&#34;roles&#34;</span><span class="p">:</span> <span class="p">[</span>
                                    <span class="p">{</span>
                                          <span class="nt">&#34;appointing_president&#34;</span><span class="p">:</span> <span class="s2">&#34;John Adams&#34;</span><span class="p">,</span>
                                          <span class="nt">&#34;href&#34;</span><span class="p">:</span> <span class="s2">&#34;https://api.oyez.org/preson_role/scotus_justice/2737&#34;</span><span class="p">,</span>
                                          <span class="nt">&#34;role_title&#34;</span><span class="p">:</span> <span class="s2">&#34;Associate Justice of the Supreme Court of the United States&#34;</span><span class="p">,</span>
                                          <span class="nt">&#34;type&#34;</span><span class="p">:</span> <span class="s2">&#34;scotus_justice&#34;</span><span class="p">,</span>
                                          <span class="nt">&#34;date_end&#34;</span><span class="p">:</span> <span class="mi">-4421066400</span><span class="p">,</span>
                                          <span class="nt">&#34;id&#34;</span><span class="p">:</span> <span class="mi">2737</span><span class="p">,</span>
                                          <span class="nt">&#34;date_start&#34;</span><span class="p">:</span> <span class="mi">-5400756000</span><span class="p">,</span>
                                          <span class="nt">&#34;institution_name&#34;</span><span class="p">:</span> <span class="s2">&#34;Supreme Court of the United States&#34;</span>
                                    <span class="p">}</span>
                              <span class="p">],</span>
                              <span class="nt">&#34;name&#34;</span><span class="p">:</span> <span class="s2">&#34;Bushrod Washington&#34;</span>
                        <span class="p">},</span>
                        <span class="p">{</span>
                              <span class="nt">&#34;href&#34;</span><span class="p">:</span> <span class="s2">&#34;https://api.oyez.org/people/william_johnson&#34;</span><span class="p">,</span>
                              <span class="nt">&#34;ID&#34;</span><span class="p">:</span> <span class="mi">15059</span><span class="p">,</span>
                              <span class="nt">&#34;last_name&#34;</span><span class="p">:</span> <span class="s2">&#34;Johnson&#34;</span><span class="p">,</span>
                              <span class="nt">&#34;thumbnail&#34;</span><span class="p">:</span> <span class="p">{</span>
                                    <span class="nt">&#34;size&#34;</span><span class="p">:</span> <span class="mi">45940</span><span class="p">,</span>
                                    <span class="nt">&#34;href&#34;</span><span class="p">:</span> <span class="s2">&#34;https://api.oyez.org/sites/default/files/images/people/william_johnson/william_johnson.thumb.png&#34;</span><span class="p">,</span>
                                    <span class="nt">&#34;id&#34;</span><span class="p">:</span> <span class="mi">32779</span><span class="p">,</span>
                                    <span class="nt">&#34;mime&#34;</span><span class="p">:</span> <span class="s2">&#34;image/png&#34;</span>
                              <span class="p">},</span>
                              <span class="nt">&#34;length_of_service&#34;</span><span class="p">:</span> <span class="mi">11046</span><span class="p">,</span>
                              <span class="nt">&#34;view_count&#34;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
                              <span class="nt">&#34;identifier&#34;</span><span class="p">:</span> <span class="s2">&#34;william_johnson&#34;</span><span class="p">,</span>
                              <span class="nt">&#34;roles&#34;</span><span class="p">:</span> <span class="p">[</span>
                                    <span class="p">{</span>
                                          <span class="nt">&#34;appointing_president&#34;</span><span class="p">:</span> <span class="s2">&#34;Thomas Jefferson&#34;</span><span class="p">,</span>
                                          <span class="nt">&#34;href&#34;</span><span class="p">:</span> <span class="s2">&#34;https://api.oyez.org/preson_role/scotus_justice/2703&#34;</span><span class="p">,</span>
                                          <span class="nt">&#34;role_title&#34;</span><span class="p">:</span> <span class="s2">&#34;Associate Justice of the Supreme Court of the United States&#34;</span><span class="p">,</span>
                                          <span class="nt">&#34;type&#34;</span><span class="p">:</span> <span class="s2">&#34;scotus_justice&#34;</span><span class="p">,</span>
                                          <span class="nt">&#34;date_end&#34;</span><span class="p">:</span> <span class="mi">-4273149600</span><span class="p">,</span>
                                          <span class="nt">&#34;id&#34;</span><span class="p">:</span> <span class="mi">2703</span><span class="p">,</span>
                                          <span class="nt">&#34;date_start&#34;</span><span class="p">:</span> <span class="mi">-5227524000</span><span class="p">,</span>
                                          <span class="nt">&#34;institution_name&#34;</span><span class="p">:</span> <span class="s2">&#34;Supreme Court of the United States&#34;</span>
                                    <span class="p">}</span>
                              <span class="p">],</span>
                              <span class="nt">&#34;name&#34;</span><span class="p">:</span> <span class="s2">&#34;William Johnson&#34;</span>
                        <span class="p">},</span>
                        <span class="p">{</span>
                              <span class="nt">&#34;href&#34;</span><span class="p">:</span> <span class="s2">&#34;https://api.oyez.org/people/brockholst_livingston&#34;</span><span class="p">,</span>
                              <span class="nt">&#34;ID&#34;</span><span class="p">:</span> <span class="mi">15111</span><span class="p">,</span>
                              <span class="nt">&#34;last_name&#34;</span><span class="p">:</span> <span class="s2">&#34;Livingston&#34;</span><span class="p">,</span>
                              <span class="nt">&#34;thumbnail&#34;</span><span class="p">:</span> <span class="p">{</span>
                                    <span class="nt">&#34;size&#34;</span><span class="p">:</span> <span class="mi">44786</span><span class="p">,</span>
                                    <span class="nt">&#34;href&#34;</span><span class="p">:</span> <span class="s2">&#34;https://api.oyez.org/sites/default/files/images/people/brockholst_livingston/brockholst_livingston.thumb.png&#34;</span><span class="p">,</span>
                                    <span class="nt">&#34;id&#34;</span><span class="p">:</span> <span class="mi">32714</span><span class="p">,</span>
                                    <span class="nt">&#34;mime&#34;</span><span class="p">:</span> <span class="s2">&#34;image/png&#34;</span>
                              <span class="p">},</span>
                              <span class="nt">&#34;length_of_service&#34;</span><span class="p">:</span> <span class="mi">5901</span><span class="p">,</span>
                              <span class="nt">&#34;view_count&#34;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
                              <span class="nt">&#34;identifier&#34;</span><span class="p">:</span> <span class="s2">&#34;brockholst_livingston&#34;</span><span class="p">,</span>
                              <span class="nt">&#34;roles&#34;</span><span class="p">:</span> <span class="p">[</span>
                                    <span class="p">{</span>
                                          <span class="nt">&#34;appointing_president&#34;</span><span class="p">:</span> <span class="s2">&#34;Thomas Jefferson&#34;</span><span class="p">,</span>
                                          <span class="nt">&#34;href&#34;</span><span class="p">:</span> <span class="s2">&#34;https://api.oyez.org/preson_role/scotus_justice/2755&#34;</span><span class="p">,</span>
                                          <span class="nt">&#34;role_title&#34;</span><span class="p">:</span> <span class="s2">&#34;Associate Justice of the Supreme Court of the United States&#34;</span><span class="p">,</span>
                                          <span class="nt">&#34;type&#34;</span><span class="p">:</span> <span class="s2">&#34;scotus_justice&#34;</span><span class="p">,</span>
                                          <span class="nt">&#34;date_end&#34;</span><span class="p">:</span> <span class="mi">-4632314400</span><span class="p">,</span>
                                          <span class="nt">&#34;id&#34;</span><span class="p">:</span> <span class="mi">2755</span><span class="p">,</span>
                                          <span class="nt">&#34;date_start&#34;</span><span class="p">:</span> <span class="mi">-5142160800</span><span class="p">,</span>
                                          <span class="nt">&#34;institution_name&#34;</span><span class="p">:</span> <span class="s2">&#34;Supreme Court of the United States&#34;</span>
                                    <span class="p">}</span>
                              <span class="p">],</span>
                              <span class="nt">&#34;name&#34;</span><span class="p">:</span> <span class="s2">&#34;Henry Brockholst Livingston&#34;</span>
                        <span class="p">},</span>
                        <span class="p">{</span>
                              <span class="nt">&#34;href&#34;</span><span class="p">:</span> <span class="s2">&#34;https://api.oyez.org/people/thomas_todd&#34;</span><span class="p">,</span>
                              <span class="nt">&#34;ID&#34;</span><span class="p">:</span> <span class="mi">15039</span><span class="p">,</span>
                              <span class="nt">&#34;last_name&#34;</span><span class="p">:</span> <span class="s2">&#34;Todd&#34;</span><span class="p">,</span>
                              <span class="nt">&#34;thumbnail&#34;</span><span class="p">:</span> <span class="p">{</span>
                                    <span class="nt">&#34;size&#34;</span><span class="p">:</span> <span class="mi">41113</span><span class="p">,</span>
                                    <span class="nt">&#34;href&#34;</span><span class="p">:</span> <span class="s2">&#34;https://api.oyez.org/sites/default/files/images/people/thomas_todd/thomas_todd.thumb.png&#34;</span><span class="p">,</span>
                                    <span class="nt">&#34;id&#34;</span><span class="p">:</span> <span class="mi">32769</span><span class="p">,</span>
                                    <span class="nt">&#34;mime&#34;</span><span class="p">:</span> <span class="s2">&#34;image/png&#34;</span>
                              <span class="p">},</span>
                              <span class="nt">&#34;length_of_service&#34;</span><span class="p">:</span> <span class="mi">6854</span><span class="p">,</span>
                              <span class="nt">&#34;view_count&#34;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
                              <span class="nt">&#34;identifier&#34;</span><span class="p">:</span> <span class="s2">&#34;thomas_todd&#34;</span><span class="p">,</span>
                              <span class="nt">&#34;roles&#34;</span><span class="p">:</span> <span class="p">[</span>
                                    <span class="p">{</span>
                                          <span class="nt">&#34;appointing_president&#34;</span><span class="p">:</span> <span class="s2">&#34;Thomas Jefferson&#34;</span><span class="p">,</span>
                                          <span class="nt">&#34;href&#34;</span><span class="p">:</span> <span class="s2">&#34;https://api.oyez.org/preson_role/scotus_justice/2683&#34;</span><span class="p">,</span>
                                          <span class="nt">&#34;role_title&#34;</span><span class="p">:</span> <span class="s2">&#34;Associate Justice of the Supreme Court of the United States&#34;</span><span class="p">,</span>
                                          <span class="nt">&#34;type&#34;</span><span class="p">:</span> <span class="s2">&#34;scotus_justice&#34;</span><span class="p">,</span>
                                          <span class="nt">&#34;date_end&#34;</span><span class="p">:</span> <span class="mi">-4540989600</span><span class="p">,</span>
                                          <span class="nt">&#34;id&#34;</span><span class="p">:</span> <span class="mi">2683</span><span class="p">,</span>
                                          <span class="nt">&#34;date_start&#34;</span><span class="p">:</span> <span class="mi">-5133175200</span><span class="p">,</span>
                                          <span class="nt">&#34;institution_name&#34;</span><span class="p">:</span> <span class="s2">&#34;Supreme Court of the United States&#34;</span>
                                    <span class="p">}</span>
                              <span class="p">],</span>
                              <span class="nt">&#34;name&#34;</span><span class="p">:</span> <span class="s2">&#34;Thomas Todd&#34;</span>
                        <span class="p">}</span>
                  <span class="p">],</span>
                  <span class="nt">&#34;court_start&#34;</span><span class="p">:</span> <span class="mi">-5133175200</span><span class="p">,</span>
                  <span class="nt">&#34;view_count&#34;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
                  <span class="nt">&#34;identifier&#34;</span><span class="p">:</span> <span class="s2">&#34;marshall6&#34;</span><span class="p">,</span>
                  <span class="nt">&#34;images&#34;</span><span class="p">:</span> <span class="p">[</span>
                        <span class="p">{</span>
                              <span class="nt">&#34;size&#34;</span><span class="p">:</span> <span class="mi">4355969</span><span class="p">,</span>
                              <span class="nt">&#34;href&#34;</span><span class="p">:</span> <span class="s2">&#34;https://api.oyez.org/sites/default/files/images/courts/marshall6.jpg&#34;</span><span class="p">,</span>
                              <span class="nt">&#34;id&#34;</span><span class="p">:</span> <span class="mi">78522</span><span class="p">,</span>
                              <span class="nt">&#34;mime&#34;</span><span class="p">:</span> <span class="s2">&#34;image/jpeg&#34;</span>
                        <span class="p">}</span>
                  <span class="p">],</span>
                  <span class="nt">&#34;name&#34;</span><span class="p">:</span> <span class="s2">&#34;Marshall Court (1807-1810)&#34;</span>
            <span class="p">}</span>
      <span class="p">],</span>
      <span class="nt">&#34;manner_of_jurisdiction&#34;</span><span class="p">:</span> <span class="s2">&#34;Writ of &lt;i&gt;certiorari&lt;/i&gt;&#34;</span><span class="p">,</span>
      <span class="nt">&#34;view_count&#34;</span><span class="p">:</span> <span class="mi">1793</span><span class="p">,</span>
      <span class="nt">&#34;lower_court&#34;</span><span class="p">:</span> <span class="kc">null</span><span class="p">,</span>
      <span class="nt">&#34;justia_url&#34;</span><span class="p">:</span> <span class="s2">&#34;https://supreme.justia.com/cases/federal/us/10/87/&#34;</span><span class="p">,</span>
      <span class="nt">&#34;docket_number&#34;</span><span class="p">:</span> <span class="s2">&#34;None&#34;</span><span class="p">,</span>
      <span class="nt">&#34;ID&#34;</span><span class="p">:</span> <span class="mi">62333</span><span class="p">,</span>
      <span class="nt">&#34;written_opinion&#34;</span><span class="p">:</span> <span class="p">[</span>
            <span class="p">{</span>
                  <span class="nt">&#34;author&#34;</span><span class="p">:</span> <span class="kc">null</span><span class="p">,</span>
                  <span class="nt">&#34;judge_full_name&#34;</span><span class="p">:</span> <span class="kc">null</span><span class="p">,</span>
                  <span class="nt">&#34;title&#34;</span><span class="p">:</span> <span class="s2">&#34;Syllabus&#34;</span><span class="p">,</span>
                  <span class="nt">&#34;id&#34;</span><span class="p">:</span> <span class="mi">16171</span><span class="p">,</span>
                  <span class="nt">&#34;href&#34;</span><span class="p">:</span> <span class="s2">&#34;https://api.oyez.org/case_document/written_opinion/16171&#34;</span><span class="p">,</span>
                  <span class="nt">&#34;justia_opinion_url&#34;</span><span class="p">:</span> <span class="s2">&#34;https://supreme.justia.com/cases/federal/us/10/87/&#34;</span><span class="p">,</span>
                  <span class="nt">&#34;judge_last_name&#34;</span><span class="p">:</span> <span class="kc">null</span><span class="p">,</span>
                  <span class="nt">&#34;justia_opinion_id&#34;</span><span class="p">:</span> <span class="mi">1907670</span><span class="p">,</span>
                  <span class="nt">&#34;type&#34;</span><span class="p">:</span> <span class="p">{</span>
                        <span class="nt">&#34;value&#34;</span><span class="p">:</span> <span class="s2">&#34;syllabus&#34;</span><span class="p">,</span>
                        <span class="nt">&#34;label&#34;</span><span class="p">:</span> <span class="s2">&#34;Syllabus&#34;</span>
                  <span class="p">}</span>
            <span class="p">},</span>
            <span class="p">{</span>
                  <span class="nt">&#34;author&#34;</span><span class="p">:</span> <span class="kc">null</span><span class="p">,</span>
                  <span class="nt">&#34;judge_full_name&#34;</span><span class="p">:</span> <span class="kc">null</span><span class="p">,</span>
                  <span class="nt">&#34;title&#34;</span><span class="p">:</span> <span class="s2">&#34;View Case&#34;</span><span class="p">,</span>
                  <span class="nt">&#34;id&#34;</span><span class="p">:</span> <span class="mi">16172</span><span class="p">,</span>
                  <span class="nt">&#34;href&#34;</span><span class="p">:</span> <span class="s2">&#34;https://api.oyez.org/case_document/written_opinion/16172&#34;</span><span class="p">,</span>
                  <span class="nt">&#34;justia_opinion_url&#34;</span><span class="p">:</span> <span class="s2">&#34;https://supreme.justia.com/cases/federal/us/10/87/case.html&#34;</span><span class="p">,</span>
                  <span class="nt">&#34;judge_last_name&#34;</span><span class="p">:</span> <span class="kc">null</span><span class="p">,</span>
                  <span class="nt">&#34;justia_opinion_id&#34;</span><span class="p">:</span> <span class="mi">1907671</span><span class="p">,</span>
                  <span class="nt">&#34;type&#34;</span><span class="p">:</span> <span class="p">{</span>
                        <span class="nt">&#34;value&#34;</span><span class="p">:</span> <span class="s2">&#34;case&#34;</span><span class="p">,</span>
                        <span class="nt">&#34;label&#34;</span><span class="p">:</span> <span class="kc">null</span>
                  <span class="p">}</span>
            <span class="p">}</span>
      <span class="p">],</span>
      <span class="nt">&#34;question&#34;</span><span class="p">:</span> <span class="s2">&#34;&lt;p&gt;Could the contract between Fletcher and Peck be invalidated by an act of the Georgia legislature?&lt;/p&gt;\n&#34;</span><span class="p">,</span>
      <span class="nt">&#34;citation&#34;</span><span class="p">:</span> <span class="p">{</span>
            <span class="nt">&#34;page&#34;</span><span class="p">:</span> <span class="s2">&#34;87&#34;</span><span class="p">,</span>
            <span class="nt">&#34;volume&#34;</span><span class="p">:</span> <span class="s2">&#34;10&#34;</span><span class="p">,</span>
            <span class="nt">&#34;year&#34;</span><span class="p">:</span> <span class="s2">&#34;1810&#34;</span><span class="p">,</span>
            <span class="nt">&#34;href&#34;</span><span class="p">:</span> <span class="s2">&#34;https://api.oyez.org/case_citation/case_citation/27135&#34;</span>
      <span class="p">},</span>
      <span class="nt">&#34;oral_argument_audio&#34;</span><span class="p">:</span> <span class="kc">null</span><span class="p">,</span>
      <span class="nt">&#34;decided_by&#34;</span><span class="p">:</span> <span class="p">{</span>
            <span class="nt">&#34;href&#34;</span><span class="p">:</span> <span class="s2">&#34;https://api.oyez.org/courts/marshall6&#34;</span><span class="p">,</span>
            <span class="nt">&#34;ID&#34;</span><span class="p">:</span> <span class="mi">15247</span><span class="p">,</span>
            <span class="nt">&#34;members&#34;</span><span class="p">:</span> <span class="p">[</span>
                  <span class="p">{</span>
                        <span class="nt">&#34;href&#34;</span><span class="p">:</span> <span class="s2">&#34;https://api.oyez.org/people/john_marshall&#34;</span><span class="p">,</span>
                        <span class="nt">&#34;ID&#34;</span><span class="p">:</span> <span class="mi">15085</span><span class="p">,</span>
                        <span class="nt">&#34;last_name&#34;</span><span class="p">:</span> <span class="s2">&#34;Marshall&#34;</span><span class="p">,</span>
                        <span class="nt">&#34;thumbnail&#34;</span><span class="p">:</span> <span class="p">{</span>
                              <span class="nt">&#34;size&#34;</span><span class="p">:</span> <span class="mi">53035</span><span class="p">,</span>
                              <span class="nt">&#34;href&#34;</span><span class="p">:</span> <span class="s2">&#34;https://api.oyez.org/sites/default/files/images/people/john_marshall/john_marshall.thumb.png&#34;</span><span class="p">,</span>
                              <span class="nt">&#34;id&#34;</span><span class="p">:</span> <span class="mi">32729</span><span class="p">,</span>
                              <span class="nt">&#34;mime&#34;</span><span class="p">:</span> <span class="s2">&#34;image/png&#34;</span>
                        <span class="p">},</span>
                        <span class="nt">&#34;length_of_service&#34;</span><span class="p">:</span> <span class="mi">12570</span><span class="p">,</span>
                        <span class="nt">&#34;view_count&#34;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
                        <span class="nt">&#34;identifier&#34;</span><span class="p">:</span> <span class="s2">&#34;john_marshall&#34;</span><span class="p">,</span>
                        <span class="nt">&#34;roles&#34;</span><span class="p">:</span> <span class="p">[</span>
                              <span class="p">{</span>
                                    <span class="nt">&#34;appointing_president&#34;</span><span class="p">:</span> <span class="s2">&#34;John Adams&#34;</span><span class="p">,</span>
                                    <span class="nt">&#34;href&#34;</span><span class="p">:</span> <span class="s2">&#34;https://api.oyez.org/preson_role/scotus_justice/2729&#34;</span><span class="p">,</span>
                                    <span class="nt">&#34;role_title&#34;</span><span class="p">:</span> <span class="s2">&#34;Chief Justice of the United States&#34;</span><span class="p">,</span>
                                    <span class="nt">&#34;type&#34;</span><span class="p">:</span> <span class="s2">&#34;scotus_justice&#34;</span><span class="p">,</span>
                                    <span class="nt">&#34;date_end&#34;</span><span class="p">:</span> <span class="mi">-4244119200</span><span class="p">,</span>
                                    <span class="nt">&#34;id&#34;</span><span class="p">:</span> <span class="mi">2729</span><span class="p">,</span>
                                    <span class="nt">&#34;date_start&#34;</span><span class="p">:</span> <span class="mi">-5330167200</span><span class="p">,</span>
                                    <span class="nt">&#34;institution_name&#34;</span><span class="p">:</span> <span class="s2">&#34;Supreme Court of the United States&#34;</span>
                              <span class="p">}</span>
                        <span class="p">],</span>
                        <span class="nt">&#34;name&#34;</span><span class="p">:</span> <span class="s2">&#34;John Marshall&#34;</span>
                  <span class="p">},</span>
                  <span class="p">{</span>
                        <span class="nt">&#34;href&#34;</span><span class="p">:</span> <span class="s2">&#34;https://api.oyez.org/people/william_cushing&#34;</span><span class="p">,</span>
                        <span class="nt">&#34;ID&#34;</span><span class="p">:</span> <span class="mi">15077</span><span class="p">,</span>
                        <span class="nt">&#34;last_name&#34;</span><span class="p">:</span> <span class="s2">&#34;Cushing&#34;</span><span class="p">,</span>
                        <span class="nt">&#34;thumbnail&#34;</span><span class="p">:</span> <span class="p">{</span>
                              <span class="nt">&#34;size&#34;</span><span class="p">:</span> <span class="mi">52796</span><span class="p">,</span>
                              <span class="nt">&#34;href&#34;</span><span class="p">:</span> <span class="s2">&#34;https://api.oyez.org/sites/default/files/images/people/william_cushing/william_cushing.thumb.png&#34;</span><span class="p">,</span>
                              <span class="nt">&#34;id&#34;</span><span class="p">:</span> <span class="mi">32776</span><span class="p">,</span>
                              <span class="nt">&#34;mime&#34;</span><span class="p">:</span> <span class="s2">&#34;image/png&#34;</span>
                        <span class="p">},</span>
                        <span class="nt">&#34;length_of_service&#34;</span><span class="p">:</span> <span class="mi">7527</span><span class="p">,</span>
                        <span class="nt">&#34;view_count&#34;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
                        <span class="nt">&#34;identifier&#34;</span><span class="p">:</span> <span class="s2">&#34;william_cushing&#34;</span><span class="p">,</span>
                        <span class="nt">&#34;roles&#34;</span><span class="p">:</span> <span class="p">[</span>
                              <span class="p">{</span>
                                    <span class="nt">&#34;appointing_president&#34;</span><span class="p">:</span> <span class="s2">&#34;George Washington&#34;</span><span class="p">,</span>
                                    <span class="nt">&#34;href&#34;</span><span class="p">:</span> <span class="s2">&#34;https://api.oyez.org/preson_role/scotus_justice/2721&#34;</span><span class="p">,</span>
                                    <span class="nt">&#34;role_title&#34;</span><span class="p">:</span> <span class="s2">&#34;Associate Justice of the Supreme Court of the United States&#34;</span><span class="p">,</span>
                                    <span class="nt">&#34;type&#34;</span><span class="p">:</span> <span class="s2">&#34;scotus_justice&#34;</span><span class="p">,</span>
                                    <span class="nt">&#34;date_end&#34;</span><span class="p">:</span> <span class="mi">-5027076000</span><span class="p">,</span>
                                    <span class="nt">&#34;id&#34;</span><span class="p">:</span> <span class="mi">2721</span><span class="p">,</span>
                                    <span class="nt">&#34;date_start&#34;</span><span class="p">:</span> <span class="mi">-5677408800</span><span class="p">,</span>
                                    <span class="nt">&#34;institution_name&#34;</span><span class="p">:</span> <span class="s2">&#34;Supreme Court of the United States&#34;</span>
                              <span class="p">}</span>
                        <span class="p">],</span>
                        <span class="nt">&#34;name&#34;</span><span class="p">:</span> <span class="s2">&#34;William Cushing&#34;</span>
                  <span class="p">},</span>
                  <span class="p">{</span>
                        <span class="nt">&#34;href&#34;</span><span class="p">:</span> <span class="s2">&#34;https://api.oyez.org/people/samuel_chase&#34;</span><span class="p">,</span>
                        <span class="nt">&#34;ID&#34;</span><span class="p">:</span> <span class="mi">15105</span><span class="p">,</span>
                        <span class="nt">&#34;last_name&#34;</span><span class="p">:</span> <span class="s2">&#34;Chase&#34;</span><span class="p">,</span>
                        <span class="nt">&#34;thumbnail&#34;</span><span class="p">:</span> <span class="p">{</span>
                              <span class="nt">&#34;size&#34;</span><span class="p">:</span> <span class="mi">52231</span><span class="p">,</span>
                              <span class="nt">&#34;href&#34;</span><span class="p">:</span> <span class="s2">&#34;https://api.oyez.org/sites/default/files/images/people/samuel_chase/samuel_chase.thumb.png&#34;</span><span class="p">,</span>
                              <span class="nt">&#34;id&#34;</span><span class="p">:</span> <span class="mi">32759</span><span class="p">,</span>
                              <span class="nt">&#34;mime&#34;</span><span class="p">:</span> <span class="s2">&#34;image/png&#34;</span>
                        <span class="p">},</span>
                        <span class="nt">&#34;length_of_service&#34;</span><span class="p">:</span> <span class="mi">5613</span><span class="p">,</span>
                        <span class="nt">&#34;view_count&#34;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
                        <span class="nt">&#34;identifier&#34;</span><span class="p">:</span> <span class="s2">&#34;samuel_chase&#34;</span><span class="p">,</span>
                        <span class="nt">&#34;roles&#34;</span><span class="p">:</span> <span class="p">[</span>
                              <span class="p">{</span>
                                    <span class="nt">&#34;appointing_president&#34;</span><span class="p">:</span> <span class="s2">&#34;George Washington&#34;</span><span class="p">,</span>
                                    <span class="nt">&#34;href&#34;</span><span class="p">:</span> <span class="s2">&#34;https://api.oyez.org/preson_role/scotus_justice/2749&#34;</span><span class="p">,</span>
                                    <span class="nt">&#34;role_title&#34;</span><span class="p">:</span> <span class="s2">&#34;Associate Justice of the Supreme Court of the United States&#34;</span><span class="p">,</span>
                                    <span class="nt">&#34;type&#34;</span><span class="p">:</span> <span class="s2">&#34;scotus_justice&#34;</span><span class="p">,</span>
                                    <span class="nt">&#34;date_end&#34;</span><span class="p">:</span> <span class="mi">-5002970400</span><span class="p">,</span>
                                    <span class="nt">&#34;id&#34;</span><span class="p">:</span> <span class="mi">2749</span><span class="p">,</span>
                                    <span class="nt">&#34;date_start&#34;</span><span class="p">:</span> <span class="mi">-5487933600</span><span class="p">,</span>
                                    <span class="nt">&#34;institution_name&#34;</span><span class="p">:</span> <span class="s2">&#34;Supreme Court of the United States&#34;</span>
                              <span class="p">}</span>
                        <span class="p">],</span>
                        <span class="nt">&#34;name&#34;</span><span class="p">:</span> <span class="s2">&#34;Samuel Chase&#34;</span>
                  <span class="p">},</span>
                  <span class="p">{</span>
                        <span class="nt">&#34;href&#34;</span><span class="p">:</span> <span class="s2">&#34;https://api.oyez.org/people/bushrod_washington&#34;</span><span class="p">,</span>
                        <span class="nt">&#34;ID&#34;</span><span class="p">:</span> <span class="mi">15093</span><span class="p">,</span>
                        <span class="nt">&#34;last_name&#34;</span><span class="p">:</span> <span class="s2">&#34;Washington&#34;</span><span class="p">,</span>
                        <span class="nt">&#34;thumbnail&#34;</span><span class="p">:</span> <span class="p">{</span>
                              <span class="nt">&#34;size&#34;</span><span class="p">:</span> <span class="mi">42759</span><span class="p">,</span>
                              <span class="nt">&#34;href&#34;</span><span class="p">:</span> <span class="s2">&#34;https://api.oyez.org/sites/default/files/images/people/bushrod_washington/bushrod_washington.thumb.png&#34;</span><span class="p">,</span>
                              <span class="nt">&#34;id&#34;</span><span class="p">:</span> <span class="mi">32698</span><span class="p">,</span>
                              <span class="nt">&#34;mime&#34;</span><span class="p">:</span> <span class="s2">&#34;image/png&#34;</span>
                        <span class="p">},</span>
                        <span class="nt">&#34;length_of_service&#34;</span><span class="p">:</span> <span class="mi">11339</span><span class="p">,</span>
                        <span class="nt">&#34;view_count&#34;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
                        <span class="nt">&#34;identifier&#34;</span><span class="p">:</span> <span class="s2">&#34;bushrod_washington&#34;</span><span class="p">,</span>
                        <span class="nt">&#34;roles&#34;</span><span class="p">:</span> <span class="p">[</span>
                              <span class="p">{</span>
                                    <span class="nt">&#34;appointing_president&#34;</span><span class="p">:</span> <span class="s2">&#34;John Adams&#34;</span><span class="p">,</span>
                                    <span class="nt">&#34;href&#34;</span><span class="p">:</span> <span class="s2">&#34;https://api.oyez.org/preson_role/scotus_justice/2737&#34;</span><span class="p">,</span>
                                    <span class="nt">&#34;role_title&#34;</span><span class="p">:</span> <span class="s2">&#34;Associate Justice of the Supreme Court of the United States&#34;</span><span class="p">,</span>
                                    <span class="nt">&#34;type&#34;</span><span class="p">:</span> <span class="s2">&#34;scotus_justice&#34;</span><span class="p">,</span>
                                    <span class="nt">&#34;date_end&#34;</span><span class="p">:</span> <span class="mi">-4421066400</span><span class="p">,</span>
                                    <span class="nt">&#34;id&#34;</span><span class="p">:</span> <span class="mi">2737</span><span class="p">,</span>
                                    <span class="nt">&#34;date_start&#34;</span><span class="p">:</span> <span class="mi">-5400756000</span><span class="p">,</span>
                                    <span class="nt">&#34;institution_name&#34;</span><span class="p">:</span> <span class="s2">&#34;Supreme Court of the United States&#34;</span>
                              <span class="p">}</span>
                        <span class="p">],</span>
                        <span class="nt">&#34;name&#34;</span><span class="p">:</span> <span class="s2">&#34;Bushrod Washington&#34;</span>
                  <span class="p">},</span>
                  <span class="p">{</span>
                        <span class="nt">&#34;href&#34;</span><span class="p">:</span> <span class="s2">&#34;https://api.oyez.org/people/william_johnson&#34;</span><span class="p">,</span>
                        <span class="nt">&#34;ID&#34;</span><span class="p">:</span> <span class="mi">15059</span><span class="p">,</span>
                        <span class="nt">&#34;last_name&#34;</span><span class="p">:</span> <span class="s2">&#34;Johnson&#34;</span><span class="p">,</span>
                        <span class="nt">&#34;thumbnail&#34;</span><span class="p">:</span> <span class="p">{</span>
                              <span class="nt">&#34;size&#34;</span><span class="p">:</span> <span class="mi">45940</span><span class="p">,</span>
                              <span class="nt">&#34;href&#34;</span><span class="p">:</span> <span class="s2">&#34;https://api.oyez.org/sites/default/files/images/people/william_johnson/william_johnson.thumb.png&#34;</span><span class="p">,</span>
                              <span class="nt">&#34;id&#34;</span><span class="p">:</span> <span class="mi">32779</span><span class="p">,</span>
                              <span class="nt">&#34;mime&#34;</span><span class="p">:</span> <span class="s2">&#34;image/png&#34;</span>
                        <span class="p">},</span>
                        <span class="nt">&#34;length_of_service&#34;</span><span class="p">:</span> <span class="mi">11046</span><span class="p">,</span>
                        <span class="nt">&#34;view_count&#34;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
                        <span class="nt">&#34;identifier&#34;</span><span class="p">:</span> <span class="s2">&#34;william_johnson&#34;</span><span class="p">,</span>
                        <span class="nt">&#34;roles&#34;</span><span class="p">:</span> <span class="p">[</span>
                              <span class="p">{</span>
                                    <span class="nt">&#34;appointing_president&#34;</span><span class="p">:</span> <span class="s2">&#34;Thomas Jefferson&#34;</span><span class="p">,</span>
                                    <span class="nt">&#34;href&#34;</span><span class="p">:</span> <span class="s2">&#34;https://api.oyez.org/preson_role/scotus_justice/2703&#34;</span><span class="p">,</span>
                                    <span class="nt">&#34;role_title&#34;</span><span class="p">:</span> <span class="s2">&#34;Associate Justice of the Supreme Court of the United States&#34;</span><span class="p">,</span>
                                    <span class="nt">&#34;type&#34;</span><span class="p">:</span> <span class="s2">&#34;scotus_justice&#34;</span><span class="p">,</span>
                                    <span class="nt">&#34;date_end&#34;</span><span class="p">:</span> <span class="mi">-4273149600</span><span class="p">,</span>
                                    <span class="nt">&#34;id&#34;</span><span class="p">:</span> <span class="mi">2703</span><span class="p">,</span>
                                    <span class="nt">&#34;date_start&#34;</span><span class="p">:</span> <span class="mi">-5227524000</span><span class="p">,</span>
                                    <span class="nt">&#34;institution_name&#34;</span><span class="p">:</span> <span class="s2">&#34;Supreme Court of the United States&#34;</span>
                              <span class="p">}</span>
                        <span class="p">],</span>
                        <span class="nt">&#34;name&#34;</span><span class="p">:</span> <span class="s2">&#34;William Johnson&#34;</span>
                  <span class="p">},</span>
                  <span class="p">{</span>
                        <span class="nt">&#34;href&#34;</span><span class="p">:</span> <span class="s2">&#34;https://api.oyez.org/people/brockholst_livingston&#34;</span><span class="p">,</span>
                        <span class="nt">&#34;ID&#34;</span><span class="p">:</span> <span class="mi">15111</span><span class="p">,</span>
                        <span class="nt">&#34;last_name&#34;</span><span class="p">:</span> <span class="s2">&#34;Livingston&#34;</span><span class="p">,</span>
                        <span class="nt">&#34;thumbnail&#34;</span><span class="p">:</span> <span class="p">{</span>
                              <span class="nt">&#34;size&#34;</span><span class="p">:</span> <span class="mi">44786</span><span class="p">,</span>
                              <span class="nt">&#34;href&#34;</span><span class="p">:</span> <span class="s2">&#34;https://api.oyez.org/sites/default/files/images/people/brockholst_livingston/brockholst_livingston.thumb.png&#34;</span><span class="p">,</span>
                              <span class="nt">&#34;id&#34;</span><span class="p">:</span> <span class="mi">32714</span><span class="p">,</span>
                              <span class="nt">&#34;mime&#34;</span><span class="p">:</span> <span class="s2">&#34;image/png&#34;</span>
                        <span class="p">},</span>
                        <span class="nt">&#34;length_of_service&#34;</span><span class="p">:</span> <span class="mi">5901</span><span class="p">,</span>
                        <span class="nt">&#34;view_count&#34;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
                        <span class="nt">&#34;identifier&#34;</span><span class="p">:</span> <span class="s2">&#34;brockholst_livingston&#34;</span><span class="p">,</span>
                        <span class="nt">&#34;roles&#34;</span><span class="p">:</span> <span class="p">[</span>
                              <span class="p">{</span>
                                    <span class="nt">&#34;appointing_president&#34;</span><span class="p">:</span> <span class="s2">&#34;Thomas Jefferson&#34;</span><span class="p">,</span>
                                    <span class="nt">&#34;href&#34;</span><span class="p">:</span> <span class="s2">&#34;https://api.oyez.org/preson_role/scotus_justice/2755&#34;</span><span class="p">,</span>
                                    <span class="nt">&#34;role_title&#34;</span><span class="p">:</span> <span class="s2">&#34;Associate Justice of the Supreme Court of the United States&#34;</span><span class="p">,</span>
                                    <span class="nt">&#34;type&#34;</span><span class="p">:</span> <span class="s2">&#34;scotus_justice&#34;</span><span class="p">,</span>
                                    <span class="nt">&#34;date_end&#34;</span><span class="p">:</span> <span class="mi">-4632314400</span><span class="p">,</span>
                                    <span class="nt">&#34;id&#34;</span><span class="p">:</span> <span class="mi">2755</span><span class="p">,</span>
                                    <span class="nt">&#34;date_start&#34;</span><span class="p">:</span> <span class="mi">-5142160800</span><span class="p">,</span>
                                    <span class="nt">&#34;institution_name&#34;</span><span class="p">:</span> <span class="s2">&#34;Supreme Court of the United States&#34;</span>
                              <span class="p">}</span>
                        <span class="p">],</span>
                        <span class="nt">&#34;name&#34;</span><span class="p">:</span> <span class="s2">&#34;Henry Brockholst Livingston&#34;</span>
                  <span class="p">},</span>
                  <span class="p">{</span>
                        <span class="nt">&#34;href&#34;</span><span class="p">:</span> <span class="s2">&#34;https://api.oyez.org/people/thomas_todd&#34;</span><span class="p">,</span>
                        <span class="nt">&#34;ID&#34;</span><span class="p">:</span> <span class="mi">15039</span><span class="p">,</span>
                        <span class="nt">&#34;last_name&#34;</span><span class="p">:</span> <span class="s2">&#34;Todd&#34;</span><span class="p">,</span>
                        <span class="nt">&#34;thumbnail&#34;</span><span class="p">:</span> <span class="p">{</span>
                              <span class="nt">&#34;size&#34;</span><span class="p">:</span> <span class="mi">41113</span><span class="p">,</span>
                              <span class="nt">&#34;href&#34;</span><span class="p">:</span> <span class="s2">&#34;https://api.oyez.org/sites/default/files/images/people/thomas_todd/thomas_todd.thumb.png&#34;</span><span class="p">,</span>
                              <span class="nt">&#34;id&#34;</span><span class="p">:</span> <span class="mi">32769</span><span class="p">,</span>
                              <span class="nt">&#34;mime&#34;</span><span class="p">:</span> <span class="s2">&#34;image/png&#34;</span>
                        <span class="p">},</span>
                        <span class="nt">&#34;length_of_service&#34;</span><span class="p">:</span> <span class="mi">6854</span><span class="p">,</span>
                        <span class="nt">&#34;view_count&#34;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
                        <span class="nt">&#34;identifier&#34;</span><span class="p">:</span> <span class="s2">&#34;thomas_todd&#34;</span><span class="p">,</span>
                        <span class="nt">&#34;roles&#34;</span><span class="p">:</span> <span class="p">[</span>
                              <span class="p">{</span>
                                    <span class="nt">&#34;appointing_president&#34;</span><span class="p">:</span> <span class="s2">&#34;Thomas Jefferson&#34;</span><span class="p">,</span>
                                    <span class="nt">&#34;href&#34;</span><span class="p">:</span> <span class="s2">&#34;https://api.oyez.org/preson_role/scotus_justice/2683&#34;</span><span class="p">,</span>
                                    <span class="nt">&#34;role_title&#34;</span><span class="p">:</span> <span class="s2">&#34;Associate Justice of the Supreme Court of the United States&#34;</span><span class="p">,</span>
                                    <span class="nt">&#34;type&#34;</span><span class="p">:</span> <span class="s2">&#34;scotus_justice&#34;</span><span class="p">,</span>
                                    <span class="nt">&#34;date_end&#34;</span><span class="p">:</span> <span class="mi">-4540989600</span><span class="p">,</span>
                                    <span class="nt">&#34;id&#34;</span><span class="p">:</span> <span class="mi">2683</span><span class="p">,</span>
                                    <span class="nt">&#34;date_start&#34;</span><span class="p">:</span> <span class="mi">-5133175200</span><span class="p">,</span>
                                    <span class="nt">&#34;institution_name&#34;</span><span class="p">:</span> <span class="s2">&#34;Supreme Court of the United States&#34;</span>
                              <span class="p">}</span>
                        <span class="p">],</span>
                        <span class="nt">&#34;name&#34;</span><span class="p">:</span> <span class="s2">&#34;Thomas Todd&#34;</span>
                  <span class="p">}</span>
            <span class="p">],</span>
            <span class="nt">&#34;court_start&#34;</span><span class="p">:</span> <span class="mi">-5133175200</span><span class="p">,</span>
            <span class="nt">&#34;view_count&#34;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
            <span class="nt">&#34;identifier&#34;</span><span class="p">:</span> <span class="s2">&#34;marshall6&#34;</span><span class="p">,</span>
            <span class="nt">&#34;images&#34;</span><span class="p">:</span> <span class="p">[</span>
                  <span class="p">{</span>
                        <span class="nt">&#34;size&#34;</span><span class="p">:</span> <span class="mi">4355969</span><span class="p">,</span>
                        <span class="nt">&#34;href&#34;</span><span class="p">:</span> <span class="s2">&#34;https://api.oyez.org/sites/default/files/images/courts/marshall6.jpg&#34;</span><span class="p">,</span>
                        <span class="nt">&#34;id&#34;</span><span class="p">:</span> <span class="mi">78522</span><span class="p">,</span>
                        <span class="nt">&#34;mime&#34;</span><span class="p">:</span> <span class="s2">&#34;image/jpeg&#34;</span>
                  <span class="p">}</span>
            <span class="p">],</span>
            <span class="nt">&#34;name&#34;</span><span class="p">:</span> <span class="s2">&#34;Marshall Court (1807-1810)&#34;</span>
      <span class="p">},</span>
      <span class="nt">&#34;location&#34;</span><span class="p">:</span> <span class="kc">null</span><span class="p">,</span>
      <span class="nt">&#34;name&#34;</span><span class="p">:</span> <span class="s2">&#34;Fletcher v. Peck&#34;</span><span class="p">,</span>
      <span class="nt">&#34;term&#34;</span><span class="p">:</span> <span class="s2">&#34;1789-1850&#34;</span><span class="p">,</span>
      <span class="nt">&#34;additional_docket_numbers&#34;</span><span class="p">:</span> <span class="kc">null</span><span class="p">,</span>
      <span class="nt">&#34;loc_id&#34;</span><span class="p">:</span> <span class="s2">&#34;http://www.loc.gov/item/usrep010087/&#34;</span><span class="p">,</span>
      <span class="nt">&#34;loc_url&#34;</span><span class="p">:</span> <span class="s2">&#34;http://www.loc.gov/item/usrep010087/&#34;</span><span class="p">,</span>
      <span class="nt">&#34;simple_citation&#34;</span><span class="p">:</span> <span class="s2">&#34;usrep010087&#34;</span><span class="p">,</span>
      <span class="nt">&#34;shelf_id&#34;</span><span class="p">:</span> <span class="s2">&#34;series: Volume 10 Call Number: KF101 Series: Contracts Law&#34;</span><span class="p">,</span>
      <span class="nt">&#34;title&#34;</span><span class="p">:</span> <span class="s2">&#34;U.S. Reports: Fletcher v. Peck, 10 U.S. (6 Cranch) 87 (1810).&#34;</span><span class="p">,</span>
      <span class="nt">&#34;issues&#34;</span><span class="p">:</span> <span class="p">[</span>
            <span class="p">{</span>
                  <span class="nt">&#34;issue&#34;</span><span class="p">:</span> <span class="s2">&#34;supreme court&#34;</span>
            <span class="p">},</span>
            <span class="p">{</span>
                  <span class="nt">&#34;issue&#34;</span><span class="p">:</span> <span class="s2">&#34;united states&#34;</span>
            <span class="p">},</span>
            <span class="p">{</span>
                  <span class="nt">&#34;issue&#34;</span><span class="p">:</span> <span class="s2">&#34;court opinions&#34;</span>
            <span class="p">},</span>
            <span class="p">{</span>
                  <span class="nt">&#34;issue&#34;</span><span class="p">:</span> <span class="s2">&#34;periodical&#34;</span>
            <span class="p">},</span>
            <span class="p">{</span>
                  <span class="nt">&#34;issue&#34;</span><span class="p">:</span> <span class="s2">&#34;land titles&#34;</span>
            <span class="p">},</span>
            <span class="p">{</span>
                  <span class="nt">&#34;issue&#34;</span><span class="p">:</span> <span class="s2">&#34;contracts law&#34;</span>
            <span class="p">},</span>
            <span class="p">{</span>
                  <span class="nt">&#34;issue&#34;</span><span class="p">:</span> <span class="s2">&#34;court cases&#34;</span>
            <span class="p">},</span>
            <span class="p">{</span>
                  <span class="nt">&#34;issue&#34;</span><span class="p">:</span> <span class="s2">&#34;judicial decisions&#34;</span>
            <span class="p">},</span>
            <span class="p">{</span>
                  <span class="nt">&#34;issue&#34;</span><span class="p">:</span> <span class="s2">&#34;equity&#34;</span>
            <span class="p">},</span>
            <span class="p">{</span>
                  <span class="nt">&#34;issue&#34;</span><span class="p">:</span> <span class="s2">&#34;law library&#34;</span>
            <span class="p">},</span>
            <span class="p">{</span>
                  <span class="nt">&#34;issue&#34;</span><span class="p">:</span> <span class="s2">&#34;public lands&#34;</span>
            <span class="p">},</span>
            <span class="p">{</span>
                  <span class="nt">&#34;issue&#34;</span><span class="p">:</span> <span class="s2">&#34;judicial review and appeals&#34;</span>
            <span class="p">},</span>
            <span class="p">{</span>
                  <span class="nt">&#34;issue&#34;</span><span class="p">:</span> <span class="s2">&#34;contracts&#34;</span>
            <span class="p">},</span>
            <span class="p">{</span>
                  <span class="nt">&#34;issue&#34;</span><span class="p">:</span> <span class="s2">&#34;government documents&#34;</span>
            <span class="p">},</span>
            <span class="p">{</span>
                  <span class="nt">&#34;issue&#34;</span><span class="p">:</span> <span class="s2">&#34;bills and resolutions&#34;</span>
            <span class="p">},</span>
            <span class="p">{</span>
                  <span class="nt">&#34;issue&#34;</span><span class="p">:</span> <span class="s2">&#34;law&#34;</span>
            <span class="p">},</span>
            <span class="p">{</span>
                  <span class="nt">&#34;issue&#34;</span><span class="p">:</span> <span class="s2">&#34;common law&#34;</span>
            <span class="p">},</span>
            <span class="p">{</span>
                  <span class="nt">&#34;issue&#34;</span><span class="p">:</span> <span class="s2">&#34;property rights&#34;</span>
            <span class="p">},</span>
            <span class="p">{</span>
                  <span class="nt">&#34;issue&#34;</span><span class="p">:</span> <span class="s2">&#34;court decisions&#34;</span>
            <span class="p">},</span>
            <span class="p">{</span>
                  <span class="nt">&#34;issue&#34;</span><span class="p">:</span> <span class="s2">&#34;u.s. reports&#34;</span>
            <span class="p">},</span>
            <span class="p">{</span>
                  <span class="nt">&#34;issue&#34;</span><span class="p">:</span> <span class="s2">&#34;legislative powers&#34;</span>
            <span class="p">},</span>
            <span class="p">{</span>
                  <span class="nt">&#34;issue&#34;</span><span class="p">:</span> <span class="s2">&#34;real estate&#34;</span>
            <span class="p">},</span>
            <span class="p">{</span>
                  <span class="nt">&#34;issue&#34;</span><span class="p">:</span> <span class="s2">&#34;property&#34;</span>
            <span class="p">}</span>
      <span class="p">],</span>
      <span class="nt">&#34;major_topics&#34;</span><span class="p">:</span> <span class="p">[</span>
            <span class="p">{</span>
                  <span class="nt">&#34;major_topic&#34;</span><span class="p">:</span> <span class="s2">&#34;contracts law&#34;</span>
            <span class="p">}</span>
      <span class="p">],</span>
      <span class="nt">&#34;loc_pdf&#34;</span><span class="p">:</span> <span class="s2">&#34;https://tile.loc.gov/storage-services/service/ll/usrep/usrep010/usrep010087/usrep010087.pdf&#34;</span>
<span class="p">}</span>
</code></pre></div>]]></content>
			<postid> 8a7f426a22b4ef47a37750941b78570c</postid>
			<author>Justin Napolitano</author>
			<author_name>Justin Napolitano</author_name>
			<author_email>personal.jnapolitano@gmail.com</author_email>
			<author_id>87654367b2fca109e7dc9d3ea8a1ebbaf0bfe374773b148c2c20d278479add99</author_id>			
		</item>
		
		<item>
			<title>Legal Research with AI Part 7: Wrangling Data with Julia</title>
			<link>jnapolitano.com/posts/legal-research-part-7/</link>
			<pubDate>Sun, 22 May 2022 16:30:32 +0000</pubDate>
			<guid>jnapolitano.com/posts/legal-research-part-7/</guid>
			<description><![CDATA[File management with Julia in preperation for data merge.]]></description>
			<content type="html"><![CDATA[<h2 id="intro">Intro</h2>
<p>In a <a href="https://blog.jnapolitano.io/posts/legal-research-part-5/">previous post</a>, I seperated all of the results returned from the Library of Congress API into individual JSON documents to be imported as nodes into a neo4j graph.</p>
<p>In this post, I filter the <code>LOC</code> data against another data set from Oyez that will be integrated in the next post.</p>
<h2 id="filtering-data">Filtering Data</h2>
<p>Both data sets have been seperated into individual case nodes stored in the json format as a file with the format : <!-- raw HTML omitted -->.json.</p>
<p>The Library of Congress data contains indices, admonitions, briefs, and other data that I will not yet be incorporating into my data set.</p>
<p>In order to find only the case data I will be creating a dataframe containing the paths of json files with matching citations.</p>
<h2 id="using-julia-instead-of-python">Using Julia Instead of Python</h2>
<p>I love Python, but I want to try something new.  Julia&rsquo;s <a href="https://docs.julialang.org/en/v1/manual/methods/">multiple dispatch</a> design tempted me to try it out.  This is my first Julia program.  I will be documenting the work more so than usual.</p>
<h3 id="julia-import-functions">Julia &ldquo;import&rdquo; Functions</h3>
<p>Coming from Python, I typically import libraries/packages with an <code>import</code> call.  Something like:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python">
<span class="kn">import</span> <span class="nn">numpy</span>

</code></pre></div><p>In Julia, we use the <code>using</code> call to import the package. Like:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-julia" data-lang="julia">
<span class="k">using</span> <span class="n">DataFrames</span>
<span class="k">using</span> <span class="n">CSV</span>

</code></pre></div><p>A package can also be imported, but this does not instantiate the methods and functions within it (As far as I understand it).</p>
<p>For instance <code>import CSV</code> would only load the package but I would have to call CSV.method to actually do something.  Something like <code>from pandas import to_csv</code> in Python.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-julia" data-lang="julia">
<span class="k">import</span> <span class="n">DataFrames</span>
<span class="k">import</span> <span class="n">CSV</span>

</code></pre></div><h2 id="the-main-function">The Main Function</h2>
<p>Just like in C -and like we should in Python-, I declared a main function to run the program.  I call it with main().  I do not know if there is a similar convention to Python&rsquo;s <code>if __name__ == &quot;__main__&quot;</code>.  I will find out soon.</p>
<p>The main difference in function declaration between Python and Julia is the inclusion of the <code>end</code> keyword and the end of the function.</p>
<p>For instance review the main function below :</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-julia" data-lang="julia"><span class="k">function</span> <span class="n">main</span><span class="p">()</span>
    
    <span class="c"># outpath fo the current file</span>
    <span class="n">outpath</span> <span class="o">=</span> <span class="n">joinpath</span><span class="p">(</span><span class="n">pwd</span><span class="p">(),</span><span class="s">&#34;case_files.csv&#34;</span><span class="p">)</span>

    <span class="c">#Glob files from directory</span>
    <span class="n">oyez_dataframe</span> <span class="o">=</span> <span class="n">get_files</span><span class="p">(</span><span class="s">&#34;oyez_cited&#34;</span><span class="p">)</span>
    
    <span class="c">#Glob files from directory</span>
    <span class="n">loc_dataframe</span> <span class="o">=</span> <span class="n">get_files</span><span class="p">(</span><span class="s">&#34;loc_cited&#34;</span><span class="p">)</span>

    
    <span class="c"># Join on File excluding extraneous data not in the oyez dataset</span>
    <span class="n">master_df</span> <span class="o">=</span> <span class="n">innerjoin</span><span class="p">(</span><span class="n">oyez_dataframe</span><span class="p">,</span> <span class="n">loc_dataframe</span><span class="p">,</span> <span class="n">on</span> <span class="o">=</span> <span class="ss">:File</span><span class="p">,</span> <span class="n">validate</span><span class="o">=</span><span class="p">(</span><span class="nb">true</span><span class="p">,</span> <span class="nb">true</span><span class="p">),</span> <span class="n">makeunique</span> <span class="o">=</span> <span class="nb">true</span><span class="p">)</span>

    <span class="c">#Select every file but the .DS_Store from the dataframe.  </span>
    <span class="n">master_df</span> <span class="o">=</span> <span class="n">filter</span><span class="p">(</span><span class="n">row</span> <span class="o">-&gt;</span> <span class="o">!</span><span class="p">(</span><span class="n">row</span><span class="o">.</span><span class="n">File</span> <span class="o">==</span> <span class="s">&#34;.DS_Store&#34;</span><span class="p">),</span> <span class="n">master_df</span><span class="p">)</span>

    <span class="c">#Write to file</span>
    <span class="n">outpath</span> <span class="o">=</span> <span class="n">df_to_file</span><span class="p">(</span><span class="n">master_df</span><span class="p">,</span><span class="n">outpath</span><span class="p">)</span>
    

<span class="k">end</span>

<span class="n">main</span><span class="p">()</span>


</code></pre></div><h3 id="creating-an-outpath">Creating an outpath</h3>
<p>The main function creates an outpath to write the resultant master df to file by calling <code>joinpath(pwd(), &quot;case_files.csv&quot;)</code>.</p>
<h3 id="the-get-files-function">The Get Files Function</h3>
<p>Next, the get_files function is called to create two data frames:  the loc_df and the oyez_df.</p>
<h4 id="declaring-empty-string-arrays">Declaring empty string arrays</h4>
<p>Each file name is appended to a file_name array declared with <code>&lt;array_name&gt; = String[]</code></p>
<h4 id="reading-files-with-readdir">Reading Files with readdir()</h4>
<p>File names are from from a directory passed to the built in <code>readdir()</code> function.</p>
<h4 id="appending-files-to-file_name-array">Appending Files to file_name Array</h4>
<p>Each file name is appended to a file_name array declared with <code>file_name = String[]</code> and appended to with the push!(file_name,f) call.  Note the <code>!</code> following push.  This typically means that the function is operating on the data in memory and will not return a new value.</p>
<h4 id="appending-file-paths-to-file_path-array">Appending File Paths to file_path Array</h4>
<p>I also include the file path by appending what is returned by <code>path = joinpath(working_path, f)</code> to the file_path list.</p>
<p>I love the built in <code>joinpath</code> function.  Pythons <code>os.sep.join()</code> works well, but I really like Julia&rsquo;s implementation.</p>
<h4 id="sorting-the-arrays-with-merge-sort">Sorting the Arrays with Merge Sort</h4>
<p>Arrays are soreted by call <code>sort_array(&lt;array&gt;)</code>.  It returns a sorted array using the merge sort alogorithm.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-julia" data-lang="julia"><span class="k">function</span> <span class="n">sort_array</span><span class="p">(</span><span class="n">array</span><span class="p">)</span>
    
    <span class="k">return</span> <span class="n">sort</span><span class="p">(</span><span class="n">array</span><span class="p">;</span> <span class="n">alg</span><span class="o">=</span><span class="nb">MergeSort</span><span class="p">)</span>

<span class="k">end</span>
</code></pre></div><h4 id="crating-a-dataframe-with-the-arrays">Crating a Dataframe with the Arrays</h4>
<p>Finally a dataframe containing the sorted file_name and file_path lists as the columns file and path is created and then returned.</p>
<h4 id="a-note-on-refactoring">A note on refactoring</h4>
<p>This function should be refactored into seperate ones, but it works well enough with this workflow that I am going to leave it.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-julia" data-lang="julia"><span class="k">function</span> <span class="n">get_files</span><span class="p">(</span><span class="n">directory</span><span class="p">)</span>
    <span class="n">file_name</span> <span class="o">=</span> <span class="kt">String</span><span class="p">[]</span>
    <span class="n">file_path</span> <span class="o">=</span> <span class="kt">String</span><span class="p">[]</span>

    <span class="n">working_path</span> <span class="o">=</span> <span class="n">joinpath</span><span class="p">(</span><span class="n">pwd</span><span class="p">(),</span> <span class="n">directory</span><span class="p">)</span>
    <span class="c"># context management.  Cd and then go back to the orignal pwd</span>
    <span class="n">cd</span><span class="p">(</span><span class="n">working_path</span><span class="p">)</span> <span class="k">do</span> 
        <span class="c">#print(&#34;Current directory: &#34;, working_path)</span>
        <span class="n">foreach</span><span class="p">(</span><span class="n">readdir</span><span class="p">())</span> <span class="k">do</span> <span class="n">f</span>
            <span class="n">path</span> <span class="o">=</span> <span class="n">joinpath</span><span class="p">(</span><span class="n">working_path</span><span class="p">,</span> <span class="n">f</span><span class="p">)</span>
            <span class="n">push!</span><span class="p">(</span><span class="n">file_name</span><span class="p">,</span><span class="n">f</span><span class="p">)</span>
            <span class="n">push!</span><span class="p">(</span><span class="n">file_path</span><span class="p">,</span> <span class="n">path</span><span class="p">)</span>
            <span class="c">#dump(stat(f.desc)) # you can customize what you want to print</span>
        <span class="k">end</span>
    <span class="k">end</span>
    <span class="c">#println(&#39;\n&#39;, pwd())</span>
    <span class="c">#display(file_paths)</span>
    <span class="n">file_name</span> <span class="o">=</span> <span class="n">sort_array</span><span class="p">(</span><span class="n">file_name</span><span class="p">)</span>
    <span class="n">file_path</span> <span class="o">=</span> <span class="n">sort_array</span><span class="p">(</span><span class="n">file_path</span><span class="p">)</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">DataFrame</span><span class="p">(</span><span class="n">File</span> <span class="o">=</span> <span class="n">file_name</span><span class="p">,</span> <span class="n">Path</span> <span class="o">=</span> <span class="n">file_path</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">df</span>

<span class="k">end</span>


</code></pre></div><h3 id="joining-data-frames-by-citation">Joining Data Frames by Citation</h3>
<p>Julia&rsquo;s DataFrames package can easily join dataframes on a column.  In this workflow the file which is titled after a case citation is used.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-julia" data-lang="julia"><span class="c"># Join on File excluding extraneous data not in the oyez dataset</span>
<span class="n">master_df</span> <span class="o">=</span> <span class="n">innerjoin</span><span class="p">(</span><span class="n">oyez_dataframe</span><span class="p">,</span> <span class="n">loc_dataframe</span><span class="p">,</span> <span class="n">on</span> <span class="o">=</span> <span class="ss">:File</span><span class="p">,</span> <span class="n">validate</span><span class="o">=</span><span class="p">(</span><span class="nb">true</span><span class="p">,</span> <span class="nb">true</span><span class="p">),</span> <span class="n">makeunique</span> <span class="o">=</span> <span class="nb">true</span><span class="p">)</span>

</code></pre></div><h3 id="filtering-the-df-for-extraneous-files">Filtering the DF for Extraneous Files</h3>
<p>The master_df  is filtered to remove <code>.DS_Store</code> from the list of files to be processed.  Below notice the <code>!</code> in this case it will return all a data frame of values that are not equal to .DS_Store in the File column.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-julia" data-lang="julia"><span class="c">#Select every file but the .DS_Store from the dataframe.  </span>
<span class="n">master_df</span> <span class="o">=</span> <span class="n">filter</span><span class="p">(</span><span class="n">row</span> <span class="o">-&gt;</span> <span class="o">!</span><span class="p">(</span><span class="n">row</span><span class="o">.</span><span class="n">File</span> <span class="o">==</span> <span class="s">&#34;.DS_Store&#34;</span><span class="p">),</span> <span class="n">master_df</span><span class="p">)</span>
</code></pre></div><h3 id="the-df_to_file-function">The df_to_file Function</h3>
<p>Finally the df is written to file.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-julia" data-lang="julia"><span class="c">#Write to file</span>
<span class="n">outpath</span> <span class="o">=</span> <span class="n">df_to_file</span><span class="p">(</span><span class="n">master_df</span><span class="p">,</span><span class="n">outpath</span><span class="p">)</span>


<span class="k">function</span> <span class="n">df_to_file</span><span class="p">(</span><span class="n">df</span><span class="p">,</span><span class="n">outpath</span><span class="p">)</span>
    <span class="n">CSV</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">outpath</span><span class="p">,</span> <span class="n">df</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">outpath</span>

<span class="k">end</span>

</code></pre></div><h2 id="the-complete-program">The Complete Program</h2>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-julia" data-lang="julia"><span class="k">using</span> <span class="n">DataFrames</span>
<span class="k">using</span> <span class="n">CSV</span>

<span class="k">function</span> <span class="n">get_files</span><span class="p">(</span><span class="n">directory</span><span class="p">)</span>
    <span class="n">file_name</span> <span class="o">=</span> <span class="kt">String</span><span class="p">[]</span>
    <span class="n">file_path</span> <span class="o">=</span> <span class="kt">String</span><span class="p">[]</span>

    <span class="n">working_path</span> <span class="o">=</span> <span class="n">joinpath</span><span class="p">(</span><span class="n">pwd</span><span class="p">(),</span> <span class="n">directory</span><span class="p">)</span>
    <span class="c"># context management.  Cd and then go back to the orignal pwd</span>
    <span class="n">cd</span><span class="p">(</span><span class="n">working_path</span><span class="p">)</span> <span class="k">do</span> 
        <span class="c">#print(&#34;Current directory: &#34;, working_path)</span>
        <span class="n">foreach</span><span class="p">(</span><span class="n">readdir</span><span class="p">())</span> <span class="k">do</span> <span class="n">f</span>
            <span class="n">path</span> <span class="o">=</span> <span class="n">joinpath</span><span class="p">(</span><span class="n">working_path</span><span class="p">,</span> <span class="n">f</span><span class="p">)</span>
            <span class="n">push!</span><span class="p">(</span><span class="n">file_name</span><span class="p">,</span><span class="n">f</span><span class="p">)</span>
            <span class="n">push!</span><span class="p">(</span><span class="n">file_path</span><span class="p">,</span> <span class="n">path</span><span class="p">)</span>
            <span class="c">#dump(stat(f.desc)) # you can customize what you want to print</span>
        <span class="k">end</span>
    <span class="k">end</span>
    <span class="c">#println(&#39;\n&#39;, pwd())</span>
    <span class="c">#display(file_paths)</span>
    <span class="n">file_name</span> <span class="o">=</span> <span class="n">sort_array</span><span class="p">(</span><span class="n">file_name</span><span class="p">)</span>
    <span class="n">file_path</span> <span class="o">=</span> <span class="n">sort_array</span><span class="p">(</span><span class="n">file_path</span><span class="p">)</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">DataFrame</span><span class="p">(</span><span class="n">File</span> <span class="o">=</span> <span class="n">file_name</span><span class="p">,</span> <span class="n">Path</span> <span class="o">=</span> <span class="n">file_path</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">df</span>

<span class="k">end</span>



<span class="k">function</span> <span class="n">sort_array</span><span class="p">(</span><span class="n">array</span><span class="p">)</span>
    
    <span class="k">return</span> <span class="n">sort</span><span class="p">(</span><span class="n">array</span><span class="p">;</span> <span class="n">alg</span><span class="o">=</span><span class="nb">MergeSort</span><span class="p">)</span>

<span class="k">end</span>



<span class="k">function</span> <span class="n">df_to_file</span><span class="p">(</span><span class="n">df</span><span class="p">,</span><span class="n">outpath</span><span class="p">)</span>
    <span class="n">CSV</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">outpath</span><span class="p">,</span> <span class="n">df</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">outpath</span>

<span class="k">end</span>


<span class="k">function</span> <span class="n">main</span><span class="p">()</span>
    
    <span class="c"># outpath fo the current file</span>
    <span class="n">outpath</span> <span class="o">=</span> <span class="n">joinpath</span><span class="p">(</span><span class="n">pwd</span><span class="p">(),</span><span class="s">&#34;case_files.csv&#34;</span><span class="p">)</span>

    <span class="c">#Glob files from directory</span>
    <span class="n">oyez_dataframe</span> <span class="o">=</span> <span class="n">get_files</span><span class="p">(</span><span class="s">&#34;oyez_cited&#34;</span><span class="p">)</span>
    
    <span class="c">#Glob files from directory</span>
    <span class="n">loc_dataframe</span> <span class="o">=</span> <span class="n">get_files</span><span class="p">(</span><span class="s">&#34;loc_cited&#34;</span><span class="p">)</span>

    
    <span class="c"># Join on File excluding extraneous data not in the oyez dataset</span>
    <span class="n">master_df</span> <span class="o">=</span> <span class="n">innerjoin</span><span class="p">(</span><span class="n">oyez_dataframe</span><span class="p">,</span> <span class="n">loc_dataframe</span><span class="p">,</span> <span class="n">on</span> <span class="o">=</span> <span class="ss">:File</span><span class="p">,</span> <span class="n">validate</span><span class="o">=</span><span class="p">(</span><span class="nb">true</span><span class="p">,</span> <span class="nb">true</span><span class="p">),</span> <span class="n">makeunique</span> <span class="o">=</span> <span class="nb">true</span><span class="p">)</span>

    <span class="c">#Select every file but the .DS_Store from the dataframe.  </span>
    <span class="n">master_df</span> <span class="o">=</span> <span class="n">filter</span><span class="p">(</span><span class="n">row</span> <span class="o">-&gt;</span> <span class="o">!</span><span class="p">(</span><span class="n">row</span><span class="o">.</span><span class="n">File</span> <span class="o">==</span> <span class="s">&#34;.DS_Store&#34;</span><span class="p">),</span> <span class="n">master_df</span><span class="p">)</span>

    <span class="c">#Write to file</span>
    <span class="n">outpath</span> <span class="o">=</span> <span class="n">df_to_file</span><span class="p">(</span><span class="n">master_df</span><span class="p">,</span><span class="n">outpath</span><span class="p">)</span>
    

<span class="k">end</span>

<span class="n">main</span><span class="p">()</span>

</code></pre></div>]]></content>
			<postid> db6caa3bc9a9590b628925a0b061f9c2</postid>
			<author>Justin Napolitano</author>
			<author_name>Justin Napolitano</author_name>
			<author_email>personal.jnapolitano@gmail.com</author_email>
			<author_id>87654367b2fca109e7dc9d3ea8a1ebbaf0bfe374773b148c2c20d278479add99</author_id>			
		</item>
		
		<item>
			<title>Legal Research with AI: Part 6</title>
			<link>jnapolitano.com/posts/masterpiece/</link>
			<pubDate>Sat, 21 May 2022 19:40:32 +0000</pubDate>
			<guid>jnapolitano.com/posts/masterpiece/</guid>
			<description><![CDATA[Control Model: A traditional statistical analysis of voting behavior in SPSS.]]></description>
			<content type="html"><![CDATA[<h2 id="introduction">Introduction</h2>
<p>Currently, my server is mining data from the neo4j graph database.</p>
<p>This post contains a control model completed in SPSS that will serve as the base line for comparison to Ml models.  It includes a short literature review of the theoritical foundation of the Attitudinal Model of Judicial Behavior.</p>
<h2 id="hypothesis">Hypothesis</h2>
<p>When considering the individual Supreme Court Justices, their voting behavior may be best described by the interaction between their ideological precepts and the facts of the case.  Their vote will not be dictated entirely by the constraint of precedent.</p>
<h2 id="experimental-design">Experimental Design</h2>
<p>In this paper, the legal model is tested against the attitudinal model.   The intent is to best describe the process of Supreme Court decision making in relationship to Masterpiece Cakeshop, Ltd. v. Colorado Civil Rights Commission {cite}<code>masterpiececake</code>.</p>
<h3 id="the-legal-model">The Legal Model</h3>
<p>The Legal Model consists of three major components:</p>
<ol>
<li>precedent <sup id="fnref:1"><a href="#fn:1" class="footnote-ref" role="doc-noteref">1</a></sup></li>
<li>text (constitutional and statutory provisions) <sup id="fnref:1"><a href="#fn:1" class="footnote-ref" role="doc-noteref">1</a></sup></li>
<li>legislative intent. <sup id="fnref:1"><a href="#fn:1" class="footnote-ref" role="doc-noteref">1</a></sup></li>
</ol>
<p>The initial analysis of Masterpiece Cakeshop Ltd. v. Colorado Civil Rights Commission {cite}<code>masterpiececake</code> will consist of an argument dependent on all three.</p>
<h3 id="the-attitudinal-model">The Attitudinal Model</h3>
<p>The proposed attitudinal model will derive ideological values for the individual justices according to subject area <sup id="fnref:2"><a href="#fn:2" class="footnote-ref" role="doc-noteref">2</a></sup>.  This is accomplished by cross-referencing the current Supreme Court justices’ votes on the merits across time <sup id="fnref:2"><a href="#fn:2" class="footnote-ref" role="doc-noteref">2</a></sup>.  The first set of scores describe general voting behavior.  The next by first amendment cases.  Finally, by first amendment cases controlling for establishment <sup id="fnref:3"><a href="#fn:3" class="footnote-ref" role="doc-noteref">3</a></sup> and free exercise <sup id="fnref:3"><a href="#fn:3" class="footnote-ref" role="doc-noteref">3</a></sup> clause. and external situations <sup id="fnref:2"><a href="#fn:2" class="footnote-ref" role="doc-noteref">2</a></sup>.  When applying these to the facts of the case in Masterpiece Cakeshop Ltd. vs. Colorado Civil Rights Board (2018) it is expected that ideological scores will predict the outcome.</p>
<h2 id="legal-model-case-study">Legal Model Case Study</h2>
<p>Write an intro.  Facts, text,</p>
<h3 id="the-facts-of-the-case">The Facts of the Case</h3>
<p>The facts of the case in this instance are pulled directly from the syllabus of the Supreme Court Opinion {cite}<code>masterpiececake</code>:</p>
<blockquote>
<p>Masterpiece Cakeshop, Ltd., is a Colorado bakery owned and operated by Jack Phillips, an expert baker and devout Christian. In 2012, he told a same-sex couple that he would not create a cake for their wedding celebration because of his religious opposition to same-sex marriages—marriages that Colorado did not then recognize—but that he would sell them other baked goods, e.g., birthday cakes. The couple filed a charge with the Colorado Civil Rights Commission (Commission) pursuant to the Colorado Anti-Discrimination Act (CADA), which prohibits, as relevant here, discrimination based on sexual orientation in a “place of business engaged in any sales to the public and any place offering services . . . to the public.&quot; Under CADA’s administrative review system, the Colorado Civil Rights Division first found probable cause for a violation and referred the case to the Commission. The Commission then referred the case for a formal hearing before a state Administrative Law Judge (ALJ), who ruled in the couple’s favor. In so doing, the ALJ rejected Phillips’ First Amendment claims: that requiring him to create a cake for a same-sex wedding would violate his right to free speech by compelling him to exercise his artistic talents to express a message with which he disagreed and would violate his right to the free exercise of religion.</p>
</blockquote>
<h3 id="the-pertinent-text">The Pertinent Text</h3>
<p>The first step of the test is to test Mr. Phillips claims against pertinent text of the controlling statutory and constitutional provisions.  Therefore, the relevant texts relating to the free speech claims are:</p>
<ol>
<li>The First Amendment of the Constitution <sup id="fnref:3"><a href="#fn:3" class="footnote-ref" role="doc-noteref">3</a></sup></li>
<li>The Colorado Public Accommodation law {cite}:<code>crs-title24-art-34-part-6-section 601-604-2016</code>.</li>
</ol>
<p>These will be tested against the claim that the Colorado Law unduly burdens Mr. Phillips by abridging his free exercise of religion, as well as his freedom of speech.  <sup id="fnref:4"><a href="#fn:4" class="footnote-ref" role="doc-noteref">4</a></sup></p>
<h4 id="the-first-ammendment-text">The First Ammendment Text</h4>
<p>I begin with the First Amendment <sup id="fnref:3"><a href="#fn:3" class="footnote-ref" role="doc-noteref">3</a></sup>.  Due to its brevity, I include the entire text:</p>
<blockquote>
<p>Congress shall make no law respecting an establishment of religion, or prohibiting the free exercise thereof; or abridging the freedom of speech, or of the press; or the right of the people peaceably to assemble, and to petition the Government for a redress of grievances. (U.S. Const. amend I)</p>
</blockquote>
<h4 id="colorado-state-law-title-24-article-34-part-6-section-601-604-2016">Colorado State Law Title 24, Article 34, Part 6, Section 601-604 2016</h4>
<p>The pertinent clause of the Colorado State Law in question reads:</p>
<blockquote>
<p>It is a discriminatory practice and unlawful for a person, directly or indirectly, to refuse, withhold from, or deny to an individual or a group, because of disability, race, creed, color, sex, sexual orientation, marital status, national origin, or ancestry, the full and equal enjoyment of the goods, services, facilities, privileges, advantages, or accommodations of a place of public accommodation (Colorado Revised Statute, Title 24, Article 34, Part 6, Section 601-604 2016).</p>
</blockquote>
<h3 id="standing">Standing</h3>
<p>Based simply on textual grounds, Mr. Phillips’ free exercise, and freedom of speech claims are completely unfounded.  The first amendment as written does not protect the individual resident of an individual state from undue abridgements of personal religious and speech freedoms.  If we adopt the standard of incorporation as written into the precedent the first amendment still does not seem to support the claims.1  Speech, if understood according to Webster, is “communication or expression of thoughts in spoken words (Webster&rsquo;s New World 2016).” The action of making a cake, cannot be in any way considered speech by this definition. speech.  Symbolic speech, whatever that means, is not written into the Constitution.</p>
<h4 id="the-first-ammendment-standing">The First Ammendment Standing</h4>
<p>At first reading, Mr. Phillips claim <sup id="fnref:5"><a href="#fn:5" class="footnote-ref" role="doc-noteref">5</a></sup> does not seem to be legitimate.  If in fact the Colorado Law abridges religious freedoms, or individual speech in any way the amendment reads that “Congress shall make no law”.  At least when reading the text of the First Amendment as plainly as possible it does not apply directly to the case at hand. As a matter of fact, it does not apply to state in any capacity. The difficulty however, is that the Court has incorporated into the common law this amendment.  Therefore, it considered applicable to the states, and thus operable upon the residents of the individual states.  Forgoing this truth, we also run into a few textual problems.  For instance, how is it that speech is defined? Or exactly what constitutes a prohibition of the free exercise of religion?  These questions may only be answer by consulting precedent.</p>
<h4 id="colorado-state-law-standing">Colorado State Law Standing</h4>
<p>Contrary to Mr. Phillips’ claim the law does not seem to unduly burden any religious freedoms, nor speech in general.  Rather, it is a generally applicable law, that extends protections in places of public accommodation to people according to sexual-orientation.  Reading this in contrast to the First Amendment, there are no direct violations.</p>
<h3 id="legislative-intent">Legislative Intent</h3>
<p>If the Court relied entirely on the textual evidence to judge, it is apparent that the case would not have been heard by the bench. However, this is obviously not the case.  As such, Legislative Intent must also be considered in this analysis.  This section will attempt to discover the intent behind the First Amendment in order to judge Mr. Philips’ claims against original intent.</p>
<h4 id="the-first-ammendment-intent">The First Ammendment Intent</h4>
<p>The First Amendment along with the remaining nine were first introduced to the floor of Congress in 1789 to address the concern that specific individual liberties could be eroded by the powers of the national congress. According to James Madison, in order to limit the power of the legislature.  The case being that it is the most powerful branch, and therefore most likely to be abused (Lloyd 1789).  At the behest of the representatives of the individual states, as well as their ratification committees, the National Congress in order to ratify the Constitution agreed to ratify a Bill of Rights.</p>
<p>Each individual clause of the amendment is important to the discussion.  For the purpose of this paper, I will discuss the legislative history of the Establishment and Free Exercise Clauses, as well as the Freedom of Speech Clauses.  Then a short discussion on the drafting process of the entire amendment will be had.</p>
<h4 id="freedom-of-speech">Freedom of Speech</h4>
<p>The ideological and textual foundations for the free speech clauses come from English heritage.  For instance, the English Bill of Rights, drafted in 1689, states “that the freedome of speech and debates or proceedings in Parlyament ought not to be impeached or questioned in any court or place out of Parlyament (1 Will. And Mar. Sess. 2, c. 2.)”</p>
<p>The individual states in their constitutions drafted protection for at least the “freedom of the press.” <sup id="fnref:6"><a href="#fn:6" class="footnote-ref" role="doc-noteref">6</a></sup>  The state of Pennsylvania in their 1790 Constitution states that:</p>
<blockquote>
<p>The printing presses shall be free to every person who undertakes to examine the proceedings of the legislature, or any branch of government: And no law shall ever be made to restrain the right thereof.  The Free communication of the thoughts and opinions is one of the invaluable rights of man; and every citizen may freely speak, write and print on any subject, being responsible for the abuse of that liberty.  (Dallas 1791, xxxiv)</p>
</blockquote>
<p>Evident here is the strong common law and statutory practice of protection of the rights of the individual to publish material no matter the content, however, there does not seem to be a protection for symbolic expressions of speech such as the production of a cake.</p>
<p>The state ratification committees offer the best insight into the matter of free speech, as it meant to those most concerned with protecting that right.  The Honorable James Lincoln, of South Carolina puts the point most succinctly:</p>
<blockquote>
<p>Why in this Constitution, is a total silence with regard to the liberty of the press?  Was it forgotten? Impossible!  Then it must have been purposely omitted…. The Liberty of the press was the tyrants scourge — it was the true friend and firmest supporter of civil liberty; therefore, why pass it by in silence?&hellip; Pray, sir, what security have we for a republican form of government, when it depends on the mere will and pleasure of a few men, who, with an army, navy, and rich treasury at their back, may change and alter it as they please?  It may be said they will be sworn.  Sir, the king of Great Britain, at his coronation, swore to govern his subjects with justice and mercy.  We were then his subjects, and continued so for a long time after.  He would be glad to know how he observed his oath.  If, then, the king of Great Britain forswore himself, what security have we that a future President and four or five senators — like himself — will think more solemnly of so sacred an obligation than he did?   (Elliot 1888, 314-316)</p>
</blockquote>
<p>The most obvious concern is the failure of the Constitution to draft specific protections to secure the individual states from the type of tyranny experienced under the English Crown.  So too is a bit of realism present.  How is it that men, men of high rank, can be expected to uphold their oaths to govern with regard to the people?  When it is likely that men that acquire power will in many cases do the utmost to retain that power.  It is difficult to make the argument that these men had much of a consideration for individual speech, or any form of symbolic speech <sup id="fnref:7"><a href="#fn:7" class="footnote-ref" role="doc-noteref">7</a></sup></p>
<p>The Congressional accounts support the same basic idea.  James Madison proposed to the House, that the “people shall not be deprived or abridged of their right to speak, to write, or to publish their sentiments; and the freedom of the press, as one of the great bulwarks of liberty, shall be inviolable (Lloyd 1789).  Roger Sherman, also put to the floor, that “people have certain natural rights which are retained by them when they enter into society. Such are the rights… of Speaking, writing and publishing their Sentiments with decency and freedom (Lloyd 1789).”   There is no apparent concern for symbolic forms of speech.  Rather, the idea is that someone may privately write and say what he so wishes, and publish that material if one so chooses.</p>
<p>The overarching intent of the Free Speech clause, appears to be an intent to forbid the federal government from restricting access to free presses.  The concern is almost exclusively focused on published material, and the fact that a free press enables the people of a nation to challenge the acts of government.  To restrict this right, in the eyes of some members of the congress, and the state ratification committees, was to in effect establish a tyrannical government.  The English Bill of Rights, State Constitutions, and the accounts of the State Ratification Committees all support this.</p>
<p>The conditional clauses within the state constitutions also point to the fact, that speech was not to be construed to enable a person to act in a way that is harmful to the public welfare.  State laws passed in order to improve the well being of the general public could not be abrogated by individuals claiming a free speech exemption.  In reference to Mr. Phillips’ claims an original intent lens, at best guess <sup id="fnref:8"><a href="#fn:8" class="footnote-ref" role="doc-noteref">8</a></sup>, would not support an individual protection from state public accommodation laws on free speech grounds.</p>
<h4 id="establishment-and-free-exercise-clauses">Establishment and Free Exercise Clauses</h4>
<p>Again, the English heritage of founders of the United States is relevant to the discussion.  The English Bill of Rights reads, “that the commission for erecting the late courts of commissioners of ecclesiastical causes and all other commissions and courts of like nature are illegal and pernicious (1 Will. and Mary. Sess. 2, c. 2).” <sup id="fnref:9"><a href="#fn:9" class="footnote-ref" role="doc-noteref">9</a></sup></p>
<p>Also, certain State constitutions prohibit religious tests necessary to hold office, as well as the imposition of any religious belief upon inhabitants.  Georgia’s in particular, “All persons whatever shall have the free exercise of their religion; provided it be not repugnant to the peace and safety of the State; and shall not, unless by consent, support any teacher, or teachers, except those of their own profession…. No clergyman, of any denomination, shall be allowed a seat in the legislature (Watkins and Watkins 1800, 15-16).” Also, important is the state of New York’s 1777 constitution which states, “that the free Exercise and Enjoyment of religious Profession and Worship, without Discrimination or Preference, shall forever hereafter be allowed within this state to all Mankind.” Noticeable is the conditional clause, citing: Provided, that the Liberty and Conscience hereby granted, shall not be so construed, as to excuse Acts of Licentiousness, or justify Practices inconsistent with the Peace or Safety of this State (The State of New York 1789, 13).” A number of other states follow in like fashion. <sup id="fnref:10"><a href="#fn:10" class="footnote-ref" role="doc-noteref">10</a></sup></p>
<p>An intent to separate civil and political life is also apparent at the first congress.  For instance, at first drafting what became the establishment clause read, “The civil rights of none shall be abridged on account of religious belief or worship, nor shall any national religion be established, nor shall the full and equal rights of conscience be in any manner, or any pretext infringed (Lloyd 1789).”  A later draft also read, “Congress shall make no law establishing articles of faith or a mode of worship, or prohibiting the free exercise of religion, or abridging the freedom of speech, or the press, or the right of the people peaceable to assemble, and petition to the Government for the redress of grievances (Lloyd 1789).”</p>
<p>Together, these provide little evidence into the intention of the legislators present at the first congress.  The first draft, quite different from the final, implies a respect for both the free exercise of religion, and for free exercise of action according to the dictate of conscience.  As a summary of Mr. Samuel Huntington’s concern reads, “he hoped therefore the amendment would be made in such a way as to secure the rights of conscience, and a free exercise of the rights of religion, but not to patronize those who profess no religion at all (Lloyd 1789).” Thus, concern for both religious exercise, as well as non-religious seems to be equally supported by at least Mr. Huntington.  Governor Randolph of Virginia puts this same convention more forwardly in stating that, “a mutual toleration, and a persuasion that no man has the right to impose his opinion on other” is his intent behind the ratification of what became the first amendment (Elliot 1888).</p>
<p>However, the next draft removes this consideration, and limits the wording to include only protections for the free-exercise of religion.  Freedom of consciousness, whatever that they may mean is dropped.  A series of other drafts may be considered, as may conflicting pamphlets but the pressing reality is that the members of the first congress, as well as the state ratification committees, and the general public at large, all had different concerns.  Who is considered to be authoritative on this matter is dependent upon the values of the individual reader.  Therefore, there cannot be one legislative intent, but instead a diversity of intents that converged about a single piece of legislation.</p>
<p>If one were to guess, which is the best that can be done on the matter, the intent behind the establishment clause was to protect the individual states from usurpation of powers by the federal government of powers historically held by the states.  The protections for religion, speech, assembly, and redress, grant to the states special protections in order to further weaken the federal government.  There is not a unanimous application of these rights to all individual inhabitants within the United States.    No, instead, a blanket restriction was imposed upon the federal government, in order to allow the states to manage these affairs as they saw fit.  If a justice were to consult this original intention, Mr. Philips’ claims would be superfluous, as the amendment would not be binding on the state of Colorado.</p>
<h3 id="precedent">Precedent</h3>
<h4 id="analysis-of-case-law">Analysis of Case Law</h4>
<p>To test Mr. Phillips’ claim to a freedom of speech, and a free exercise exemption, this section of the paper will analyze the doctrines created by the Supreme Court in regard to Privacy, Establishment, Free Exercise, and the Freedom of Contract.</p>
<h4 id="establishment-of-clause">Establishment of Clause</h4>
<p>Lemon v. Kurtzman is the authority which the court recognizes as the standard by which to test laws for Establishment Clause violations.  The “Lemon Test” states three rules.  “First, the statute must have a secular legislative purpose; second, its principal or primary effect must be one that neither advances nor inhibits religion; Finally, the statute must not foster an excessive government entanglement with religion (Lemon v. Kurtzman, 1971) “In order to determine whether the government entanglement with religious is excessive, we must examine the character and purpose of the institutions that benefitted, the nature of the aid the state provides, and the resulting relationship between the government and the religious authority (Lemon v. Kurtzman, 1971).”  The Colorado state law in question, does not in any way violate these provisions.</p>
<p>For example, it may not be construed to have any other purpose than a secular one.  Secondly, the primary effect does not inhibit nor advance religion.  The primary purpose only protects individuals from discrimination in place of public accommodation.  Third, the law does not entangle the government, federal or state, with religion.  In effect, the government, no matter the degree of separation, is not entangled with any church, mosque, or any other form of religion.</p>
<h4 id="free-exercise">Free Exercise</h4>
<p>The Free Exercise claim is not as easily defeated.  A number of cases must be reviewed in order to conclude whether the Colorado law is in violation of this clause (U.S. Const. amend. I cl.1)</p>
<h5 id="reynolds-v-united-states-1879">Reynolds v. United States 1879</h5>
<p>The first case under consideration is Reynolds v. United States (1879), in which laws prohibiting bigamy were brought under scrutiny when challenged by members of the Church of Latter Day Saints.  To challenge the conviction, which was considered, as it is at present antithetical to publically accepted morality the Court argued that “laws are made for the government of actions, and while they cannot interfere with mere religious belief and opinions, they may with practices (Reynolds v. United States, 1879)” in order to promote the general welfare of the people.  To permit otherwise “would be to make the professed doctrines of religious belief superior to the law of the land, and in effect to permit every citizen to become a law unto himself (Reynolds v. United States, 1879).”</p>
<h5 id="employment-division-v-smith-1990">Employment Division v. Smith 1990</h5>
<p>This position is reiterated in Employment Div. v. Smith (1990) in which the court deliberated on the validity of a Seattle State law’s prohibition on providing unemployment benefits to individuals found to have used schedule I substance despite a claim to a religious exemption.  The appellant sought to reverse the verdict of Reynolds.  The Court did not budge.  To force the state to violate its own laws at the behest of an individual claiming religious exemptions for specific practices in effect does put the government behind the promotion of the claimant’s religious beliefs.  In fact, “it is a permissible reading of U.S Const. Amend. I to say that if prohibiting the exercise or religion is not the object of a law, but merely the incidental effect of a generally applicable and otherwise valid provision, the First Amendment has not been offended (Employment Div. v. Smith, 1990).”</p>
<h5 id="hobby-lobby-inc-v-burwell-2014">Hobby Lobby, Inc v. Burwell 2014</h5>
<p>The court shifted however in Hobby Lobby, Inc v. Burwell which the Supreme Court violated the spirit of previous decisions in response to Congress’ passage of the Religious Land Use and Institutionalized Persons Act, the RLUIPA. Which is “in an obvious effort to effect a complete separation from First Amendment case law (Hobby Lobby, Inc v. Burwell, 2014).” The Court did not strike the law as they had done City of Boerne v. Flores (1997).  Instead they validated it despite the fact “the powers of the legislature are defined and limited; and that those limits may not be mistaken (City of Boerne v. Flores, 1997).”  Unlike the consensus in Employment Div. v. Smith (1990), that a rule of general applicability may supersede one’s free exercise rights, the court found in favor of the corporate entity Hobby Lobby’s stance that the imposition of fines as punishment for not providing contraceptive coverage to female employees is not the “least restrictive means of furthering” a government interest.</p>
<h5 id="free-exercise-mr-so-and-sos-claim">Free Exercise Mr. So and So&rsquo;s Claim</h5>
<p>Considering the current claim, is it that the Colorado Law unduly inhibits the free exercise of religious belief?  No, it does not in any way.  By way of Lemon v. Kurtzman (1971), Reynolds v. United States (1879), and Employment Div. v. Smith (1990), the Colorado Public Accommodation law passes the test of general applicability.  However, the only precedent which may challenge its constitutionality is Hobby Lobby, Inc v. Burwell (2014).  Nonetheless, the Colorado Law may be considered the least restrictive means to further the public accommodation protections according to sexual-orientation.  To accomplish the same ends in any way less restrictive would require the law to be struck from the books.</p>
<h4 id="privacy">Privacy</h4>
<p>The right to marriage, well the right for same-sex couples to marry is a right founded in the doctrine of privacy and supported by the Fourteenth Amendment.  Obergefell v. Hodges (2015) the ruling which enabled same-sex couples to marry is the culmination of a development of a doctrine which proposes that institutions understood to be fundamental to ordered liberty ought not to be excessively regulated by the Congress (Palko v. Connecticut, 1937).   A string of cases in which the Court came to adopt the position that consenting adults of nontraditional relationships ought to receive the same protections under the law as those of traditional relationships rationalize the ruling. <sup id="fnref:11"><a href="#fn:11" class="footnote-ref" role="doc-noteref">11</a></sup></p>
<h5 id="griswold-v-connecticut-1965">Griswold v. Connecticut 1965</h5>
<p>In Griswold v. Connecticut (1965) it was found that a consenting couple may receive counseling from a planned parenthood representative with regard to birth control.  The right of that couple to act according to their discretion is fundamental to the institution of marriage.  The court could not find a rational government interest to infringe upon that sacred barrier.</p>
<h5 id="loving-v-virginia-1967">Loving v. Virginia 1967</h5>
<p>Accordingly, the Court ruled in Loving v. Virginia (1967) that the rights afforded to white couples and black couples, could not be excluded from couples of mixed races.  Marriage is a fundamental right.  Therefore, it cannot be awarded only to select classes. Rather it is a right afforded to each individual of the United States.  The Fourteenth Amendment ensures that all people are afforded equal protection under the law.  To violate this principle is to violate the constitution.</p>
<h5 id="lawrence-v-texas-2003">Lawrence v. Texas 2003</h5>
<p>Lawrence v. Texas (2003) applied this principle to same sex couples.  It was found that sodomy laws in general restrict the ability for male same-sex couples to fully realize intimacy.  The laws unduly affected a single class of individuals without reason except to eliminate a socially unaccepted behavior from the private lives of two consenting adults.  The court could find no basis for the ban apart from undue bias directed at same-sex couples.</p>
<h5 id="obergefell-v-hodges-2015">Obergefell v. Hodges 2015</h5>
<p>The ultimate realization of the privacy protections and Fourteenth Amendment jurisprudence is found in Obergefell v. Hodges (2015) The court here found that “the right to marry is a fundamental right inherent in the liberty of the person (Obergefell v. Hodges, 2015).”  To disallow a same sex couples the right to marriage “denies individual dignity and autonomy (Obergefell v. Hodges, 2015).” to a subclass of citizens without rational basis.  In Obergefell v. Hodges (2015) “under the Due Process and Equal Protections Clauses of the Fourteenth Amendment couples of the same-sex may not be deprived” of their right to marry and to share the same privileges of same-sex couples.</p>
<h5 id="privacy-and-mr-so-and-sos-claim">Privacy and Mr. So and So&rsquo;s Claim</h5>
<p>According then to the Privacy doctrine, and namely Obergefell v. Hodges the right for gay couples to marry is fundamental.  They must then receive the same privileges and protections of all other married couples.  Without even the Colorado Law in place, I would argue that the Privacy Doctrine in of itself protects gay couples from the type of discrimination experienced by Mr. Charlie Craig and Mr. Dave Mullins.  The sanctity of the institution of marriage no matter those whom enter into it is fundamental to the idea of liberty in this country. To violate that sanctity when two gay men marry is to violate the holding of Obergefell and more heinously the dignity of two individuals.</p>
<h4 id="freedom-to-contract">Freedom to Contract</h4>
<p>There may be a case for the individual right to bargain for the terms of one’s contracts free from the regulation of the government, but the court has already spoken on this matter.  “The power… to restrict freedom of contract may be exercised in the public interest (West Coast Hotel Co. v. Parrish, 1937) Also, the authority of the government to regulate products that affect interstate commerce has been affirmed in United States v. Darby (1941). The real question here is whether a state government may regulate services in places of public accommodation?</p>
<p>The answer is a resounding yes. The Federal government for instance may do so when commerce is affected.  The two most important cases for the purpose of this paper are Katzenbach v. McClung (1964) and Heart of Atlanta Motel, Inc. v. United States (379 U.S. 241, 1964). These cases both rest on the validity of Title II of the Civil Rights Act of 1964 which states “all Persons shall be entitled to the full and equal enjoyment of the goods, services, facilities, privileges, advantages, and accommodations of any place of public accommodation.”  Public accommodation is defined as “any inn, hotel, motel, or other establishment which provides lodging to transient guests.  Any Restaurant, cafeteria, lunchroom, lunch counter, soda fountain, or other facility principally engaged in selling food for consumption on the premises. (42 U.S.C. S 2000a(a), 42 U.S.C. S 2000a(b)).</p>
<h5 id="katzenbach-v-mcclung-1964">Katzenbach v. McClung 1964</h5>
<p>In Katzenbach v. McClung (1964) the Court recognized “that discrimination in restaurants has a direct and highly restrictive effect upon interstate travel… This results because discriminatory practices prevent Negroes from buying prepared food… except in isolated and unkempt restaurants and under unsatisfactory and often unpleasant conditions (Katzenbach v. McClung, 1964).”  The outcome of which is the treatment of Blacks as second-class citizens not deserving the standards of decency enjoyed by their White peers. As the Congress enjoys “the power to make all laws which shall be necessary and proper for carrying into execution” it’s Commercial and Spending powers, Congress may regulate “those activities intrastate which so affect interstate commerce… to the attainment of a legitimate end (Katzenbach v. McClung, 1964).”</p>
<h5 id="heart-of-atlanta-motel-inc-v-united-states-1964">Heart of Atlanta Motel, Inc, v. United States 1964</h5>
<p>Heart of Atlanta Motel, Inc. v. United States (1964) reiterates the opinion of Katzenbach v. McClung (1964), but further specifies when the Congress may in fact regulate commercial services.  “The only questions are (1) whether Congress had a rational basis for finding that racial discrimination&hellip; affected commerce, and (2) if it had such a basis, whether the means it selected to eliminate that evil reasonable and appropriate (Heart of Atlanta Motel, Inc. v. United States, 1964).”  In the case of the segregation of hotels the Congress is well within its bounds to manage the way in which proprietors treat their customers, in order to avoid the evil of segregation.  It is not a stretch to apply the same principles to support the right of a state’s legislature to ensure that no discrimination occurs on the basis of sexual-orientation.</p>
<h5 id="freedom-to-contract-and-mr-so-and-sos-claim">Freedom to Contract and Mr. So and So&rsquo;s claim</h5>
<p>In the case of the individual states, their police powers alone allow them to enforce public accommodation laws by way of the 10th amendment.  The barometer in the case of Masterpiece Cake (2018)  is whether the Colorado law protects the welfare, safety, and health of the public at large.  Obviously, a state law which purports to protect the general welfare, and safety of all people can be said to meet this standard.</p>
<p>(attitudinal-case-study)=</p>
<h2 id="attitudinal-model-case-study">Attitudinal Model Case Study</h2>
<p>Write an intro.  Facts, text,</p>
<h3 id="methodology">Methodology</h3>
<p>To build a model that takes into account the subjective attitudes of the Supreme Court Justices. I use the Washington University Law Database (Spaeth, Epstein, et al. 2017) that takes into account the individual decisions of each justice in order to determine their ideological value across time.   I then test these values against the facts, including attitudinal objects, and attitudinal situations, of Masterpiece Cake LTD. v. Colorado Civil Rights Commission (2018)</p>
<h4 id="ideological-score-by-justice">Ideological Score by Justice</h4>
<p>To determine a justice’s ideological score I test their votes across time to determine whether they vote conservatively or liberally.  A simple mean value between one and two is then generated.  The closer to one a justice votes the more conservative.  Alternatively, the closer to two the value, the more liberal.  The results for the individual justices are included in
the chart below.</p>
<h6 id="table">Table</h6>
<table>
<thead>
<tr>
<th>Justice</th>
<th>Mean</th>
<th>N</th>
<th>Std. Deviation</th>
<th>Variance</th>
</tr>
</thead>
<tbody>
<tr>
<td>AMKennedy</td>
<td>1.42</td>
<td>2668</td>
<td>0.493</td>
<td>0.243</td>
</tr>
<tr>
<td>CThomas</td>
<td>1.32</td>
<td>2179</td>
<td>0.468</td>
<td>0.219</td>
</tr>
<tr>
<td>RBGinsburg</td>
<td>1.6</td>
<td>1964</td>
<td>0.491</td>
<td>0.241</td>
</tr>
<tr>
<td>SGBreyer</td>
<td>1.56</td>
<td>1848</td>
<td>0.496</td>
<td>0.246</td>
</tr>
<tr>
<td>JGRoberts</td>
<td>1.42</td>
<td>913</td>
<td>0.493</td>
<td>0.243</td>
</tr>
<tr>
<td>SAAlito</td>
<td>1.36</td>
<td>874</td>
<td>0.481</td>
<td>0.232</td>
</tr>
<tr>
<td>SSotomayor</td>
<td>1.62</td>
<td>600</td>
<td>0.487</td>
<td>0.237</td>
</tr>
<tr>
<td>EKagan</td>
<td>1.59</td>
<td>486</td>
<td>0.492</td>
<td>0.242</td>
</tr>
<tr>
<td>NMGorsuch</td>
<td>1.18</td>
<td>17</td>
<td>0.393</td>
<td>0.154</td>
</tr>
<tr>
<td>Total</td>
<td>1.47</td>
<td>11549</td>
<td>0.499</td>
<td>0.249</td>
</tr>
</tbody>
</table>
<h4 id="ideological-score-by-justice-first-ammendment">Ideological Score by Justice First Ammendment</h4>
<p>Similarly, I derive ideological values according to voting patterns relating to first amendment cases.  The results are printed in the following chart.</p>
<h5 id="table-1">Table</h5>
<table>
<thead>
<tr>
<th>Justice</th>
<th>issue area of case (coarse)</th>
<th>Mean</th>
<th>N</th>
<th>Std. Deviation</th>
<th>Variance</th>
</tr>
</thead>
<tbody>
<tr>
<td>AMKennedy</td>
<td>First Amendment</td>
<td>1.47</td>
<td>167</td>
<td>0.5</td>
<td>0.25</td>
</tr>
<tr>
<td>CThomas</td>
<td>First Amendment</td>
<td>1.33</td>
<td>127</td>
<td>0.472</td>
<td>0.223</td>
</tr>
<tr>
<td>RBGinsburg</td>
<td>First Amendment</td>
<td>1.68</td>
<td>112</td>
<td>0.469</td>
<td>0.22</td>
</tr>
<tr>
<td>SGBreyer</td>
<td>First Amendment</td>
<td>1.55</td>
<td>108</td>
<td>0.5</td>
<td>0.25</td>
</tr>
<tr>
<td>JGRoberts</td>
<td>First Amendment</td>
<td>1.51</td>
<td>47</td>
<td>0.505</td>
<td>0.255</td>
</tr>
<tr>
<td>SAAlito</td>
<td>First Amendment</td>
<td>1.42</td>
<td>43</td>
<td>0.499</td>
<td>0.249</td>
</tr>
<tr>
<td>SSotomayor</td>
<td>First Amendment</td>
<td>1.67</td>
<td>33</td>
<td>0.479</td>
<td>0.229</td>
</tr>
<tr>
<td>EKagan</td>
<td>First Amendment</td>
<td>1.67</td>
<td>27</td>
<td>0.48</td>
<td>0.231</td>
</tr>
<tr>
<td>NMGorsuch</td>
<td>First Amendment</td>
<td>2</td>
<td>1</td>
<td>.</td>
<td>.</td>
</tr>
<tr>
<td>Total</td>
<td>First Amendment</td>
<td>1.51</td>
<td>665</td>
<td>0.5</td>
<td>0.25</td>
</tr>
</tbody>
</table>
<h4 id="ideological-score-by-justice-by-individual-issue-area">Ideological Score by Justice by Individual Issue Area</h4>
<p>Finally, ideological scores are derived by issue area.  For the purpose of this discussion this is equivalent to an evaluation of the individual attitude-situations as they relate to the facts of the case.  The results are below:</p>
<h5 id="table-2">Table</h5>
<table>
<thead>
<tr>
<th>Justice</th>
<th>issue area of case (coarse)</th>
<th>Issue Area Of Case (Fine)</th>
<th>Mean</th>
<th>N</th>
<th>Std. Deviation</th>
<th>Variance</th>
</tr>
</thead>
<tbody>
<tr>
<td>AMKennedy</td>
<td>First Amendment</td>
<td>Free Exercise Of Religion</td>
<td>1.71</td>
<td>14</td>
<td>0.469</td>
<td>0.22</td>
</tr>
<tr>
<td></td>
<td>Establishment Of Religion</td>
<td>1.23</td>
<td>13</td>
<td>0.439</td>
<td>0.192</td>
<td></td>
</tr>
<tr>
<td></td>
<td>Total</td>
<td>1.48</td>
<td>27</td>
<td>0.509</td>
<td>0.259</td>
<td></td>
</tr>
<tr>
<td>Total</td>
<td>Free Exercise Of Religion</td>
<td>1.71</td>
<td>14</td>
<td>0.469</td>
<td>0.22</td>
<td></td>
</tr>
<tr>
<td></td>
<td>Establishment Of Religion</td>
<td>1.23</td>
<td>13</td>
<td>0.439</td>
<td>0.192</td>
<td></td>
</tr>
<tr>
<td></td>
<td>Total</td>
<td>1.48</td>
<td>27</td>
<td>0.509</td>
<td>0.259</td>
<td></td>
</tr>
<tr>
<td>CThomas</td>
<td>First Amendment</td>
<td>Free Exercise Of Religion</td>
<td>1.91</td>
<td>11</td>
<td>0.302</td>
<td>0.091</td>
</tr>
<tr>
<td></td>
<td>Establishment Of Religion</td>
<td>1.1</td>
<td>10</td>
<td>0.316</td>
<td>0.1</td>
<td></td>
</tr>
<tr>
<td></td>
<td>Total</td>
<td>1.52</td>
<td>21</td>
<td>0.512</td>
<td>0.262</td>
<td></td>
</tr>
<tr>
<td>Total</td>
<td>Free Exercise Of Religion</td>
<td>1.91</td>
<td>11</td>
<td>0.302</td>
<td>0.091</td>
<td></td>
</tr>
<tr>
<td></td>
<td>Establishment Of Religion</td>
<td>1.1</td>
<td>10</td>
<td>0.316</td>
<td>0.1</td>
<td></td>
</tr>
<tr>
<td></td>
<td>Total</td>
<td>1.52</td>
<td>21</td>
<td>0.512</td>
<td>0.262</td>
<td></td>
</tr>
<tr>
<td>RBGinsburg</td>
<td>First Amendment</td>
<td>Free Exercise Of Religion</td>
<td>1.56</td>
<td>9</td>
<td>0.527</td>
<td>0.278</td>
</tr>
<tr>
<td></td>
<td>Establishment Of Religion</td>
<td>2</td>
<td>9</td>
<td>0</td>
<td>0</td>
<td></td>
</tr>
<tr>
<td></td>
<td>Total</td>
<td>1.78</td>
<td>18</td>
<td>0.428</td>
<td>0.183</td>
<td></td>
</tr>
<tr>
<td>Total</td>
<td>Free Exercise Of Religion</td>
<td>1.56</td>
<td>9</td>
<td>0.527</td>
<td>0.278</td>
<td></td>
</tr>
<tr>
<td></td>
<td>Establishment Of Religion</td>
<td>2</td>
<td>9</td>
<td>0</td>
<td>0</td>
<td></td>
</tr>
<tr>
<td></td>
<td>Total</td>
<td>1.78</td>
<td>18</td>
<td>0.428</td>
<td>0.183</td>
<td></td>
</tr>
<tr>
<td>SGBreyer</td>
<td>First Amendment</td>
<td>Free Exercise Of Religion</td>
<td>1.78</td>
<td>9</td>
<td>0.441</td>
<td>0.194</td>
</tr>
<tr>
<td></td>
<td>Establishment Of Religion</td>
<td>1.67</td>
<td>9</td>
<td>0.5</td>
<td>0.25</td>
<td></td>
</tr>
<tr>
<td></td>
<td>Total</td>
<td>1.72</td>
<td>18</td>
<td>0.461</td>
<td>0.212</td>
<td></td>
</tr>
<tr>
<td>Total</td>
<td>Free Exercise Of Religion</td>
<td>1.78</td>
<td>9</td>
<td>0.441</td>
<td>0.194</td>
<td></td>
</tr>
<tr>
<td></td>
<td>Establishment Of Religion</td>
<td>1.67</td>
<td>9</td>
<td>0.5</td>
<td>0.25</td>
<td></td>
</tr>
<tr>
<td></td>
<td>Total</td>
<td>1.72</td>
<td>18</td>
<td>0.461</td>
<td>0.212</td>
<td></td>
</tr>
<tr>
<td>JGRoberts</td>
<td>First Amendment</td>
<td>Free Exercise Of Religion</td>
<td>2</td>
<td>7</td>
<td>0</td>
<td>0</td>
</tr>
<tr>
<td></td>
<td>Establishment Of Religion</td>
<td>1</td>
<td>2</td>
<td>0</td>
<td>0</td>
<td></td>
</tr>
<tr>
<td></td>
<td>Total</td>
<td>1.78</td>
<td>9</td>
<td>0.441</td>
<td>0.194</td>
<td></td>
</tr>
<tr>
<td>Total</td>
<td>Free Exercise Of Religion</td>
<td>2</td>
<td>7</td>
<td>0</td>
<td>0</td>
<td></td>
</tr>
<tr>
<td></td>
<td>Establishment Of Religion</td>
<td>1</td>
<td>2</td>
<td>0</td>
<td>0</td>
<td></td>
</tr>
<tr>
<td></td>
<td>Total</td>
<td>1.78</td>
<td>9</td>
<td>0.441</td>
<td>0.194</td>
<td></td>
</tr>
<tr>
<td>SAAlito</td>
<td>First Amendment</td>
<td>Free Exercise Of Religion</td>
<td>2</td>
<td>6</td>
<td>0</td>
<td>0</td>
</tr>
<tr>
<td></td>
<td>Establishment Of Religion</td>
<td>1</td>
<td>2</td>
<td>0</td>
<td>0</td>
<td></td>
</tr>
<tr>
<td></td>
<td>Total</td>
<td>1.75</td>
<td>8</td>
<td>0.463</td>
<td>0.214</td>
<td></td>
</tr>
<tr>
<td>Total</td>
<td>Free Exercise Of Religion</td>
<td>2</td>
<td>6</td>
<td>0</td>
<td>0</td>
<td></td>
</tr>
<tr>
<td></td>
<td>Establishment Of Religion</td>
<td>1</td>
<td>2</td>
<td>0</td>
<td>0</td>
<td></td>
</tr>
<tr>
<td></td>
<td>Total</td>
<td>1.75</td>
<td>8</td>
<td>0.463</td>
<td>0.214</td>
<td></td>
</tr>
<tr>
<td>SSotomayor</td>
<td>First Amendment</td>
<td>Free Exercise Of Religion</td>
<td>1.5</td>
<td>6</td>
<td>0.548</td>
<td>0.3</td>
</tr>
<tr>
<td></td>
<td>Establishment Of Religion</td>
<td>2</td>
<td>2</td>
<td>0</td>
<td>0</td>
<td></td>
</tr>
<tr>
<td></td>
<td>Total</td>
<td>1.63</td>
<td>8</td>
<td>0.518</td>
<td>0.268</td>
<td></td>
</tr>
<tr>
<td>Total</td>
<td>Free Exercise Of Religion</td>
<td>1.5</td>
<td>6</td>
<td>0.548</td>
<td>0.3</td>
<td></td>
</tr>
<tr>
<td></td>
<td>Establishment Of Religion</td>
<td>2</td>
<td>2</td>
<td>0</td>
<td>0</td>
<td></td>
</tr>
<tr>
<td></td>
<td>Total</td>
<td>1.63</td>
<td>8</td>
<td>0.518</td>
<td>0.268</td>
<td></td>
</tr>
<tr>
<td>EKagan</td>
<td>First Amendment</td>
<td>Free Exercise Of Religion</td>
<td>1.8</td>
<td>5</td>
<td>0.447</td>
<td>0.2</td>
</tr>
<tr>
<td></td>
<td>Establishment Of Religion</td>
<td>2</td>
<td>1</td>
<td>.</td>
<td>.</td>
<td></td>
</tr>
<tr>
<td></td>
<td>Total</td>
<td>1.83</td>
<td>6</td>
<td>0.408</td>
<td>0.167</td>
<td></td>
</tr>
<tr>
<td>NMGorsuch</td>
<td>First Amendment</td>
<td>Free Exercise Of Religion</td>
<td>2</td>
<td>1</td>
<td>.</td>
<td>.</td>
</tr>
<tr>
<td></td>
<td>Total</td>
<td>2</td>
<td>1</td>
<td>.</td>
<td>.</td>
<td></td>
</tr>
<tr>
<td>Total</td>
<td>Free Exercise Of Religion</td>
<td>2</td>
<td>1</td>
<td>.</td>
<td>.</td>
<td></td>
</tr>
<tr>
<td></td>
<td>Total</td>
<td>2</td>
<td>1</td>
<td>.</td>
<td>.</td>
<td></td>
</tr>
<tr>
<td>Total</td>
<td>First Amendment</td>
<td>Free Exercise Of Religion</td>
<td>1.78</td>
<td>68</td>
<td>0.418</td>
<td>0.174</td>
</tr>
<tr>
<td></td>
<td>Establishment Of Religion</td>
<td>1.46</td>
<td>48</td>
<td>0.504</td>
<td>0.254</td>
<td></td>
</tr>
<tr>
<td></td>
<td>Total</td>
<td>1.65</td>
<td>116</td>
<td>0.48</td>
<td>0.231</td>
<td></td>
</tr>
<tr>
<td>Total</td>
<td>Free Exercise Of Religion</td>
<td>1.78</td>
<td>68</td>
<td>0.418</td>
<td>0.174</td>
<td></td>
</tr>
<tr>
<td></td>
<td>Establishment Of Religion</td>
<td>1.46</td>
<td>48</td>
<td>0.504</td>
<td>0.254</td>
<td></td>
</tr>
<tr>
<td></td>
<td>Total</td>
<td>1.65</td>
<td>116</td>
<td>0.48</td>
<td>0.231</td>
<td></td>
</tr>
</tbody>
</table>
<h3 id="expected-results">Expected Results</h3>
<p>In an attempt to replicate the results of Masterpiece Cakeshop Ltd. v. Chicago Civil Rights Commission (2018) I will simply consult the three ideological values above.  If a justice scores below a 1.5 in any area, then they will be expected to vote conservatively.  Conversely if a score above 1.5 is observed the justice is expected to vote liberally.</p>
<p>In context, A liberal vote will found in favor of the Mr. Charlie Craig and his partner, Mr. Dave Mullins.  The following variables describe liberal voting preferences as they relate to the case.  Pro-civil liberties or civil rights, pro-neutrality in establishment clause cases, pro-underdog, anti-owner, anti-business, pro-government, pro-exercise of judicial action, and pro-judicial activism. A conservative vote is in favor of Mr. Philips, the Colorado baker. Conservatism in context is described as opposite the above liberal values.</p>
<h4 id="justice-vote-according-to-general-ideological-score">Justice Vote According to General Ideological Score</h4>
<h5 id="table-3">Table</h5>
<table>
<thead>
<tr>
<th>Justice</th>
<th>Score</th>
<th>Vote</th>
</tr>
</thead>
<tbody>
<tr>
<td>AMKennedy</td>
<td>1.42</td>
<td>Cons.</td>
</tr>
<tr>
<td>CThomas</td>
<td>1.32</td>
<td>Cons.</td>
</tr>
<tr>
<td>RBGinsburg</td>
<td>1.6</td>
<td>Lib.</td>
</tr>
<tr>
<td>SGBreyer</td>
<td>1.56</td>
<td>Lib.</td>
</tr>
<tr>
<td>JGRoberts</td>
<td>1.42</td>
<td>Cons.</td>
</tr>
<tr>
<td>SAAlito</td>
<td>1.36</td>
<td>Cons.</td>
</tr>
<tr>
<td>SSotomayor</td>
<td>1.62</td>
<td>Lib.</td>
</tr>
<tr>
<td>EKagan</td>
<td>1.59</td>
<td>Lib.</td>
</tr>
<tr>
<td>NMGorsuch</td>
<td>1.18</td>
<td>Cons.</td>
</tr>
<tr>
<td>Total</td>
<td>1.47</td>
<td>Cons.</td>
</tr>
</tbody>
</table>
<h4 id="justice-votes-by-first-amendment">Justice Votes by First Amendment</h4>
<h5 id="table-4">Table</h5>
<table>
<thead>
<tr>
<th>Justice</th>
<th>issue area of case (coarse)</th>
<th>Score</th>
<th>Vote</th>
</tr>
</thead>
<tbody>
<tr>
<td>AMKennedy</td>
<td>First Amendment</td>
<td>1.47</td>
<td>Cons.</td>
</tr>
<tr>
<td>CThomas</td>
<td>First Amendment</td>
<td>1.33</td>
<td>Cons.</td>
</tr>
<tr>
<td>RBGinsburg</td>
<td>First Amendment</td>
<td>1.68</td>
<td>Lib.</td>
</tr>
<tr>
<td>SGBreyer</td>
<td>First Amendment</td>
<td>1.55</td>
<td>Lib.</td>
</tr>
<tr>
<td>JGRoberts</td>
<td>First Amendment</td>
<td>1.51</td>
<td>Lib.</td>
</tr>
<tr>
<td>SAAlito</td>
<td>First Amendment</td>
<td>1.42</td>
<td>Cons.</td>
</tr>
<tr>
<td>SSotomayor</td>
<td>First Amendment</td>
<td>1.67</td>
<td>Lib.</td>
</tr>
<tr>
<td>EKagan</td>
<td>First Amendment</td>
<td>1.67</td>
<td>Lib.</td>
</tr>
<tr>
<td>NMGorsuch</td>
<td>First Amendment</td>
<td>2</td>
<td>Cons.</td>
</tr>
<tr>
<td>Total</td>
<td>First Amendment</td>
<td>1.51</td>
<td>Lib.</td>
</tr>
<tr>
<td>Total</td>
<td>1.51</td>
<td>Lib.</td>
<td></td>
</tr>
</tbody>
</table>
<h4 id="justice-votes-by-issue-area">Justice Votes by Issue Area</h4>
<h5 id="table-5">Table</h5>
<table>
<thead>
<tr>
<th>Justice Identification Number</th>
<th>Issue Area Of Case (Coarse)</th>
<th>Issue Area Of Case (Fine)</th>
<th>Score</th>
<th>Vote</th>
</tr>
</thead>
<tbody>
<tr>
<td>Amkennedy</td>
<td>First Amendment</td>
<td>Free Exercise Of Religion</td>
<td>1.71</td>
<td>Lib.</td>
</tr>
<tr>
<td></td>
<td>Establishment Of Religion</td>
<td>1.23</td>
<td>Cons.</td>
<td></td>
</tr>
<tr>
<td></td>
<td>Total</td>
<td>1.48</td>
<td>Cons.</td>
<td></td>
</tr>
<tr>
<td>Cthomas</td>
<td>First Amendment</td>
<td>Free Exercise Of Religion</td>
<td>1.91</td>
<td>Lib.</td>
</tr>
<tr>
<td></td>
<td>Establishment Of Religion</td>
<td>1.1</td>
<td>Cons.</td>
<td></td>
</tr>
<tr>
<td></td>
<td>Total</td>
<td>1.52</td>
<td>Lib</td>
<td></td>
</tr>
<tr>
<td>Rbginsburg</td>
<td>First Amendment</td>
<td>Free Exercise Of Religion</td>
<td>1.56</td>
<td>Lib</td>
</tr>
<tr>
<td></td>
<td>Establishment Of Religion</td>
<td>2</td>
<td>Lib</td>
<td></td>
</tr>
<tr>
<td></td>
<td>Total</td>
<td>1.78</td>
<td>Lib</td>
<td></td>
</tr>
<tr>
<td>Sgbreyer</td>
<td>First Amendment</td>
<td>Free Exercise Of Religion</td>
<td>1.78</td>
<td>Lib</td>
</tr>
<tr>
<td></td>
<td>Establishment Of Religion</td>
<td>1.67</td>
<td>Lib</td>
<td></td>
</tr>
<tr>
<td></td>
<td>Total</td>
<td>1.72</td>
<td>Lib</td>
<td></td>
</tr>
<tr>
<td>Jgroberts</td>
<td>First Amendment</td>
<td>Free Exercise Of Religion</td>
<td>2</td>
<td>Lib</td>
</tr>
<tr>
<td></td>
<td>Establishment Of Religion</td>
<td>1</td>
<td>Cons.</td>
<td></td>
</tr>
<tr>
<td></td>
<td>Total</td>
<td>1.78</td>
<td>Lib.</td>
<td></td>
</tr>
<tr>
<td>Saalito</td>
<td>First Amendment</td>
<td>Free Exercise Of Religion</td>
<td>2</td>
<td>Lib.</td>
</tr>
<tr>
<td></td>
<td>Establishment Of Religion</td>
<td>1</td>
<td>Cons.</td>
<td></td>
</tr>
<tr>
<td></td>
<td>Total</td>
<td>1.75</td>
<td>Lib.</td>
<td></td>
</tr>
<tr>
<td>Ssotomayor</td>
<td>First Amendment</td>
<td>Free Exercise Of Religion</td>
<td>1.5</td>
<td>Lib/Con</td>
</tr>
<tr>
<td></td>
<td>Establishment Of Religion</td>
<td>2</td>
<td>Lib.</td>
<td></td>
</tr>
<tr>
<td></td>
<td>Total</td>
<td>1.63</td>
<td>Lib.</td>
<td></td>
</tr>
<tr>
<td>Ekagan</td>
<td>First Amendment</td>
<td>Free Exercise Of Religion</td>
<td>1.8</td>
<td>Lib.</td>
</tr>
<tr>
<td></td>
<td>Establishment Of Religion</td>
<td>2</td>
<td>Lib.</td>
<td></td>
</tr>
<tr>
<td></td>
<td>Total</td>
<td>1.83</td>
<td>Lib.</td>
<td></td>
</tr>
<tr>
<td>Nmgorsuch</td>
<td>First Amendment</td>
<td>Free Exercise Of Religion</td>
<td>2</td>
<td>Lib.</td>
</tr>
<tr>
<td></td>
<td>Total</td>
<td>2</td>
<td>Lib.</td>
<td></td>
</tr>
<tr>
<td>Total</td>
<td>First Amendment</td>
<td>Free Exercise Of Religion</td>
<td>1.78</td>
<td>Lib.</td>
</tr>
<tr>
<td></td>
<td>Establishment Of Religion</td>
<td>1.46</td>
<td>Cons.</td>
<td></td>
</tr>
<tr>
<td></td>
<td>Total</td>
<td>1.65</td>
<td>Lib.</td>
<td></td>
</tr>
</tbody>
</table>
<h3 id="prediction-summary">Prediction Summary</h3>
<p>The general ideological value scores predict a 5-4 split along the usual lines (figure 5 include a ref).  The conservative majority coalition consists of Justices, Kennedy, Thomas, Roberts, Alito, and Gorsuch.  The liberal minority is of Justices Ginsberg, Breyer, Sotomayor, and Kagan.</p>
<p>The ideological scores by the first amendment issue area, predicts a very different outcome.  For instance, a 7-2 liberal majority is expected.  Kennedy, is expected to vote with the conservative coalition, along with Gorsuch.  The Liberal majority consists of, Thomas, Ginsberg, Breyer, Roberts, Alito, Sotomayor, and Kagan.</p>
<p>Testing again for individual issue areas, the results seem spurious.  When controlling for just the establishment clause, there is a 5-4 majority conservative coalition comprised of Justices Kennedy, Thomas, Roberts, Alito and Gorsuch.  The minority coalition consists of Justices, Ginsberg, Breyer, Sotomayor, Kagan.  However, when controlling for Free Exercise, a 9-0 liberal majority is the expected outcome.</p>
<h2 id="findings">Findings</h2>
<h3 id="actual-results">Actual Results</h3>
<p>The actual results of Masterpiece Cakeshop, Ltd, v. Chicago Civil Rights Commission (2018) yield a 7-2 conservative majority in favor of Mr. Phillips consisting of Justice Roberts, Justice Kennedy, Justice Thomas, Justice Breyer, Justice Alito, Justice Kagan, and Justice Gorsuch.  The liberal minority consist of Justice Ginsberg and Justice Sotomayor.  Justice Kennedy delivered the opinion of the Court.</p>
<p>The set of ideological values that best predict the actual outcome of the case is the general ideological score.  A 5-4 conservative majority in this case was expected with Justices Kennedy, Thomas, Roberts, Alito, and Gorsuch in the majority.  Justices Ginsberg, Breyer, Sotomayor, and Kagan were in the expected minority.</p>
<h3 id="attitudinal-model-evaluation">Attitudinal Model Evaluation</h3>
<p>The discrepancy between the expected results and the actual results is difficult to explain.  Restricting the analysis at this point to only the attitudinal model the explanation must be that the ideologies of the justices acted upon the facts of the case, the situations in an unexpected way.  This could be caused by two factors. The first being that the variables defining conservatism and liberalism are inaccurate.  The other being that Justices, primarily the liberals which voted conservatively voted against the dictate of their ideological preferences.</p>
<p>As stated above the attributes defining liberalism are pro-civil liberties or civil rights, pro-underdog, anti-owner, anti-business, pro-government, pro-exercise of judicial action, and pro-judicial activism.  Justice Breyer and Justice Kagan both tend to vote towards this direction.  In Masterpiece Cakeshop Ltd, v. Colorado Civil Rights Commission (2018)  however, they did not.  To run through the facts of the case quickly, Mr. Phillips is the proprietor of a small business that discriminates against a quasi-suspect class of citizens (non-heterosexual couples) in violation of Colorado state civil rights law.  When brought to suit, a civil rights administration of the state of Colorado, which is de-facto a quasi-judicial bureaucracy, oversaw the case and declared Mr. Phillip in violation of generally applicable and religiously neutral Colorado public accommodation laws.  Or in other words, every factor leading to a liberal vote is apparent in this case.  So then, Justices’ Breyer and Kagan moving in the conservative direction is remarkable.</p>
<p>Or is it?   While reading through the Court’s opinion, the Court does not greatly address Mr. Phillips’ claim.  In fact, Justice Kennedy completely side steps the freedom of speech and religious freedom haymaker.  Rather, the object of consideration turns from Mr. Phillip’s to the actions of the state’s Civil Rights Commission.  “When the Colorado Civil Rights Commission considered this case, it did not do so with the religious neutrality that the Constitution requires.” (Masterpiece Cakeshop Ltd. v. Colorado Civil Rights Commission 2018) Considering this change in object, is it that the pertinent facts of the case change as well?</p>
<p>Pro-civil liberties or civil rights, pro-underdog, anti-owner, anti-business, pro-government, pro-exercise of judicial action, and pro-judicial activism all still apply.  With the additional imposition by the Commission of “comprehensive staff training” and “quarterly compliance reports” it could also be argued that the pro-affirmative action factor may be active in this case. However, the startling material fact that distinguishes this case is the abject hostility the Civil Rights Commission demonstrated towards Mr. Philips’ “sincerely held religious beliefs (Masterpiece Cakeshop Ltd. v. Colorado Civil Rights Commission 2018).”  Therefore, the pro-neutrality of the establishment clause is grossly violated.  To such a degree that the “clear and impermissible hostility towards [the] sincere religious beliefs (Masterpiece Cakeshop Ltd. v. Colorado Civil Rights Commission 2018)” forced two liberal Justices to join the conservative coalition.</p>
<p>In Justice Kagan’s own words,</p>
<blockquote>
<p>“[I]t is a general rule that [religious and philosophical] objections do not allow business owners and other actors in the economy and in society to deny protected persons equal access to goods and services under a neutral and generally applicable public accommodations law.” Ante, at 9. But in upholding that principle, state actors cannot show hostility to religious views; rather, they must give those views “neutral and respectful consideration.” Ante, at 12. I join the Court’s opinion in full because I believe the Colorado Civil Rights Commission did not satisfy that obligation. (Masterpiece Cakeshop Ltd. v. Colorado Civil Rights Commission 2018)</p>
</blockquote>
<p>What is apparent then is that Justice Kagan recognizes that in order to apply the establishment clause neutrally the federal and state governments must not act with hostility towards individuals with sincerely held religious beliefs.  Laws of general applicability in order to be constitutional must not unduly harm religious individuals.  Thus, Justice Breyer, and Justice Kagan both agree in full with the opinion of the Court.</p>
<h3 id="legal-model-evalution">Legal Model Evalution</h3>
<p>More startling then the actual outcome of the case is the fact that the Justices largely adhered to precedent, or at least to the judicially created rule that valid law applied neutrally in respect to the establishment clause may be considered good law.  When considering the facts of the case to previous first amendment questions the results in light of the Civil Rights Commission’s hostility towards Mr. Phillips are not in any way remarkable.</p>
<p>The three-pronged Lemon v. Kurtzman (1971) test exclusively could yield the same results.  First the Colorado law does have a secular purpose.  On the other hand, due to the way in which the Civil Rights Commission applied the law, its effect “inhibits religion”.  Because of that inhibition, the Colorado state government does become unnecessarily entangled in religion.  Passing through the matrix, the actions of the state are obviously unconstitutional.</p>
<p>Consulting also Employment Div. v. Smith (1990) the court in Masterpiece Cakeshop Ltd, v. Colorado Civil Rights Commission (2018) stuck to their statement that “it is a permissible reading of U.S Const. Amend. I to say that if prohibiting the exercise or religion is not the object of a law, but merely the incidental effect of a generally applicable and otherwise valid provision, the First Amendment has not been offended (Employment Div. v. Smith, 1990).”  Therefore, a law of general applicability, applied neutrally does not warrant individual exemptions.  A point driven home by Justice Kennedy in the majority opinion, and also by Justice Kagan in her concurrence.</p>
<p>Also echoed is the basic reasoning of Obergefell v. Hodges (2015) that “under the Due Process and Equal Protections Clauses of the Fourteenth Amendment couples of the same-sex may not be deprived” of their right to marry and to share the same privileges of same-sex couples.</p>
<p>The cynical critique, however of the Court’s adherence to precedent is the fact that to a large degree precedent does not conflict with the ideological preferences of the members of the Court.   Many of the cases cited by Justice Kennedy he either authored or was member to the majority.  To those that he was not, the opinions may be linked to ideological predecessors.</p>
<p>Justice Kagan and Justice Breyer most likely voted “conservatively” due to the fact that the outcome of the case supports well established liberal precedent.  Namely in support of the neutrality of the establishment clause.  The opinion may have also persuaded their vote.  In it Justice Kennedy supports the validity of public accommodation laws protecting the civil rights of same-sex couples and people of other sexual orientations.   In the words of the Court, “It is unexceptional that Colorado law can protect gay persons, just as it can protect other classes of individuals, in acquiring whatever products and services they choose on the same terms and conditions as are offered to other members of the public (Masterpiece Cakeshop v. Colorado Civil Rights Commission, 2018)”.  It is my hypothesis that due the fact that this provision, which supports the basis of the Colorado Public Accommodation law, and the opinion in general supports a neutral application of the Establishment Clause, two liberal Justices voted in the conservative majority.</p>
<section class="footnotes" role="doc-endnotes">
<hr>
<ol>
<li id="fn:1" role="doc-endnote">
<p>Include a reference!&#160;<a href="#fnref:1" class="footnote-backref" role="doc-backlink">&#x21a9;&#xfe0e;</a></p>
</li>
<li id="fn:2" role="doc-endnote">
<p>Include a reference to the definition.&#160;<a href="#fnref:2" class="footnote-backref" role="doc-backlink">&#x21a9;&#xfe0e;</a></p>
</li>
<li id="fn:3" role="doc-endnote">
<p>Include reference to constitutional ammendment and clause&#160;<a href="#fnref:3" class="footnote-backref" role="doc-backlink">&#x21a9;&#xfe0e;</a></p>
</li>
<li id="fn:4" role="doc-endnote">
<p>This sentence doesn&rsquo;t really mean anything.  Expand upon it.&#160;<a href="#fnref:4" class="footnote-backref" role="doc-backlink">&#x21a9;&#xfe0e;</a></p>
</li>
<li id="fn:5" role="doc-endnote">
<p>reference his claim&#160;<a href="#fnref:5" class="footnote-backref" role="doc-backlink">&#x21a9;&#xfe0e;</a></p>
</li>
<li id="fn:6" role="doc-endnote">
<p>Georgia Laws, p 16; Massachusetts Perpetual laws, p. 7; New Hampshire Laws, pp. 26, 27; North Carolina Laws, p. 275.&#160;<a href="#fnref:6" class="footnote-backref" role="doc-backlink">&#x21a9;&#xfe0e;</a></p>
</li>
<li id="fn:7" role="doc-endnote">
<p>An argument could be made that language is inherently symbolic speech, but references to contemporary works must be support the argument.   The intent behind the amendment does not seem to apply to the public exhibition of painting and sculpture.&#160;<a href="#fnref:7" class="footnote-backref" role="doc-backlink">&#x21a9;&#xfe0e;</a></p>
</li>
<li id="fn:8" role="doc-endnote">
<p>Again, it is impossible to actually determine original intent.&#160;<a href="#fnref:8" class="footnote-backref" role="doc-backlink">&#x21a9;&#xfe0e;</a></p>
</li>
<li id="fn:9" role="doc-endnote">
<p>This clause importantly was written in response to the Catholic persecution of English Protestants under the reign of King James.  Under William and Mary, following the Glorious Revolution, the English Bill of Rights limited the discretion of the monarch, and secured the prevalence of the Parliament.&#160;<a href="#fnref:9" class="footnote-backref" role="doc-backlink">&#x21a9;&#xfe0e;</a></p>
</li>
<li id="fn:10" role="doc-endnote">
<p>North Carolina Laws, p. 280; Massachusetts Perpetual Laws, pp. 5-6, New Hampshire Laws, p. 23;  South Carolina Laws, App., p. 41; Virginia Religious Freedom Act, pp. 7.&#160;<a href="#fnref:10" class="footnote-backref" role="doc-backlink">&#x21a9;&#xfe0e;</a></p>
</li>
<li id="fn:11" role="doc-endnote">
<p>Traditional is to be understood as a heterosexual relationship of members of the same race.  Nontraditional is to be anything that differs from that idea.&#160;<a href="#fnref:11" class="footnote-backref" role="doc-backlink">&#x21a9;&#xfe0e;</a></p>
</li>
</ol>
</section>
]]></content>
			<postid> 32a5f76d6e0693af16c1a0fdf5f14ee4</postid>
			<author>Justin Napolitano</author>
			<author_name>Justin Napolitano</author_name>
			<author_email>personal.jnapolitano@gmail.com</author_email>
			<author_id>87654367b2fca109e7dc9d3ea8a1ebbaf0bfe374773b148c2c20d278479add99</author_id>			
		</item>
		
		<item>
			<title>Conduct Legal Research with AI: Part 5</title>
			<link>jnapolitano.com/posts/legal-research-part-5/</link>
			<pubDate>Sat, 21 May 2022 14:30:32 +0000</pubDate>
			<guid>jnapolitano.com/posts/legal-research-part-5/</guid>
			<description><![CDATA[Transforming the Library of Congress results into individual json documents contaning case information.]]></description>
			<content type="html"><![CDATA[<h1 id="legal-research-with-ai-part-5">Legal Research with AI: Part 5&quot;</h1>
<p>In the previous posts in this series, I have downloaded the data required to build the neo4j graph.  In this post, I will arrange the data into a data structure that will permit me to easily create graph nodes and most importantly relationships.</p>
<h2 id="the-runner-program">The Runner Program</h2>
<p>The raw structure of the data is organized by the results of the api requests.  There are thus 80 cases per file.  I want them organized by individual cases to facilitate integration with another dataset that will be detailed in the next post.</p>
<h3 id="glob-the-input-older">Glob the input older</h3>
<p>The program below simply reads thedownloaded json data from a folder to create a list of file paths to read.</p>
<h3 id="modify-the-case-data">Modify The Case Data</h3>
<p>It then traverses that list to find the individual case data to write to file.</p>
<h3 id="add--loc_id-to-the-dictionary">Add  <code>loc_id</code> to the Dictionary</h3>
<p>For each case it create the <code>loc_id</code> key that will be used to join with another dataset.</p>
<h3 id="write-to-file">Write to File</h3>
<p>Finally, it writes the new case dictionary to file.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-Python" data-lang="Python">
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">glob</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">json</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">from</span> <span class="nn">pprint</span> <span class="kn">import</span> <span class="n">pprint</span>
<span class="kn">import</span> <span class="nn">re</span>
<span class="c1">#from neoModelAPI import NeoNodes as nn</span>




    

<span class="k">def</span> <span class="nf">get_cwd</span><span class="p">():</span>
    <span class="n">cwd</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">cwd</span>

<span class="k">def</span> <span class="nf">get_files</span><span class="p">(</span><span class="n">cwd</span> <span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">(),</span> <span class="n">input_directory</span> <span class="o">=</span> <span class="s1">&#39;loc_cases&#39;</span><span class="p">):</span>
    
    <span class="n">path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">sep</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">cwd</span><span class="p">,</span><span class="n">input_directory</span><span class="p">])</span>
    <span class="n">file_list</span><span class="o">=</span> <span class="p">[</span><span class="n">f</span> <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">glob</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="n">path</span> <span class="o">+</span> <span class="s2">&#34;**/*.json&#34;</span><span class="p">,</span> <span class="n">recursive</span><span class="o">=</span><span class="kc">True</span><span class="p">)]</span>
  
    <span class="k">return</span> <span class="n">file_list</span>



<span class="k">def</span> <span class="nf">load_json_data</span><span class="p">(</span><span class="n">file</span><span class="p">):</span>
    <span class="n">f</span> <span class="o">=</span> <span class="nb">open</span> <span class="p">(</span><span class="n">file</span><span class="p">,</span> <span class="s2">&#34;r&#34;</span><span class="p">)</span>
  
    <span class="c1"># Reading from file</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">())</span>
    <span class="k">return</span> <span class="n">data</span>

<span class="k">def</span> <span class="nf">citation_output</span><span class="p">(</span><span class="n">file_list</span><span class="p">,</span><span class="n">cwd</span><span class="p">):</span>
    <span class="n">outpath</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">sep</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">cwd</span><span class="p">,</span><span class="s1">&#39;loc_cited&#39;</span><span class="p">])</span>
    <span class="k">for</span> <span class="n">file</span> <span class="ow">in</span> <span class="n">file_list</span><span class="p">:</span>
        
        <span class="n">data</span> <span class="o">=</span> <span class="n">load_json_data</span><span class="p">(</span><span class="n">file</span><span class="o">=</span><span class="n">file</span><span class="p">)</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;results&#39;</span><span class="p">]</span>
        <span class="c1">#data = create_citation(data)</span>
        <span class="k">for</span> <span class="n">result</span> <span class="ow">in</span> <span class="n">data</span><span class="p">:</span>
            <span class="n">split</span> <span class="o">=</span> <span class="n">result</span><span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">)</span>
            <span class="n">result</span><span class="p">[</span><span class="s1">&#39;loc_id&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">split</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span>
            <span class="n">outfile</span> <span class="o">=</span> <span class="n">split</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span> <span class="o">+</span> <span class="s1">&#39;.json&#39;</span>
            <span class="n">outfile</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">sep</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">outpath</span><span class="p">,</span><span class="n">outfile</span><span class="p">])</span>
            
            <span class="n">pprint</span><span class="p">(</span><span class="n">outfile</span><span class="p">)</span>
            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">outfile</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
                <span class="n">json</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">result</span><span class="p">,</span> <span class="n">f</span><span class="p">)</span>



<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&#34;__main__&#34;</span><span class="p">:</span>
    <span class="c1">#neo_applified = instantiate_neo_model_api()</span>
    <span class="n">cwd</span> <span class="o">=</span> <span class="n">get_cwd</span><span class="p">()</span>
    <span class="n">file_list</span> <span class="o">=</span> <span class="n">get_files</span><span class="p">(</span><span class="n">cwd</span> <span class="o">=</span> <span class="n">cwd</span><span class="p">)</span>
    <span class="n">output_files</span> <span class="o">=</span> <span class="n">citation_output</span><span class="p">(</span><span class="n">file_list</span><span class="p">,</span><span class="n">cwd</span><span class="p">)</span>

</code></pre></div>]]></content>
			<postid> 3cb320c8b411159d5d3ffe1a95808307</postid>
			<author>Justin Napolitano</author>
			<author_name>Justin Napolitano</author_name>
			<author_email>personal.jnapolitano@gmail.com</author_email>
			<author_id>87654367b2fca109e7dc9d3ea8a1ebbaf0bfe374773b148c2c20d278479add99</author_id>			
		</item>
		
		<item>
			<title>Rice Paddy Methane Emissions Estimation: Part 1</title>
			<link>jnapolitano.com/posts/rice-paddy-emissions-1/</link>
			<pubDate>Sat, 21 May 2022 08:30:32 +0000</pubDate>
			<guid>jnapolitano.com/posts/rice-paddy-emissions-1/</guid>
			<description><![CDATA[Fact checking reported methane emissions proposed by the UN and Climate TRACE]]></description>
			<content type="html"><![CDATA[<h1 id="methane-emissions-estimation-data-part-1-a-comparison-between-faostat-and-university-of-malaysia-estimates">Methane Emissions Estimation Data Part 1: A Comparison between FAOSTAT and University of Malaysia Estimates</h1>
<p>This post documents the data exploration phase of a project that determines whether global methane emissions produced by rice paddies are undercounted.</p>
<p>It is fairly code python and pandas heavy.</p>
<p>The code and data exploration follows the summary below.</p>
<h2 id="inspiration-for-this-work">Inspiration for this work</h2>
<p>The University of Malaysia in partnership with Climate TRACE release a paper stating that the UN undercounts rice paddy methane emissions by about 16%.  Upon review of their claims, I decided to test the data myself across a 5 year distribution to verify that the claims hold up across multiple distributions.</p>
<h3 id="university-of-malaysia-methodological-deficiencies">University of Malaysia Methodological Deficiencies</h3>
<ul>
<li>Comparing a 2019 distribution FAOSTAT to a 2020 distribution.</li>
<li>Rounding to 4 signficant figures.</li>
<li>Testing only one year of emissions data.</li>
<li>Did not publish data to hypothesis testing to determine if emission distributions significantly vary annually and between states.</li>
<li>Relying only on satellite data may undercount hectares in cultivation at higher altitudes.</li>
</ul>
<h3 id="faostat-methodological-deficiencies">FaoStat Methodological Deficiencies</h3>
<ul>
<li>Relies upon official government statistics which can be manipulated at any point along the bureaucratic paper chain.</li>
<li>There is an incentive for certain nations to reduce their counts in order to receive international aid and to meet emissions standards.</li>
</ul>
<h3 id="university-of-malaysia-acknowledging-deficiencies-like-all-good-papers-should">University of Malaysia acknowledging deficiencies (like all good papers should)</h3>
<p>&ldquo;The difference between harvested rice cultivation area from statistical data and remote-sensing estimates can be due to two factors: (i) MODIS data which have moderate spatial resolution lead to mixed pixels, where rice fields and non-rice fields are combined. This can overestimate area, especially in lowland regions and have a low ability to detect small rice field patches in upland regions (Frolking et al 1999, Seto et al 2000); and (ii) political and policy factors (Yan et al., 2019) such as determination of the amount of subsidies for fertilizers and evaluation of achievement of government programs in the agricultural sector. Other factors that contribute to discrepancy in CH4 emission are from different emission and scale factors that are related to water regime and organic amendment. These values give high uncertainty since the availability of these data are limited and quite variable.&rdquo;</p>
<h2 id="my-initial-impressions-and-findings">My Initial Impressions and findings</h2>
<h3 id="initial">Initial</h3>
<p>The percent difference and the tonnage difference do not support each other.  I need to recalculate the totals section to ensure that we are doing things correctly.</p>
<p>I need to confirm the values, but I&rsquo;m initially impressed by the fact that the FAOSTAT data reports higher values than the Malaysia data on average.  According to the included paper this should not be the case.</p>
<h3 id="verified">Verified</h3>
<p>I calculated differences totals and means per DataFrame to ensure accuracy prior to the join.  I also dropped pre-calcuated values when joining to ensure that the aggregation algorithms to not modify the results.</p>
<p>The data is now consistent and supports the findings of the University of Malaysia Paper.  With that said it is important to note that the differences recorded are far smaller than suggested.</p>
<h2 id="import-dependencies">Import Dependencies</h2>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">geopandas</span> <span class="k">as</span> <span class="nn">gpd</span>
<span class="kn">import</span> <span class="nn">folium</span>
<span class="kn">import</span> <span class="nn">contextily</span> <span class="k">as</span> <span class="nn">cx</span>
<span class="kn">from</span> <span class="nn">shapely.geometry</span> <span class="kn">import</span> <span class="n">Point</span><span class="p">,</span> <span class="n">LineString</span><span class="p">,</span> <span class="n">Polygon</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">from</span> <span class="nn">scipy.spatial</span> <span class="kn">import</span> <span class="n">cKDTree</span>
<span class="kn">from</span> <span class="nn">geopy.distance</span> <span class="kn">import</span> <span class="n">distance</span>
<span class="kn">import</span> <span class="nn">scipy.stats</span> <span class="k">as</span> <span class="nn">stats</span>

</code></pre></div><h3 id="dependencies">Dependencies</h3>
<ul>
<li>Geopandas</li>
<li>pandas</li>
<li>openpyxl</li>
<li>Shapely</li>
<li>geopy Distance</li>
<li>numpy</li>
</ul>
<h2 id="exploration-plan">Exploration Plan</h2>
<h3 id="data-imports">Data Imports</h3>
<ul>
<li>/Users/jnapolitano/Projects/wattime-takehome/data/ch4_2015-2021.xlsx</li>
<li>/Users/jnapolitano/Projects/wattime-takehome/data/emissions_csv_fao_emiss_csv_ch4_fao_2015_2019_tonnes.xlsx</li>
</ul>
<h3 id="import-data-frames">Import Data Frames</h3>
<p>Since jupyter caches the data to the notebook json I can import the dataframes that I will be using together.</p>
<p>If I were to build automated scripts to perform the analysis I would only load the data necessary to perform a process.</p>
<h3 id="experiment-with-plots-for-each-set">Experiment with Plots for each Set</h3>
<p>I don&rsquo;t know exactly which plots I want to include in the final report.</p>
<p>I &rsquo;ll plot a few for each data set</p>
<h3 id="calculate-differences-between-the-datasets">Calculate differences between the datasets</h3>
<ul>
<li>create a differences data frame</li>
<li>write to file for use</li>
<li>plot</li>
</ul>
<h2 id="university-of-malaysia-emission-estimates">University of Malaysia Emission Estimates</h2>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="n">filepath</span> <span class="o">=</span> <span class="s2">&#34;/Users/jnapolitano/Projects/wattime-takehome/wattime-takehome/data/ch4_2015-2021.xlsx&#34;</span>

<span class="n">malaysia_emissions_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_excel</span><span class="p">(</span><span class="n">filepath</span><span class="p">)</span>
</code></pre></div><h3 id="print-df-head">Print Df Head</h3>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="n">malaysia_emissions_df</span>
</code></pre></div><!-- raw HTML omitted -->
<pre><code>.dataframe tbody tr th {
    vertical-align: top;
}

.dataframe thead th {
    text-align: right;
}
</code></pre>
<p><!-- raw HTML omitted --></p>
<!-- raw HTML omitted -->
<h3 id="calculate-co2-equivalency">Calculate Co2 Equivalency</h3>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="n">malaysia_emissions_df</span><span class="p">[</span><span class="s1">&#39;tCO2_2015&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">malaysia_emissions_df</span><span class="p">[</span><span class="s1">&#39;tCH4_2015&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="mi">25</span><span class="p">)</span>
<span class="n">malaysia_emissions_df</span><span class="p">[</span><span class="s1">&#39;tCO2_2016&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">malaysia_emissions_df</span><span class="p">[</span><span class="s1">&#39;tCH4_2016&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="mi">25</span><span class="p">)</span>
<span class="n">malaysia_emissions_df</span><span class="p">[</span><span class="s1">&#39;tCO2_2017&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">malaysia_emissions_df</span><span class="p">[</span><span class="s1">&#39;tCH4_2017&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="mi">25</span><span class="p">)</span>
<span class="n">malaysia_emissions_df</span><span class="p">[</span><span class="s1">&#39;tCO2_2018&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">malaysia_emissions_df</span><span class="p">[</span><span class="s1">&#39;tCH4_2018&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="mi">25</span><span class="p">)</span>
<span class="n">malaysia_emissions_df</span><span class="p">[</span><span class="s1">&#39;tCO2_2019&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">malaysia_emissions_df</span><span class="p">[</span><span class="s1">&#39;tCH4_2019&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="mi">25</span><span class="p">)</span>
</code></pre></div><h3 id="calculate-means">Calculate Means</h3>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="n">malaysia_emissions_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="s1">&#39;mean&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">malaysia_emissions_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[(</span><span class="n">malaysia_emissions_df</span><span class="p">[</span><span class="s1">&#39;country_name&#39;</span><span class="p">]</span> <span class="o">!=</span> <span class="s2">&#34;Total&#34;</span><span class="p">)]</span><span class="o">.</span><span class="n">select_dtypes</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">number</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
<span class="n">malaysia_emissions_df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="s1">&#39;mean&#39;</span><span class="p">,</span><span class="s1">&#39;country_name&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;mean&#39;</span>
<span class="n">malaysia_emissions_df</span>
</code></pre></div><!-- raw HTML omitted -->
<pre><code>.dataframe tbody tr th {
    vertical-align: top;
}

.dataframe thead th {
    text-align: right;
}
</code></pre>
<p><!-- raw HTML omitted --></p>
<!-- raw HTML omitted -->
<h3 id="calculate-means-and-totals-across-rows">Calculate Means and Totals Across Rows</h3>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="n">malaysia_emissions_df</span><span class="p">[</span><span class="s2">&#34;Mean_CH4&#34;</span><span class="p">]</span> <span class="o">=</span> <span class="n">mean_series</span>
<span class="n">malaysia_emissions_df</span><span class="p">[</span><span class="s1">&#39;Total_CH4&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">total_series</span> 
</code></pre></div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="c1">## the select np.number is uncecessary, but i&#39;m including anyways as it doesnt really hurt but for a small calculation penalty</span>
<span class="n">malaysia_emissions_df</span><span class="p">[</span><span class="s2">&#34;Mean_CO2&#34;</span><span class="p">]</span> <span class="o">=</span> <span class="n">mean_series</span>
<span class="n">malaysia_emissions_df</span><span class="p">[</span><span class="s1">&#39;Total_CO2&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">total_series</span> 
</code></pre></div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="n">malaysia_emissions_df</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">drop</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>
</code></pre></div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="n">malaysia_emissions_df</span>
</code></pre></div><!-- raw HTML omitted -->
<pre><code>.dataframe tbody tr th {
    vertical-align: top;
}

.dataframe thead th {
    text-align: right;
}
</code></pre>
<p><!-- raw HTML omitted --></p>
<!-- raw HTML omitted -->
<h3 id="write-data-to-file">Write Data to File</h3>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="n">outfile</span> <span class="o">=</span> <span class="s2">&#34;/Users/jnapolitano/Projects/wattime-takehome/wattime-takehome/data/TRACE_DATA.csv&#34;</span>

<span class="n">malaysia_emissions_df</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="n">outfile</span><span class="p">)</span>
</code></pre></div><h2 id="university-of-malaysia-plots">University of Malaysia Plots</h2>
<h3 id="university-of-malaysia-bar-plot">University of Malaysia Bar Plot</h3>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="n">malaysia_emissions_df</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">kind</span> <span class="o">=</span> <span class="s2">&#34;barh&#34;</span><span class="p">,</span> <span class="n">x</span> <span class="o">=</span> <span class="s1">&#39;country_name&#39;</span><span class="p">,</span> <span class="n">xlabel</span> <span class="o">=</span> <span class="s2">&#34;Country Name&#34;</span><span class="p">,</span> <span class="n">ylabel</span> <span class="o">=</span> <span class="s2">&#34;CH4 Tonnes&#34;</span><span class="p">,</span> <span class="n">figsize</span> <span class="o">=</span> <span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">5</span><span class="p">))</span>
</code></pre></div><pre><code>&lt;AxesSubplot:ylabel='Country Name'&gt;
</code></pre>
<p><img src="data_exploration_files/data_exploration_28_1.png" alt="png"></p>
<h3 id="university-of-malaysia-density-plot">University of Malaysia Density Plot</h3>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="n">malaysia_emissions_df</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">rot</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">kind</span> <span class="o">=</span> <span class="s2">&#34;density&#34;</span><span class="p">,</span> <span class="n">figsize</span> <span class="o">=</span> <span class="p">(</span><span class="mi">15</span><span class="p">,</span><span class="mi">5</span><span class="p">))</span> 
</code></pre></div><pre><code>&lt;AxesSubplot:ylabel='Density'&gt;
</code></pre>
<p><img src="data_exploration_files/data_exploration_30_1.png" alt="png"></p>
<p>I did not exclude totals or mean from the dataframe, but as we can see the second hump in the density graph shows the distribution of totals annualy.  Interestingly the 2020 data is shifted further to the right than other years.  This actually questions the validity of the study promoted by the University of malaysia</p>
<h2 id="faostat-data">FAOSTAT Data</h2>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="n">filepath</span> <span class="o">=</span> <span class="s2">&#34;/Users/jnapolitano/Projects/wattime-takehome/wattime-takehome/data/emissions_csv_fao_emiss_csv_ch4_fao_2015_2019_tonnes.xlsx&#34;</span>

<span class="n">faostat_emissions_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_excel</span><span class="p">(</span><span class="n">filepath</span><span class="p">)</span>
</code></pre></div><h3 id="print-faostat-data">Print FAOSTAT Data</h3>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="c1">## I didn&#39;t write the index to the csv file in the previous step.  IF time permits go back and fix this error</span>
<span class="n">faostat_emissions_df</span>

</code></pre></div><!-- raw HTML omitted -->
<pre><code>.dataframe tbody tr th {
    vertical-align: top;
}

.dataframe thead th {
    text-align: right;
}
</code></pre>
<p><!-- raw HTML omitted --></p>
<!-- raw HTML omitted -->
<h3 id="change-code-to-iso3_country">Change code to iso3_country</h3>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python">
<span class="n">faostat_emissions_df</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="s2">&#34;code&#34;</span><span class="p">:</span> <span class="s2">&#34;iso3_country&#34;</span><span class="p">},</span> <span class="n">inplace</span> <span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">faostat_emissions_df</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="s2">&#34;country&#34;</span><span class="p">:</span> <span class="s2">&#34;country_name&#34;</span><span class="p">},</span> <span class="n">inplace</span> <span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="c1"># The column title is not a string.  It is understood as an int or a datetime.  </span>
<span class="c1">#faostat_emissions_df[&#39;2015&#39;]</span>
<span class="n">faostat_emissions_df</span>
</code></pre></div><!-- raw HTML omitted -->
<pre><code>.dataframe tbody tr th {
    vertical-align: top;
}

.dataframe thead th {
    text-align: right;
}
</code></pre>
<p><!-- raw HTML omitted --></p>
<!-- raw HTML omitted -->
<h3 id="set-country_name-total-to-total">Set country_name total to total</h3>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="n">faostat_emissions_df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="mi">23</span><span class="p">,</span><span class="s1">&#39;country_name&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;Total&#39;</span>
</code></pre></div><h3 id="drop-fao-country-code">Drop Fao Country Code</h3>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="n">faostat_emissions_df</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">labels</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;country_fao&#39;</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">faostat_emissions_df</span>
</code></pre></div><!-- raw HTML omitted -->
<pre><code>.dataframe tbody tr th {
    vertical-align: top;
}

.dataframe thead th {
    text-align: right;
}
</code></pre>
<p><!-- raw HTML omitted --></p>
<!-- raw HTML omitted -->
<h3 id="calculate-co2-equivalency-1">Calculate Co2 Equivalency</h3>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="n">faostat_emissions_df</span><span class="p">[</span><span class="s1">&#39;tCO2_2015&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">faostat_emissions_df</span><span class="p">[</span><span class="mi">2015</span><span class="p">]</span> <span class="o">*</span> <span class="mi">25</span>
<span class="n">faostat_emissions_df</span><span class="p">[</span><span class="s1">&#39;tCO2_2016&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">faostat_emissions_df</span><span class="p">[</span><span class="mi">2016</span><span class="p">]</span> <span class="o">*</span> <span class="mi">25</span>
<span class="n">faostat_emissions_df</span><span class="p">[</span><span class="s1">&#39;tCO2_2017&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">faostat_emissions_df</span><span class="p">[</span><span class="mi">2017</span><span class="p">]</span> <span class="o">*</span> <span class="mi">25</span>
<span class="n">faostat_emissions_df</span><span class="p">[</span><span class="s1">&#39;tCO2_2018&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">faostat_emissions_df</span><span class="p">[</span><span class="mi">2018</span><span class="p">]</span> <span class="o">*</span> <span class="mi">25</span>
<span class="n">faostat_emissions_df</span><span class="p">[</span><span class="s1">&#39;tCO2_2019&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">faostat_emissions_df</span><span class="p">[</span><span class="mi">2019</span><span class="p">]</span> <span class="o">*</span> <span class="mi">25</span>
</code></pre></div><h3 id="calculate-means-1">Calculate Means</h3>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="n">faostat_emissions_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="s1">&#39;mean&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">faostat_emissions_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[(</span><span class="n">faostat_emissions_df</span><span class="p">[</span><span class="s1">&#39;country_name&#39;</span><span class="p">]</span> <span class="o">!=</span> <span class="s2">&#34;Total&#34;</span><span class="p">)]</span><span class="o">.</span><span class="n">select_dtypes</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">number</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
<span class="n">faostat_emissions_df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="s1">&#39;mean&#39;</span><span class="p">,</span><span class="s1">&#39;country_name&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;mean&#39;</span>
<span class="n">faostat_emissions_df</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="c1">#faostat_emissions_df.at[&#39;mean&#39;,&#39;country_fao&#39;] = &#39;mean&#39;</span>

</code></pre></div><h3 id="calculate-means-and-totals-across-rows-1">Calculate Means and Totals Across Rows</h3>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="n">faostat_emissions_df</span><span class="p">[</span><span class="s2">&#34;Mean_CH4&#34;</span><span class="p">]</span> <span class="o">=</span> <span class="n">mean_series</span>
<span class="n">faostat_emissions_df</span><span class="p">[</span><span class="s1">&#39;Total_CH4&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">total_series</span> 
</code></pre></div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="c1">## the select np.number is uncecessary, but i&#39;m including anyways as it doesnt really hurt but for a small calculation penalty</span>
<span class="n">faostat_emissions_df</span><span class="p">[</span><span class="s2">&#34;Mean_CO2&#34;</span><span class="p">]</span> <span class="o">=</span> <span class="n">mean_series</span>
<span class="n">faostat_emissions_df</span><span class="p">[</span><span class="s1">&#39;Total_CO2&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">total_series</span> 
</code></pre></div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="n">faostat_emissions_df</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</code></pre></div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="n">faostat_emissions_df</span>
</code></pre></div><!-- raw HTML omitted -->
<pre><code>.dataframe tbody tr th {
    vertical-align: top;
}

.dataframe thead th {
    text-align: right;
}
</code></pre>
<p><!-- raw HTML omitted --></p>
<!-- raw HTML omitted -->
<h3 id="faostat-data-to-file">FAOSTAT Data to File</h3>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="n">outfile</span> <span class="o">=</span> <span class="s2">&#34;/Users/jnapolitano/Projects/wattime-takehome/wattime-takehome/data/FAOSTAT_DATA.csv&#34;</span>

<span class="n">faostat_emissions_df</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="n">outfile</span><span class="p">)</span>
</code></pre></div><h2 id="faostat-plots">FaoSTAT PLOTS</h2>
<h3 id="faostat-hectare-estimates-bar-plot">FAOSTAT Hectare Estimates Bar Plot</h3>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="n">faostat_emissions_df</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">kind</span> <span class="o">=</span> <span class="s2">&#34;barh&#34;</span><span class="p">,</span> <span class="n">x</span> <span class="o">=</span> <span class="s1">&#39;country_name&#39;</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="p">[</span><span class="mi">2015</span><span class="p">,</span> <span class="mi">2016</span><span class="p">,</span> <span class="mi">2017</span><span class="p">,</span> <span class="mi">2018</span><span class="p">,</span> <span class="mi">2019</span><span class="p">],</span> <span class="n">xlabel</span> <span class="o">=</span> <span class="s2">&#34;Country Name&#34;</span><span class="p">,</span> <span class="n">ylabel</span> <span class="o">=</span> <span class="s2">&#34;Tonnes CH4&#34;</span><span class="p">,</span> <span class="n">figsize</span> <span class="o">=</span> <span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">5</span><span class="p">))</span>
</code></pre></div><pre><code>&lt;AxesSubplot:ylabel='Country Name'&gt;
</code></pre>
<p><img src="data_exploration_files/data_exploration_55_1.png" alt="png"></p>
<h3 id="faostat-density-plot">FAOSTAT Density Plot</h3>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="n">faostat_emissions_df</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">rot</span> <span class="o">=</span> <span class="mi">90</span><span class="p">,</span> <span class="n">kind</span> <span class="o">=</span> <span class="s2">&#34;density&#34;</span><span class="p">,</span><span class="n">y</span> <span class="o">=</span> <span class="p">[</span><span class="mi">2015</span><span class="p">,</span> <span class="mi">2016</span><span class="p">,</span> <span class="mi">2017</span><span class="p">,</span> <span class="mi">2018</span><span class="p">,</span> <span class="mi">2019</span><span class="p">],</span> <span class="n">figsize</span> <span class="o">=</span> <span class="p">(</span><span class="mi">15</span><span class="p">,</span><span class="mi">5</span><span class="p">))</span> 
</code></pre></div><pre><code>&lt;AxesSubplot:ylabel='Density'&gt;
</code></pre>
<p><img src="data_exploration_files/data_exploration_57_1.png" alt="png"></p>
<p>The density plot is fairly consistent.  There is nearly no variation between nations and in total.  The 2020 data may show otherwise as the Malaysian data shows.</p>
<h2 id="join-dfs-by-iso3-country">Join Df&rsquo;s by ISO3 Country</h2>
<h3 id="drop-totals-and-means-from-the-original-df">Drop totals and means from the original df.</h3>
<p>Because I am joining on iso3 country country code if the totals and means are located at different indexes we may experience merge and calculation errors</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="n">faostat_emissions_df</span> <span class="o">=</span> <span class="n">faostat_emissions_df</span><span class="p">[(</span><span class="n">faostat_emissions_df</span><span class="p">[</span><span class="s2">&#34;country_name&#34;</span><span class="p">]</span> <span class="o">!=</span> <span class="s2">&#34;Total&#34;</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">faostat_emissions_df</span><span class="p">[</span><span class="s1">&#39;country_name&#39;</span><span class="p">]</span> <span class="o">!=</span> <span class="s1">&#39;mean&#39;</span><span class="p">)]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</code></pre></div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="n">malaysia_emissions_df</span> <span class="o">=</span> <span class="n">malaysia_emissions_df</span><span class="p">[(</span><span class="n">malaysia_emissions_df</span><span class="p">[</span><span class="s2">&#34;country_name&#34;</span><span class="p">]</span> <span class="o">!=</span> <span class="s2">&#34;Total&#34;</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">malaysia_emissions_df</span><span class="p">[</span><span class="s1">&#39;country_name&#39;</span><span class="p">]</span> <span class="o">!=</span> <span class="s1">&#39;mean&#39;</span><span class="p">)]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</code></pre></div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="n">faostat_emissions_df</span>
</code></pre></div><!-- raw HTML omitted -->
<pre><code>.dataframe tbody tr th {
    vertical-align: top;
}

.dataframe thead th {
    text-align: right;
}
</code></pre>
<p><!-- raw HTML omitted --></p>
<!-- raw HTML omitted -->
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="n">malaysia_emissions_df</span>
</code></pre></div><!-- raw HTML omitted -->
<pre><code>.dataframe tbody tr th {
    vertical-align: top;
}

.dataframe thead th {
    text-align: right;
}
</code></pre>
<p><!-- raw HTML omitted --></p>
<!-- raw HTML omitted -->
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="n">merged_df</span> <span class="o">=</span> <span class="n">faostat_emissions_df</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">malaysia_emissions_df</span><span class="p">,</span><span class="n">suffixes</span><span class="o">=</span><span class="p">(</span><span class="s1">&#39;_FAOSTAT&#39;</span><span class="p">,</span> <span class="s1">&#39;_TRACE&#39;</span><span class="p">),</span> <span class="n">on</span><span class="o">=</span><span class="s1">&#39;iso3_country&#39;</span><span class="p">,</span> <span class="n">how</span><span class="o">=</span><span class="s1">&#39;left&#39;</span><span class="p">,</span> <span class="n">sort</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</code></pre></div><h3 id="dropping-2020-and-2021-from-the-data-sets">Dropping 2020 and 2021 from the data sets</h3>
<p>I will only compare data compiled from the same year.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="n">merged_df</span><span class="o">.</span><span class="n">drop</span><span class="p">([</span><span class="mi">2020</span><span class="p">,</span> <span class="mi">2021</span><span class="p">,</span> <span class="s2">&#34;tCH4_2020&#34;</span><span class="p">,</span><span class="s2">&#34;tCH4_2021&#34;</span><span class="p">],</span> <span class="n">axis</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">inplace</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>
</code></pre></div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="n">merged_df</span>
</code></pre></div><!-- raw HTML omitted -->
<pre><code>.dataframe tbody tr th {
    vertical-align: top;
}

.dataframe thead th {
    text-align: right;
}
</code></pre>
<p><!-- raw HTML omitted --></p>
<!-- raw HTML omitted -->
<h3 id="calculate-difference-in-ch4-tonnes-between-the-estimates">Calculate difference in Ch4 Tonnes Between the Estimates</h3>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="c1"># Calculate Difference in tons</span>
<span class="n">merged_df</span><span class="p">[</span><span class="s1">&#39;CH4_diff_2015&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">merged_df</span><span class="p">[</span><span class="mi">2015</span><span class="p">]</span> <span class="o">-</span> <span class="n">merged_df</span><span class="p">[</span><span class="s1">&#39;tCH4_2015&#39;</span><span class="p">]</span>
<span class="n">merged_df</span><span class="p">[</span><span class="s1">&#39;CH4_diff_2016&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">merged_df</span><span class="p">[</span><span class="mi">2016</span><span class="p">]</span> <span class="o">-</span> <span class="n">merged_df</span><span class="p">[</span><span class="s1">&#39;tCH4_2016&#39;</span><span class="p">]</span>
<span class="n">merged_df</span><span class="p">[</span><span class="s1">&#39;CH4_diff_2017&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">merged_df</span><span class="p">[</span><span class="mi">2017</span><span class="p">]</span> <span class="o">-</span> <span class="n">merged_df</span><span class="p">[</span><span class="s1">&#39;tCH4_2017&#39;</span><span class="p">]</span>
<span class="n">merged_df</span><span class="p">[</span><span class="s1">&#39;CH4_diff_2018&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">merged_df</span><span class="p">[</span><span class="mi">2018</span><span class="p">]</span> <span class="o">-</span> <span class="n">merged_df</span><span class="p">[</span><span class="s1">&#39;tCH4_2018&#39;</span><span class="p">]</span>
<span class="n">merged_df</span><span class="p">[</span><span class="s1">&#39;CH4_diff_2019&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">merged_df</span><span class="p">[</span><span class="mi">2019</span><span class="p">]</span> <span class="o">-</span> <span class="n">merged_df</span><span class="p">[</span><span class="s1">&#39;tCH4_2019&#39;</span><span class="p">]</span>
<span class="n">merged_df</span><span class="p">[</span><span class="s1">&#39;CH4_diff_means&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">merged_df</span><span class="p">[</span><span class="s1">&#39;Mean_CH4_FAOSTAT&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">merged_df</span><span class="p">[</span><span class="s1">&#39;Mean_CH4_TRACE&#39;</span><span class="p">]</span>
<span class="n">merged_df</span><span class="p">[</span><span class="s1">&#39;CH4_diff_totals&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">merged_df</span><span class="p">[</span><span class="s1">&#39;Total_CH4_FAOSTAT&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">merged_df</span><span class="p">[</span><span class="s1">&#39;Total_CH4_TRACE&#39;</span><span class="p">]</span>


</code></pre></div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="n">merged_df</span>
</code></pre></div><!-- raw HTML omitted -->
<pre><code>.dataframe tbody tr th {
    vertical-align: top;
}

.dataframe thead th {
    text-align: right;
}
</code></pre>
<p><!-- raw HTML omitted --></p>
<!-- raw HTML omitted -->
<h3 id="calculate-difference-in-c02-tonnes-between-the-estimates">Calculate difference in C02 Tonnes Between the Estimates</h3>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="c1"># Calculate Difference in tons</span>
<span class="n">merged_df</span><span class="p">[</span><span class="s1">&#39;CO2_diff_2015&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">merged_df</span><span class="p">[</span><span class="s1">&#39;tCO2_2015_FAOSTAT&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">merged_df</span><span class="p">[</span><span class="s1">&#39;tCO2_2015_TRACE&#39;</span><span class="p">]</span>
<span class="n">merged_df</span><span class="p">[</span><span class="s1">&#39;CO2_diff_2016&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">merged_df</span><span class="p">[</span><span class="s1">&#39;tCO2_2016_FAOSTAT&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">merged_df</span><span class="p">[</span><span class="s1">&#39;tCO2_2016_TRACE&#39;</span><span class="p">]</span>
<span class="n">merged_df</span><span class="p">[</span><span class="s1">&#39;CO2_diff_2017&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">merged_df</span><span class="p">[</span><span class="s1">&#39;tCO2_2017_FAOSTAT&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">merged_df</span><span class="p">[</span><span class="s1">&#39;tCO2_2017_TRACE&#39;</span><span class="p">]</span>
<span class="n">merged_df</span><span class="p">[</span><span class="s1">&#39;CO2_diff_2018&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">merged_df</span><span class="p">[</span><span class="s1">&#39;tCO2_2018_FAOSTAT&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">merged_df</span><span class="p">[</span><span class="s1">&#39;tCO2_2018_TRACE&#39;</span><span class="p">]</span>
<span class="n">merged_df</span><span class="p">[</span><span class="s1">&#39;CO2_diff_2019&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">merged_df</span><span class="p">[</span><span class="s1">&#39;tCO2_2019_FAOSTAT&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">merged_df</span><span class="p">[</span><span class="s1">&#39;tCO2_2019_TRACE&#39;</span><span class="p">]</span>
<span class="n">merged_df</span><span class="p">[</span><span class="s1">&#39;CO2_diff_means&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">merged_df</span><span class="p">[</span><span class="s1">&#39;Mean_CO2_FAOSTAT&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">merged_df</span><span class="p">[</span><span class="s1">&#39;Mean_CO2_TRACE&#39;</span><span class="p">]</span>
<span class="n">merged_df</span><span class="p">[</span><span class="s1">&#39;CO2_diff_totals&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">merged_df</span><span class="p">[</span><span class="s1">&#39;Total_CO2_FAOSTAT&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">merged_df</span><span class="p">[</span><span class="s1">&#39;Total_CO2_TRACE&#39;</span><span class="p">]</span>


</code></pre></div><h3 id="calculating-the-ch4-percent-differences-between-the-estimates">Calculating the CH4 Percent Differences Between the Estimates</h3>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="c1">## Calculate Percent Differnces on this data set )*100</span>
<span class="c1"># With raw data i could have accomplished this with a groupby.aggregate(lambda x ), however the pivot tables given are not easy to apply #vectorized functions across time series</span>
<span class="n">merged_df</span><span class="p">[</span><span class="s1">&#39;CH4_abs_percent_diff_2015&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">((</span><span class="nb">abs</span><span class="p">(</span><span class="n">merged_df</span><span class="p">[</span><span class="mi">2015</span><span class="p">]</span> <span class="o">-</span> <span class="n">merged_df</span><span class="p">[</span><span class="s1">&#39;tCH4_2015&#39;</span><span class="p">]))</span><span class="o">/</span><span class="p">((</span><span class="n">merged_df</span><span class="p">[</span><span class="mi">2015</span><span class="p">]</span> <span class="o">+</span> <span class="n">merged_df</span><span class="p">[</span><span class="s1">&#39;tCH4_2015&#39;</span><span class="p">])</span><span class="o">/</span><span class="mi">2</span><span class="p">))</span><span class="o">*</span><span class="mi">100</span>
<span class="n">merged_df</span><span class="p">[</span><span class="s1">&#39;CH4_abs_percent_diff_2016&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">((</span><span class="nb">abs</span><span class="p">((</span><span class="n">merged_df</span><span class="p">[</span><span class="mi">2016</span><span class="p">]</span> <span class="o">-</span> <span class="n">merged_df</span><span class="p">[</span><span class="s1">&#39;tCH4_2016&#39;</span><span class="p">]))</span><span class="o">/</span><span class="p">((</span><span class="n">merged_df</span><span class="p">[</span><span class="mi">2016</span><span class="p">]</span> <span class="o">+</span> <span class="n">merged_df</span><span class="p">[</span><span class="s1">&#39;tCH4_2016&#39;</span><span class="p">])</span><span class="o">/</span><span class="mi">2</span><span class="p">)))</span><span class="o">*</span><span class="mi">100</span>
<span class="n">merged_df</span><span class="p">[</span><span class="s1">&#39;CH4_abs_percent_diff_2017&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">((</span><span class="nb">abs</span><span class="p">(</span><span class="n">merged_df</span><span class="p">[</span><span class="mi">2017</span><span class="p">]</span> <span class="o">-</span> <span class="n">merged_df</span><span class="p">[</span><span class="s1">&#39;tCH4_2017&#39;</span><span class="p">]))</span><span class="o">/</span><span class="p">((</span><span class="n">merged_df</span><span class="p">[</span><span class="mi">2017</span><span class="p">]</span> <span class="o">+</span> <span class="n">merged_df</span><span class="p">[</span><span class="s1">&#39;tCH4_2017&#39;</span><span class="p">])</span><span class="o">/</span><span class="mi">2</span><span class="p">))</span><span class="o">*</span><span class="mi">100</span>
<span class="n">merged_df</span><span class="p">[</span><span class="s1">&#39;CH4_abs_percent_diff_2018&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="nb">abs</span><span class="p">((</span><span class="n">merged_df</span><span class="p">[</span><span class="mi">2018</span><span class="p">]</span> <span class="o">-</span> <span class="n">merged_df</span><span class="p">[</span><span class="s1">&#39;tCH4_2018&#39;</span><span class="p">]))</span><span class="o">/</span><span class="p">((</span><span class="n">merged_df</span><span class="p">[</span><span class="mi">2018</span><span class="p">]</span> <span class="o">+</span> <span class="n">merged_df</span><span class="p">[</span><span class="s1">&#39;tCH4_2018&#39;</span><span class="p">])</span><span class="o">/</span><span class="mi">2</span><span class="p">))</span><span class="o">*</span><span class="mi">100</span>
<span class="n">merged_df</span><span class="p">[</span><span class="s1">&#39;CH4_abs_percent_diff_2019&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="nb">abs</span><span class="p">((</span><span class="n">merged_df</span><span class="p">[</span><span class="mi">2019</span><span class="p">]</span> <span class="o">-</span> <span class="n">merged_df</span><span class="p">[</span><span class="s1">&#39;tCH4_2019&#39;</span><span class="p">]))</span><span class="o">/</span><span class="p">((</span><span class="n">merged_df</span><span class="p">[</span><span class="mi">2019</span><span class="p">]</span> <span class="o">+</span> <span class="n">merged_df</span><span class="p">[</span><span class="s1">&#39;tCH4_2019&#39;</span><span class="p">])</span><span class="o">/</span><span class="mi">2</span><span class="p">))</span><span class="o">*</span><span class="mi">100</span>
<span class="n">merged_df</span><span class="p">[</span><span class="s1">&#39;CH4_abs_percent_diff_means&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="nb">abs</span><span class="p">((</span><span class="n">merged_df</span><span class="p">[</span><span class="s1">&#39;Mean_CH4_FAOSTAT&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">merged_df</span><span class="p">[</span><span class="s1">&#39;Mean_CH4_TRACE&#39;</span><span class="p">]))</span><span class="o">/</span><span class="p">((</span><span class="n">merged_df</span><span class="p">[</span><span class="s1">&#39;Mean_CH4_FAOSTAT&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">merged_df</span><span class="p">[</span><span class="s1">&#39;Mean_CH4_TRACE&#39;</span><span class="p">])</span><span class="o">/</span><span class="mi">2</span><span class="p">))</span><span class="o">*</span> <span class="mi">100</span>
<span class="n">merged_df</span><span class="p">[</span><span class="s1">&#39;CH4_abs_percent_diff_totals&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="nb">abs</span><span class="p">((</span><span class="n">merged_df</span><span class="p">[</span><span class="s1">&#39;Total_CH4_FAOSTAT&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">merged_df</span><span class="p">[</span><span class="s1">&#39;Total_CH4_TRACE&#39;</span><span class="p">]))</span><span class="o">/</span><span class="p">((</span><span class="n">merged_df</span><span class="p">[</span><span class="s1">&#39;Total_CH4_TRACE&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">merged_df</span><span class="p">[</span><span class="s1">&#39;Total_CH4_FAOSTAT&#39;</span><span class="p">])</span><span class="o">/</span><span class="mi">2</span><span class="p">))</span><span class="o">*</span><span class="mi">100</span>


<span class="n">merged_df</span><span class="p">[</span><span class="s1">&#39;CH4_relative_percent_diff_2015&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">((</span><span class="n">merged_df</span><span class="p">[</span><span class="mi">2015</span><span class="p">]</span> <span class="o">-</span> <span class="n">merged_df</span><span class="p">[</span><span class="s1">&#39;tCH4_2015&#39;</span><span class="p">])</span><span class="o">/</span><span class="p">(</span><span class="n">merged_df</span><span class="p">[</span><span class="mi">2015</span><span class="p">]))</span><span class="o">*</span><span class="mi">100</span>
<span class="n">merged_df</span><span class="p">[</span><span class="s1">&#39;CH4_relative_percent_diff_2016&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">((</span><span class="n">merged_df</span><span class="p">[</span><span class="mi">2016</span><span class="p">]</span> <span class="o">-</span> <span class="n">merged_df</span><span class="p">[</span><span class="s1">&#39;tCH4_2016&#39;</span><span class="p">])</span><span class="o">/</span><span class="p">(</span><span class="n">merged_df</span><span class="p">[</span><span class="mi">2016</span><span class="p">]))</span><span class="o">*</span><span class="mi">100</span>
<span class="n">merged_df</span><span class="p">[</span><span class="s1">&#39;CH4_relative_percent_diff_2017&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">((</span><span class="n">merged_df</span><span class="p">[</span><span class="mi">2017</span><span class="p">]</span> <span class="o">-</span> <span class="n">merged_df</span><span class="p">[</span><span class="s1">&#39;tCH4_2017&#39;</span><span class="p">])</span><span class="o">/</span><span class="p">(</span><span class="n">merged_df</span><span class="p">[</span><span class="mi">2017</span><span class="p">]))</span><span class="o">*</span><span class="mi">100</span>
<span class="n">merged_df</span><span class="p">[</span><span class="s1">&#39;CH4_relative_percent_diff_2018&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">((</span><span class="n">merged_df</span><span class="p">[</span><span class="mi">2018</span><span class="p">]</span> <span class="o">-</span> <span class="n">merged_df</span><span class="p">[</span><span class="s1">&#39;tCH4_2018&#39;</span><span class="p">])</span><span class="o">/</span><span class="p">(</span><span class="n">merged_df</span><span class="p">[</span><span class="mi">2018</span><span class="p">]))</span><span class="o">*</span><span class="mi">100</span>
<span class="n">merged_df</span><span class="p">[</span><span class="s1">&#39;CH4_relative_percent_diff_2019&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">((</span><span class="n">merged_df</span><span class="p">[</span><span class="mi">2019</span><span class="p">]</span> <span class="o">-</span> <span class="n">merged_df</span><span class="p">[</span><span class="s1">&#39;tCH4_2019&#39;</span><span class="p">])</span><span class="o">/</span><span class="p">(</span><span class="n">merged_df</span><span class="p">[</span><span class="mi">2019</span><span class="p">]))</span><span class="o">*</span><span class="mi">100</span>
<span class="n">merged_df</span><span class="p">[</span><span class="s1">&#39;CH4_relative_percent_diff_means&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">((</span><span class="n">merged_df</span><span class="p">[</span><span class="s1">&#39;Mean_CH4_FAOSTAT&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">merged_df</span><span class="p">[</span><span class="s1">&#39;Mean_CH4_TRACE&#39;</span><span class="p">])</span><span class="o">/</span><span class="p">(</span><span class="n">merged_df</span><span class="p">[</span><span class="s2">&#34;Mean_CH4_FAOSTAT&#34;</span><span class="p">]))</span><span class="o">*</span><span class="mi">100</span>
<span class="n">merged_df</span><span class="p">[</span><span class="s1">&#39;CH4_relative_percent_diff_totals&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">((</span><span class="n">merged_df</span><span class="p">[</span><span class="s1">&#39;Total_CH4_FAOSTAT&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">merged_df</span><span class="p">[</span><span class="s1">&#39;Total_CH4_TRACE&#39;</span><span class="p">])</span><span class="o">/</span><span class="p">(</span><span class="n">merged_df</span><span class="p">[</span><span class="s2">&#34;Total_CH4_FAOSTAT&#34;</span><span class="p">]))</span><span class="o">*</span><span class="mi">100</span>

</code></pre></div><h3 id="calculate-co2-differences">Calculate CO2 Differences</h3>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="c1">## Calculate Percent Differnces on this data set )*100</span>
<span class="c1"># With raw data i could have accomplished this with a groupby.aggregate(lambda x ), however the pivot tables given are not easy to apply #vectorized functions across time series</span>
<span class="n">merged_df</span><span class="p">[</span><span class="s1">&#39;CO2_abs_percent_diff_2015&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="nb">abs</span><span class="p">((</span><span class="n">merged_df</span><span class="p">[</span><span class="s1">&#39;tCO2_2015_FAOSTAT&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">merged_df</span><span class="p">[</span><span class="s1">&#39;tCO2_2015_TRACE&#39;</span><span class="p">]))</span><span class="o">/</span><span class="p">((</span><span class="n">merged_df</span><span class="p">[</span><span class="s1">&#39;tCO2_2015_TRACE&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">merged_df</span><span class="p">[</span><span class="s1">&#39;tCO2_2015_FAOSTAT&#39;</span><span class="p">])</span><span class="o">/</span><span class="mi">2</span><span class="p">))</span><span class="o">*</span><span class="mi">100</span>
<span class="n">merged_df</span><span class="p">[</span><span class="s1">&#39;CO2_abs_percent_diff_2016&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">((</span><span class="nb">abs</span><span class="p">(</span><span class="n">merged_df</span><span class="p">[</span><span class="s1">&#39;tCO2_2016_FAOSTAT&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">merged_df</span><span class="p">[</span><span class="s1">&#39;tCO2_2016_TRACE&#39;</span><span class="p">]))</span><span class="o">/</span><span class="p">((</span><span class="n">merged_df</span><span class="p">[</span><span class="s1">&#39;tCO2_2016_TRACE&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">merged_df</span><span class="p">[</span><span class="s1">&#39;tCO2_2016_FAOSTAT&#39;</span><span class="p">])</span><span class="o">/</span><span class="mi">2</span><span class="p">))</span><span class="o">*</span><span class="mi">100</span>
<span class="n">merged_df</span><span class="p">[</span><span class="s1">&#39;CO2_abs_percent_diff_2017&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">((</span><span class="nb">abs</span><span class="p">(</span><span class="n">merged_df</span><span class="p">[</span><span class="s1">&#39;tCO2_2017_FAOSTAT&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">merged_df</span><span class="p">[</span><span class="s1">&#39;tCO2_2017_TRACE&#39;</span><span class="p">]))</span><span class="o">/</span><span class="p">((</span><span class="n">merged_df</span><span class="p">[</span><span class="s1">&#39;tCO2_2017_TRACE&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">merged_df</span><span class="p">[</span><span class="s1">&#39;tCO2_2017_FAOSTAT&#39;</span><span class="p">])</span><span class="o">/</span><span class="mi">2</span><span class="p">))</span><span class="o">*</span><span class="mi">100</span>
<span class="n">merged_df</span><span class="p">[</span><span class="s1">&#39;CO2_abs_percent_diff_2018&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">((</span><span class="nb">abs</span><span class="p">(</span><span class="n">merged_df</span><span class="p">[</span><span class="s1">&#39;tCO2_2018_FAOSTAT&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">merged_df</span><span class="p">[</span><span class="s1">&#39;tCO2_2018_TRACE&#39;</span><span class="p">]))</span><span class="o">/</span><span class="p">((</span><span class="n">merged_df</span><span class="p">[</span><span class="s1">&#39;tCO2_2018_TRACE&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">merged_df</span><span class="p">[</span><span class="s1">&#39;tCO2_2018_FAOSTAT&#39;</span><span class="p">])</span><span class="o">/</span><span class="mi">2</span><span class="p">))</span><span class="o">*</span><span class="mi">100</span>
<span class="n">merged_df</span><span class="p">[</span><span class="s1">&#39;CO2_abs_percent_diff_2019&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">((</span><span class="nb">abs</span><span class="p">(</span><span class="n">merged_df</span><span class="p">[</span><span class="s1">&#39;tCO2_2019_FAOSTAT&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">merged_df</span><span class="p">[</span><span class="s1">&#39;tCO2_2019_TRACE&#39;</span><span class="p">]))</span><span class="o">/</span><span class="p">((</span><span class="n">merged_df</span><span class="p">[</span><span class="s1">&#39;tCO2_2019_TRACE&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">merged_df</span><span class="p">[</span><span class="s1">&#39;tCO2_2019_FAOSTAT&#39;</span><span class="p">])</span><span class="o">/</span><span class="mi">2</span><span class="p">))</span><span class="o">*</span><span class="mi">100</span>
<span class="n">merged_df</span><span class="p">[</span><span class="s1">&#39;CO2_abs_percent_diff_means&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">((</span><span class="nb">abs</span><span class="p">(</span><span class="n">merged_df</span><span class="p">[</span><span class="s1">&#39;Mean_CO2_FAOSTAT&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">merged_df</span><span class="p">[</span><span class="s1">&#39;Mean_CO2_TRACE&#39;</span><span class="p">]))</span><span class="o">/</span><span class="p">((</span><span class="n">merged_df</span><span class="p">[</span><span class="s1">&#39;Mean_CO2_FAOSTAT&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">merged_df</span><span class="p">[</span><span class="s1">&#39;Mean_CO2_TRACE&#39;</span><span class="p">])</span><span class="o">/</span><span class="mi">2</span><span class="p">))</span><span class="o">*</span> <span class="mi">100</span>
<span class="n">merged_df</span><span class="p">[</span><span class="s1">&#39;CO2_abs_percent_diff_totals&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">((</span><span class="nb">abs</span><span class="p">(</span><span class="n">merged_df</span><span class="p">[</span><span class="s1">&#39;Total_CO2_FAOSTAT&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">merged_df</span><span class="p">[</span><span class="s1">&#39;Total_CO2_TRACE&#39;</span><span class="p">]))</span><span class="o">/</span><span class="p">((</span><span class="n">merged_df</span><span class="p">[</span><span class="s1">&#39;Total_CO2_TRACE&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">merged_df</span><span class="p">[</span><span class="s1">&#39;Total_CO2_FAOSTAT&#39;</span><span class="p">])</span><span class="o">/</span><span class="mi">2</span><span class="p">))</span><span class="o">*</span><span class="mi">100</span>


<span class="n">merged_df</span><span class="p">[</span><span class="s1">&#39;CO2_relative_percent_diff_2015&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">((</span><span class="n">merged_df</span><span class="p">[</span><span class="s1">&#39;tCO2_2015_FAOSTAT&#39;</span><span class="p">]</span>  <span class="o">-</span> <span class="n">merged_df</span><span class="p">[</span><span class="s1">&#39;tCO2_2015_TRACE&#39;</span><span class="p">])</span><span class="o">/</span><span class="p">(</span><span class="n">merged_df</span><span class="p">[</span><span class="s1">&#39;tCO2_2015_FAOSTAT&#39;</span><span class="p">]))</span><span class="o">*</span><span class="mi">100</span>
<span class="n">merged_df</span><span class="p">[</span><span class="s1">&#39;CO2_relative_percent_diff_2016&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">((</span><span class="n">merged_df</span><span class="p">[</span><span class="s1">&#39;tCO2_2016_FAOSTAT&#39;</span><span class="p">]</span>  <span class="o">-</span> <span class="n">merged_df</span><span class="p">[</span><span class="s1">&#39;tCO2_2016_TRACE&#39;</span><span class="p">])</span><span class="o">/</span><span class="p">(</span><span class="n">merged_df</span><span class="p">[</span><span class="s1">&#39;tCO2_2016_FAOSTAT&#39;</span><span class="p">]))</span><span class="o">*</span><span class="mi">100</span>
<span class="n">merged_df</span><span class="p">[</span><span class="s1">&#39;CO2_relative_percent_diff_2017&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">((</span><span class="n">merged_df</span><span class="p">[</span><span class="s1">&#39;tCO2_2017_FAOSTAT&#39;</span><span class="p">]</span>  <span class="o">-</span> <span class="n">merged_df</span><span class="p">[</span><span class="s1">&#39;tCO2_2017_TRACE&#39;</span><span class="p">])</span><span class="o">/</span><span class="p">(</span><span class="n">merged_df</span><span class="p">[</span><span class="s1">&#39;tCO2_2017_FAOSTAT&#39;</span><span class="p">]))</span><span class="o">*</span><span class="mi">100</span>
<span class="n">merged_df</span><span class="p">[</span><span class="s1">&#39;CO2_relative_percent_diff_2018&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">((</span><span class="n">merged_df</span><span class="p">[</span><span class="s1">&#39;tCO2_2018_FAOSTAT&#39;</span><span class="p">]</span>  <span class="o">-</span> <span class="n">merged_df</span><span class="p">[</span><span class="s1">&#39;tCO2_2018_TRACE&#39;</span><span class="p">])</span><span class="o">/</span><span class="p">(</span><span class="n">merged_df</span><span class="p">[</span><span class="s1">&#39;tCO2_2018_FAOSTAT&#39;</span><span class="p">]))</span><span class="o">*</span><span class="mi">100</span>
<span class="n">merged_df</span><span class="p">[</span><span class="s1">&#39;CO2_relative_percent_diff_2019&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">((</span><span class="n">merged_df</span><span class="p">[</span><span class="s1">&#39;tCO2_2019_FAOSTAT&#39;</span><span class="p">]</span>  <span class="o">-</span> <span class="n">merged_df</span><span class="p">[</span><span class="s1">&#39;tCO2_2019_TRACE&#39;</span><span class="p">])</span><span class="o">/</span><span class="p">(</span><span class="n">merged_df</span><span class="p">[</span><span class="s1">&#39;tCO2_2019_FAOSTAT&#39;</span><span class="p">]))</span><span class="o">*</span><span class="mi">100</span>
<span class="n">merged_df</span><span class="p">[</span><span class="s1">&#39;CO2_relative_percent_diff_means&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">((</span><span class="n">merged_df</span><span class="p">[</span><span class="s2">&#34;Mean_CO2_FAOSTAT&#34;</span><span class="p">]</span> <span class="o">-</span> <span class="n">merged_df</span><span class="p">[</span><span class="s1">&#39;Mean_CO2_TRACE&#39;</span><span class="p">])</span><span class="o">/</span><span class="p">(</span><span class="n">merged_df</span><span class="p">[</span><span class="s2">&#34;Mean_CO2_FAOSTAT&#34;</span><span class="p">]))</span><span class="o">*</span><span class="mi">100</span>
<span class="n">merged_df</span><span class="p">[</span><span class="s1">&#39;CO2_relative_percent_diff_totals&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">((</span><span class="n">merged_df</span><span class="p">[</span><span class="s1">&#39;Total_CO2_FAOSTAT&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">merged_df</span><span class="p">[</span><span class="s1">&#39;Total_CO2_TRACE&#39;</span><span class="p">])</span><span class="o">/</span><span class="p">(</span><span class="n">merged_df</span><span class="p">[</span><span class="s2">&#34;Total_CO2_FAOSTAT&#34;</span><span class="p">]))</span><span class="o">*</span><span class="mi">100</span>
</code></pre></div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="n">merged_df</span>
</code></pre></div><!-- raw HTML omitted -->
<pre><code>.dataframe tbody tr th {
    vertical-align: top;
}

.dataframe thead th {
    text-align: right;
}
</code></pre>
<p><!-- raw HTML omitted --></p>
<!-- raw HTML omitted -->
<h3 id="recalculate-means">Recalculate Means</h3>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="n">merged_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="s1">&#39;mean&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">merged_df</span><span class="o">.</span><span class="n">select_dtypes</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">number</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>

</code></pre></div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="n">merged_df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="s1">&#39;mean&#39;</span><span class="p">,</span><span class="s1">&#39;country_name_FAOSTAT&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;mean&#39;</span>
<span class="n">merged_df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="s1">&#39;mean&#39;</span><span class="p">,</span><span class="s1">&#39;country_name_TRACE&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;mean&#39;</span>
</code></pre></div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="n">merged_df</span>
</code></pre></div><!-- raw HTML omitted -->
<pre><code>.dataframe tbody tr th {
    vertical-align: top;
}

.dataframe thead th {
    text-align: right;
}
</code></pre>
<p><!-- raw HTML omitted --></p>
<!-- raw HTML omitted -->
<h3 id="recalculate-totals">Recalculate Totals</h3>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="n">merged_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="s1">&#39;total&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">merged_df</span><span class="p">[</span><span class="n">merged_df</span><span class="p">[</span><span class="s1">&#39;country_name_FAOSTAT&#39;</span><span class="p">]</span> <span class="o">!=</span> <span class="s1">&#39;mean&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">select_dtypes</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">number</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
</code></pre></div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="n">merged_df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="s1">&#39;total&#39;</span><span class="p">,</span><span class="s1">&#39;country_name_FAOSTAT&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;total&#39;</span>
<span class="n">merged_df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="s1">&#39;total&#39;</span><span class="p">,</span><span class="s1">&#39;country_name_TRACE&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;total&#39;</span>
</code></pre></div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="n">merged_df</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">drop</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>
</code></pre></div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="n">merged_df</span>
</code></pre></div><!-- raw HTML omitted -->
<pre><code>.dataframe tbody tr th {
    vertical-align: top;
}

.dataframe thead th {
    text-align: right;
}
</code></pre>
<p><!-- raw HTML omitted --></p>
<!-- raw HTML omitted -->
<h3 id="merged-data-to-file">Merged Data to File</h3>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="n">outfile</span> <span class="o">=</span> <span class="s2">&#34;/Users/jnapolitano/Projects/wattime-takehome/wattime-takehome/data/MERGED_DATA.csv&#34;</span>

<span class="n">merged_df</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="n">outfile</span><span class="p">)</span>
</code></pre></div><h3 id="co2-difference-plots">CO2 Difference Plots</h3>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="n">merged_df</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">kind</span> <span class="o">=</span> <span class="s2">&#34;barh&#34;</span><span class="p">,</span> <span class="n">x</span> <span class="o">=</span> <span class="s1">&#39;country_name_FAOSTAT&#39;</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&#34;CO2_diff_2015&#34;</span><span class="p">,</span> <span class="s2">&#34;CO2_diff_2016&#34;</span><span class="p">,</span>	<span class="s2">&#34;CO2_diff_2017&#34;</span><span class="p">,</span> <span class="s2">&#34;CO2_diff_2018&#34;</span><span class="p">,</span> <span class="s2">&#34;CO2_diff_2019&#34;</span><span class="p">],</span> <span class="n">xlabel</span> <span class="o">=</span> <span class="s2">&#34;Country Name&#34;</span><span class="p">,</span> <span class="n">ylabel</span> <span class="o">=</span> <span class="s2">&#34;Tonnes CH4&#34;</span><span class="p">,</span> <span class="n">figsize</span> <span class="o">=</span> <span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">10</span><span class="p">))</span>
</code></pre></div><pre><code>&lt;AxesSubplot:ylabel='Country Name'&gt;
</code></pre>
<p><img src="data_exploration_files/data_exploration_92_1.png" alt="png"></p>
<h3 id="percent-difference-plot">Percent Difference Plot</h3>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="n">merged_df</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">kind</span> <span class="o">=</span> <span class="s2">&#34;barh&#34;</span><span class="p">,</span> <span class="n">x</span> <span class="o">=</span> <span class="s1">&#39;country_name_FAOSTAT&#39;</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&#34;CO2_relative_percent_diff_2015&#34;</span><span class="p">,</span> <span class="s2">&#34;CO2_relative_percent_diff_2016&#34;</span><span class="p">,</span>	<span class="s2">&#34;CO2_relative_percent_diff_2017&#34;</span><span class="p">,</span> <span class="s2">&#34;CO2_relative_percent_diff_2018&#34;</span><span class="p">,</span> <span class="s2">&#34;CO2_relative_percent_diff_2019&#34;</span><span class="p">],</span> <span class="n">xlabel</span> <span class="o">=</span> <span class="s2">&#34;Country Name&#34;</span><span class="p">,</span> <span class="n">ylabel</span> <span class="o">=</span> <span class="s2">&#34;Tonnes CH4&#34;</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">10</span><span class="p">))</span>
</code></pre></div><pre><code>&lt;AxesSubplot:ylabel='Country Name'&gt;
</code></pre>
<p><img src="data_exploration_files/data_exploration_94_1.png" alt="png"></p>
]]></content>
			<postid> 477064bf1a183c84a108497c0b1d6787</postid>
			<author>Justin Napolitano</author>
			<author_name>Justin Napolitano</author_name>
			<author_email>personal.jnapolitano@gmail.com</author_email>
			<author_id>87654367b2fca109e7dc9d3ea8a1ebbaf0bfe374773b148c2c20d278479add99</author_id>			
		</item>
		
		<item>
			<title>Conduct Legal Research with AI: Part 4</title>
			<link>jnapolitano.com/posts/legal-research-part-4/</link>
			<pubDate>Thu, 19 May 2022 22:30:32 +0000</pubDate>
			<guid>jnapolitano.com/posts/legal-research-part-4/</guid>
			<description><![CDATA[Importing case variables and established relationships to the graph.]]></description>
			<content type="html"><![CDATA[<h1 id="conduct-legal-research-with-ai-part-4">Conduct Legal Research with AI Part 4</h1>
<p>This is the fourth post in a series documenting the process of building an ml pipeline used to train models to predict the outcomes of Supreme Court cases.</p>
<p>You can find the others at:</p>
<ul>
<li>Part 1: <a href="https://blog.jnapolitano.io/neo4j_integration/">blog.jnapolitano.io/neo4j_integration/</a></li>
<li>Part 2: <a href="https://blog.jnapolitano.io/constitution_to_neo/">blog.jnapolitano.io/constitution_to_neo/</a></li>
<li>Part 3: <a href="https://blog.jnapolitano.io/ai-proof-of-concept/">blog.jnapolitano.io/ai-proof-of-concept/</a></li>
</ul>
<h2 id="modeling-the-supreme-court">Modeling the Supreme Court</h2>
<p>Thankfully, much of the ground work has been done by contributors to <a href="http://scdb.wustl.edu/documentation.php">The Washington University of St. Louis Law School Supreme Court Database</a></p>
<p>Unfortunately, The Supreme Court Database is limited in its scope. My approach extends their work by  creating a graph database.</p>
<p>I have chosen to model the data in a graph database with a Person, Object, Event, Location (POLE) schema.  This will permit me to relate cases, justices, subjects, objects, ideas, and events to one another to train ML models to automate much of the legal research pipeline.</p>
<p>The models could be ported to work with any body of jurisprudence.</p>
<h2 id="the-case-class">The Case Class</h2>
<p>In this post, I publish only the Case schema that will be used to relate cases to other objects for a machine learning algorithm to predict the outcomes, subjects, and legal provisions of court cases.</p>
<p>A detailed report documenting each variable will be produced in the future when I publish the database.  For the time being, the Case class below should suitably demonstrate the foundation of the database.</p>
<p>I will continue to publish the remaining classes as they are completed.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="k">class</span> <span class="nc">Case</span><span class="p">(</span><span class="n">StructuredNode</span><span class="p">):</span>
    <span class="c1">#####Media########</span>
    <span class="n">pdf</span> <span class="o">=</span> <span class="n">StringProperty</span><span class="p">(</span><span class="n">unique_index</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">required</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span> 

    <span class="c1">#### Identification Variables####</span>
    <span class="n">uid</span> <span class="o">=</span> <span class="n">UniqueIdProperty</span><span class="p">()</span>

    <span class="n">group</span> <span class="o">=</span> <span class="n">StringProperty</span><span class="p">(</span><span class="n">unique_index</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">required</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="n">loc_title</span> <span class="o">=</span> <span class="n">StringProperty</span><span class="p">(</span><span class="n">unique_index</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">required</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="n">url</span> <span class="o">=</span> <span class="n">StringProperty</span><span class="p">(</span><span class="n">unique_index</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">required</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    
    <span class="n">shelf_id</span> <span class="o">=</span> <span class="n">StringProperty</span><span class="p">()</span>

    <span class="n">usCite</span> <span class="o">=</span> <span class="n">StringProperty</span><span class="p">(</span><span class="n">unique_index</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">required</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    
    
    <span class="n">caseId</span> <span class="o">=</span> <span class="n">StringProperty</span><span class="p">(</span><span class="n">unique_index</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">required</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
   
    <span class="n">caseName</span> <span class="o">=</span> <span class="n">StringProperty</span><span class="p">(</span><span class="n">unique_index</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">required</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    
    <span class="n">scdb_docket_id</span> <span class="o">=</span> <span class="n">StringProperty</span><span class="p">(</span><span class="n">unique_index</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">required</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    
    <span class="n">scdb_vote_id</span> <span class="o">=</span> <span class="n">StringProperty</span><span class="p">(</span><span class="n">unique_index</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">required</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    
    <span class="n">scdb_issues_id</span> <span class="o">=</span> <span class="n">StringProperty</span><span class="p">(</span><span class="n">unique_index</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">required</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    
    <span class="n">supCite</span> <span class="o">=</span> <span class="n">StringProperty</span><span class="p">(</span><span class="n">unique_index</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">required</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    
    <span class="n">lawEdCite</span> <span class="o">=</span> <span class="n">StringProperty</span><span class="p">(</span><span class="n">unique_index</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">required</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    
    <span class="n">lexisCite</span> <span class="o">=</span> <span class="n">StringProperty</span><span class="p">(</span><span class="n">unique_index</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">required</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    
    <span class="n">dockNumb</span> <span class="o">=</span> <span class="n">StringProperty</span><span class="p">(</span><span class="n">unique_index</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">required</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="c1">######background Variables########</span>
    <span class="n">name</span> <span class="o">=</span> <span class="n">StringProperty</span><span class="p">(</span><span class="n">unique_index</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">required</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">petitioner</span> <span class="o">=</span> <span class="n">Relationship</span><span class="p">(</span><span class="s1">&#39;Petitioner&#39;</span><span class="p">,</span> <span class="s1">&#39;IS_PETITIONER&#39;</span><span class="p">)</span>
    <span class="n">petitionState</span> <span class="o">=</span> <span class="n">Relationship</span><span class="p">(</span><span class="s1">&#39;State&#39;</span><span class="p">,</span> <span class="s1">&#39;IS_PETITIONER&#39;</span><span class="p">)</span>

    <span class="n">respondent</span> <span class="o">=</span> <span class="n">Relationship</span><span class="p">(</span><span class="s1">&#39;Respondent&#39;</span><span class="p">,</span> <span class="s1">&#39;IS_RESPONDENT&#39;</span><span class="p">)</span>
    <span class="n">respondentState</span> <span class="o">=</span> <span class="n">Relationship</span><span class="p">(</span><span class="s1">&#39;State&#39;</span><span class="p">,</span> <span class="s1">&#39;IS_RESPONDENT&#39;</span><span class="p">)</span>

    <span class="n">jurisdiction</span> <span class="o">=</span> <span class="n">Relationship</span><span class="p">(</span><span class="s1">&#39;Jurisdiction&#39;</span><span class="p">,</span> <span class="s1">&#39;JURISDICTION&#39;</span><span class="p">)</span>
    
    <span class="n">adminAction</span> <span class="o">=</span> <span class="n">Relationship</span><span class="p">(</span><span class="s1">&#39;Admin&#39;</span><span class="p">,</span> <span class="s1">&#39;ACTION&#39;</span><span class="p">)</span>

    <span class="n">threeJudgeFdc</span> <span class="o">=</span> <span class="n">BooleanProperty</span><span class="p">()</span>

    <span class="n">origin</span> <span class="o">=</span> <span class="n">Relationship</span><span class="p">(</span><span class="s1">&#39;USCOURT&#39;</span><span class="p">,</span> <span class="s1">&#39;ORIGIN&#39;</span><span class="p">)</span>

    <span class="n">origin_state</span> <span class="o">=</span> <span class="n">Relationship</span><span class="p">(</span><span class="s1">&#39;State&#39;</span><span class="p">,</span> <span class="s1">&#39;ORIGIN&#39;</span><span class="p">)</span>

    <span class="n">source</span> <span class="o">=</span> <span class="n">Relationship</span><span class="p">(</span><span class="s1">&#39;Source&#39;</span><span class="p">,</span> <span class="s1">&#39;SOURCE&#39;</span><span class="p">)</span>

    <span class="n">source_state</span> <span class="o">=</span> <span class="n">Relationship</span><span class="p">(</span><span class="s1">&#39;State&#39;</span><span class="p">,</span> <span class="s1">&#39;SOURCE&#39;</span><span class="p">)</span>

    <span class="n">lc_disagreement</span> <span class="o">=</span> <span class="n">BooleanProperty</span><span class="p">()</span>

    <span class="n">certReason</span> <span class="o">=</span> <span class="n">Relationship</span><span class="p">(</span><span class="s1">&#39;CertReason&#39;</span><span class="p">,</span> <span class="s1">&#39;REASON&#39;</span><span class="p">)</span>

    <span class="n">lc_disposition</span> <span class="o">=</span> <span class="n">Relationship</span><span class="p">(</span><span class="s1">&#39;Disposition&#39;</span><span class="p">,</span> <span class="s1">&#39;LC_DISPOSITION&#39;</span><span class="p">)</span>

    <span class="n">lc_direction</span> <span class="o">=</span> <span class="n">Relationship</span><span class="p">(</span><span class="s1">&#39;Direction&#39;</span><span class="p">,</span> <span class="s1">&#39;LC_DIRECTION&#39;</span><span class="p">)</span>

    <span class="c1">#####3 Chronological #####</span>

    <span class="c1"># From Spaethe</span>
    <span class="n">dateArgument</span> <span class="o">=</span> <span class="n">DateProperty</span><span class="p">()</span>
    <span class="n">dateDecision</span> <span class="o">=</span> <span class="n">DateProperty</span><span class="p">()</span>
    <span class="n">dateReargue</span> <span class="o">=</span> <span class="n">DateProperty</span><span class="p">()</span>

    <span class="c1"># From LOC</span>
    <span class="n">date</span> <span class="o">=</span> <span class="n">StringProperty</span><span class="p">(</span><span class="n">unique_index</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">required</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">dates</span> <span class="o">=</span> <span class="n">StringProperty</span><span class="p">(</span><span class="n">unique_index</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">required</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    
    <span class="n">term</span> <span class="o">=</span> <span class="n">Relationship</span><span class="p">(</span><span class="s1">&#39;Term&#39;</span><span class="p">,</span> <span class="s1">&#39;TERM_OF&#39;</span><span class="p">)</span>
    <span class="n">natCourt</span> <span class="o">=</span> <span class="n">Relationship</span><span class="p">(</span><span class="s1">&#39;Natcourt&#39;</span><span class="p">,</span><span class="s1">&#39;NAT_COURT&#39;</span><span class="p">)</span>

    <span class="n">chief</span> <span class="o">=</span> <span class="n">Relationship</span><span class="p">(</span><span class="s1">&#39;Justice&#39;</span><span class="p">,</span> <span class="s1">&#39;IS_CHIEF&#39;</span><span class="p">)</span>

    <span class="c1">######Substantive#####</span>

    <span class="n">subject</span> <span class="o">=</span> <span class="n">StringProperty</span><span class="p">(</span><span class="n">unique_index</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">required</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="n">decisionDirection</span> <span class="o">=</span> <span class="n">Relationship</span><span class="p">(</span><span class="s1">&#39;Direction&#39;</span><span class="p">,</span> <span class="s1">&#39;SUP_COURT_MAJORITY_DIRECTION&#39;</span><span class="p">)</span>
    
    <span class="n">decisionDirectionDissent</span> <span class="o">=</span> <span class="n">Relationship</span><span class="p">(</span><span class="s1">&#39;Direction&#39;</span><span class="p">,</span> <span class="s1">&#39;SUP_COURT_DISSENT_DIRECTION&#39;</span><span class="p">)</span>
    
    <span class="n">spaethIssue</span> <span class="o">=</span> <span class="n">Relationship</span><span class="p">(</span><span class="s1">&#39;SpaethIssue&#39;</span><span class="p">,</span> <span class="s1">&#39;IS_SPAETH_ISSUE&#39;</span><span class="p">)</span>
    
    <span class="n">spaethIssueArea</span> <span class="o">=</span> <span class="n">Relationship</span><span class="p">(</span><span class="s1">&#39;SpaethIssueArea&#39;</span><span class="p">,</span> <span class="s1">&#39;IS_SPAETH_ISSUE_AREA&#39;</span><span class="p">)</span>

    <span class="n">subject_relationship</span> <span class="o">=</span> <span class="n">Relationship</span><span class="p">(</span><span class="s2">&#34;Subject&#34;</span><span class="p">,</span> <span class="s2">&#34;IS_CASE_OF&#34;</span><span class="p">)</span>
    
    <span class="n">article</span> <span class="o">=</span> <span class="n">Relationship</span><span class="p">(</span><span class="s2">&#34;Case&#34;</span><span class="p">,</span> <span class="s1">&#39;IS_ARTICLE_OF&#39;</span><span class="p">)</span>
    
    <span class="n">clause</span> <span class="o">=</span> <span class="n">Relationship</span><span class="p">(</span><span class="s2">&#34;Clause&#34;</span><span class="p">,</span> <span class="s1">&#39;IS_CLAUSE_OF&#39;</span><span class="p">)</span>
    
    <span class="n">section</span> <span class="o">=</span> <span class="n">Relationship</span><span class="p">(</span><span class="s2">&#34;Section&#34;</span><span class="p">,</span> <span class="s1">&#39;IS_SECTION_OF&#39;</span><span class="p">)</span>
    
    <span class="n">sub_clause</span> <span class="o">=</span> <span class="n">Relationship</span><span class="p">(</span><span class="s2">&#34;Subclause&#34;</span><span class="p">,</span> <span class="s1">&#39;IS_SUB_CLAUSE_OF&#39;</span><span class="p">)</span>
    
    <span class="n">major_case_topic</span> <span class="o">=</span> <span class="n">Relationship</span><span class="p">(</span><span class="s1">&#39;Subject&#39;</span><span class="p">,</span> <span class="s1">&#39;IS_MAJOR_TOPIC&#39;</span><span class="p">)</span>

    <span class="n">authority</span> <span class="o">=</span> <span class="n">Relationship</span><span class="p">(</span><span class="s1">&#39;Authority&#39;</span><span class="p">,</span> <span class="s1">&#39;IS_AUTHORITY&#39;</span><span class="p">)</span>

    <span class="n">legalProvision</span> <span class="o">=</span> <span class="n">Relationship</span><span class="p">(</span><span class="s1">&#39;legalProvision&#39;</span><span class="p">,</span> <span class="s1">&#39;IS_PROVISION&#39;</span><span class="p">)</span>
    
    <span class="n">lawType</span> <span class="o">=</span> <span class="n">Relationship</span><span class="p">(</span><span class="s1">&#39;lawType&#39;</span><span class="p">,</span> <span class="s1">&#39;lawType&#39;</span><span class="p">)</span>

    <span class="n">law</span> <span class="o">=</span> <span class="n">Relationship</span><span class="p">(</span><span class="s1">&#39;Law&#39;</span><span class="p">,</span> <span class="s1">&#39;SUPPORTING_LAW&#39;</span><span class="p">)</span>

   
    <span class="c1">######Outcome Variables#####</span>

    <span class="n">decisionType</span> <span class="o">=</span> <span class="n">Relationship</span><span class="p">(</span><span class="s1">&#39;DecisionType&#39;</span><span class="p">,</span> <span class="s1">&#39;IS_DECISION_TYPE&#39;</span><span class="p">)</span>

    <span class="n">declarationUnconstitutional</span> <span class="o">=</span> <span class="n">Relationship</span><span class="p">(</span><span class="s1">&#39;Constitutional&#39;</span><span class="p">,</span><span class="s1">&#39;UNCONSTITUTIONAL&#39;</span><span class="p">)</span>
    
    <span class="n">delcarationConstitutional</span> <span class="o">=</span> <span class="n">Relationship</span><span class="p">(</span><span class="s1">&#39;Constitutional&#39;</span><span class="p">,</span> <span class="s2">&#34;CONSTITUTIONAL&#34;</span><span class="p">)</span>

    <span class="n">disposition</span> <span class="o">=</span> <span class="n">Relationship</span><span class="p">(</span><span class="s1">&#39;Disposition&#39;</span><span class="p">,</span> <span class="s1">&#39;IS_DISPOSITION&#39;</span><span class="p">)</span>

    <span class="n">winningParty</span> <span class="o">=</span> <span class="n">Relationship</span><span class="p">(</span><span class="s1">&#39;Party&#39;</span><span class="p">,</span> <span class="s1">&#39;IS_WINNER&#39;</span><span class="p">)</span>
    <span class="n">FormalAlterationOfPrecedent</span> <span class="o">=</span> <span class="n">BooleanProperty</span><span class="p">()</span>
    
    <span class="n">alteredPrecedent</span> <span class="o">=</span> <span class="n">Relationship</span><span class="p">(</span><span class="s2">&#34;Case&#34;</span><span class="p">,</span> <span class="s1">&#39;Altered_Precedent&#39;</span><span class="p">)</span>
    

    <span class="c1">## Voting and Opinion Variables</span>
    <span class="c1"># will account for all types of votes a node for each outcome</span>
    <span class="n">vote</span> <span class="o">=</span> <span class="n">Relationship</span><span class="p">(</span><span class="s1">&#39;Vote&#39;</span><span class="p">,</span> <span class="s1">&#39;OUTCOME&#39;</span><span class="p">)</span>
    
    <span class="n">majOpinWriter</span> <span class="o">=</span> <span class="n">Relationship</span><span class="p">(</span><span class="s1">&#39;Justice&#39;</span><span class="p">,</span> <span class="s1">&#39;WROTE_MAJORITY_OPINION&#39;</span><span class="p">)</span>
    
    <span class="n">majOpinWriter</span> <span class="o">=</span> <span class="n">Relationship</span><span class="p">(</span><span class="s1">&#39;Justice&#39;</span><span class="p">,</span> <span class="s2">&#34;ASSIGNED_MAJORITY_OPINION&#34;</span><span class="p">)</span>

    <span class="n">affirmative_vote</span> <span class="o">=</span> <span class="n">Relationship</span><span class="p">(</span><span class="s1">&#39;Justice&#39;</span><span class="p">,</span> <span class="s2">&#34;AFFIRMATE_VOTE&#34;</span><span class="p">)</span>
    
    <span class="n">negative_vote</span> <span class="o">=</span> <span class="n">Relationship</span><span class="p">(</span><span class="s1">&#39;Justice&#39;</span><span class="p">,</span> <span class="s2">&#34;NEGATIVE_VOTE&#34;</span><span class="p">)</span>

    <span class="n">conservative_vote</span> <span class="o">=</span> <span class="n">Relationship</span><span class="p">(</span><span class="s1">&#39;Justice&#39;</span><span class="p">,</span> <span class="s1">&#39;CONSERVATIVE&#39;</span><span class="p">)</span>
    <span class="n">liberal_vote</span> <span class="o">=</span> <span class="n">Relationship</span><span class="p">(</span><span class="s1">&#39;Justice&#39;</span><span class="p">,</span> <span class="s2">&#34;LIBERAL&#34;</span><span class="p">)</span>

    <span class="n">majority_vote</span> <span class="o">=</span> <span class="n">Relationship</span><span class="p">(</span><span class="s1">&#39;Justice&#39;</span><span class="p">,</span> <span class="s1">&#39;MAJORITY_VOTE&#39;</span><span class="p">)</span>

    <span class="n">miniority_vote</span> <span class="o">=</span> <span class="n">Relationship</span><span class="p">(</span><span class="s1">&#39;Justice&#39;</span><span class="p">,</span><span class="s1">&#39;MINORITY_VOTE&#39;</span><span class="p">)</span>

    <span class="n">wrote_an_opinion</span> <span class="o">=</span> <span class="n">Relationship</span><span class="p">(</span><span class="s1">&#39;Justice&#39;</span><span class="p">,</span> <span class="s1">&#39;WROTE_AN_OPINION&#39;</span><span class="p">)</span>

    <span class="n">co_authored_opinion</span> <span class="o">=</span> <span class="n">Relationship</span><span class="p">(</span><span class="s1">&#39;Justice&#39;</span><span class="p">,</span> <span class="s2">&#34;COAUTHORED_OPINION&#34;</span><span class="p">)</span>

    <span class="n">agreed_with_concurrence</span> <span class="o">=</span> <span class="n">Relationship</span><span class="p">(</span><span class="s1">&#39;Justice&#39;</span><span class="p">,</span> <span class="s1">&#39;AGREED_WITH_CONCURRENCE&#39;</span><span class="p">)</span>

    <span class="n">agreed_with_dissent</span> <span class="o">=</span> <span class="n">Relationship</span><span class="p">(</span><span class="s1">&#39;Justice&#39;</span><span class="p">,</span> <span class="s1">&#39;AGREED_WITH_CONCURRENCE&#39;</span><span class="p">)</span>
</code></pre></div>]]></content>
			<postid> 9f5aaaa103ede6048db01cc188d7d733</postid>
			<author>Justin Napolitano</author>
			<author_name>Justin Napolitano</author_name>
			<author_email>personal.jnapolitano@gmail.com</author_email>
			<author_id>87654367b2fca109e7dc9d3ea8a1ebbaf0bfe374773b148c2c20d278479add99</author_id>			
		</item>
		
		<item>
			<title>Conduct Legal Research with AI: Part 3</title>
			<link>jnapolitano.com/posts/legal-research-part-3/</link>
			<pubDate>Wed, 18 May 2022 14:40:32 +0000</pubDate>
			<guid>jnapolitano.com/posts/legal-research-part-3/</guid>
			<description><![CDATA[Testing TensorFlow models against the SCDB data set.]]></description>
			<content type="html"><![CDATA[<h1 id="conduct-legal-research-with-ai-part-3">Conduct Legal Research with AI: Part 3</h1>
<p>This is the third post in a series documenting the process of building an ml pipeline that will be used to train models to predict the outcomes of Supreme Court Cases.</p>
<p>You can find the others at:</p>
<ul>
<li><a href="https://blog.jnapolitano.io/neo4j_integration/">blog.jnapolitano.io/neo4j_integration/</a></li>
<li><a href="https://blog.jnapolitano.io/constitution_to_neo/">blog.jnapolitano.io/constitution_to_neo/</a></li>
</ul>
<h2 id="introduction">Introduction</h2>
<p>In this post, I will be testing a sample TensorFlow pipeline against the <a href="http://scdb.wustl.edu/">Supreme Court Database</a> maintained by the Washington University Law School in order to build a proof of concept model for a Supreme Court Graph Analysis project.</p>
<h2 id="the-data-set">The Data Set</h2>
<p>The data set is fairly limited. There are only about 250 issue areas to train against. It also does not include doctrinal trees to train an algorithm to predict when the court will break from precedent.</p>
<p>The data records primarily the voting behavior of justices, the policy direction of the outcome, and the political ideology score of the outcome.</p>
<p>Policy direction and political ideology are factors coded by individuals that may be prone to error an bias. In my analysis I will test against the findings of this model to determine which factors are most powerful.</p>
<h2 id="the-model">The Model</h2>
<p>I tested against case centric and justice centric data orientations.</p>
<h3 id="case-centric-model">Case Centric Model</h3>
<p>The first is case centric.  The power of this model is fairly limited, as it attempts to discern the outcome of a case from the aggregate behavior of the current justices on the bench.  It essentially creates a score that is modified by each case outcome to determine if the court will vote conservatively or liberally towards a case of regarding a specific issue area.  It is important to note that the database limits each case to one overarching issue area.</p>
<h4 id="case-centric-training-features">Case Centric Training Features</h4>
<ul>
<li>issue</li>
<li>issueArea</li>
<li>naturalCourt</li>
<li>petitioner</li>
<li>petitionerState</li>
<li>respondent</li>
<li>jurisdiction</li>
<li>adminAction</li>
<li>adminActionState</li>
<li>threeJudgeFdc</li>
<li>caseOrigin</li>
<li>caseOriginState</li>
<li>respondentState</li>
<li>caseSource</li>
<li>caseSourceState</li>
<li>lawType</li>
<li>lawSupp</li>
</ul>
<h4 id="case-centric-results">Case Centric Results</h4>
<p>The models were able to predict the outcomes about 75 percent of the time following 1,000 epochs of training.  It is likely that factors other than previous voting behavior determine the outcome of the case.</p>
<h3 id="justice-centric-model">Justice Centric Model</h3>
<p>The second is justice centric.  The predictive power of this model, should in theory be greater as it attempts to determine the likely vote of an individual justice against an issue area.  Again this is limited as only the overarching issue area is available in the data.  It may very well prove that justices may favor free speech in most cases, except when the military is the target.  The model could not predict that, because the data is limited.</p>
<h4 id="justice-centric-training-features">Justice Centric Training Features</h4>
<ul>
<li>justice</li>
<li>issue</li>
<li>issueArea</li>
<li>lawType</li>
<li>direction</li>
<li>petitioner</li>
<li>naturalCourt</li>
<li>petitionerState</li>
<li>respondent</li>
<li>respondentState</li>
<li>jurisdiction</li>
<li>caseOrigin</li>
<li>caseOriginState</li>
<li>caseSource</li>
<li>caseSourceState</li>
<li>certReason</li>
<li>lawSupp</li>
</ul>
<h4 id="justice-centric-results">Justice Centric Results</h4>
<p>The justice centric pipeline results in accuracy exceeding 82 percent.  This is better, but a model that could consider more factors and issue areas would likely improve the results.</p>
<h2 id="next-steps">Next Steps</h2>
<p>I will integrate the models to my neo4j data set.  As of now, the graph database exceeds 50,000 individuals nodes and over 400,000 relationships.  It will allow me to train an algorithm that can determine a justices attitude towards, cases, clauses, sentences, states, petitioners, and any other feature integrated into the dataset.</p>
<h2 id="the-code">The Code</h2>
<h3 id="case-centric-training-pipeline">Case Centric Training Pipeline</h3>
<p>I&rsquo;ve included the entire model below.  Review my <a href="https://docs.jnapolitano.io/parts/ml-ai/tensorflow/project-supcourt-tensorflow/docs/SupremeCourtPredictionsCase/index.html">documentation site</a> for more detail.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-Python" data-lang="Python"><span class="c1">#supremeCourtPrediction.py</span>
<span class="c1">#a program that uses the segal and spaeth dataset to predict the outcomes of cases</span>


<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>

<span class="kn">import</span> <span class="nn">tensorflow</span> <span class="k">as</span> <span class="nn">tf</span>

<span class="kn">import</span> <span class="nn">math</span>

<span class="kn">import</span> <span class="nn">seaborn</span> <span class="k">as</span> <span class="nn">sns</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>

<span class="kn">import</span> <span class="nn">shap</span>
<span class="n">shap</span><span class="o">.</span><span class="n">initjs</span><span class="p">()</span>

<span class="kn">import</span> <span class="nn">os</span> 
<span class="kn">import</span> <span class="nn">csv</span>
<span class="kn">import</span> <span class="nn">datetime</span>

<span class="kn">from</span> <span class="nn">tensorflow</span> <span class="kn">import</span> <span class="n">feature_column</span>
<span class="kn">from</span> <span class="nn">tensorflow.keras</span> <span class="kn">import</span> <span class="n">layers</span>
<span class="kn">from</span> <span class="nn">sklearn.model_selection</span> <span class="kn">import</span> <span class="n">train_test_split</span>

<span class="kn">from</span> <span class="nn">itertools</span> <span class="kn">import</span> <span class="n">permutations</span> 

<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>



<span class="k">def</span> <span class="nf">get_environmental_variables</span><span class="p">():</span>
    <span class="n">cwd</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">()</span>
    <span class="n">log_dir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">cwd</span><span class="p">,</span><span class="s2">&#34;logs/fit/&#34;</span><span class="p">)</span> <span class="o">+</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">&#34;%Y%m</span><span class="si">%d</span><span class="s2">-%H%M%S&#34;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">cwd</span><span class="p">,</span> <span class="n">log_dir</span>



<span class="k">def</span> <span class="nf">load_data</span><span class="p">(</span><span class="n">cwd</span><span class="p">):</span>
    <span class="n">data_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">cwd</span><span class="p">,</span><span class="s1">&#39;data&#39;</span><span class="p">,</span><span class="s1">&#39;citation.csv&#39;</span><span class="p">)</span> 
    <span class="n">drop_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">cwd</span><span class="p">,</span><span class="s1">&#39;data&#39;</span><span class="p">,</span><span class="s1">&#39;features&#39;</span><span class="p">,</span><span class="s1">&#39;drop&#39;</span><span class="p">,</span><span class="s1">&#39;drop.txt&#39;</span><span class="p">)</span>
    <span class="c1">#print(path)</span>
    <span class="n">dataframe</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">data_path</span><span class="p">,</span><span class="n">encoding</span><span class="o">=</span> <span class="s1">&#39;unicode_escape&#39;</span><span class="p">)</span>
    <span class="c1">#print(dataframe.head())</span>
    
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">drop_path</span><span class="p">)</span> <span class="k">as</span> <span class="n">fp</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">cnt</span><span class="p">,</span> <span class="n">line</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">fp</span><span class="p">):</span>
            <span class="c1">#print(&#34;Dropping {} from dataframe&#34;.format(line))</span>
            <span class="n">line</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
            <span class="n">line</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\t</span><span class="s1">&#39;</span><span class="p">)</span>
            <span class="n">line</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="s2">&#34;&#39;&#34;</span><span class="p">)</span>

            <span class="n">dataframe</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">line</span><span class="p">,</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    
    <span class="n">dataframe</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">dataframe</span><span class="p">)</span>
    <span class="c1">#dataframe.issue = dataframe.astype({&#39;issue&#39;: &#39;str&#39;})</span>
    <span class="c1">#dataframe[issue] = dataframe[issue].astype(str)</span>
    <span class="c1">#print(dataframe)</span>
    <span class="c1">#print(dataframe.head())</span>
    <span class="k">return</span> <span class="n">dataframe</span>



<span class="k">def</span> <span class="nf">split_datframe</span><span class="p">(</span><span class="n">dataframe</span><span class="p">):</span>
    <span class="n">train</span><span class="p">,</span> <span class="n">test</span> <span class="o">=</span> <span class="n">train_test_split</span><span class="p">(</span><span class="n">dataframe</span><span class="p">,</span> <span class="n">test_size</span><span class="o">=</span><span class="mf">0.2</span><span class="p">)</span>
    <span class="n">train</span><span class="p">,</span> <span class="n">val</span> <span class="o">=</span> <span class="n">train_test_split</span><span class="p">(</span><span class="n">train</span><span class="p">,</span> <span class="n">test_size</span><span class="o">=</span><span class="mf">0.2</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">train</span><span class="p">),</span> <span class="s1">&#39;train examples&#39;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">val</span><span class="p">),</span> <span class="s1">&#39;validation examples&#39;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">test</span><span class="p">),</span> <span class="s1">&#39;test examples&#39;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">train</span><span class="p">,</span> <span class="n">test</span><span class="p">,</span> <span class="n">val</span>


    <span class="c1"># A utility method to create a tf.data dataset from a Pandas Dataframe</span>

<span class="k">def</span> <span class="nf">df_to_dataset</span><span class="p">(</span><span class="n">dataframe</span><span class="p">,</span> <span class="n">shuffle</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">batch_size</span><span class="o">=</span><span class="mi">32</span><span class="p">):</span>
    <span class="n">dataframe</span> <span class="o">=</span> <span class="n">dataframe</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
    <span class="n">labels</span> <span class="o">=</span> <span class="n">dataframe</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;declarationUncon&#39;</span><span class="p">)</span>
    <span class="n">ds</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">Dataset</span><span class="o">.</span><span class="n">from_tensor_slices</span><span class="p">((</span><span class="nb">dict</span><span class="p">(</span><span class="n">dataframe</span><span class="p">),</span> <span class="n">labels</span><span class="p">))</span>
    <span class="k">if</span> <span class="n">shuffle</span><span class="p">:</span>
        <span class="n">ds</span> <span class="o">=</span> <span class="n">ds</span><span class="o">.</span><span class="n">shuffle</span><span class="p">(</span><span class="n">buffer_size</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">dataframe</span><span class="p">))</span>
    <span class="n">ds</span> <span class="o">=</span> <span class="n">ds</span><span class="o">.</span><span class="n">batch</span><span class="p">(</span><span class="n">batch_size</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">ds</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">ds</span>



<span class="k">def</span> <span class="nf">get_input_pipeline</span><span class="p">(</span><span class="n">train</span><span class="p">,</span> <span class="n">test</span><span class="p">,</span> <span class="n">val</span><span class="p">,</span> <span class="n">batch_size</span><span class="o">=</span><span class="mi">32</span><span class="p">,</span> <span class="n">shuffle</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
    <span class="n">train_ds</span> <span class="o">=</span> <span class="n">df_to_dataset</span><span class="p">(</span><span class="n">train</span><span class="p">,</span> <span class="n">batch_size</span><span class="o">=</span><span class="n">batch_size</span><span class="p">)</span>
    <span class="n">val_ds</span> <span class="o">=</span> <span class="n">df_to_dataset</span><span class="p">(</span><span class="n">val</span><span class="p">,</span> <span class="n">shuffle</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">batch_size</span><span class="o">=</span><span class="n">batch_size</span><span class="p">)</span>
    <span class="n">test_ds</span> <span class="o">=</span> <span class="n">df_to_dataset</span><span class="p">(</span><span class="n">test</span><span class="p">,</span> <span class="n">shuffle</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">batch_size</span><span class="o">=</span><span class="n">batch_size</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">train_ds</span><span class="p">,</span> <span class="n">val_ds</span><span class="p">,</span> <span class="n">test_ds</span>



<span class="k">def</span> <span class="nf">get_feature_layer</span><span class="p">(</span><span class="n">cwd</span><span class="p">):</span> <span class="c1">#select the columns for analysis from dataset</span>
    <span class="n">feature_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">cwd</span><span class="p">,</span><span class="s1">&#39;data&#39;</span><span class="p">,</span><span class="s1">&#39;features&#39;</span><span class="p">,</span><span class="s1">&#39;use&#39;</span><span class="p">,</span><span class="s1">&#39;features.txt&#39;</span><span class="p">)</span>
    <span class="n">dict_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">cwd</span><span class="p">,</span><span class="s1">&#39;data&#39;</span><span class="p">,</span><span class="s1">&#39;features&#39;</span><span class="p">,</span><span class="s1">&#39;use&#39;</span><span class="p">)</span>
    <span class="n">feature_columns</span> <span class="o">=</span> <span class="p">[]</span>
    
    <span class="c1">#embedded columns</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">feature_path</span><span class="p">)</span> <span class="k">as</span> <span class="n">fp</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">cnt</span><span class="p">,</span> <span class="n">line</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">fp</span><span class="p">):</span>
            <span class="c1">#print(&#34;Adding {} to features&#34;.format(line))</span>
            <span class="n">line</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
            <span class="n">line</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\t</span><span class="s1">&#39;</span><span class="p">)</span>
            <span class="n">line</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="s2">&#34;&#39;&#34;</span><span class="p">)</span>

            <span class="nb">print</span><span class="p">(</span><span class="n">cnt</span><span class="p">)</span>   
            <span class="nb">print</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>

            <span class="n">indicator</span> <span class="o">=</span> <span class="n">feature_column</span><span class="o">.</span><span class="n">numeric_column</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>
            
            <span class="c1">#feature_column.categorical_column_with_vocabulary_file(</span>
            <span class="c1">#            key = line, vocabulary_file = os.path.join(dict_path,&#34;{}.txt&#34;.format(line)), default_value=0)</span>

            <span class="nb">print</span><span class="p">(</span><span class="n">indicator</span><span class="p">)</span>
            <span class="n">feature_columns</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">indicator</span><span class="p">)</span>


            <span class="c1">#feature_columns.append(feature_column.embedding_column(indicator, dimension=8))</span>

    
    <span class="n">crossed_feature</span> <span class="o">=</span> <span class="n">feature_column</span><span class="o">.</span><span class="n">crossed_column</span><span class="p">([</span><span class="s1">&#39;issue&#39;</span><span class="p">,</span> <span class="s1">&#39;issueArea&#39;</span><span class="p">,</span> <span class="s1">&#39;naturalCourt&#39;</span><span class="p">],</span> <span class="n">hash_bucket_size</span><span class="o">=</span><span class="mi">1000</span><span class="p">)</span>
    <span class="n">crossed_feature</span> <span class="o">=</span> <span class="n">feature_column</span><span class="o">.</span><span class="n">indicator_column</span><span class="p">(</span><span class="n">crossed_feature</span><span class="p">)</span>
    <span class="n">feature_columns</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">crossed_feature</span><span class="p">)</span>


    <span class="n">crossed_feature</span> <span class="o">=</span> <span class="n">feature_column</span><span class="o">.</span><span class="n">crossed_column</span><span class="p">([</span><span class="s1">&#39;issue&#39;</span><span class="p">,</span> <span class="s1">&#39;naturalCourt&#39;</span><span class="p">],</span> <span class="n">hash_bucket_size</span><span class="o">=</span><span class="mi">1000</span><span class="p">)</span>
    <span class="n">crossed_feature</span> <span class="o">=</span> <span class="n">feature_column</span><span class="o">.</span><span class="n">indicator_column</span><span class="p">(</span><span class="n">crossed_feature</span><span class="p">)</span>
    <span class="n">feature_columns</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">crossed_feature</span><span class="p">)</span>

    <span class="n">crossed_feature</span> <span class="o">=</span> <span class="n">feature_column</span><span class="o">.</span><span class="n">crossed_column</span><span class="p">([</span><span class="s1">&#39;issueArea&#39;</span><span class="p">,</span> <span class="s1">&#39;naturalCourt&#39;</span><span class="p">],</span><span class="n">hash_bucket_size</span><span class="o">=</span><span class="mi">1000</span><span class="p">)</span>
    <span class="n">crossed_feature</span> <span class="o">=</span> <span class="n">feature_column</span><span class="o">.</span><span class="n">indicator_column</span><span class="p">(</span><span class="n">crossed_feature</span><span class="p">)</span>
    <span class="n">feature_columns</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">crossed_feature</span><span class="p">)</span>
    
   <span class="c1"># court_buckets = feature_column.bucketized_column(naturalCourt, boundaries=[18, 25, 30, 35, 40, 45, 50, 55, 60, 65])</span>

    <span class="c1">#print(feature_columns)</span>
    <span class="n">feature_layer</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">layers</span><span class="o">.</span><span class="n">DenseFeatures</span><span class="p">(</span><span class="n">feature_columns</span><span class="p">)</span>
    <span class="c1">#for item in feature_columns:</span>
    <span class="c1">#    print(item)</span>
    <span class="c1">#    print(&#34;\n&#34;)</span>

    <span class="k">return</span> <span class="n">feature_layer</span>

     
    <span class="c1">#crossed cols</span>


    <span class="c1">#categorical_columns </span>

<span class="k">def</span> <span class="nf">understand_input_pipeline</span><span class="p">(</span><span class="n">train_ds</span><span class="p">):</span>
    <span class="k">for</span> <span class="n">feature_batch</span><span class="p">,</span> <span class="n">label_batch</span> <span class="ow">in</span> <span class="n">train_ds</span><span class="o">.</span><span class="n">take</span><span class="p">(</span><span class="mi">1</span><span class="p">):</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Every feature:&#39;</span><span class="p">,</span> <span class="nb">list</span><span class="p">(</span><span class="n">feature_batch</span><span class="o">.</span><span class="n">keys</span><span class="p">()))</span>
        <span class="c1">#print(&#39;A batch of ages:&#39;, feature_batch[&#39;age&#39;])</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;A batch of targets:&#39;</span><span class="p">,</span> <span class="n">label_batch</span> <span class="p">)</span>



<span class="k">def</span> <span class="nf">create_model</span><span class="p">(</span><span class="n">log_dir</span><span class="p">,</span><span class="n">feature_layer</span><span class="p">,</span> <span class="n">train_ds</span><span class="p">,</span> <span class="n">val_ds</span><span class="p">,</span> <span class="n">epochs</span> <span class="o">=</span> <span class="mi">5</span><span class="p">):</span>
    
    <span class="n">model</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">Sequential</span><span class="p">([</span>
        <span class="n">feature_layer</span><span class="p">,</span>
        <span class="n">layers</span><span class="o">.</span><span class="n">Dense</span><span class="p">(</span><span class="mi">128</span><span class="p">,</span> <span class="n">activation</span><span class="o">=</span><span class="s1">&#39;relu&#39;</span><span class="p">),</span>
        <span class="n">layers</span><span class="o">.</span><span class="n">Dense</span><span class="p">(</span><span class="mi">128</span><span class="p">,</span> <span class="n">activation</span><span class="o">=</span><span class="s1">&#39;relu&#39;</span><span class="p">),</span>
        <span class="n">layers</span><span class="o">.</span><span class="n">Dense</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
    <span class="p">])</span>

    <span class="n">model</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="n">optimizer</span><span class="o">=</span><span class="s1">&#39;adam&#39;</span><span class="p">,</span>
            <span class="n">loss</span><span class="o">=</span><span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">losses</span><span class="o">.</span><span class="n">BinaryCrossentropy</span><span class="p">(</span><span class="n">from_logits</span><span class="o">=</span><span class="kc">True</span><span class="p">),</span>
            <span class="n">metrics</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;accuracy&#39;</span><span class="p">,</span> <span class="s1">&#39;mae&#39;</span><span class="p">])</span>

    <span class="n">history</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">train_ds</span><span class="p">,</span>
            <span class="n">validation_data</span><span class="o">=</span><span class="n">val_ds</span><span class="p">,</span>
            <span class="n">epochs</span><span class="o">=</span><span class="n">epochs</span><span class="p">)</span>

    <span class="n">loss</span><span class="p">,</span> <span class="n">accuracy</span><span class="p">,</span><span class="n">mae</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">evaluate</span><span class="p">(</span><span class="n">test_ds</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&#34;Accuracy&#34;</span><span class="p">,</span> <span class="n">accuracy</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">summary</span><span class="p">())</span>
    <span class="k">return</span> <span class="n">model</span><span class="p">,</span><span class="n">history</span>


<span class="k">def</span> <span class="nf">plot_history</span><span class="p">(</span><span class="n">history</span><span class="p">):</span>

    <span class="n">hist</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">history</span><span class="o">.</span><span class="n">history</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">hist</span><span class="p">)</span>
    <span class="n">hist</span><span class="p">[</span><span class="s1">&#39;epoch&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">history</span><span class="o">.</span><span class="n">epoch</span>

    <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Epoch&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Mean Absolute Error&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">hist</span><span class="p">[</span><span class="s1">&#39;epoch&#39;</span><span class="p">],</span> <span class="n">hist</span><span class="p">[</span><span class="s1">&#39;mae&#39;</span><span class="p">],</span>
            <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Train Error&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">hist</span><span class="p">[</span><span class="s1">&#39;epoch&#39;</span><span class="p">],</span> <span class="n">hist</span><span class="p">[</span><span class="s1">&#39;val_mae&#39;</span><span class="p">],</span>
            <span class="n">label</span> <span class="o">=</span> <span class="s1">&#39;Val Error&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>



<span class="k">def</span> <span class="nf">explain_kernal</span><span class="p">(</span><span class="n">df_train</span><span class="p">,</span><span class="n">model</span><span class="p">,</span><span class="n">train_ds</span><span class="p">):</span>
    
    <span class="c1"># KernelExplainer is a general approach that can work with any ML framework</span>
    <span class="c1"># Its inputs are the predictions and training data</span>

    <span class="c1"># Summarize the training set to accelerate analysis</span>
    <span class="n">df_train_summary</span> <span class="o">=</span> <span class="n">shap</span><span class="o">.</span><span class="n">kmeans</span><span class="p">(</span><span class="n">df_train</span><span class="o">.</span><span class="n">values</span><span class="p">,</span> <span class="mi">25</span><span class="p">)</span>

    <span class="c1"># Instantiate an explainer with the model predictions and training data summary</span>
    <span class="n">explainer</span> <span class="o">=</span> <span class="n">shap</span><span class="o">.</span><span class="n">KernelExplainer</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">predict</span><span class="p">,</span> <span class="n">df_train</span><span class="p">)</span>


<span class="c1"># Extract Shapley values from the explainer</span>
    <span class="c1">#shap_values = explainer.shap_values(df_train.values)</span>
<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&#34;__main__&#34;</span><span class="p">:</span>
    <span class="n">cwd</span><span class="p">,</span> <span class="n">log_dir</span> <span class="o">=</span> <span class="n">get_environmental_variables</span><span class="p">()</span>
    <span class="c1">#print(cwd)</span>

    <span class="n">df</span> <span class="o">=</span> <span class="n">load_data</span><span class="p">(</span><span class="n">cwd</span><span class="p">)</span>

    <span class="n">train</span><span class="p">,</span><span class="n">test</span><span class="p">,</span><span class="n">val</span> <span class="o">=</span> <span class="n">split_datframe</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>
    <span class="n">dataset</span> <span class="o">=</span> <span class="n">df_to_dataset</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>
    <span class="n">train_ds</span><span class="p">,</span> <span class="n">val_ds</span><span class="p">,</span> <span class="n">test_ds</span> <span class="o">=</span> <span class="n">get_input_pipeline</span><span class="p">(</span><span class="n">train</span><span class="p">,</span><span class="n">test</span><span class="p">,</span><span class="n">val</span><span class="p">,</span><span class="mi">32</span><span class="p">)</span>
    <span class="n">understand_input_pipeline</span><span class="p">(</span><span class="n">train_ds</span><span class="p">)</span>
    <span class="n">feature_layer</span> <span class="o">=</span> <span class="n">get_feature_layer</span><span class="p">(</span><span class="n">cwd</span><span class="p">)</span>
    <span class="n">model</span><span class="p">,</span> <span class="n">model_history</span> <span class="o">=</span> <span class="n">create_model</span><span class="p">(</span><span class="n">log_dir</span><span class="p">,</span><span class="n">feature_layer</span><span class="p">,</span> <span class="n">train_ds</span><span class="p">,</span> <span class="n">val_ds</span><span class="p">)</span>
    <span class="n">plot_history</span><span class="p">(</span><span class="n">model_history</span><span class="p">)</span>
    <span class="c1">#print(model.predict(train_ds))</span>
    <span class="c1">#print(model.predict)</span>
    <span class="n">explain_kernal</span><span class="p">(</span><span class="n">df</span><span class="p">,</span><span class="n">model</span><span class="p">,</span><span class="n">train_ds</span><span class="p">)</span>
</code></pre></div><h3 id="the-justice-centric-training-pipeline">The Justice Centric Training Pipeline</h3>
<p>The entire pipeline is included below.  Review the <a href="https://docs.jnapolitano.io/parts/ml-ai/tensorflow/project-supcourt-tensorflow/docs/SupremeCourtPredictionsJustice/index.html">documentation</a> for greater detail.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="c1">#supremeCourtPrediction.py</span>
<span class="c1">#a program that uses the segal and spaeth dataset to predict the outcomes of cases</span>


<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>

<span class="kn">import</span> <span class="nn">tensorflow</span> <span class="k">as</span> <span class="nn">tf</span>

<span class="kn">import</span> <span class="nn">math</span>

<span class="kn">import</span> <span class="nn">seaborn</span> <span class="k">as</span> <span class="nn">sns</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>

<span class="kn">import</span> <span class="nn">shap</span>
<span class="n">shap</span><span class="o">.</span><span class="n">initjs</span><span class="p">()</span>

<span class="kn">import</span> <span class="nn">os</span> 
<span class="kn">import</span> <span class="nn">csv</span>
<span class="kn">import</span> <span class="nn">datetime</span>

<span class="kn">from</span> <span class="nn">tensorflow</span> <span class="kn">import</span> <span class="n">feature_column</span>
<span class="kn">from</span> <span class="nn">tensorflow.keras</span> <span class="kn">import</span> <span class="n">layers</span>
<span class="kn">from</span> <span class="nn">sklearn.model_selection</span> <span class="kn">import</span> <span class="n">train_test_split</span>

<span class="kn">from</span> <span class="nn">itertools</span> <span class="kn">import</span> <span class="n">permutations</span>
<span class="kn">from</span> <span class="nn">itertools</span> <span class="kn">import</span> <span class="n">combinations_with_replacement</span>

<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>




<span class="k">def</span> <span class="nf">get_environmental_variables</span><span class="p">():</span>
    <span class="n">cwd</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">()</span>
    <span class="n">log_dir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">cwd</span><span class="p">,</span><span class="s2">&#34;logs/fit/&#34;</span><span class="p">)</span> <span class="o">+</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">&#34;%Y%m</span><span class="si">%d</span><span class="s2">-%H%M%S&#34;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">cwd</span><span class="p">,</span> <span class="n">log_dir</span>




<span class="k">def</span> <span class="nf">load_data</span><span class="p">(</span><span class="n">cwd</span><span class="p">):</span>
    <span class="n">data_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">cwd</span><span class="p">,</span><span class="s1">&#39;data&#39;</span><span class="p">,</span><span class="s1">&#39;justice.csv&#39;</span><span class="p">)</span> 
    <span class="n">drop_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">cwd</span><span class="p">,</span><span class="s1">&#39;data&#39;</span><span class="p">,</span><span class="s1">&#39;features&#39;</span><span class="p">,</span><span class="s1">&#39;drop&#39;</span><span class="p">,</span><span class="s1">&#39;drop.txt&#39;</span><span class="p">)</span>
    <span class="n">target_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">cwd</span><span class="p">,</span><span class="s1">&#39;data&#39;</span><span class="p">,</span><span class="s1">&#39;features&#39;</span><span class="p">,</span><span class="s1">&#39;targets.txt&#39;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">data_path</span><span class="p">)</span>
    <span class="n">dataframe</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">data_path</span><span class="p">,</span><span class="n">encoding</span><span class="o">=</span> <span class="s1">&#39;unicode_escape&#39;</span><span class="p">)</span>
    <span class="c1">#print(dataframe.head())</span>
    
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">drop_path</span><span class="p">)</span> <span class="k">as</span> <span class="n">fp</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">cnt</span><span class="p">,</span> <span class="n">line</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">fp</span><span class="p">):</span>
            <span class="c1">#print(&#34;Dropping {} from dataframe&#34;.format(line))</span>
            <span class="n">line</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
            <span class="n">line</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\t</span><span class="s1">&#39;</span><span class="p">)</span>
            <span class="n">line</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="s2">&#34;&#39;&#34;</span><span class="p">)</span>

            <span class="n">dataframe</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">line</span><span class="p">,</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    
    <span class="n">dataframe</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">dataframe</span><span class="p">)</span>
    <span class="c1">#dataframe.issue = dataframe.astype({&#39;issue&#39;: &#39;str&#39;})</span>
    <span class="c1">#dataframe[issue] = dataframe[issue].astype(str)</span>
    <span class="c1">#print(dataframe)</span>
    <span class="c1">#print(dataframe.head())</span>
    <span class="k">return</span> <span class="n">dataframe</span>




<span class="k">def</span> <span class="nf">split_datframe</span><span class="p">(</span><span class="n">dataframe</span><span class="p">):</span>
    <span class="n">train</span><span class="p">,</span> <span class="n">test</span> <span class="o">=</span> <span class="n">train_test_split</span><span class="p">(</span><span class="n">dataframe</span><span class="p">,</span> <span class="n">test_size</span><span class="o">=</span><span class="mf">0.2</span><span class="p">)</span>
    <span class="n">train</span><span class="p">,</span> <span class="n">val</span> <span class="o">=</span> <span class="n">train_test_split</span><span class="p">(</span><span class="n">train</span><span class="p">,</span> <span class="n">test_size</span><span class="o">=</span><span class="mf">0.2</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">train</span><span class="p">),</span> <span class="s1">&#39;train examples&#39;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">val</span><span class="p">),</span> <span class="s1">&#39;validation examples&#39;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">test</span><span class="p">),</span> <span class="s1">&#39;test examples&#39;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">train</span><span class="p">,</span> <span class="n">test</span><span class="p">,</span> <span class="n">val</span>


    <span class="c1"># A utility method to create a tf.data dataset from a Pandas Dataframe</span>


<span class="k">def</span> <span class="nf">df_to_dataset</span><span class="p">(</span><span class="n">dataframe</span><span class="p">,</span> <span class="n">shuffle</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">batch_size</span><span class="o">=</span><span class="mi">32</span><span class="p">):</span>
    <span class="n">dataframe</span> <span class="o">=</span> <span class="n">dataframe</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
    <span class="n">labels</span> <span class="o">=</span> <span class="n">dataframe</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;vote&#39;</span><span class="p">)</span>
    <span class="n">ds</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">Dataset</span><span class="o">.</span><span class="n">from_tensor_slices</span><span class="p">((</span><span class="nb">dict</span><span class="p">(</span><span class="n">dataframe</span><span class="p">),</span> <span class="n">labels</span><span class="p">))</span>
    <span class="k">if</span> <span class="n">shuffle</span><span class="p">:</span>
        <span class="n">ds</span> <span class="o">=</span> <span class="n">ds</span><span class="o">.</span><span class="n">shuffle</span><span class="p">(</span><span class="n">buffer_size</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">dataframe</span><span class="p">))</span>
    <span class="n">ds</span> <span class="o">=</span> <span class="n">ds</span><span class="o">.</span><span class="n">batch</span><span class="p">(</span><span class="n">batch_size</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">ds</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">ds</span>




<span class="k">def</span> <span class="nf">get_input_pipeline</span><span class="p">(</span><span class="n">train</span><span class="p">,</span> <span class="n">test</span><span class="p">,</span> <span class="n">val</span><span class="p">,</span> <span class="n">batch_size</span><span class="o">=</span><span class="mi">32</span><span class="p">,</span> <span class="n">shuffle</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
    <span class="n">train_ds</span> <span class="o">=</span> <span class="n">df_to_dataset</span><span class="p">(</span><span class="n">train</span><span class="p">,</span> <span class="n">batch_size</span><span class="o">=</span><span class="n">batch_size</span><span class="p">)</span>
    <span class="n">val_ds</span> <span class="o">=</span> <span class="n">df_to_dataset</span><span class="p">(</span><span class="n">val</span><span class="p">,</span> <span class="n">shuffle</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">batch_size</span><span class="o">=</span><span class="n">batch_size</span><span class="p">)</span>
    <span class="n">test_ds</span> <span class="o">=</span> <span class="n">df_to_dataset</span><span class="p">(</span><span class="n">test</span><span class="p">,</span> <span class="n">shuffle</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">batch_size</span><span class="o">=</span><span class="n">batch_size</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">train_ds</span><span class="p">,</span> <span class="n">val_ds</span><span class="p">,</span> <span class="n">test_ds</span>




<span class="k">def</span> <span class="nf">get_feature_layer</span><span class="p">(</span><span class="n">cwd</span><span class="p">):</span> <span class="c1">#select the columns for analysis from dataset</span>
    <span class="n">feature_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">cwd</span><span class="p">,</span><span class="s1">&#39;data&#39;</span><span class="p">,</span><span class="s1">&#39;features&#39;</span><span class="p">,</span><span class="s1">&#39;use&#39;</span><span class="p">,</span><span class="s1">&#39;features.txt&#39;</span><span class="p">)</span>
    <span class="n">dict_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">cwd</span><span class="p">,</span><span class="s1">&#39;data&#39;</span><span class="p">,</span><span class="s1">&#39;features&#39;</span><span class="p">,</span><span class="s1">&#39;use&#39;</span><span class="p">)</span>
    <span class="n">feature_columns</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">feature_list</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="c1">#embedded columns</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">feature_path</span><span class="p">)</span> <span class="k">as</span> <span class="n">fp</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">cnt</span><span class="p">,</span> <span class="n">line</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">fp</span><span class="p">):</span>
            <span class="c1">#print(&#34;Adding {} to features&#34;.format(line))</span>
            <span class="n">line</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
            <span class="n">line</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\t</span><span class="s1">&#39;</span><span class="p">)</span>
            <span class="n">line</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="s2">&#34;&#39;&#34;</span><span class="p">)</span>

            <span class="nb">print</span><span class="p">(</span><span class="n">cnt</span><span class="p">)</span>   
            <span class="nb">print</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>
            <span class="n">feature_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>

            <span class="n">indicator</span> <span class="o">=</span> <span class="n">feature_column</span><span class="o">.</span><span class="n">numeric_column</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>
            
            <span class="c1">#feature_column.categorical_column_with_vocabulary_file(</span>
            <span class="c1">#            key = line, vocabulary_file = os.path.join(dict_path,&#34;{}.txt&#34;.format(line)), default_value=0)</span>

            <span class="nb">print</span><span class="p">(</span><span class="n">indicator</span><span class="p">)</span>
            <span class="n">feature_columns</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">indicator</span><span class="p">)</span>


            <span class="c1">#feature_columns.append(feature_column.embedding_column(indicator, dimension=8))</span>

    <span class="n">feature_comb</span> <span class="o">=</span> <span class="n">combinations_with_replacement</span><span class="p">(</span><span class="n">feature_list</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span> 
    <span class="n">lst</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">feature_comb</span><span class="p">)</span>
    <span class="n">limit</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">feature_list</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">limit</span><span class="p">)</span>
    <span class="n">j</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">k</span> <span class="o">=</span> <span class="n">limit</span> <span class="o">-</span> <span class="mi">1</span>
    <span class="n">lookup</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">limit</span><span class="p">):</span>
        <span class="n">lookup</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="n">j</span><span class="p">)</span>
        <span class="n">j</span> <span class="o">=</span> <span class="n">j</span> <span class="o">+</span> <span class="n">k</span>
        <span class="n">k</span> <span class="o">=</span> <span class="n">k</span> <span class="o">-</span> <span class="mi">1</span> 


    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">lst</span><span class="p">)):</span>
        <span class="k">if</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">lookup</span><span class="p">:</span>
            <span class="k">continue</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">one</span><span class="p">,</span> <span class="n">two</span> <span class="o">=</span> <span class="n">lst</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
            <span class="n">crossed_feature</span> <span class="o">=</span> <span class="n">feature_column</span><span class="o">.</span><span class="n">crossed_column</span><span class="p">([</span><span class="n">one</span><span class="p">,</span> <span class="n">two</span><span class="p">],</span> <span class="n">hash_bucket_size</span><span class="o">=</span><span class="mi">1000</span><span class="p">)</span>
            <span class="n">crossed_feature</span> <span class="o">=</span> <span class="n">feature_column</span><span class="o">.</span><span class="n">indicator_column</span><span class="p">(</span><span class="n">crossed_feature</span><span class="p">)</span>
            <span class="n">feature_columns</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">crossed_feature</span><span class="p">)</span>

    <span class="s2">&#34;&#34;&#34;
</span><span class="s2">    crossed_feature = feature_column.crossed_column([&#39;issue&#39;, &#39;naturalCourt&#39;], hash_bucket_size=1000)
</span><span class="s2">    crossed_feature = feature_column.indicator_column(crossed_feature)
</span><span class="s2">    feature_columns.append(crossed_feature)
</span><span class="s2">
</span><span class="s2">    crossed_feature = feature_column.crossed_column([&#39;issueArea&#39;, &#39;naturalCourt&#39;],hash_bucket_size=1000)
</span><span class="s2">    crossed_feature = feature_column.indicator_column(crossed_feature)
</span><span class="s2">    feature_columns.append(crossed_feature)
</span><span class="s2">    &#34;&#34;&#34;</span>
   <span class="c1"># court_buckets = feature_column.bucketized_column(naturalCourt, boundaries=[18, 25, 30, 35, 40, 45, 50, 55, 60, 65])</span>

    <span class="c1">#print(feature_columns)</span>
    <span class="n">feature_layer</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">layers</span><span class="o">.</span><span class="n">DenseFeatures</span><span class="p">(</span><span class="n">feature_columns</span><span class="p">)</span>
    <span class="c1">#for item in feature_columns:</span>
    <span class="c1">#    print(item)</span>
    <span class="c1">#    print(&#34;\n&#34;)</span>

    <span class="k">return</span> <span class="n">feature_layer</span>

     
    <span class="c1">#crossed cols</span>


    <span class="c1">#categorical_columns </span>


<span class="k">def</span> <span class="nf">understand_input_pipeline</span><span class="p">(</span><span class="n">train_ds</span><span class="p">):</span>
    <span class="k">for</span> <span class="n">feature_batch</span><span class="p">,</span> <span class="n">label_batch</span> <span class="ow">in</span> <span class="n">train_ds</span><span class="o">.</span><span class="n">take</span><span class="p">(</span><span class="mi">1</span><span class="p">):</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Every feature:&#39;</span><span class="p">,</span> <span class="nb">list</span><span class="p">(</span><span class="n">feature_batch</span><span class="o">.</span><span class="n">keys</span><span class="p">()))</span>
        <span class="c1">#print(&#39;A batch of ages:&#39;, feature_batch[&#39;age&#39;])</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;A batch of targets:&#39;</span><span class="p">,</span> <span class="n">label_batch</span> <span class="p">)</span>




<span class="k">def</span> <span class="nf">create_model</span><span class="p">(</span><span class="n">log_dir</span><span class="p">,</span><span class="n">feature_layer</span><span class="p">,</span> <span class="n">train_ds</span><span class="p">,</span> <span class="n">val_ds</span><span class="p">,</span> <span class="n">epochs</span> <span class="o">=</span> <span class="mi">8</span><span class="p">):</span>
    
    <span class="n">model</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">Sequential</span><span class="p">([</span>
        <span class="n">feature_layer</span><span class="p">,</span>
        <span class="n">layers</span><span class="o">.</span><span class="n">Dense</span><span class="p">(</span><span class="mi">128</span><span class="p">,</span> <span class="n">activation</span><span class="o">=</span><span class="s1">&#39;relu&#39;</span><span class="p">),</span>
        <span class="n">layers</span><span class="o">.</span><span class="n">Dense</span><span class="p">(</span><span class="mi">128</span><span class="p">,</span> <span class="n">activation</span><span class="o">=</span><span class="s1">&#39;relu&#39;</span><span class="p">),</span>
        <span class="n">layers</span><span class="o">.</span><span class="n">Dense</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
    <span class="p">])</span>

    <span class="n">model</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="n">optimizer</span><span class="o">=</span><span class="s1">&#39;adam&#39;</span><span class="p">,</span>
            <span class="n">loss</span><span class="o">=</span><span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">losses</span><span class="o">.</span><span class="n">BinaryCrossentropy</span><span class="p">(</span><span class="n">from_logits</span><span class="o">=</span><span class="kc">True</span><span class="p">),</span>
            <span class="n">metrics</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;accuracy&#39;</span><span class="p">,</span> <span class="s1">&#39;mae&#39;</span><span class="p">])</span>

    <span class="n">history</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">train_ds</span><span class="p">,</span>
            <span class="n">validation_data</span><span class="o">=</span><span class="n">val_ds</span><span class="p">,</span>
            <span class="n">epochs</span><span class="o">=</span><span class="n">epochs</span><span class="p">)</span>

    <span class="n">loss</span><span class="p">,</span> <span class="n">accuracy</span><span class="p">,</span><span class="n">mae</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">evaluate</span><span class="p">(</span><span class="n">test_ds</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&#34;Accuracy&#34;</span><span class="p">,</span> <span class="n">accuracy</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">summary</span><span class="p">())</span>
    <span class="k">return</span> <span class="n">model</span><span class="p">,</span><span class="n">history</span>




<span class="k">def</span> <span class="nf">plot_history</span><span class="p">(</span><span class="n">history</span><span class="p">):</span>

    <span class="n">hist</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">history</span><span class="o">.</span><span class="n">history</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">hist</span><span class="p">)</span>
    <span class="n">hist</span><span class="p">[</span><span class="s1">&#39;epoch&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">history</span><span class="o">.</span><span class="n">epoch</span>

    <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Epoch&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Mean Absolute Error&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">hist</span><span class="p">[</span><span class="s1">&#39;epoch&#39;</span><span class="p">],</span> <span class="n">hist</span><span class="p">[</span><span class="s1">&#39;mae&#39;</span><span class="p">],</span>
            <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Train Error&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">hist</span><span class="p">[</span><span class="s1">&#39;epoch&#39;</span><span class="p">],</span> <span class="n">hist</span><span class="p">[</span><span class="s1">&#39;val_mae&#39;</span><span class="p">],</span>
            <span class="n">label</span> <span class="o">=</span> <span class="s1">&#39;Val Error&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>




<span class="k">def</span> <span class="nf">explain_kernal</span><span class="p">(</span><span class="n">model</span><span class="p">,</span><span class="n">train_ds</span><span class="p">):</span>
    <span class="n">model</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">train_ds</span><span class="p">)</span>
    <span class="c1"># KernelExplainer is a general approach that can work with any ML framework</span>
    <span class="c1"># Its inputs are the predictions and training data</span>

    <span class="c1"># Summarize the training set to accelerate analysis</span>
    <span class="n">df_train_summary</span> <span class="o">=</span> <span class="n">shap</span><span class="o">.</span><span class="n">kmeans</span><span class="p">(</span><span class="n">train_ds</span><span class="o">.</span><span class="n">values</span><span class="p">,</span> <span class="mi">25</span><span class="p">)</span>
    <span class="c1">#print(df_train_summary)</span>
    <span class="c1">#model.predict(df_train_summary)</span>
    <span class="c1"># Instantiate an explainer with the model predictions and training data summary</span>
    <span class="n">explainer</span> <span class="o">=</span> <span class="n">shap</span><span class="o">.</span><span class="n">KernelExplainer</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">predict</span><span class="p">,</span> <span class="n">train_ds</span><span class="p">)</span>


<span class="c1"># Extract Shapley values from the explainer</span>
    <span class="c1">#shap_values = explainer.shap_values(df_train.values)</span>
<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&#34;__main__&#34;</span><span class="p">:</span>
    <span class="n">cwd</span><span class="p">,</span> <span class="n">log_dir</span> <span class="o">=</span> <span class="n">get_environmental_variables</span><span class="p">()</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">cwd</span><span class="p">)</span>


    <span class="n">df</span> <span class="o">=</span> <span class="n">load_data</span><span class="p">(</span><span class="n">cwd</span><span class="p">)</span>

    <span class="n">train</span><span class="p">,</span><span class="n">test</span><span class="p">,</span><span class="n">val</span> <span class="o">=</span> <span class="n">split_datframe</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>
    <span class="n">dataset</span> <span class="o">=</span> <span class="n">df_to_dataset</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>
    <span class="n">train_ds</span><span class="p">,</span> <span class="n">val_ds</span><span class="p">,</span> <span class="n">test_ds</span> <span class="o">=</span> <span class="n">get_input_pipeline</span><span class="p">(</span><span class="n">train</span><span class="p">,</span><span class="n">test</span><span class="p">,</span><span class="n">val</span><span class="p">,</span><span class="mi">32</span><span class="p">)</span>
    <span class="n">understand_input_pipeline</span><span class="p">(</span><span class="n">train_ds</span><span class="p">)</span>
    <span class="n">feature_layer</span> <span class="o">=</span> <span class="n">get_feature_layer</span><span class="p">(</span><span class="n">cwd</span><span class="p">)</span>
    <span class="n">model</span><span class="p">,</span> <span class="n">model_history</span> <span class="o">=</span> <span class="n">create_model</span><span class="p">(</span><span class="n">log_dir</span><span class="p">,</span><span class="n">feature_layer</span><span class="p">,</span> <span class="n">train_ds</span><span class="p">,</span> <span class="n">val_ds</span><span class="p">)</span>
    <span class="c1">#plot_history(model_history)</span>
    <span class="c1">#print(model.predict(train_ds))</span>
    <span class="c1">#print(model.predict)</span>
    <span class="c1">#explain_kernal(model,train_ds)</span>
</code></pre></div>]]></content>
			<postid> b5f3ceb4a57b8625893a7e9dfeed9f2d</postid>
			<author>Justin Napolitano</author>
			<author_name>Justin Napolitano</author_name>
			<author_email>personal.jnapolitano@gmail.com</author_email>
			<author_id>87654367b2fca109e7dc9d3ea8a1ebbaf0bfe374773b148c2c20d278479add99</author_id>			
		</item>
		
		<item>
			<title>Conduct Legal Research with AI: Part 2</title>
			<link>jnapolitano.com/posts/legal-reserch-part-2/</link>
			<pubDate>Tue, 17 May 2022 18:40:32 +0000</pubDate>
			<guid>jnapolitano.com/posts/legal-reserch-part-2/</guid>
			<description><![CDATA[Documenting classes and an application to integrate the US Constitution into my Neo4j DB]]></description>
			<content type="html"><![CDATA[<h1 id="integrating-the-constitution-to-neo4j">Integrating the Constitution to Neo4j</h1>
<p>I am currenlty building a graph database of Supreme Court cases in neo4j to model the behavior and decison making of the court.</p>
<p>In this post, I include the classes that I will be using to create individual nodes for the articles, sections, clauses, and subclauses of the Consititution.</p>
<p>Later, these will be related to cases and subjecst in order to train a tensorflow algorithm to recommend case law by issue area and to predict the outcome of cases.</p>
<h2 id="workflow">Workflow</h2>
<p>The basic workflow requires creating a node and then submitting it to the neo4j db.   My previous posts have documented this process in detail.  Review <a href="https://blog.jnapolitano.io/neo4j_integration/">blog.jnapolitano.io/neo4j_integration/</a> for more information.</p>
<h2 id="neomodel-api-classes">Neomodel Api Classes</h2>
<p>The neomodel classes below generate the nodes to be integrated into the database.</p>
<h3 id="article-class">Article Class</h3>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="k">class</span> <span class="nc">Article</span><span class="p">(</span><span class="n">StructuredNode</span><span class="p">):</span>
    <span class="n">uuid</span> <span class="o">=</span> <span class="n">UniqueIdProperty</span><span class="p">()</span>
    <span class="n">name</span> <span class="o">=</span> <span class="n">StringProperty</span><span class="p">(</span><span class="n">unique_index</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">required</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">topic</span> <span class="o">=</span> <span class="n">StringProperty</span><span class="p">(</span><span class="n">unique_index</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">required</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">citation</span> <span class="o">=</span> <span class="n">StringProperty</span><span class="p">(</span><span class="n">unique_index</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">required</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">clause</span> <span class="o">=</span> <span class="n">Relationship</span><span class="p">(</span><span class="s2">&#34;Clause&#34;</span><span class="p">,</span> <span class="s2">&#34;IS_ARTICLE_OF&#34;</span><span class="p">)</span>
    <span class="n">sub_clause</span> <span class="o">=</span> <span class="n">Relationship</span><span class="p">(</span><span class="s2">&#34;Subclause&#34;</span><span class="p">,</span> <span class="s2">&#34;IS_ARTICLE_OF&#34;</span><span class="p">)</span>
    <span class="n">case</span> <span class="o">=</span> <span class="n">Relationship</span><span class="p">(</span><span class="s2">&#34;Case&#34;</span><span class="p">,</span> <span class="s1">&#39;IS_ARTICLE_OF&#39;</span><span class="p">)</span>

</code></pre></div><h3 id="section-class">Section Class</h3>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="k">class</span> <span class="nc">Section</span><span class="p">(</span><span class="n">StructuredNode</span><span class="p">):</span>
    <span class="n">uuid</span> <span class="o">=</span> <span class="n">UniqueIdProperty</span><span class="p">()</span>
    <span class="n">name</span> <span class="o">=</span> <span class="n">StringProperty</span><span class="p">(</span><span class="n">unique_index</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">required</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">topic</span> <span class="o">=</span> <span class="n">StringProperty</span><span class="p">(</span><span class="n">unique_index</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">required</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">article</span> <span class="o">=</span> <span class="n">Relationship</span><span class="p">(</span><span class="s2">&#34;Article&#34;</span><span class="p">,</span> <span class="s2">&#34;IS_SECTION_OF&#34;</span><span class="p">)</span>
    <span class="n">citation</span> <span class="o">=</span> <span class="n">StringProperty</span><span class="p">(</span><span class="n">unique_index</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">required</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">clause</span> <span class="o">=</span> <span class="n">Relationship</span><span class="p">(</span><span class="s2">&#34;Clause&#34;</span><span class="p">,</span> <span class="s2">&#34;IS_SECTION_OF&#34;</span><span class="p">)</span>
    <span class="n">sub_clause</span> <span class="o">=</span> <span class="n">Relationship</span><span class="p">(</span><span class="s2">&#34;Subclause&#34;</span><span class="p">,</span> <span class="s2">&#34;IS_SECTION_OF&#34;</span><span class="p">)</span>
    <span class="n">case</span> <span class="o">=</span> <span class="n">Relationship</span><span class="p">(</span><span class="s2">&#34;Case&#34;</span><span class="p">,</span> <span class="s1">&#39;IS_SECTION_OF&#39;</span><span class="p">)</span>

</code></pre></div><h3 id="clause-class">Clause Class</h3>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python">
<span class="k">class</span> <span class="nc">Clause</span><span class="p">(</span><span class="n">StructuredNode</span><span class="p">):</span>
    <span class="n">uuid</span> <span class="o">=</span> <span class="n">UniqueIdProperty</span><span class="p">()</span>
    <span class="n">name</span> <span class="o">=</span> <span class="n">StringProperty</span><span class="p">(</span><span class="n">unique_index</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">required</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">topic</span> <span class="o">=</span> <span class="n">StringProperty</span><span class="p">(</span><span class="n">unique_index</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">required</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">citation</span> <span class="o">=</span> <span class="n">StringProperty</span><span class="p">(</span><span class="n">unique_index</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">required</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">article</span> <span class="o">=</span> <span class="n">Relationship</span><span class="p">(</span><span class="s2">&#34;Article&#34;</span><span class="p">,</span> <span class="s2">&#34;IS_CLAUSE_OF&#34;</span><span class="p">)</span>
    <span class="n">sibling_clause</span><span class="o">=</span> <span class="n">Relationship</span><span class="p">(</span><span class="s2">&#34;Clause&#34;</span><span class="p">,</span> <span class="s2">&#34;IS_CLAUSE_OF&#34;</span><span class="p">)</span>
    <span class="n">sub_clause</span> <span class="o">=</span> <span class="n">Relationship</span><span class="p">(</span><span class="s2">&#34;Subclause&#34;</span><span class="p">,</span> <span class="s2">&#34;IS_CLAUSE_OF&#34;</span><span class="p">)</span>
    <span class="n">case</span> <span class="o">=</span> <span class="n">Relationship</span><span class="p">(</span><span class="s2">&#34;Case&#34;</span><span class="p">,</span> <span class="s1">&#39;IS_CLAUSE_OF&#39;</span><span class="p">)</span>

</code></pre></div><h3 id="subclause-class">Subclause Class</h3>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python">
<span class="k">class</span> <span class="nc">Subclause</span><span class="p">(</span><span class="n">StructuredNode</span><span class="p">):</span>
    <span class="n">uuid</span> <span class="o">=</span> <span class="n">UniqueIdProperty</span><span class="p">()</span>
    <span class="n">name</span> <span class="o">=</span> <span class="n">StringProperty</span><span class="p">(</span><span class="n">unique_index</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">required</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">topic</span> <span class="o">=</span> <span class="n">StringProperty</span><span class="p">(</span><span class="n">unique_index</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">required</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">citation</span> <span class="o">=</span> <span class="n">StringProperty</span><span class="p">(</span><span class="n">unique_index</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">required</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">article</span> <span class="o">=</span> <span class="n">Relationship</span><span class="p">(</span><span class="s2">&#34;Article&#34;</span><span class="p">,</span> <span class="s2">&#34;&#39;IS_SUBCLAUSE_OF&#39;&#34;</span><span class="p">)</span>
    <span class="n">clause</span> <span class="o">=</span> <span class="n">Relationship</span><span class="p">(</span><span class="s2">&#34;Article&#34;</span><span class="p">,</span> <span class="s2">&#34;&#39;IS_SUBCLAUSE_OF&#39;&#34;</span><span class="p">)</span>
    <span class="n">sibling_clause</span><span class="o">=</span> <span class="n">Relationship</span><span class="p">(</span><span class="s2">&#34;Clause&#34;</span><span class="p">,</span> <span class="s2">&#34;&#39;IS_SUBCLAUSE_OF&#39;&#34;</span><span class="p">)</span>
    <span class="n">case</span> <span class="o">=</span> <span class="n">Relationship</span><span class="p">(</span><span class="s2">&#34;Case&#34;</span><span class="p">,</span> <span class="s1">&#39;IS_SUBCLAUSE_OF&#39;</span><span class="p">)</span>
    <span class="c1">#sub_clause = Relationship(&#34;Subclause&#34;, &#34;IS_SUBCLAUSE_OF&#34;)</span>

</code></pre></div><h2 id="sample-application">Sample Application</h2>
<p>The application below creates a dataframe with node objects that will be uploaded to the neo4j database.  In order to accomplish an upload the .save() function must be called on the object.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python">
<span class="kn">from</span> <span class="nn">platform</span> <span class="kn">import</span> <span class="n">node</span>
<span class="kn">from</span> <span class="nn">pprint</span> <span class="kn">import</span> <span class="n">pprint</span>
<span class="c1">#from neomodel import (config, StructuredNode, StringProperty, IntegerProperty,</span>
<span class="c1">#    UniqueIdProperty, RelationshipTo, BooleanProperty, EmailProperty, Relationship,db)</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="c1">#import NeoNodes as nn</span>
<span class="c1">#import GoogleServices</span>
<span class="c1">#import sparkAPI as spark</span>
<span class="kn">import</span> <span class="nn">neoModelAPI</span> <span class="k">as</span> <span class="nn">neo</span>
<span class="kn">import</span> <span class="nn">glob</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">json</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">shutil</span>



<span class="k">def</span> <span class="nf">instantiate_neo_model_api</span><span class="p">():</span>
    <span class="n">uri</span> <span class="o">=</span> <span class="s2">&#34;7a92f171.databases.neo4j.io&#34;</span>
    <span class="n">user</span> <span class="o">=</span> <span class="s2">&#34;neo4j&#34;</span>
    <span class="n">psw</span> <span class="o">=</span> <span class="s1">&#39;RF4Gr2IJTNhHlW6HOrLDqz_I2E2Upyh7o8paTwfnCxg&#39;</span>
    <span class="k">return</span> <span class="n">neo</span><span class="o">.</span><span class="n">neoAPI</span><span class="o">.</span><span class="n">instantiate_neo_model_session</span><span class="p">(</span><span class="n">uri</span><span class="o">=</span><span class="n">uri</span><span class="p">,</span><span class="n">user</span><span class="o">=</span><span class="n">user</span><span class="p">,</span><span class="n">psw</span><span class="o">=</span><span class="n">psw</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">get_cwd</span><span class="p">():</span>
    <span class="n">cwd</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">cwd</span>


<span class="k">def</span> <span class="nf">get_files</span><span class="p">(</span><span class="n">cwd</span> <span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">(),</span> <span class="n">input_directory</span> <span class="o">=</span> <span class="s1">&#39;article_data&#39;</span><span class="p">):</span>
    
    <span class="n">path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">sep</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">cwd</span><span class="p">,</span><span class="n">input_directory</span><span class="p">])</span>
    <span class="c1">#pprint(path)</span>
    <span class="n">file_list</span><span class="o">=</span> <span class="p">[</span><span class="n">f</span> <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">glob</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="n">path</span> <span class="o">+</span> <span class="s2">&#34;**/*.csv&#34;</span><span class="p">,</span> <span class="n">recursive</span><span class="o">=</span><span class="kc">True</span><span class="p">)]</span>
  
    <span class="k">return</span> <span class="n">file_list</span>

<span class="k">def</span> <span class="nf">get_df</span><span class="p">(</span><span class="n">file_list</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">a_file</span> <span class="ow">in</span> <span class="n">file_list</span><span class="p">:</span>
            <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">a_file</span> <span class="p">)</span>
            <span class="k">return</span> <span class="n">df</span>
    <span class="k">except</span><span class="p">:</span>
        <span class="k">raise</span>
       

<span class="k">def</span> <span class="nf">get_transaction_df</span><span class="p">(</span><span class="n">df</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>  
    <span class="c1">#pprint(justice_df)</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="c1">#pprint(df.columns)</span>
        <span class="c1">#   df.apply(lambda x: print(x), axis =1)</span>
        <span class="n">df</span><span class="p">[</span><span class="s1">&#39;transaction&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">neo</span><span class="o">.</span><span class="n">neoAPI</span><span class="o">.</span><span class="n">create_section_node</span><span class="p">(</span><span class="n">name</span><span class="o">=</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;section&#39;</span><span class="p">],</span>  
        <span class="n">topic</span> <span class="o">=</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;topic&#39;</span><span class="p">],</span> 
        <span class="n">citation</span> <span class="o">=</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;citation&#39;</span><span class="p">]),</span>
        <span class="n">axis</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="p">)</span>
        <span class="k">return</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>
    <span class="k">except</span><span class="p">:</span>
    
        <span class="k">raise</span>

<span class="k">def</span> <span class="nf">write_transaction_to_file</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">cwd</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">(),</span><span class="n">import_directory</span> <span class="o">=</span> <span class="s1">&#39;merge_articles&#39;</span><span class="p">,</span> <span class="n">file_name</span> <span class="o">=</span> <span class="s1">&#39;article_transaction_df&#39;</span><span class="p">):</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">outfile</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">sep</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">cwd</span><span class="p">,</span><span class="n">import_directory</span><span class="p">,</span><span class="n">file_name</span><span class="p">])</span>
        <span class="c1">#pprint(outfile)</span>
        <span class="n">df</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="n">outfile</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">outfile</span>
    <span class="k">except</span><span class="p">:</span>
        <span class="k">raise</span>

<span class="k">def</span> <span class="nf">send_closing_message</span><span class="p">(</span><span class="n">df</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">outfile</span><span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
    <span class="n">size</span> <span class="o">=</span> <span class="n">shutil</span><span class="o">.</span><span class="n">get_terminal_size</span><span class="p">((</span><span class="mi">80</span><span class="p">,</span> <span class="mi">20</span><span class="p">))</span>
    <span class="n">columns</span> <span class="o">=</span> <span class="n">size</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span><span class="mi">2</span>


    <span class="n">seperator</span> <span class="o">=</span> <span class="s2">&#34;*&#34;</span> <span class="o">*</span> <span class="n">columns</span>
    <span class="n">df_message</span> <span class="o">=</span> <span class="s2">&#34;Your Final df looks like: &#34;</span>
    <span class="n">outfile_message</span> <span class="o">=</span> <span class="s2">&#34;You will find the data at: </span><span class="si">{}</span><span class="s2">&#34;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">outfile</span><span class="p">)</span>
    <span class="n">pprint</span><span class="p">(</span><span class="n">seperator</span><span class="p">)</span>
    <span class="n">pprint</span><span class="p">(</span><span class="n">df_message</span><span class="p">)</span>
    <span class="n">pprint</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>
    <span class="n">pprint</span><span class="p">(</span><span class="n">seperator</span><span class="p">)</span>
    <span class="n">pprint</span><span class="p">(</span><span class="n">outfile_message</span><span class="p">)</span>
    <span class="k">return</span> <span class="kc">True</span>
    


    


<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&#34;__main__&#34;</span><span class="p">:</span>
    <span class="c1">#neo_applified = instantiate_neo_model_api()</span>
    <span class="n">cwd</span> <span class="o">=</span> <span class="n">get_cwd</span><span class="p">()</span>
    <span class="n">file_list</span> <span class="o">=</span> <span class="n">get_files</span><span class="p">(</span><span class="n">cwd</span> <span class="o">=</span> <span class="n">cwd</span><span class="p">,</span> <span class="n">input_directory</span> <span class="o">=</span> <span class="s1">&#39;sections_data&#39;</span><span class="p">)</span>
    <span class="c1">#pprint(file_list)</span>
    <span class="c1">#master_subject_table = create_master_subject_table()</span>
    <span class="c1">#json_pipeline(file_list=file_list, master_subject_table=master_subject_table)</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">get_df</span><span class="p">(</span><span class="n">file_list</span> <span class="o">=</span> <span class="n">file_list</span><span class="p">)</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">get_transaction_df</span><span class="p">(</span><span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="p">)</span>
    <span class="n">outfile</span> <span class="o">=</span> <span class="n">write_transaction_to_file</span><span class="p">(</span><span class="n">df</span> <span class="o">=</span> <span class="n">df</span> <span class="p">,</span> <span class="n">cwd</span> <span class="o">=</span> <span class="n">cwd</span><span class="p">,</span> <span class="n">file_name</span> <span class="o">=</span> <span class="s1">&#39;sections_transaction_df.csv&#39;</span><span class="p">)</span>
    <span class="n">messaged</span> <span class="o">=</span> <span class="n">send_closing_message</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">outfile</span><span class="p">)</span>


    <span class="c1">#pprint(justice_df)</span>

</code></pre></div>]]></content>
			<postid> 5c42ac4525fd6ecc725586606ddd9e5a</postid>
			<author>Justin Napolitano</author>
			<author_name>Justin Napolitano</author_name>
			<author_email>personal.jnapolitano@gmail.com</author_email>
			<author_id>87654367b2fca109e7dc9d3ea8a1ebbaf0bfe374773b148c2c20d278479add99</author_id>			
		</item>
		
		<item>
			<title>Conduct Legal Research with AI: Part 1</title>
			<link>jnapolitano.com/posts/legal-research-part-1/</link>
			<pubDate>Mon, 16 May 2022 14:40:32 +0000</pubDate>
			<guid>jnapolitano.com/posts/legal-research-part-1/</guid>
			<description><![CDATA[Integrate JSON data from a rest API into your Neo4j Stack]]></description>
			<content type="html"><![CDATA[<h2 id="introduction">Introduction</h2>
<p>In a previous <a href="https://blog.jnapolitano.io/loc_crawler/">post</a>, I detailed the process of crawling the Library of Congress API to generate json files that could be intergrated into you DB of choice.</p>
<p>In this discussion, we will integrate JSON data into a Neo4j graph database.</p>
<h2 id="overview">Overview</h2>
<p>The process is fairly straightforward.  The most difficult part is wrangling your json data into the right format for integration.</p>
<p>The main function first instantiates the database config informormation.  It then gets the cwd from a context manager.  We then import the files to be integrated.  A master subject table is created to record only unique subjects to avoid duplicates.  Finally, a json pipeline extracts the data from json, transforms it to integrate into neo4j, and finally we upload using the neomodels api.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&#34;__main__&#34;</span><span class="p">:</span>
    <span class="n">neo_applified</span> <span class="o">=</span> <span class="n">instantiate_neo_model_api</span><span class="p">()</span>
    <span class="n">cwd</span> <span class="o">=</span> <span class="n">get_cwd</span><span class="p">()</span>
    <span class="n">file_list</span> <span class="o">=</span> <span class="n">get_files</span><span class="p">(</span><span class="n">cwd</span> <span class="o">=</span> <span class="n">cwd</span><span class="p">)</span>
    <span class="n">master_subject_table</span> <span class="o">=</span> <span class="n">create_master_subject_table</span><span class="p">()</span>
    <span class="n">json_pipeline</span><span class="p">(</span><span class="n">file_list</span><span class="o">=</span><span class="n">file_list</span><span class="p">,</span> <span class="n">master_subject_table</span><span class="o">=</span><span class="n">master_subject_table</span><span class="p">)</span>
</code></pre></div><h2 id="instantiate-neo-model-api">Instantiate Neo Model Api</h2>
<p>I extended the neo model api with a few helper functions.  The repo is found at <a href="https://github.com/justin-napolitano/neo4jAPI">https://github.com/justin-napolitano/neo4jAPI</a>.</p>
<p>You can also review the snapshot below.</p>
<p>We will be calling the initation function to set the config information, update, create Case, and Create Subject classes during this review.</p>
<p>create subject calls the custom subject class and returns an object that can later be integrated into the db with the .save() function.</p>
<p>Create case does exactly the same.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="kn">from</span> <span class="nn">dataclasses</span> <span class="kn">import</span> <span class="n">dataclass</span>
<span class="kn">from</span> <span class="nn">datetime</span> <span class="kn">import</span> <span class="n">date</span>
<span class="kn">from</span> <span class="nn">shelve</span> <span class="kn">import</span> <span class="n">Shelf</span>
<span class="kn">from</span> <span class="nn">neomodel</span> <span class="kn">import</span> <span class="p">(</span><span class="n">config</span><span class="p">,</span> <span class="n">StructuredNode</span><span class="p">,</span> <span class="n">StringProperty</span><span class="p">,</span> <span class="n">IntegerProperty</span><span class="p">,</span>
    <span class="n">UniqueIdProperty</span><span class="p">,</span> <span class="n">RelationshipTo</span><span class="p">,</span> <span class="n">BooleanProperty</span><span class="p">,</span> <span class="n">EmailProperty</span><span class="p">,</span> <span class="n">Relationship</span><span class="p">,</span> <span class="n">db</span><span class="p">)</span>
<span class="kn">from</span> <span class="nn">pprint</span> <span class="kn">import</span> <span class="n">pprint</span>

<span class="k">class</span> <span class="nc">neoAPI</span><span class="p">():</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">uri</span><span class="p">,</span><span class="n">user</span><span class="p">,</span><span class="n">psw</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">db_init</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">instantiate_neo_model_session</span><span class="p">(</span><span class="n">uri</span><span class="p">,</span><span class="n">user</span><span class="p">,</span><span class="n">psw</span><span class="p">)</span>    
        
    
    <span class="k">def</span> <span class="nf">instantiate_neo_model_session</span><span class="p">(</span><span class="n">uri</span><span class="p">,</span><span class="n">user</span><span class="p">,</span><span class="n">psw</span><span class="p">):</span>
        
        <span class="c1">#config.DATABASE_URL = &#39;neo4j+s://{}:{}@{}&#39;.format(user, psw, uri)</span>
        <span class="n">config</span><span class="o">.</span><span class="n">DATABASE_URL</span> <span class="o">=</span><span class="s1">&#39;bolt://neo4j:beautiful@localhost:7687&#39;</span>
        <span class="c1">#config.DATABASE_URL = uri</span>
        <span class="k">return</span> <span class="kc">True</span>


    <span class="k">def</span> <span class="nf">standard_query</span><span class="p">():</span>
        <span class="n">results</span><span class="p">,</span> <span class="n">meta</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">cypher_query</span><span class="p">(</span><span class="n">query</span><span class="p">,</span> <span class="n">params</span><span class="p">)</span>
        <span class="n">people</span> <span class="o">=</span> <span class="p">[</span><span class="n">Person</span><span class="o">.</span><span class="n">inflate</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">results</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">create_case_node</span><span class="p">(</span><span class="n">date</span><span class="p">,</span> <span class="n">dates</span><span class="p">,</span> <span class="n">group</span><span class="p">,</span><span class="n">name</span><span class="p">,</span> <span class="n">pdf</span><span class="p">,</span> <span class="n">shelf_id</span><span class="p">,</span> <span class="n">subject</span><span class="p">,</span> <span class="n">title</span><span class="p">,</span> <span class="n">url</span><span class="p">,</span> <span class="n">subject_relationship</span> <span class="o">=</span> <span class="kc">True</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">Case</span><span class="p">(</span><span class="n">date</span><span class="o">=</span><span class="n">date</span><span class="p">,</span> <span class="n">dates</span><span class="o">=</span><span class="n">dates</span><span class="p">,</span> <span class="n">group</span><span class="o">=</span><span class="n">group</span><span class="p">,</span><span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">,</span> <span class="n">pdf</span><span class="o">=</span><span class="n">pdf</span><span class="p">,</span> <span class="n">shelf_id</span><span class="o">=</span><span class="n">shelf_id</span><span class="p">,</span> <span class="n">subject</span><span class="o">=</span><span class="n">subject</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="n">title</span><span class="p">,</span> <span class="n">url</span><span class="o">=</span><span class="n">url</span><span class="p">)</span>


    <span class="k">def</span> <span class="nf">create_city_node</span><span class="p">(</span><span class="n">name</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">City</span><span class="p">(</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span><span class="p">)</span>
        
    <span class="k">def</span> <span class="nf">create_country_node</span><span class="p">(</span><span class="n">code</span><span class="p">,</span><span class="n">name</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">Country</span><span class="p">(</span><span class="n">code</span> <span class="o">=</span> <span class="n">code</span><span class="p">,</span> <span class="n">name</span> <span class="o">=</span> <span class="n">name</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">create_state_node</span><span class="p">(</span><span class="n">code</span><span class="p">,</span><span class="n">name</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">State</span><span class="p">(</span><span class="n">code</span> <span class="o">=</span> <span class="n">code</span><span class="p">,</span> <span class="n">name</span> <span class="o">=</span> <span class="n">name</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">create_realtor_search_url_node</span><span class="p">(</span><span class="n">url</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">Realtor_Search_URL</span><span class="p">(</span><span class="n">url</span> <span class="o">=</span> <span class="n">url</span><span class="p">,</span> <span class="n">is_root</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="n">is_sibling</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="n">is_parent</span><span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">is_child</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">searched</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span>
    
    <span class="k">def</span> <span class="nf">create_root_node</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">name</span> <span class="o">=</span> <span class="s1">&#39;realtor.com&#39;</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">Root</span><span class="p">(</span><span class="n">is_root</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span><span class="p">,</span><span class="n">is_parent</span> <span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">is_sibling</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">is_child</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">url</span> <span class="o">=</span> <span class="n">url</span><span class="p">)</span>
        <span class="n">uid</span> <span class="o">=</span> <span class="n">UniqueIdProperty</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">create_child_node</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">name</span> <span class="o">=</span> <span class="s1">&#39;realtor.com&#39;</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">Child</span><span class="p">(</span><span class="n">is_root</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span><span class="p">,</span><span class="n">is_parent</span> <span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">is_sibling</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">is_child</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">url</span> <span class="o">=</span> <span class="n">url</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">create_parent_node</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">name</span> <span class="o">=</span> <span class="s1">&#39;realtor.com&#39;</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">Parent</span><span class="p">(</span><span class="n">is_root</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span><span class="p">,</span><span class="n">is_parent</span> <span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">is_sibling</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">is_child</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">url</span> <span class="o">=</span> <span class="n">url</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">create_sibling_node</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">name</span> <span class="o">=</span> <span class="s1">&#39;realtor.com&#39;</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">Sibling</span><span class="p">(</span><span class="n">is_root</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span><span class="p">,</span><span class="n">is_parent</span> <span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">is_sibling</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">is_child</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">url</span> <span class="o">=</span> <span class="n">url</span><span class="p">)</span>
    
    <span class="k">def</span> <span class="nf">create_relationship</span><span class="p">(</span><span class="n">source</span><span class="p">,</span><span class="n">target</span><span class="p">):</span>
      
        
        <span class="n">rel</span> <span class="o">=</span> <span class="n">source</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">target</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">rel</span>

        <span class="c1">#print(&#34;{}&#34;+&#34;.connect&#34; + &#34;{}&#34;.format(source,target))</span>
        
    <span class="k">def</span> <span class="nf">create_subject_node</span><span class="p">(</span><span class="n">name</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,):</span>
        <span class="k">return</span> <span class="n">Subject</span><span class="p">(</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">update</span><span class="p">(</span><span class="n">obj</span><span class="p">):</span>
        <span class="k">with</span> <span class="n">db</span><span class="o">.</span><span class="n">transaction</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">obj</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>

<span class="k">class</span> <span class="nc">Subject</span><span class="p">(</span><span class="n">StructuredNode</span><span class="p">):</span>
    <span class="n">uuid</span> <span class="o">=</span> <span class="n">UniqueIdProperty</span><span class="p">()</span>
    <span class="n">name</span> <span class="o">=</span> <span class="n">StringProperty</span><span class="p">(</span><span class="n">unique_index</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">required</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">Case</span><span class="p">(</span><span class="n">StructuredNode</span><span class="p">):</span>
    <span class="n">uid</span> <span class="o">=</span> <span class="n">UniqueIdProperty</span><span class="p">()</span>
    <span class="n">date</span> <span class="o">=</span> <span class="n">StringProperty</span><span class="p">(</span><span class="n">unique_index</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">required</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">dates</span> <span class="o">=</span> <span class="n">StringProperty</span><span class="p">(</span><span class="n">unique_index</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">required</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">group</span> <span class="o">=</span> <span class="n">StringProperty</span><span class="p">(</span><span class="n">unique_index</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">required</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">name</span> <span class="o">=</span> <span class="n">StringProperty</span><span class="p">(</span><span class="n">unique_index</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">required</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">pdf</span> <span class="o">=</span> <span class="n">StringProperty</span><span class="p">(</span><span class="n">unique_index</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">required</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span> 
    <span class="n">shelf_id</span> <span class="o">=</span> <span class="n">StringProperty</span><span class="p">(</span><span class="n">unique_index</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">required</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">subject</span> <span class="o">=</span> <span class="n">StringProperty</span><span class="p">(</span><span class="n">unique_index</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">required</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="c1">#primary_topic = StringProperty(unique_index=True, required=True)</span>
    <span class="n">title</span> <span class="o">=</span> <span class="n">StringProperty</span><span class="p">(</span><span class="n">unique_index</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">required</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">url</span> <span class="o">=</span> <span class="n">StringProperty</span><span class="p">(</span><span class="n">unique_index</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">required</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">subject_relationship</span> <span class="o">=</span> <span class="n">Relationship</span><span class="p">(</span><span class="s2">&#34;Subject&#34;</span><span class="p">,</span> <span class="s2">&#34;IS_SUBJECT&#34;</span><span class="p">)</span>

<span class="k">class</span> <span class="nc">Processed</span><span class="p">(</span><span class="n">StructuredNode</span><span class="p">):</span>
    <span class="n">uid</span> <span class="o">=</span> <span class="n">UniqueIdProperty</span><span class="p">()</span>

<span class="k">class</span> <span class="nc">NotProcessed</span><span class="p">(</span><span class="n">StructuredNode</span><span class="p">):</span>
    <span class="n">uid</span> <span class="o">=</span> <span class="n">UniqueIdProperty</span><span class="p">()</span>
    

<span class="k">class</span> <span class="nc">City</span><span class="p">(</span><span class="n">StructuredNode</span><span class="p">):</span>
    <span class="n">uid</span> <span class="o">=</span> <span class="n">UniqueIdProperty</span><span class="p">()</span>
    <span class="n">name</span> <span class="o">=</span> <span class="n">StringProperty</span><span class="p">(</span><span class="n">unique_index</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">required</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">state</span> <span class="o">=</span> <span class="n">Relationship</span><span class="p">(</span><span class="s1">&#39;State&#39;</span><span class="p">,</span> <span class="s1">&#39;IS_STATE_OF&#39;</span><span class="p">)</span>
    <span class="n">country</span> <span class="o">=</span> <span class="n">Relationship</span><span class="p">(</span><span class="s1">&#39;Country&#39;</span><span class="p">,</span> <span class="s1">&#39;IS_COUNTRY_OF&#39;</span><span class="p">)</span>
    
    
<span class="k">class</span> <span class="nc">Country</span><span class="p">(</span><span class="n">StructuredNode</span><span class="p">):</span>
    <span class="n">uid</span> <span class="o">=</span> <span class="n">UniqueIdProperty</span><span class="p">()</span>
    <span class="n">code</span> <span class="o">=</span> <span class="n">StringProperty</span><span class="p">(</span><span class="n">unique_index</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">required</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">name</span> <span class="o">=</span> <span class="n">StringProperty</span><span class="p">(</span><span class="n">unique_index</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">required</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    

<span class="k">class</span> <span class="nc">State</span><span class="p">(</span><span class="n">StructuredNode</span><span class="p">):</span>
    <span class="n">uid</span> <span class="o">=</span> <span class="n">UniqueIdProperty</span><span class="p">()</span>
    <span class="n">code</span> <span class="o">=</span> <span class="n">StringProperty</span><span class="p">(</span><span class="n">unique_index</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">required</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">name</span> <span class="o">=</span> <span class="n">StringProperty</span><span class="p">(</span><span class="n">unique_index</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">required</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">country</span> <span class="o">=</span> <span class="n">Relationship</span><span class="p">(</span><span class="s1">&#39;Country&#39;</span><span class="p">,</span> <span class="s1">&#39;IS_COUNTRY_OF&#39;</span><span class="p">)</span>

<span class="k">class</span> <span class="nc">Root</span><span class="p">(</span><span class="n">StructuredNode</span><span class="p">):</span>
    <span class="n">uid</span> <span class="o">=</span> <span class="n">UniqueIdProperty</span><span class="p">()</span>
    <span class="n">is_root</span> <span class="o">=</span> <span class="n">BooleanProperty</span><span class="p">(</span><span class="n">unique_index</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="n">required</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>
    <span class="n">is_parent</span> <span class="o">=</span> <span class="n">BooleanProperty</span><span class="p">(</span><span class="n">unique_index</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="n">required</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>
    <span class="n">is_sibling</span> <span class="o">=</span> <span class="n">BooleanProperty</span><span class="p">(</span><span class="n">unique_index</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="n">required</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>
    <span class="n">is_child</span> <span class="o">=</span> <span class="n">BooleanProperty</span><span class="p">(</span><span class="n">unique_index</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="n">required</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>
    <span class="n">name</span> <span class="o">=</span> <span class="n">StringProperty</span><span class="p">(</span><span class="n">unique_index</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="n">required</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span>
    <span class="n">url</span> <span class="o">=</span> <span class="n">StringProperty</span><span class="p">()</span>
    <span class="n">processed</span> <span class="o">=</span> <span class="n">Relationship</span><span class="p">(</span><span class="s2">&#34;Processed&#34;</span><span class="p">,</span> <span class="s2">&#34;IS_PROCESSED&#34;</span><span class="p">)</span>
    <span class="n">NotProcessed</span> <span class="o">=</span> <span class="n">Relationship</span><span class="p">(</span><span class="s2">&#34;NotProcessed&#34;</span><span class="p">,</span> <span class="s2">&#34;NOT_PROCESSED&#34;</span><span class="p">)</span>
    <span class="n">sibling</span> <span class="o">=</span> <span class="n">Relationship</span><span class="p">(</span><span class="s2">&#34;Sibling&#34;</span><span class="p">,</span><span class="s2">&#34;IS_SIBLING&#34;</span><span class="p">)</span>
    <span class="n">child</span> <span class="o">=</span> <span class="n">Relationship</span><span class="p">(</span><span class="s2">&#34;Child&#34;</span><span class="p">,</span><span class="s2">&#34;IS_CHILD&#34;</span><span class="p">)</span>
    <span class="n">parent</span> <span class="o">=</span> <span class="n">Relationship</span><span class="p">(</span><span class="s2">&#34;Parent&#34;</span><span class="p">,</span><span class="s2">&#34;IS_PARENT&#34;</span><span class="p">)</span>
    <span class="n">root</span> <span class="o">=</span> <span class="n">Relationship</span><span class="p">(</span><span class="s2">&#34;Root&#34;</span><span class="p">,</span> <span class="s2">&#34;IS_ROOT&#34;</span><span class="p">)</span>

<span class="k">class</span> <span class="nc">Child</span><span class="p">(</span><span class="n">StructuredNode</span><span class="p">):</span>
    <span class="n">uid</span> <span class="o">=</span> <span class="n">UniqueIdProperty</span><span class="p">()</span>
    <span class="n">is_root</span> <span class="o">=</span> <span class="n">BooleanProperty</span><span class="p">(</span><span class="n">unique_index</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="n">required</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>
    <span class="n">is_parent</span> <span class="o">=</span> <span class="n">BooleanProperty</span><span class="p">(</span><span class="n">unique_index</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="n">required</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>
    <span class="n">is_sibling</span> <span class="o">=</span> <span class="n">BooleanProperty</span><span class="p">(</span><span class="n">unique_index</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="n">required</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>
    <span class="n">is_child</span> <span class="o">=</span> <span class="n">BooleanProperty</span><span class="p">(</span><span class="n">unique_index</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="n">required</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>
    <span class="n">name</span> <span class="o">=</span> <span class="n">StringProperty</span><span class="p">()</span>
    <span class="n">processed</span> <span class="o">=</span> <span class="n">Relationship</span><span class="p">(</span><span class="s2">&#34;Processed&#34;</span><span class="p">,</span> <span class="s2">&#34;IS_PROCESSED&#34;</span><span class="p">)</span>
    <span class="n">NotProcessed</span> <span class="o">=</span> <span class="n">Relationship</span><span class="p">(</span><span class="s2">&#34;NotProcessed&#34;</span><span class="p">,</span> <span class="s2">&#34;NOT_PROCESSED&#34;</span><span class="p">)</span>
    <span class="n">sibling</span> <span class="o">=</span> <span class="n">Relationship</span><span class="p">(</span><span class="s2">&#34;Sibling&#34;</span><span class="p">,</span><span class="s2">&#34;IS_SIBLING&#34;</span><span class="p">)</span>
    <span class="n">child</span> <span class="o">=</span> <span class="n">Relationship</span><span class="p">(</span><span class="s2">&#34;Child&#34;</span><span class="p">,</span><span class="s2">&#34;IS_CHILD&#34;</span><span class="p">)</span>
    <span class="n">parent</span> <span class="o">=</span> <span class="n">Relationship</span><span class="p">(</span><span class="s2">&#34;Parent&#34;</span><span class="p">,</span><span class="s2">&#34;IS_PARENT&#34;</span><span class="p">)</span>
    <span class="n">root</span> <span class="o">=</span> <span class="n">Relationship</span><span class="p">(</span><span class="s2">&#34;Root&#34;</span><span class="p">,</span> <span class="s2">&#34;IS_ROOT&#34;</span><span class="p">)</span>

<span class="k">class</span> <span class="nc">Parent</span><span class="p">(</span><span class="n">StructuredNode</span><span class="p">):</span>
    <span class="n">uid</span> <span class="o">=</span> <span class="n">UniqueIdProperty</span><span class="p">()</span>
    <span class="n">name</span> <span class="o">=</span> <span class="n">StringProperty</span><span class="p">()</span>
    <span class="n">is_root</span> <span class="o">=</span> <span class="n">BooleanProperty</span><span class="p">(</span><span class="n">unique_index</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="n">required</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>
    <span class="n">is_parent</span> <span class="o">=</span> <span class="n">BooleanProperty</span><span class="p">(</span><span class="n">unique_index</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="n">required</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>
    <span class="n">is_sibling</span> <span class="o">=</span> <span class="n">BooleanProperty</span><span class="p">(</span><span class="n">unique_index</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="n">required</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>
    <span class="n">is_child</span> <span class="o">=</span> <span class="n">BooleanProperty</span><span class="p">(</span><span class="n">unique_index</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="n">required</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>
    <span class="n">processed</span> <span class="o">=</span> <span class="n">Relationship</span><span class="p">(</span><span class="s2">&#34;Processed&#34;</span><span class="p">,</span> <span class="s2">&#34;IS_PROCESSED&#34;</span><span class="p">)</span>
    <span class="n">NotProcessed</span> <span class="o">=</span> <span class="n">Relationship</span><span class="p">(</span><span class="s2">&#34;NotProcessed&#34;</span><span class="p">,</span> <span class="s2">&#34;NOT_PROCESSED&#34;</span><span class="p">)</span>
    <span class="n">sibling</span> <span class="o">=</span> <span class="n">Relationship</span><span class="p">(</span><span class="s2">&#34;Sibling&#34;</span><span class="p">,</span><span class="s2">&#34;IS_SIBLING&#34;</span><span class="p">)</span>
    <span class="n">child</span> <span class="o">=</span> <span class="n">Relationship</span><span class="p">(</span><span class="s2">&#34;Child&#34;</span><span class="p">,</span><span class="s2">&#34;IS_CHILD&#34;</span><span class="p">)</span>
    <span class="n">parent</span> <span class="o">=</span> <span class="n">Relationship</span><span class="p">(</span><span class="s2">&#34;Parent&#34;</span><span class="p">,</span><span class="s2">&#34;IS_PARENT&#34;</span><span class="p">)</span>
    <span class="n">root</span> <span class="o">=</span> <span class="n">Relationship</span><span class="p">(</span><span class="s2">&#34;Root&#34;</span><span class="p">,</span> <span class="s2">&#34;IS_ROOT&#34;</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">Sibling</span><span class="p">(</span><span class="n">StructuredNode</span><span class="p">):</span>
    <span class="n">uid</span> <span class="o">=</span> <span class="n">UniqueIdProperty</span><span class="p">()</span>
    <span class="n">is_root</span> <span class="o">=</span> <span class="n">BooleanProperty</span><span class="p">(</span><span class="n">unique_index</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="n">required</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>
    <span class="n">is_parent</span> <span class="o">=</span> <span class="n">BooleanProperty</span><span class="p">(</span><span class="n">unique_index</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="n">required</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>
    <span class="n">is_sibling</span> <span class="o">=</span> <span class="n">BooleanProperty</span><span class="p">(</span><span class="n">unique_index</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="n">required</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>
    <span class="n">is_child</span> <span class="o">=</span> <span class="n">BooleanProperty</span><span class="p">(</span><span class="n">unique_index</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="n">required</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>
    <span class="n">name</span> <span class="o">=</span> <span class="n">StringProperty</span><span class="p">()</span>
    <span class="n">processed</span> <span class="o">=</span> <span class="n">Relationship</span><span class="p">(</span><span class="s2">&#34;Processed&#34;</span><span class="p">,</span> <span class="s2">&#34;IS_PROCESSED&#34;</span><span class="p">)</span>
    <span class="n">NotProcessed</span> <span class="o">=</span> <span class="n">Relationship</span><span class="p">(</span><span class="s2">&#34;NotProcessed&#34;</span><span class="p">,</span> <span class="s2">&#34;NOT_PROCESSED&#34;</span><span class="p">)</span>
    <span class="n">sibling</span> <span class="o">=</span> <span class="n">Relationship</span><span class="p">(</span><span class="s2">&#34;Sibling&#34;</span><span class="p">,</span><span class="s2">&#34;IS_SIBLING&#34;</span><span class="p">)</span>
    <span class="n">child</span> <span class="o">=</span> <span class="n">Relationship</span><span class="p">(</span><span class="s2">&#34;Child&#34;</span><span class="p">,</span><span class="s2">&#34;IS_CHILD&#34;</span><span class="p">)</span>
    <span class="n">parent</span> <span class="o">=</span> <span class="n">Relationship</span><span class="p">(</span><span class="s2">&#34;Parent&#34;</span><span class="p">,</span><span class="s2">&#34;IS_PARENT&#34;</span><span class="p">)</span>
    <span class="n">root</span> <span class="o">=</span> <span class="n">Relationship</span><span class="p">(</span><span class="s2">&#34;Root&#34;</span><span class="p">,</span> <span class="s2">&#34;IS_ROOT&#34;</span><span class="p">)</span>
    
<span class="k">class</span> <span class="nc">Realtor_com</span><span class="p">(</span><span class="n">StructuredNode</span><span class="p">):</span>
    <span class="n">uid</span> <span class="o">=</span> <span class="n">UniqueIdProperty</span><span class="p">()</span>
    <span class="n">is_realtor_com</span> <span class="o">=</span> <span class="n">BooleanProperty</span><span class="p">(</span><span class="n">unique_index</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="n">required</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>
    <span class="n">name</span> <span class="o">=</span> <span class="n">StringProperty</span><span class="p">()</span>

<span class="k">class</span> <span class="nc">Realtor_Search_URL</span><span class="p">(</span><span class="n">StructuredNode</span><span class="p">):</span>
    <span class="n">uid</span> <span class="o">=</span> <span class="n">UniqueIdProperty</span><span class="p">()</span>
    <span class="n">url</span> <span class="o">=</span> <span class="n">StringProperty</span><span class="p">(</span><span class="n">unique_index</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">required</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">searched</span> <span class="o">=</span> <span class="n">BooleanProperty</span><span class="p">(</span><span class="n">unique_index</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="n">required</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>
    <span class="n">is_root</span> <span class="o">=</span> <span class="n">BooleanProperty</span><span class="p">(</span><span class="n">unique_index</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="n">required</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>
    <span class="n">is_child</span> <span class="o">=</span> <span class="n">BooleanProperty</span><span class="p">(</span><span class="n">unique_index</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="n">required</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>
    <span class="n">is_parent</span> <span class="o">=</span> <span class="n">BooleanProperty</span><span class="p">(</span><span class="n">unique_index</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="n">required</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>
    <span class="n">is_sibling</span> <span class="o">=</span> <span class="n">BooleanProperty</span><span class="p">(</span><span class="n">unique_index</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="n">required</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>
    <span class="c1">#state = Relationship(&#39;State&#39;, &#39;OF&#39;)</span>
    <span class="n">state</span> <span class="o">=</span> <span class="n">Relationship</span><span class="p">(</span><span class="s1">&#39;State&#39;</span><span class="p">,</span> <span class="s1">&#39;IS_STATE_OF&#39;</span><span class="p">)</span>
    <span class="n">city</span> <span class="o">=</span> <span class="n">Relationship</span><span class="p">(</span><span class="s1">&#39;City&#39;</span><span class="p">,</span> <span class="s1">&#39;IS_CITY_OF&#39;</span><span class="p">)</span>
    <span class="n">root</span> <span class="o">=</span> <span class="n">Relationship</span><span class="p">(</span><span class="s1">&#39;Root&#39;</span><span class="p">,</span><span class="s1">&#39;IS_ROOT&#39;</span><span class="p">)</span>
    <span class="n">child</span> <span class="o">=</span> <span class="n">Relationship</span><span class="p">(</span><span class="s1">&#39;Child&#39;</span><span class="p">,</span><span class="s2">&#34;IS_CHILD&#34;</span><span class="p">)</span>
    <span class="n">parent</span> <span class="o">=</span> <span class="n">Relationship</span><span class="p">(</span><span class="s1">&#39;Parent&#39;</span><span class="p">,</span> <span class="s2">&#34;IS_PARENT&#34;</span><span class="p">)</span>
    <span class="n">sibling</span> <span class="o">=</span> <span class="n">Relationship</span><span class="p">(</span><span class="s1">&#39;Sibling&#39;</span><span class="p">,</span> <span class="s2">&#34;IS_SIBLING&#34;</span><span class="p">)</span>
    <span class="n">realtor_com</span> <span class="o">=</span> <span class="n">Relationship</span><span class="p">(</span><span class="s1">&#39;Realtor_com&#39;</span><span class="p">,</span> <span class="s2">&#34;IS_REALTOR.COM_URL&#34;</span><span class="p">)</span>
    <span class="n">processed</span> <span class="o">=</span> <span class="n">Relationship</span><span class="p">(</span><span class="s2">&#34;Processed&#34;</span><span class="p">,</span> <span class="s2">&#34;IS_PROCESSED&#34;</span><span class="p">)</span>
    <span class="n">NotProcessed</span> <span class="o">=</span> <span class="n">Relationship</span><span class="p">(</span><span class="s2">&#34;NotProcessed&#34;</span><span class="p">,</span> <span class="s2">&#34;NOT_PROCESSED&#34;</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">Person</span><span class="p">(</span><span class="n">StructuredNode</span><span class="p">):</span>
    <span class="n">uid</span> <span class="o">=</span> <span class="n">UniqueIdProperty</span><span class="p">()</span>
    <span class="n">full_name</span> <span class="o">=</span> <span class="n">StringProperty</span><span class="p">(</span><span class="n">required</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>
    <span class="n">email</span> <span class="o">=</span> <span class="n">EmailProperty</span><span class="p">()</span>
</code></pre></div><h2 id="get-files">Get Files</h2>
<p>The get_files function returns a list of files within the input directory.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python">
<span class="k">def</span> <span class="nf">get_files</span><span class="p">(</span><span class="n">cwd</span> <span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">(),</span> <span class="n">input_directory</span> <span class="o">=</span> <span class="s1">&#39;input&#39;</span><span class="p">):</span>
    
    <span class="n">path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">sep</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">cwd</span><span class="p">,</span><span class="n">input_directory</span><span class="p">])</span>
    <span class="n">file_list</span><span class="o">=</span> <span class="p">[</span><span class="n">f</span> <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">glob</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="n">path</span> <span class="o">+</span> <span class="s2">&#34;**/*.json&#34;</span><span class="p">,</span> <span class="n">recursive</span><span class="o">=</span><span class="kc">True</span><span class="p">)]</span>
  
    <span class="k">return</span> <span class="n">file_list</span>

</code></pre></div><h2 id="create-master-subject-file">Create Master Subject File</h2>
<p>Create maseter subject table generates an empty dataframe that will record every unique subject experienced in the data.</p>
<p>I will improve upon this later, by uploading a master file that will be saved following each modification.  This would enable resuming the process following an error or fault.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python">
<span class="k">def</span> <span class="nf">create_master_subject_table</span><span class="p">():</span>
    <span class="n">table</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">()</span>
    <span class="n">table</span><span class="p">[</span><span class="s1">&#39;subject&#39;</span><span class="p">]</span><span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>
    <span class="n">table</span><span class="p">[</span><span class="s1">&#39;transaction&#39;</span><span class="p">]</span><span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>
    <span class="n">table</span><span class="p">[</span><span class="s1">&#39;submitted&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>
    <span class="k">return</span><span class="p">(</span><span class="n">table</span><span class="p">)</span>

</code></pre></div><h2 id="json-pipeline-function">Json Pipeline function</h2>
<p>The json pipeline function is the runner for the etl job.  It loads each file into dataframe, manipulates the data accordingly, and updates the neo4j database.</p>
<p>When I refactor the code, I will most likely create an object that calls static functions to generate then desired output.</p>
<p>I may also seperate the case, subject, and relationship pipeline into seperate classes in order to avoid shadowing functions within functions.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="k">def</span> <span class="nf">json_pipeline</span><span class="p">(</span><span class="n">file_list</span><span class="p">,</span> <span class="n">master_subject_table</span><span class="p">):</span>
    <span class="n">case_counter</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">for</span> <span class="n">file</span> <span class="ow">in</span> <span class="n">file_list</span><span class="p">:</span>
        
        <span class="n">data</span> <span class="o">=</span> <span class="n">load_json_data</span><span class="p">(</span><span class="n">file</span><span class="o">=</span><span class="n">file</span><span class="p">)</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;results&#39;</span><span class="p">]</span>
        <span class="c1">#pprint(data)</span>
        <span class="c1">#pprint(data[0])</span>
        
        <span class="c1">#filtered_data = filter_json_data(json_data = data, filter = filter)</span>

        <span class="c1"># Creating the case nodes transaction nodes and df</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">clean_json_data</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
        <span class="n">case_data</span> <span class="o">=</span> <span class="n">stringify_json_values</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
        <span class="n">case_data</span> <span class="o">=</span> <span class="n">pandify_case_data</span><span class="p">(</span><span class="n">case_data</span><span class="p">)</span>
        <span class="n">case_data</span> <span class="o">=</span> <span class="n">nodify_case_data</span><span class="p">(</span><span class="n">case_data</span> <span class="o">=</span> <span class="n">case_data</span><span class="p">)</span>
        
        <span class="c1"># Creating the subject nodes transaction nodes and df</span>
        <span class="n">subject_list</span> <span class="o">=</span> <span class="n">slice_subject_data</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
        <span class="n">subject_list</span> <span class="o">=</span> <span class="n">identify_unique_subjects</span><span class="p">(</span><span class="n">subject_list</span><span class="p">)</span>
        <span class="n">subject_lookup_table</span> <span class="o">=</span> <span class="n">create_subject_lookup_table</span><span class="p">(</span><span class="n">subject_list</span><span class="p">)</span>
        <span class="n">master_subject_table</span> <span class="o">=</span> <span class="n">integrate_to_master_table</span><span class="p">(</span><span class="n">subject_lookup_table</span><span class="p">,</span><span class="n">master_subject_table</span><span class="p">)</span>
        <span class="c1">#pprint(master_subject_table.duplicated())</span>
        <span class="n">case_counter</span> <span class="o">=</span> <span class="n">case_counter</span> <span class="o">+</span> <span class="nb">len</span><span class="p">(</span><span class="n">case_data</span><span class="p">)</span>

        <span class="n">master_subject_table</span> <span class="o">=</span> <span class="n">nodify_subjects</span><span class="p">(</span><span class="n">master_subject_table</span><span class="p">)</span>

        <span class="c1">#pprint(case_data)</span>
        <span class="c1">#pprint(master_subject_table[&#39;transaction&#39;])</span>
        <span class="c1">#lets save data to the database</span>

        <span class="n">master_subject_table</span> <span class="o">=</span> <span class="n">submit_subjects_to_db</span><span class="p">(</span><span class="n">master_subject_table</span><span class="p">)</span>
        <span class="n">case_data</span> <span class="o">=</span> <span class="n">submit_cases_to_db</span><span class="p">(</span><span class="n">case_data</span> <span class="o">=</span> <span class="n">case_data</span><span class="p">)</span>

        <span class="c1"># Create Relationships</span>

        <span class="n">relationship_list</span><span class="o">=</span> <span class="n">create_relationship_table</span><span class="p">(</span><span class="n">case_data</span><span class="o">=</span><span class="n">case_data</span><span class="p">,</span> <span class="n">master_subject_table</span><span class="o">=</span><span class="n">master_subject_table</span><span class="p">)</span>
</code></pre></div><h3 id="case-pipeline">Case Pipeline</h3>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="c1"># Creating the case nodes transaction nodes and df</span>
<span class="n">data</span> <span class="o">=</span> <span class="n">clean_json_data</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
<span class="n">case_data</span> <span class="o">=</span> <span class="n">stringify_json_values</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
<span class="n">case_data</span> <span class="o">=</span> <span class="n">pandify_case_data</span><span class="p">(</span><span class="n">case_data</span><span class="p">)</span>
<span class="n">case_data</span> <span class="o">=</span> <span class="n">nodify_case_data</span><span class="p">(</span><span class="n">case_data</span> <span class="o">=</span> <span class="n">case_data</span><span class="p">)</span>
</code></pre></div><p>To create the case nodes four functions are called.</p>
<h4 id="clean-json-data">Clean Json Data</h4>
<p>The first is clean_json_data which is actually unnecessary.  The only operation that is required is moving the pdf froma list to a dicktionary key.  It should and will be refactored.  As it stands now, I am leaving iut as an artifact of a previous workflow.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python">
<span class="k">def</span> <span class="nf">clean_json_data</span><span class="p">(</span><span class="n">filtered_data</span><span class="p">):</span>
    <span class="c1"># Select the keys that I want from the dictionary</span>
    <span class="c1"># filter appropriatly into a df </span>
    <span class="c1"># write df to file</span>
    <span class="c1">#print(type(filtered_data))</span>
    <span class="c1">#pprint(filtered_data)</span>
    <span class="k">for</span> <span class="n">data</span> <span class="ow">in</span> <span class="n">filtered_data</span><span class="p">:</span>
        <span class="c1">#pprint(data)</span>
        <span class="c1">#creat a dictionary of columns and values for each row.  Combine them all into a df when we are done</span>
        <span class="c1"># each dictionary must be a row.... which makes perfect sense, but they can not be nested... </span>
        <span class="n">item</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;item&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="n">resources</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;resources&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="n">index</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;index&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="n">language</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;language&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="n">online_format</span><span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;online_format&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="n">original_format</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;original_format&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="n">kind</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;type&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="n">image_url</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;image_url&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="n">hassegments</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;hassegments&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="n">extract_timestamp</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;extract_timestamp&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="n">timestampe</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;timestamp&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="n">mimetype</span><span class="o">=</span><span class="n">data</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;mime_type&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">pdf</span> <span class="o">=</span> <span class="n">resources</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;pdf&#39;</span><span class="p">]</span>
        <span class="k">except</span><span class="p">:</span> 
            <span class="n">pdf</span> <span class="o">=</span> <span class="s2">&#34;noPdf&#34;</span>
        <span class="n">data</span><span class="p">[</span><span class="s2">&#34;pdf&#34;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pdf</span>
        <span class="n">data</span><span class="p">[</span><span class="s1">&#39;search_index&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">index</span>
    
</code></pre></div><h4 id="stringify-json-data">Stringify Json Data</h4>
<p>The Second is Stringify_json_data.  The imporatance of this function is that it creates strings from lists in order to properly integrate into the neo4j databse.  Iterables are permitted, however they can not be searched.  For my use case, I decided to create csv strings instead that can later be parsed if necessary.</p>
<p>This function also moves the subject list to a dedicated key in the dictionary.  This is important because it is used to generate the subject tables.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="k">def</span> <span class="nf">stringify_json_values</span><span class="p">(</span><span class="n">data</span><span class="p">):</span>
    <span class="k">for</span> <span class="nb">dict</span> <span class="ow">in</span> <span class="n">data</span><span class="p">:</span>
        <span class="n">subject_list</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">[</span><span class="s1">&#39;subject&#39;</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="nb">dict</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="nb">dict</span><span class="p">[</span><span class="n">key</span><span class="p">])</span> <span class="o">==</span> <span class="nb">list</span><span class="p">:</span>
                <span class="n">tmp_list</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="p">(</span><span class="nb">dict</span><span class="p">[</span><span class="n">key</span><span class="p">]):</span>
                    <span class="n">item</span> <span class="o">=</span> <span class="n">item</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&#34; &#34;</span><span class="p">,</span> <span class="s2">&#34;-&#34;</span><span class="p">)</span>
                    <span class="n">tmp_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>
                <span class="nb">dict</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">tmp_list</span>

                <span class="nb">dict</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&#34;,&#34;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">dict</span><span class="p">[</span><span class="n">key</span><span class="p">])</span>
        <span class="nb">dict</span><span class="p">[</span><span class="s1">&#39;subject_list&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">subject_list</span>

                
    <span class="k">return</span> <span class="n">data</span>
</code></pre></div><h4 id="pandify-case-data">Pandify Case Data</h4>
<p>The next function creates a pandas dataframe from a list of dictionaries.  Thankfully this is easy to accommplish.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="k">def</span> <span class="nf">pandify_case_data</span><span class="p">(</span><span class="n">data</span><span class="p">):</span>
    <span class="c1">#case_df = pd.concat(data, sort=False)</span>
    <span class="n">df</span><span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
    <span class="n">df</span><span class="p">[</span><span class="s1">&#39;submitted&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>
    <span class="k">return</span> <span class="n">df</span>
</code></pre></div><h4 id="nodify-case-data">Nodify Case Data</h4>
<p>Nodify creates transaction objects that can be saved to the neo4j databse.  I call the neomodel api to generate the results and save them into a dataframe that is used to apply the upload with a lambda function.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="k">def</span> <span class="nf">nodify_case_data</span><span class="p">(</span><span class="n">case_data</span><span class="p">):</span>
    <span class="c1">#non_submitted_nodes = case_data[case_data.notna()]</span>
    <span class="n">non_submitted_nodes</span> <span class="o">=</span> <span class="n">case_data</span><span class="p">[</span><span class="n">case_data</span><span class="o">.</span><span class="n">notna</span><span class="p">()</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)]</span>
    <span class="c1">#pprint(non_submitted_nodes)</span>
    <span class="n">case_nodes</span> <span class="o">=</span> <span class="n">non_submitted_nodes</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span> <span class="p">:</span><span class="n">neo</span><span class="o">.</span><span class="n">neoAPI</span><span class="o">.</span><span class="n">create_case_node</span><span class="p">(</span><span class="n">date</span> <span class="o">=</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;date&#39;</span><span class="p">],</span> <span class="n">dates</span><span class="o">=</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;dates&#39;</span><span class="p">],</span><span class="n">group</span> <span class="o">=</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;group&#39;</span><span class="p">],</span> <span class="n">name</span><span class="o">=</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">],</span> <span class="n">pdf</span><span class="o">=</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;pdf&#39;</span><span class="p">],</span> <span class="n">shelf_id</span> <span class="o">=</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;shelf_id&#39;</span><span class="p">],</span> <span class="n">subject</span><span class="o">=</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;subject&#39;</span><span class="p">],</span> <span class="n">title</span> <span class="o">=</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;title&#39;</span><span class="p">],</span> <span class="n">url</span> <span class="o">=</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;url&#39;</span><span class="p">],</span> <span class="n">subject_relationship</span><span class="o">=</span><span class="kc">True</span><span class="p">),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

    <span class="n">case_data</span><span class="p">[</span><span class="s1">&#39;transaction&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">case_nodes</span>
    <span class="k">return</span> <span class="n">case_data</span>

</code></pre></div><h3 id="the-subject-pipeline">The Subject Pipeline</h3>
<p>The subject pipeline slices the subject data from the current search result page.</p>
<p>It then identifies the unique subjects</p>
<p>The subject_lookup_table is a dataframe containing the subjects returned by subject list.  They are unique only to the result page.</p>
<p>The master_subject_table is then updated by the integrate_to_master_table function that identifes new subjects to integrate into the master table.</p>
<p>finally, the nodify subject function creates transaction objects to be uploaded to the neo4j db.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python">  <span class="c1"># Creating the subject nodes transaction nodes and df</span>
    <span class="n">subject_list</span> <span class="o">=</span> <span class="n">slice_subject_data</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
    <span class="n">subject_list</span> <span class="o">=</span> <span class="n">identify_unique_subjects</span><span class="p">(</span><span class="n">subject_list</span><span class="p">)</span>
    <span class="n">subject_lookup_table</span> <span class="o">=</span> <span class="n">create_subject_lookup_table</span><span class="p">(</span><span class="n">subject_list</span><span class="p">)</span>
    <span class="n">master_subject_table</span> <span class="o">=</span> <span class="n">integrate_to_master_table</span><span class="p">(</span><span class="n">subject_lookup_table</span><span class="p">,</span><span class="n">master_subject_table</span><span class="p">)</span>
    <span class="c1">#pprint(master_subject_table.duplicated())</span>

    <span class="n">master_subject_table</span> <span class="o">=</span> <span class="n">nodify_subjects</span><span class="p">(</span><span class="n">master_subject_table</span><span class="p">)</span>
    
</code></pre></div><h4 id="slice_subject_data">slice_subject_data</h4>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="k">def</span> <span class="nf">slice_subject_data</span><span class="p">(</span><span class="n">data</span><span class="p">):</span>
    <span class="n">subject_list</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">case</span> <span class="ow">in</span> <span class="n">data</span><span class="p">:</span>
        <span class="n">subject_list</span> <span class="o">=</span> <span class="n">subject_list</span> <span class="o">+</span> <span class="n">case</span><span class="p">[</span><span class="s1">&#39;subject_list&#39;</span><span class="p">]</span>
    <span class="c1">#pprint(subject_list)</span>
    <span class="k">return</span> <span class="n">subject_list</span>
</code></pre></div><h4 id="identify-unique-subjects">Identify Unique Subjects</h4>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="k">def</span> <span class="nf">identify_unique_subjects</span><span class="p">(</span><span class="n">subject_list</span><span class="p">):</span>
    
    <span class="c1"># insert the list to the set</span>
    <span class="n">list_set</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">subject_list</span><span class="p">)</span>
    <span class="c1"># convert the set to the list</span>
    <span class="n">unique_list</span> <span class="o">=</span> <span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">list_set</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">unique_list</span>

</code></pre></div><h4 id="create-subject-lookup-table">Create Subject Lookup Table</h4>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="k">def</span> <span class="nf">create_subject_lookup_table</span><span class="p">(</span><span class="n">subject_list</span><span class="p">):</span>
    <span class="n">lookup_table</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">subject_list</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;subject&#39;</span><span class="p">])</span>
    <span class="n">lookup_table</span><span class="p">[</span><span class="s1">&#39;transaction&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>
    <span class="n">lookup_table</span><span class="p">[</span><span class="s1">&#39;submitted&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>
    <span class="k">return</span> <span class="n">lookup_table</span>
</code></pre></div><h4 id="nodify-subject">Nodify Subject</h4>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="k">def</span> <span class="nf">nodify_subjects</span><span class="p">(</span><span class="n">master_subject_table</span><span class="p">):</span>
    <span class="n">non_submitted_nodes</span> <span class="o">=</span> <span class="n">master_subject_table</span><span class="p">[</span><span class="n">master_subject_table</span><span class="o">.</span><span class="n">isna</span><span class="p">()</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
    <span class="c1">#df[df.isna().any(axis=1)]</span>
    <span class="c1">#pprint(non_submitted_nodes)</span>
    <span class="n">non_submitted_nodes</span><span class="p">[</span><span class="s1">&#39;transaction&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">non_submitted_nodes</span><span class="p">[</span><span class="s1">&#39;subject&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span> <span class="p">:</span><span class="n">neo</span><span class="o">.</span><span class="n">neoAPI</span><span class="o">.</span><span class="n">create_subject_node</span><span class="p">(</span><span class="n">name</span> <span class="o">=</span> <span class="n">x</span><span class="p">))</span>
    <span class="n">master_subject_table</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">non_submitted_nodes</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">master_subject_table</span>
</code></pre></div><h3 id="uploading-case-and-subject-data">Uploading Case and Subject data</h3>
<p>With the transaction object dataframes created, we can then update the data to the database.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="n">master_subject_table</span> <span class="o">=</span> <span class="n">submit_subjects_to_db</span><span class="p">(</span><span class="n">master_subject_table</span><span class="p">)</span>
<span class="n">case_data</span> <span class="o">=</span> <span class="n">submit_cases_to_db</span><span class="p">(</span><span class="n">case_data</span> <span class="o">=</span> <span class="n">case_data</span><span class="p">)</span>
</code></pre></div><h4 id="submit-subjects">Submit Subjects</h4>
<p>This function selects the subject nodes from the master table that have not been uploaded to the neo4j database.</p>
<p>It identifies na in the submitted collumn in order to slice non-submitted nodes.</p>
<p>If that table can be created we upload all of the df with the update function from the neoapi.  It simply calls the db and calls save() on the object.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="k">def</span> <span class="nf">submit_subjects_to_db</span><span class="p">(</span><span class="n">master_subject_table</span><span class="p">):</span>
    <span class="c1">#unsubmitted = master_subject_table[master_subject_table.notna()]</span>
    <span class="c1">#pprint(master_subject_table)</span>
    <span class="c1">#non_submitted_nodes=master_subject_table[[master_subject_table[&#39;submitted&#39;] == np.nan]]</span>
    <span class="n">non_submitted_nodes</span> <span class="o">=</span> <span class="n">master_subject_table</span><span class="p">[</span><span class="n">master_subject_table</span><span class="p">[</span><span class="s1">&#39;submitted&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">isna</span><span class="p">()]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
    <span class="c1">#pprint(non_submitted_nodes)</span>
    <span class="k">if</span> <span class="n">non_submitted_nodes</span><span class="o">.</span><span class="n">empty</span><span class="p">:</span>   
        <span class="k">return</span> <span class="n">master_subject_table</span>
    <span class="k">else</span><span class="p">:</span>
         <span class="c1">#pprint(non_submitted_nodes)</span>
        <span class="n">non_submitted_nodes</span><span class="p">[</span><span class="s1">&#39;transaction&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">non_submitted_nodes</span><span class="p">[</span><span class="s1">&#39;transaction&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">neo</span><span class="o">.</span><span class="n">neoAPI</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">x</span><span class="p">))</span>
        <span class="n">non_submitted_nodes</span><span class="p">[</span><span class="s1">&#39;submitted&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
    
    <span class="c1">#test = non_submitted_nodes.iloc[32][&#39;transaction&#39;]</span>
    <span class="c1">#return_obj = neo.neoAPI.update(test)</span>
        <span class="n">master_subject_table</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">non_submitted_nodes</span><span class="p">)</span>
        <span class="c1">#pprint(master_subject_table)</span>
        <span class="k">return</span> <span class="n">master_subject_table</span>
</code></pre></div><h4 id="submit-cases">Submit Cases</h4>
<p>Initially i had copy and pasted the subject submission function. I realized that the checks were unnecessary.   I am assuming that each result is unique.  Therefore, every case is uploaded.  If it proves that there are duplicates in the database, the neo4j cypher language would permit me to prune those duplicate edges.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="k">def</span> <span class="nf">submit_cases_to_db</span><span class="p">(</span><span class="n">case_data</span><span class="p">):</span>
        <span class="c1">#unsubmitted = master_subject_table[master_subject_table.notna()]</span>

        <span class="c1">### in theory none of the cases wouldhave been submitted becasue i am pulling them from file.  There is no need to check.. Just submit</span>
    <span class="c1">#non_submitted_nodes = case_data[case_data[&#39;submitted&#39;].isna()].copy()</span>
    <span class="c1">#pprint(non_submitted_nodes)</span>
    <span class="c1">##pprint(non_submitted_nodes)</span>
    <span class="c1">#if non_submitted_nodes.empty:</span>
    <span class="c1">#    return case_data</span>
    <span class="c1">#else:</span>
    <span class="n">case_data</span><span class="p">[</span><span class="s1">&#39;transaction&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">case_data</span><span class="p">[</span><span class="s1">&#39;transaction&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">neo</span><span class="o">.</span><span class="n">neoAPI</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">x</span><span class="p">))</span>
    <span class="c1">#Assume all are submitted..</span>
    <span class="n">case_data</span><span class="p">[</span><span class="s1">&#39;submitted&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="c1">#test = non_submitted_nodes.iloc[32][&#39;transaction&#39;]</span>
    <span class="c1">#return_obj = neo.neoAPI.update(test)</span>
    <span class="c1">#case_data.update(non_submitted_nodes)</span>
    <span class="k">return</span> <span class="n">case_data</span>
</code></pre></div><h3 id="submit-the-relationships">Submit the Relationships</h3>
<p>The final step is to relate the cases to the subject nodes.</p>
<pre tabindex="0"><code>relationship_list= create_relationship_table(case_data=case_data, master_subject_table=master_subject_table)
</code></pre><p>This is accomplished by calling the relationship function declared in the Case class declared in the neomodel api.</p>
<p>View the reference below:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="k">class</span> <span class="nc">Case</span><span class="p">(</span><span class="n">StructuredNode</span><span class="p">):</span>
    <span class="n">uid</span> <span class="o">=</span> <span class="n">UniqueIdProperty</span><span class="p">()</span>
    <span class="n">date</span> <span class="o">=</span> <span class="n">StringProperty</span><span class="p">(</span><span class="n">unique_index</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">required</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">dates</span> <span class="o">=</span> <span class="n">StringProperty</span><span class="p">(</span><span class="n">unique_index</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">required</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">group</span> <span class="o">=</span> <span class="n">StringProperty</span><span class="p">(</span><span class="n">unique_index</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">required</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">name</span> <span class="o">=</span> <span class="n">StringProperty</span><span class="p">(</span><span class="n">unique_index</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">required</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">pdf</span> <span class="o">=</span> <span class="n">StringProperty</span><span class="p">(</span><span class="n">unique_index</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">required</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span> 
    <span class="n">shelf_id</span> <span class="o">=</span> <span class="n">StringProperty</span><span class="p">(</span><span class="n">unique_index</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">required</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">subject</span> <span class="o">=</span> <span class="n">StringProperty</span><span class="p">(</span><span class="n">unique_index</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">required</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="c1">#primary_topic = StringProperty(unique_index=True, required=True)</span>
    <span class="n">title</span> <span class="o">=</span> <span class="n">StringProperty</span><span class="p">(</span><span class="n">unique_index</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">required</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">url</span> <span class="o">=</span> <span class="n">StringProperty</span><span class="p">(</span><span class="n">unique_index</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">required</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">subject_relationship</span> <span class="o">=</span> <span class="n">Relationship</span><span class="p">(</span><span class="s2">&#34;Subject&#34;</span><span class="p">,</span> <span class="s2">&#34;IS_SUBJECT&#34;</span><span class="p">)</span>
</code></pre></div><h4 id="create-relationship-table">Create Relationship Table</h4>
<p>To create the relationships the case_data and the master_subject_table are necessary.</p>
<p>for every case a relationship is created to every subject within its subject list.</p>
<p>It is important to note, that in order for this function to work correctly, the cases and subjects must first be submitted to the database.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python">
<span class="k">def</span> <span class="nf">create_relationship_table</span><span class="p">(</span><span class="n">case_data</span><span class="p">,</span> <span class="n">master_subject_table</span><span class="p">):</span>
    <span class="c1">#pprint(case_data[])</span>
        <span class="c1">#test = master_subject_table[&#39;subject&#39;]</span>
        <span class="c1"># select </span>
    <span class="n">relationship_list</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">case_data</span><span class="p">)):</span>
        <span class="n">unique_dataframe</span> <span class="o">=</span> <span class="p">(</span><span class="n">master_subject_table</span><span class="p">[</span><span class="n">master_subject_table</span><span class="p">[</span><span class="s1">&#39;subject&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">case_data</span><span class="p">[</span><span class="s1">&#39;subject_list&#39;</span><span class="p">][</span><span class="n">row</span><span class="p">])])</span>
        <span class="c1">#pprint(unique_dataframe)</span>
        <span class="k">for</span> <span class="n">subject_row</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">unique_dataframe</span><span class="p">)):</span>
            <span class="n">case</span> <span class="o">=</span> <span class="n">case_data</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">row</span><span class="p">][</span><span class="s1">&#39;transaction&#39;</span><span class="p">]</span>
            <span class="n">subject</span> <span class="o">=</span> <span class="n">unique_dataframe</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">subject_row</span><span class="p">][</span><span class="s1">&#39;transaction&#39;</span><span class="p">]</span>
            <span class="c1">#create relationship</span>
            <span class="c1">#pprint(case)</span>
            <span class="c1">#pprint(subject)</span>
            <span class="n">relationship</span> <span class="o">=</span> <span class="n">neo</span><span class="o">.</span><span class="n">neoAPI</span><span class="o">.</span><span class="n">create_relationship</span><span class="p">(</span><span class="n">case</span><span class="o">.</span><span class="n">subject_relationship</span><span class="p">,</span><span class="n">subject</span><span class="p">)</span>
            <span class="c1">#pprint(relationship)</span>
            <span class="n">relationship_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">relationship</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">relationship_list</span>
</code></pre></div><h2 id="putting-everything-together">Putting Everything Together</h2>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python">
<span class="c1">#realtor_graph.py</span>


<span class="c1">#from neo4j_connect_2 import NeoSandboxApp</span>
<span class="c1">#import neo4j_connect_2 as neo</span>
<span class="c1">#import GoogleServices as google</span>
<span class="c1">#from pyspark.sql import SparkSession</span>
<span class="c1">#from pyspark.sql.functions import struct</span>
<span class="kn">from</span> <span class="nn">cgitb</span> <span class="kn">import</span> <span class="n">lookup</span>
<span class="kn">import</span> <span class="nn">code</span>
<span class="kn">from</span> <span class="nn">dbm</span> <span class="kn">import</span> <span class="n">dumb</span>
<span class="kn">from</span> <span class="nn">doctest</span> <span class="kn">import</span> <span class="n">master</span>
<span class="kn">from</span> <span class="nn">hmac</span> <span class="kn">import</span> <span class="n">trans_36</span>
<span class="kn">import</span> <span class="nn">mimetypes</span>
<span class="kn">from</span> <span class="nn">platform</span> <span class="kn">import</span> <span class="n">node</span>
<span class="kn">from</span> <span class="nn">pprint</span> <span class="kn">import</span> <span class="n">pprint</span>
<span class="kn">from</span> <span class="nn">pty</span> <span class="kn">import</span> <span class="n">master_open</span>
<span class="kn">from</span> <span class="nn">re</span> <span class="kn">import</span> <span class="n">sub</span>
<span class="kn">from</span> <span class="nn">unittest.util</span> <span class="kn">import</span> <span class="n">unorderable_list_difference</span>
<span class="kn">from</span> <span class="nn">urllib.parse</span> <span class="kn">import</span> <span class="n">non_hierarchical</span>
<span class="kn">from</span> <span class="nn">neomodel</span> <span class="kn">import</span> <span class="p">(</span><span class="n">config</span><span class="p">,</span> <span class="n">StructuredNode</span><span class="p">,</span> <span class="n">StringProperty</span><span class="p">,</span> <span class="n">IntegerProperty</span><span class="p">,</span>
    <span class="n">UniqueIdProperty</span><span class="p">,</span> <span class="n">RelationshipTo</span><span class="p">,</span> <span class="n">BooleanProperty</span><span class="p">,</span> <span class="n">EmailProperty</span><span class="p">,</span> <span class="n">Relationship</span><span class="p">,</span><span class="n">db</span><span class="p">)</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="c1">#import NeoNodes as nn</span>
<span class="c1">#import GoogleServices</span>
<span class="kn">import</span> <span class="nn">neo4jClasses</span>
<span class="c1">#import sparkAPI as spark</span>
<span class="kn">import</span> <span class="nn">neoModelAPI</span> <span class="k">as</span> <span class="nn">neo</span>
<span class="kn">import</span> <span class="nn">glob</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">json</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="c1">#from neoModelAPI import NeoNodes as nn</span>


<span class="k">class</span> <span class="nc">DataUploadFunctions</span><span class="p">():</span>
    <span class="k">def</span> <span class="nf">upload_df</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">df</span><span class="p">):</span>
        <span class="c1">#df.apply(lambda x: pprint(str(x) + str(type(x))))</span>
        
        <span class="n">node_list</span> <span class="o">=</span>  <span class="n">df</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">neo</span><span class="o">.</span><span class="n">neoAPI</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">x</span><span class="p">))</span>
        <span class="c1">#pprint(node_list)</span>
        <span class="k">return</span>  <span class="n">node_list</span>
    
    <span class="k">def</span> <span class="nf">map_to_df</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">df1</span><span class="p">,</span><span class="n">df2</span><span class="p">,</span><span class="n">lookup_value</span> <span class="p">:</span><span class="nb">str</span><span class="p">,</span> <span class="n">lookup_key</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
        <span class="n">df1</span><span class="p">[</span><span class="n">lookup_value</span><span class="p">]</span> <span class="o">=</span> <span class="n">df1</span><span class="p">[</span><span class="n">lookup_key</span><span class="p">]</span>
        <span class="c1">#pprint(df1.columns)</span>
        <span class="c1">#pprint(df1)</span>
        
        <span class="n">val</span>  <span class="o">=</span> <span class="n">df1</span><span class="p">[</span><span class="n">lookup_value</span><span class="p">]</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="nb">dict</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">df2</span><span class="p">[</span><span class="n">lookup_key</span><span class="p">],</span>  <span class="n">df2</span><span class="p">[</span><span class="n">lookup_value</span><span class="p">])))</span>
        <span class="k">return</span> <span class="n">val</span>

    <span class="k">def</span> <span class="nf">set_relationships</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">source_node</span><span class="p">,</span> <span class="n">target_node</span><span class="p">):</span>
        <span class="c1">#pprint(self.df.columns)</span>
        <span class="c1">#pprint(source_node)</span>
        <span class="n">rel</span> <span class="o">=</span> <span class="n">neo</span><span class="o">.</span><span class="n">neoAPI</span><span class="o">.</span><span class="n">create_relationship</span><span class="p">(</span><span class="n">source</span> <span class="o">=</span> <span class="n">source_node</span> <span class="p">,</span><span class="n">target</span> <span class="o">=</span> <span class="n">target_node</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">rel</span>

<span class="k">class</span> <span class="nc">DataPipelineFunctions</span><span class="p">():</span>
    <span class="k">def</span> <span class="nf">write_df_to_csv</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">df</span><span class="p">,</span><span class="n">path</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
        <span class="n">cwd</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">()</span>
        <span class="n">path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">sep</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">cwd</span><span class="p">,</span><span class="n">path</span><span class="p">])</span>

        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">path</span><span class="p">,</span><span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="n">df</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">path</span>

    <span class="k">def</span> <span class="nf">create_city_nodes</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">df</span><span class="p">):</span>
        <span class="n">city_nodes</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;city_name&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span> <span class="p">:</span><span class="n">neo</span><span class="o">.</span><span class="n">neoAPI</span><span class="o">.</span><span class="n">create_city_node</span><span class="p">(</span><span class="n">name</span> <span class="o">=</span> <span class="n">x</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">city_nodes</span>

    <span class="k">def</span> <span class="nf">create_url_nodes</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">df</span><span class="p">):</span>
        <span class="n">url_nodes</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;root_realtor_url&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span> <span class="p">:</span><span class="n">neo</span><span class="o">.</span><span class="n">neoAPI</span><span class="o">.</span><span class="n">create_realtor_search_url_node</span><span class="p">(</span><span class="n">url</span><span class="o">=</span> <span class="n">x</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">url_nodes</span>
    
    <span class="k">def</span> <span class="nf">create_root_nodes</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">df</span><span class="p">):</span>
        <span class="n">root_nodes</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;root_realtor_url&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span> <span class="p">:</span><span class="n">neo</span><span class="o">.</span><span class="n">neoAPI</span><span class="o">.</span><span class="n">create_root_node</span><span class="p">(</span><span class="n">url</span><span class="o">=</span> <span class="n">x</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">root_nodes</span>

    <span class="k">def</span> <span class="nf">create_country_nodes</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">df</span><span class="p">):</span>
        <span class="n">country_nodes</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span> <span class="p">:</span><span class="n">neo</span><span class="o">.</span><span class="n">neoAPI</span><span class="o">.</span><span class="n">create_country_node</span><span class="p">(</span><span class="n">code</span> <span class="o">=</span> <span class="n">x</span><span class="o">.</span><span class="n">country_code</span><span class="p">,</span> <span class="n">name</span> <span class="o">=</span> <span class="n">x</span><span class="o">.</span><span class="n">country_name</span><span class="p">),</span><span class="n">axis</span> <span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">country_nodes</span>
        

    <span class="k">def</span> <span class="nf">return_unique_country_df</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">df</span><span class="p">):</span>
        <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">drop_duplicates</span><span class="p">(</span><span class="n">subset</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;country_name&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="n">df</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">difference</span><span class="p">([</span><span class="s1">&#39;country_node&#39;</span><span class="p">,</span><span class="s1">&#39;state_node&#39;</span><span class="p">,</span><span class="s1">&#39;country_name&#39;</span><span class="p">,</span> <span class="s1">&#39;country_code&#39;</span><span class="p">,</span><span class="s1">&#39;state_name&#39;</span><span class="p">]),</span> <span class="mi">1</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="c1">#pprint(df)</span>
        <span class="k">return</span> <span class="n">df</span>


    <span class="k">def</span> <span class="nf">create_state_nodes</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">df</span><span class="p">):</span>
        <span class="n">state_nodes</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span> <span class="p">:</span><span class="n">neo</span><span class="o">.</span><span class="n">neoAPI</span><span class="o">.</span><span class="n">create_state_node</span><span class="p">(</span><span class="n">code</span> <span class="o">=</span> <span class="n">x</span><span class="o">.</span><span class="n">state_code</span><span class="p">,</span> <span class="n">name</span> <span class="o">=</span> <span class="n">x</span><span class="o">.</span><span class="n">state_name</span><span class="p">),</span><span class="n">axis</span> <span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">state_nodes</span>    

    <span class="k">def</span> <span class="nf">return_unique_state_df</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">df</span><span class="p">):</span>
        <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">drop_duplicates</span><span class="p">(</span><span class="n">subset</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;state_name&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="n">df</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">difference</span><span class="p">([</span><span class="s1">&#39;state_node&#39;</span><span class="p">,</span><span class="s1">&#39;country_node&#39;</span><span class="p">,</span><span class="s1">&#39;country_code&#39;</span><span class="p">,</span><span class="s1">&#39;state_name&#39;</span><span class="p">,</span><span class="s1">&#39;country_name&#39;</span><span class="p">,</span><span class="s1">&#39;state_code&#39;</span><span class="p">]),</span> <span class="mi">1</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="c1">#pprint(df)</span>

        <span class="k">return</span> <span class="n">df</span>

    <span class="k">def</span> <span class="nf">rename_columns</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">df</span><span class="p">,</span> <span class="n">mapper</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;city&#39;</span><span class="p">:</span> <span class="s1">&#39;city_name&#39;</span><span class="p">,</span> <span class="s1">&#39;state&#39;</span><span class="p">:</span> <span class="s1">&#39;state_code&#39;</span><span class="p">,</span><span class="s1">&#39;realtor_url&#39;</span><span class="p">:</span> <span class="s1">&#39;root_realtor_url&#39;</span><span class="p">}):</span>
        <span class="k">return</span> <span class="n">df</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span> <span class="o">=</span> <span class="n">mapper</span><span class="p">)</span>


    <span class="k">def</span> <span class="nf">add_country_code</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">country_code</span> <span class="o">=</span> <span class="s2">&#34;USA&#34;</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">country_code</span>

    <span class="k">def</span> <span class="nf">add_country_name</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">country_name</span> <span class="o">=</span> <span class="s2">&#34;United States of America&#34;</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">country_name</span>

    <span class="k">def</span> <span class="nf">upload_df</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">df</span><span class="p">):</span>
        <span class="c1">#df.apply(lambda x: pprint(str(x) + str(type(x))))</span>
        
        <span class="n">node_list</span> <span class="o">=</span>  <span class="n">df</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">neo</span><span class="o">.</span><span class="n">neoAPI</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">x</span><span class="p">))</span>
        <span class="n">pprint</span><span class="p">(</span><span class="n">node_list</span><span class="p">)</span>
        <span class="k">return</span>  <span class="n">node_list</span>
        <span class="c1">#df[&#39;server_node&#39;] =  node_list</span>
        <span class="c1">#pprint(df)</span>
        
        


    <span class="k">def</span> <span class="nf">set_url_relationships</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1">#pprint(self.df.columns)</span>
        <span class="n">update_list</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">neo</span><span class="o">.</span><span class="n">neoAPI</span><span class="o">.</span><span class="n">create_relationship</span><span class="p">(</span><span class="n">source</span> <span class="o">=</span> <span class="n">x</span><span class="o">.</span><span class="n">url_node</span><span class="o">.</span><span class="n">city</span><span class="p">,</span><span class="n">target</span> <span class="o">=</span> <span class="n">x</span><span class="o">.</span><span class="n">city_node</span><span class="p">),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">pprint</span><span class="p">(</span><span class="n">update_list</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">update_list</span>
        <span class="c1">#rel = self.df.url.connect(self.df.city)</span>

    <span class="k">def</span> <span class="nf">set_city_relationships</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1">#pprint(self.df.columns)</span>
        <span class="n">update_list</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">neo</span><span class="o">.</span><span class="n">neoAPI</span><span class="o">.</span><span class="n">create_relationship</span><span class="p">(</span><span class="n">source</span> <span class="o">=</span> <span class="n">x</span><span class="o">.</span><span class="n">city_node</span><span class="o">.</span><span class="n">country</span><span class="p">,</span><span class="n">target</span> <span class="o">=</span> <span class="n">x</span><span class="o">.</span><span class="n">country_node</span><span class="p">),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">update_list</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">neo</span><span class="o">.</span><span class="n">neoAPI</span><span class="o">.</span><span class="n">create_relationship</span><span class="p">(</span><span class="n">source</span> <span class="o">=</span> <span class="n">x</span><span class="o">.</span><span class="n">city_node</span><span class="o">.</span><span class="n">state</span><span class="p">,</span><span class="n">target</span> <span class="o">=</span> <span class="n">x</span><span class="o">.</span><span class="n">state_node</span><span class="p">),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">pprint</span><span class="p">(</span><span class="n">update_list</span><span class="p">)</span>
        <span class="c1">#rel = self.df.url.connect(self.df.city)</span>

    <span class="k">def</span> <span class="nf">set_state_relationships</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1">#pprint(self.df.columns)</span>
        <span class="n">neo</span><span class="o">.</span><span class="n">neoAPI</span><span class="o">.</span><span class="n">create_relationship</span><span class="p">(</span><span class="n">source</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">unique_state_nodes</span><span class="o">.</span><span class="n">state_node</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">country</span><span class="p">,</span><span class="n">target</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">unique_state_nodes</span><span class="o">.</span><span class="n">country_node</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="c1">#update_list = self.unique_state_nodes.apply(lambda x: neo.neoAPI.create_relationship(source = x.state_node.country,target = x.country_node.name), axis=1)</span>
        <span class="c1">#pprint(update_list)</span>
        <span class="c1">#rel = self.df.url.connect(self.df.city)</span>




    <span class="k">def</span> <span class="nf">group_by_state</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">grouped</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="n">by</span> <span class="o">=</span> <span class="s2">&#34;state_name&#34;</span><span class="p">)</span>
        
    <span class="k">def</span> <span class="nf">load_data_to_pandas_df</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">file_path</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">file_path</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">:</span>

            <span class="k">with</span> <span class="nb">open</span> <span class="p">(</span><span class="n">file_path</span><span class="p">)</span> <span class="k">as</span> <span class="n">file</span><span class="p">:</span>
                <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_json</span><span class="p">(</span><span class="n">file</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">df</span>
    
    <span class="k">def</span> <span class="nf">nodify_city_column</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;city_node&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;city&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span> <span class="p">:</span> <span class="n">neo</span><span class="o">.</span><span class="n">neoAPI</span><span class="o">.</span><span class="n">create_city_node</span><span class="p">(</span><span class="n">name</span> <span class="o">=</span> <span class="n">x</span><span class="p">))</span>
        
        
        <span class="c1">#pprint(df.city_nodes)</span>



    <span class="k">def</span> <span class="nf">nodify_states_column</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="n">unique_states</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="o">.</span><span class="n">drop_duplicates</span><span class="p">(</span><span class="n">subset</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;state&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="c1">#pprint(state_dict)</span>

        <span class="n">unique_states</span><span class="p">[</span><span class="s1">&#39;state_node&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">unique_states</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">neo</span><span class="o">.</span><span class="n">neoAPI</span><span class="o">.</span><span class="n">create_state_node</span><span class="p">(</span><span class="n">name</span> <span class="o">=</span> <span class="n">x</span><span class="o">.</span><span class="n">state_name</span><span class="p">,</span> <span class="n">code</span> <span class="o">=</span> <span class="n">x</span><span class="o">.</span><span class="n">state</span><span class="p">),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="c1">#pprint(unique_states)</span>
        <span class="c1">#self.df[&#39;state_nodes&#39;] = unique_states[&#39;state_nodes&#39;] where unique_states[state_name] = self.df_stateName</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="p">[</span><span class="s2">&#34;state_node&#34;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;state_name&#39;</span><span class="p">]</span>
        <span class="c1">#self.df[&#39;state_node&#39;] =</span>
        <span class="c1">#pprint(self.df[&#39;state_name&#39;].map(unique_states))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;state_node&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;state_node&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="nb">dict</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">unique_states</span><span class="o">.</span><span class="n">state_name</span><span class="p">,</span>  <span class="n">unique_states</span><span class="o">.</span><span class="n">state_node</span><span class="p">)))</span>
        <span class="c1">#pprint(self.df)</span>

        
     
        <span class="c1">#mask = dfd[&#39;a&#39;].str.startswith(&#39;o&#39;)</span>
        
        
        <span class="c1">#self.df[&#39;state_nodes&#39;] = self.df.apply(lambda x: neo.create_state_node(name = x.state_name, code = x.state) if x not in states_dict else states_dict[x], axis=1)</span>
        
    <span class="k">def</span> <span class="nf">nodify_url_column</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;url_node&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;realtor_url&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span> <span class="p">:</span> <span class="n">neo</span><span class="o">.</span><span class="n">neoAPI</span><span class="o">.</span><span class="n">create_url_node</span><span class="p">(</span><span class="n">url</span> <span class="o">=</span> <span class="n">x</span><span class="p">,</span> <span class="n">searched</span><span class="o">=</span> <span class="kc">False</span><span class="p">))</span>


    

<span class="k">def</span> <span class="nf">get_cwd</span><span class="p">():</span>
    <span class="n">cwd</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">cwd</span>

<span class="k">def</span> <span class="nf">get_files</span><span class="p">(</span><span class="n">cwd</span> <span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">(),</span> <span class="n">input_directory</span> <span class="o">=</span> <span class="s1">&#39;input&#39;</span><span class="p">):</span>
    
    <span class="n">path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">sep</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">cwd</span><span class="p">,</span><span class="n">input_directory</span><span class="p">])</span>
    <span class="n">file_list</span><span class="o">=</span> <span class="p">[</span><span class="n">f</span> <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">glob</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="n">path</span> <span class="o">+</span> <span class="s2">&#34;**/*.json&#34;</span><span class="p">,</span> <span class="n">recursive</span><span class="o">=</span><span class="kc">True</span><span class="p">)]</span>
  
    <span class="k">return</span> <span class="n">file_list</span>

<span class="k">def</span> <span class="nf">instantiate_neo_model_api</span><span class="p">():</span>
    <span class="n">uri</span> <span class="o">=</span> <span class="s2">&#34;7a92f171.databases.neo4j.io&#34;</span>
    <span class="n">user</span> <span class="o">=</span> <span class="s2">&#34;neo4j&#34;</span>
    <span class="n">psw</span> <span class="o">=</span> <span class="s1">&#39;RF4Gr2IJTNhHlW6HOrLDqz_I2E2Upyh7o8paTwfnCxg&#39;</span>
    <span class="k">return</span> <span class="n">neo</span><span class="o">.</span><span class="n">neoAPI</span><span class="o">.</span><span class="n">instantiate_neo_model_session</span><span class="p">(</span><span class="n">uri</span><span class="o">=</span><span class="n">uri</span><span class="p">,</span><span class="n">user</span><span class="o">=</span><span class="n">user</span><span class="p">,</span><span class="n">psw</span><span class="o">=</span><span class="n">psw</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">prepare_data_pipeline</span><span class="p">():</span>
    <span class="n">pipeline_functions</span> <span class="o">=</span> <span class="n">DataPipelineFunctions</span><span class="p">()</span>
    <span class="n">master_df</span> <span class="o">=</span> <span class="n">pipeline_functions</span><span class="o">.</span><span class="n">load_data_to_pandas_df</span><span class="p">()</span>
    <span class="n">master_df</span><span class="p">[</span><span class="s1">&#39;country_name&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pipeline_functions</span><span class="o">.</span><span class="n">add_country_name</span><span class="p">()</span>
    <span class="n">master_df</span><span class="p">[</span><span class="s1">&#39;country_code&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pipeline_functions</span><span class="o">.</span><span class="n">add_country_code</span><span class="p">()</span>
    <span class="n">master_df</span> <span class="o">=</span> <span class="n">pipeline_functions</span><span class="o">.</span><span class="n">rename_columns</span><span class="p">(</span><span class="n">master_df</span><span class="p">)</span>
    <span class="n">master_df</span><span class="p">[</span><span class="s1">&#39;city_node&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pipeline_functions</span><span class="o">.</span><span class="n">create_city_nodes</span><span class="p">(</span><span class="n">master_df</span><span class="p">)</span>
    <span class="n">master_df</span><span class="p">[</span><span class="s1">&#39;url_node&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pipeline_functions</span><span class="o">.</span><span class="n">create_url_nodes</span><span class="p">(</span><span class="n">master_df</span><span class="p">)</span>
    <span class="n">master_df</span><span class="p">[</span><span class="s1">&#39;root_node&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pipeline_functions</span><span class="o">.</span><span class="n">create_root_nodes</span><span class="p">(</span><span class="n">master_df</span><span class="p">)</span>

    
    <span class="n">master_df_path</span> <span class="o">=</span> <span class="n">pipeline_functions</span><span class="o">.</span><span class="n">write_df_to_csv</span><span class="p">(</span><span class="n">master_df</span><span class="p">,</span><span class="s1">&#39;master_df.csv&#39;</span><span class="p">)</span>

    

    
    <span class="n">state_df</span> <span class="o">=</span> <span class="n">pipeline_functions</span><span class="o">.</span><span class="n">return_unique_state_df</span><span class="p">(</span><span class="n">master_df</span><span class="p">)</span>
    <span class="n">state_df</span><span class="p">[</span><span class="s1">&#39;state_node&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pipeline_functions</span><span class="o">.</span><span class="n">create_state_nodes</span><span class="p">(</span><span class="n">state_df</span><span class="p">)</span>
    <span class="n">state_df_path</span> <span class="o">=</span> <span class="n">pipeline_functions</span><span class="o">.</span><span class="n">write_df_to_csv</span><span class="p">(</span><span class="n">state_df</span><span class="p">,</span><span class="s1">&#39;state_df.csv&#39;</span><span class="p">)</span>
    

    <span class="n">country_df</span> <span class="o">=</span> <span class="n">pipeline_functions</span><span class="o">.</span><span class="n">return_unique_country_df</span><span class="p">(</span><span class="n">master_df</span><span class="p">)</span>
    <span class="n">country_df</span><span class="p">[</span><span class="s1">&#39;country_node&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pipeline_functions</span><span class="o">.</span><span class="n">create_country_nodes</span><span class="p">(</span><span class="n">country_df</span><span class="p">)</span>
    <span class="n">country_df_path</span> <span class="o">=</span> <span class="n">pipeline_functions</span><span class="o">.</span><span class="n">write_df_to_csv</span><span class="p">(</span><span class="n">country_df</span><span class="p">,</span><span class="s1">&#39;country.csv&#39;</span><span class="p">)</span>


    



    <span class="c1">#upload nodes</span>
    
    <span class="k">return</span> <span class="p">{</span><span class="s2">&#34;master_df&#34;</span> <span class="p">:</span> <span class="n">master_df</span><span class="p">,</span> <span class="s1">&#39;state_df&#39;</span> <span class="p">:</span> <span class="n">state_df</span><span class="p">,</span> <span class="s1">&#39;country_df&#39;</span><span class="p">:</span> <span class="n">country_df</span><span class="p">}</span>



<span class="k">def</span> <span class="nf">load_json_data</span><span class="p">(</span><span class="n">file</span><span class="p">):</span>
    <span class="n">f</span> <span class="o">=</span> <span class="nb">open</span> <span class="p">(</span><span class="n">file</span><span class="p">,</span> <span class="s2">&#34;r&#34;</span><span class="p">)</span>
  
    <span class="c1"># Reading from file</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">())</span>
    <span class="k">return</span> <span class="n">data</span>


<span class="k">def</span> <span class="nf">json_pipeline</span><span class="p">(</span><span class="n">file_list</span><span class="p">,</span> <span class="n">master_subject_table</span><span class="p">):</span>
    <span class="n">case_counter</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">for</span> <span class="n">file</span> <span class="ow">in</span> <span class="n">file_list</span><span class="p">:</span>
        
        <span class="n">data</span> <span class="o">=</span> <span class="n">load_json_data</span><span class="p">(</span><span class="n">file</span><span class="o">=</span><span class="n">file</span><span class="p">)</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;results&#39;</span><span class="p">]</span>
        <span class="c1">#pprint(data)</span>
        <span class="c1">#pprint(data[0])</span>
        
        <span class="c1">#filtered_data = filter_json_data(json_data = data, filter = filter)</span>

        <span class="c1"># Creating the case nodes transaction nodes and df</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">clean_json_data</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
        <span class="n">case_data</span> <span class="o">=</span> <span class="n">stringify_json_values</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
        <span class="n">case_data</span> <span class="o">=</span> <span class="n">pandify_case_data</span><span class="p">(</span><span class="n">case_data</span><span class="p">)</span>
        <span class="n">case_data</span> <span class="o">=</span> <span class="n">nodify_case_data</span><span class="p">(</span><span class="n">case_data</span> <span class="o">=</span> <span class="n">case_data</span><span class="p">)</span>
        
        <span class="c1"># Creating the subject nodes transaction nodes and df</span>
        <span class="n">subject_list</span> <span class="o">=</span> <span class="n">slice_subject_data</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
        <span class="n">subject_list</span> <span class="o">=</span> <span class="n">identify_unique_subjects</span><span class="p">(</span><span class="n">subject_list</span><span class="p">)</span>
        <span class="n">subject_lookup_table</span> <span class="o">=</span> <span class="n">create_subject_lookup_table</span><span class="p">(</span><span class="n">subject_list</span><span class="p">)</span>
        <span class="n">master_subject_table</span> <span class="o">=</span> <span class="n">integrate_to_master_table</span><span class="p">(</span><span class="n">subject_lookup_table</span><span class="p">,</span><span class="n">master_subject_table</span><span class="p">)</span>
        <span class="c1">#pprint(master_subject_table.duplicated())</span>
        <span class="n">case_counter</span> <span class="o">=</span> <span class="n">case_counter</span> <span class="o">+</span> <span class="nb">len</span><span class="p">(</span><span class="n">case_data</span><span class="p">)</span>

        <span class="n">master_subject_table</span> <span class="o">=</span> <span class="n">nodify_subjects</span><span class="p">(</span><span class="n">master_subject_table</span><span class="p">)</span>

        <span class="c1">#pprint(case_data)</span>
        <span class="c1">#pprint(master_subject_table[&#39;transaction&#39;])</span>
        <span class="c1">#lets save data to the database</span>

        <span class="n">master_subject_table</span> <span class="o">=</span> <span class="n">submit_subjects_to_db</span><span class="p">(</span><span class="n">master_subject_table</span><span class="p">)</span>
        <span class="n">case_data</span> <span class="o">=</span> <span class="n">submit_cases_to_db</span><span class="p">(</span><span class="n">case_data</span> <span class="o">=</span> <span class="n">case_data</span><span class="p">)</span>

        <span class="c1"># Create Relationships</span>

        <span class="n">relationship_list</span><span class="o">=</span> <span class="n">create_relationship_table</span><span class="p">(</span><span class="n">case_data</span><span class="o">=</span><span class="n">case_data</span><span class="p">,</span> <span class="n">master_subject_table</span><span class="o">=</span><span class="n">master_subject_table</span><span class="p">)</span>
    




<span class="k">def</span> <span class="nf">submit_cases_to_db</span><span class="p">(</span><span class="n">case_data</span><span class="p">):</span>
        <span class="c1">#unsubmitted = master_subject_table[master_subject_table.notna()]</span>

        <span class="c1">### in theory none of the cases wouldhave been submitted becasue i am pulling them from file.  There is no need to check.. Just submit</span>
    <span class="c1">#non_submitted_nodes = case_data[case_data[&#39;submitted&#39;].isna()].copy()</span>
    <span class="c1">#pprint(non_submitted_nodes)</span>
    <span class="c1">##pprint(non_submitted_nodes)</span>
    <span class="c1">#if non_submitted_nodes.empty:</span>
    <span class="c1">#    return case_data</span>
    <span class="c1">#else:</span>
    <span class="n">case_data</span><span class="p">[</span><span class="s1">&#39;transaction&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">case_data</span><span class="p">[</span><span class="s1">&#39;transaction&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">neo</span><span class="o">.</span><span class="n">neoAPI</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">x</span><span class="p">))</span>
    <span class="c1">#Assume all are submitted..</span>
    <span class="n">case_data</span><span class="p">[</span><span class="s1">&#39;submitted&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="c1">#test = non_submitted_nodes.iloc[32][&#39;transaction&#39;]</span>
    <span class="c1">#return_obj = neo.neoAPI.update(test)</span>
    <span class="c1">#case_data.update(non_submitted_nodes)</span>
    <span class="k">return</span> <span class="n">case_data</span>

    <span class="c1">#Relationships must need to be created following saving to the df</span>
    <span class="c1">#relationships = create_relationship_table(case_data, master_subject_table)</span>

<span class="k">def</span> <span class="nf">submit_subjects_to_db</span><span class="p">(</span><span class="n">master_subject_table</span><span class="p">):</span>
    <span class="c1">#unsubmitted = master_subject_table[master_subject_table.notna()]</span>
    <span class="c1">#pprint(master_subject_table)</span>
    <span class="c1">#non_submitted_nodes=master_subject_table[[master_subject_table[&#39;submitted&#39;] == np.nan]]</span>
    <span class="n">non_submitted_nodes</span> <span class="o">=</span> <span class="n">master_subject_table</span><span class="p">[</span><span class="n">master_subject_table</span><span class="p">[</span><span class="s1">&#39;submitted&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">isna</span><span class="p">()]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
    <span class="c1">#pprint(non_submitted_nodes)</span>
    <span class="k">if</span> <span class="n">non_submitted_nodes</span><span class="o">.</span><span class="n">empty</span><span class="p">:</span>   
        <span class="k">return</span> <span class="n">master_subject_table</span>
    <span class="k">else</span><span class="p">:</span>
         <span class="c1">#pprint(non_submitted_nodes)</span>
        <span class="n">non_submitted_nodes</span><span class="p">[</span><span class="s1">&#39;transaction&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">non_submitted_nodes</span><span class="p">[</span><span class="s1">&#39;transaction&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">neo</span><span class="o">.</span><span class="n">neoAPI</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">x</span><span class="p">))</span>
        <span class="n">non_submitted_nodes</span><span class="p">[</span><span class="s1">&#39;submitted&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
    
    <span class="c1">#test = non_submitted_nodes.iloc[32][&#39;transaction&#39;]</span>
    <span class="c1">#return_obj = neo.neoAPI.update(test)</span>
        <span class="n">master_subject_table</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">non_submitted_nodes</span><span class="p">)</span>
        <span class="c1">#pprint(master_subject_table)</span>
        <span class="k">return</span> <span class="n">master_subject_table</span>

<span class="k">def</span> <span class="nf">tester</span><span class="p">():</span>
    <span class="k">return</span> <span class="s2">&#34;Hello Dolly&#34;</span>

<span class="k">def</span> <span class="nf">create_relationship_table</span><span class="p">(</span><span class="n">case_data</span><span class="p">,</span> <span class="n">master_subject_table</span><span class="p">):</span>
    <span class="c1">#pprint(case_data[])</span>
        <span class="c1">#test = master_subject_table[&#39;subject&#39;]</span>
        <span class="c1"># select </span>
    <span class="n">relationship_list</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">case_data</span><span class="p">)):</span>
        <span class="n">unique_dataframe</span> <span class="o">=</span> <span class="p">(</span><span class="n">master_subject_table</span><span class="p">[</span><span class="n">master_subject_table</span><span class="p">[</span><span class="s1">&#39;subject&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">case_data</span><span class="p">[</span><span class="s1">&#39;subject_list&#39;</span><span class="p">][</span><span class="n">row</span><span class="p">])])</span>
        <span class="c1">#pprint(unique_dataframe)</span>
        <span class="k">for</span> <span class="n">subject_row</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">unique_dataframe</span><span class="p">)):</span>
            <span class="n">case</span> <span class="o">=</span> <span class="n">case_data</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">row</span><span class="p">][</span><span class="s1">&#39;transaction&#39;</span><span class="p">]</span>
            <span class="n">subject</span> <span class="o">=</span> <span class="n">unique_dataframe</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">subject_row</span><span class="p">][</span><span class="s1">&#39;transaction&#39;</span><span class="p">]</span>
            <span class="c1">#create relationship</span>
            <span class="c1">#pprint(case)</span>
            <span class="c1">#pprint(subject)</span>
            <span class="n">relationship</span> <span class="o">=</span> <span class="n">neo</span><span class="o">.</span><span class="n">neoAPI</span><span class="o">.</span><span class="n">create_relationship</span><span class="p">(</span><span class="n">case</span><span class="o">.</span><span class="n">subject_relationship</span><span class="p">,</span><span class="n">subject</span><span class="p">)</span>
            <span class="c1">#pprint(relationship)</span>
            <span class="n">relationship_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">relationship</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">relationship_list</span>




        
    <span class="c1">#create relationship between the case and each uid in the unique_data_frame_transaction_list </span>
    <span class="n">pprint</span><span class="p">(</span><span class="n">unique_dataframe</span><span class="p">)</span>


    <span class="c1">## Creating the realation table</span>

    <span class="c1"># Thoughts</span>
    <span class="c1"># pass subject and case table</span>
    <span class="c1"># case_subject list collumn</span>
    <span class="c1"># where that list is in the master table</span>
        <span class="c1">#return  the subjects </span>
    <span class="c1"># make a connection to between each subject and the case in the returned tableuid in the table</span>
    <span class="c1"># return a transaction list </span>
    <span class="c1"># with the list commit a transaction for eachn </span>
    <span class="c1">#</span>

    <span class="c1">#case_data= filter_case_data(data)</span>
<span class="k">def</span> <span class="nf">nodify_case_data</span><span class="p">(</span><span class="n">case_data</span><span class="p">):</span>
    <span class="c1">#non_submitted_nodes = case_data[case_data.notna()]</span>
    <span class="n">non_submitted_nodes</span> <span class="o">=</span> <span class="n">case_data</span><span class="p">[</span><span class="n">case_data</span><span class="o">.</span><span class="n">notna</span><span class="p">()</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)]</span>
    <span class="c1">#pprint(non_submitted_nodes)</span>
    <span class="n">case_nodes</span> <span class="o">=</span> <span class="n">non_submitted_nodes</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span> <span class="p">:</span><span class="n">neo</span><span class="o">.</span><span class="n">neoAPI</span><span class="o">.</span><span class="n">create_case_node</span><span class="p">(</span><span class="n">date</span> <span class="o">=</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;date&#39;</span><span class="p">],</span> <span class="n">dates</span><span class="o">=</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;dates&#39;</span><span class="p">],</span><span class="n">group</span> <span class="o">=</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;group&#39;</span><span class="p">],</span> <span class="n">name</span><span class="o">=</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">],</span> <span class="n">pdf</span><span class="o">=</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;pdf&#39;</span><span class="p">],</span> <span class="n">shelf_id</span> <span class="o">=</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;shelf_id&#39;</span><span class="p">],</span> <span class="n">subject</span><span class="o">=</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;subject&#39;</span><span class="p">],</span> <span class="n">title</span> <span class="o">=</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;title&#39;</span><span class="p">],</span> <span class="n">url</span> <span class="o">=</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;url&#39;</span><span class="p">],</span> <span class="n">subject_relationship</span><span class="o">=</span><span class="kc">True</span><span class="p">),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

    <span class="n">case_data</span><span class="p">[</span><span class="s1">&#39;transaction&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">case_nodes</span>
    <span class="k">return</span> <span class="n">case_data</span>




<span class="k">def</span> <span class="nf">filter_case_data</span><span class="p">(</span><span class="n">data</span><span class="p">):</span>
    <span class="n">pprint</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>



<span class="k">def</span> <span class="nf">nodify_subjects</span><span class="p">(</span><span class="n">master_subject_table</span><span class="p">):</span>
    <span class="n">non_submitted_nodes</span> <span class="o">=</span> <span class="n">master_subject_table</span><span class="p">[</span><span class="n">master_subject_table</span><span class="o">.</span><span class="n">isna</span><span class="p">()</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
    <span class="c1">#df[df.isna().any(axis=1)]</span>
    <span class="c1">#pprint(non_submitted_nodes)</span>
    <span class="n">non_submitted_nodes</span><span class="p">[</span><span class="s1">&#39;transaction&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">non_submitted_nodes</span><span class="p">[</span><span class="s1">&#39;subject&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span> <span class="p">:</span><span class="n">neo</span><span class="o">.</span><span class="n">neoAPI</span><span class="o">.</span><span class="n">create_subject_node</span><span class="p">(</span><span class="n">name</span> <span class="o">=</span> <span class="n">x</span><span class="p">))</span>
    <span class="n">master_subject_table</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">non_submitted_nodes</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">master_subject_table</span>

<span class="k">def</span> <span class="nf">integrate_to_master_table</span><span class="p">(</span><span class="n">subject_lookup_table</span><span class="p">,</span> <span class="n">master_subject_table</span><span class="p">):</span>
    <span class="c1">#check_if subject in list is in subject of the table</span>
    <span class="c1"># if so drop it from the temp table</span>
    <span class="c1"># append what is left to the master table </span>
    <span class="c1">#pprint(subject_lookup_table)</span>
    <span class="n">test</span> <span class="o">=</span> <span class="n">master_subject_table</span><span class="p">[</span><span class="s1">&#39;subject&#39;</span><span class="p">]</span>
    <span class="n">unique_dataframe</span> <span class="o">=</span> <span class="p">(</span><span class="n">subject_lookup_table</span><span class="p">[</span><span class="o">~</span><span class="n">subject_lookup_table</span><span class="p">[</span><span class="s1">&#39;subject&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">test</span><span class="p">)])</span>
    <span class="c1">#pprint(unique_dataframe)</span>
    <span class="c1">#duplicate_list = (master_subject_table[~master_subject_table[&#39;subject&#39;].isin(subject_lookup_table[&#39;subject&#39;])])</span>
    <span class="n">master_subject_table</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">master_subject_table</span><span class="p">,</span><span class="n">unique_dataframe</span><span class="p">])</span>
    <span class="c1">#master_subject_table.update(unique_dataframe)</span>
    <span class="n">master_subject_table</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="c1">#pprint(master_subject_table)</span>
    <span class="c1">#pprint(master_subject_table.duplicated())</span>
    <span class="k">return</span> <span class="n">master_subject_table</span>

<span class="k">def</span> <span class="nf">create_subject_lookup_table</span><span class="p">(</span><span class="n">subject_list</span><span class="p">):</span>
    <span class="n">lookup_table</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">subject_list</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;subject&#39;</span><span class="p">])</span>
    <span class="n">lookup_table</span><span class="p">[</span><span class="s1">&#39;transaction&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>
    <span class="n">lookup_table</span><span class="p">[</span><span class="s1">&#39;submitted&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>
    <span class="k">return</span> <span class="n">lookup_table</span>

<span class="k">def</span> <span class="nf">identify_unique_subjects</span><span class="p">(</span><span class="n">subject_list</span><span class="p">):</span>
    
    <span class="c1"># insert the list to the set</span>
    <span class="n">list_set</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">subject_list</span><span class="p">)</span>
    <span class="c1"># convert the set to the list</span>
    <span class="n">unique_list</span> <span class="o">=</span> <span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">list_set</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">unique_list</span>

<span class="k">def</span> <span class="nf">slice_subject_data</span><span class="p">(</span><span class="n">data</span><span class="p">):</span>
    <span class="n">subject_list</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">case</span> <span class="ow">in</span> <span class="n">data</span><span class="p">:</span>
        <span class="n">subject_list</span> <span class="o">=</span> <span class="n">subject_list</span> <span class="o">+</span> <span class="n">case</span><span class="p">[</span><span class="s1">&#39;subject_list&#39;</span><span class="p">]</span>
    <span class="c1">#pprint(subject_list)</span>
    <span class="k">return</span> <span class="n">subject_list</span>

<span class="k">def</span> <span class="nf">pandify_case_data</span><span class="p">(</span><span class="n">data</span><span class="p">):</span>
    <span class="c1">#case_df = pd.concat(data, sort=False)</span>
    <span class="n">df</span><span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
    <span class="n">df</span><span class="p">[</span><span class="s1">&#39;submitted&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>
    <span class="k">return</span> <span class="n">df</span>
        
<span class="k">def</span> <span class="nf">stringify_json_values</span><span class="p">(</span><span class="n">data</span><span class="p">):</span>
    <span class="k">for</span> <span class="nb">dict</span> <span class="ow">in</span> <span class="n">data</span><span class="p">:</span>
        <span class="n">subject_list</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">[</span><span class="s1">&#39;subject&#39;</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="nb">dict</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="nb">dict</span><span class="p">[</span><span class="n">key</span><span class="p">])</span> <span class="o">==</span> <span class="nb">list</span><span class="p">:</span>
                <span class="n">tmp_list</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="p">(</span><span class="nb">dict</span><span class="p">[</span><span class="n">key</span><span class="p">]):</span>
                    <span class="n">item</span> <span class="o">=</span> <span class="n">item</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&#34; &#34;</span><span class="p">,</span> <span class="s2">&#34;-&#34;</span><span class="p">)</span>
                    <span class="n">tmp_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>
                <span class="nb">dict</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">tmp_list</span>

                <span class="nb">dict</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&#34;,&#34;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">dict</span><span class="p">[</span><span class="n">key</span><span class="p">])</span>
        <span class="nb">dict</span><span class="p">[</span><span class="s1">&#39;subject_list&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">subject_list</span>

                
    <span class="k">return</span> <span class="n">data</span>
                

    <span class="c1">#pprint(data)</span>

<span class="k">def</span> <span class="nf">clean_json_data</span><span class="p">(</span><span class="n">filtered_data</span><span class="p">):</span>
    <span class="c1"># Select the keys that I want from the dictionary</span>
    <span class="c1"># filter appropriatly into a df </span>
    <span class="c1"># write df to file</span>
    <span class="c1">#print(type(filtered_data))</span>
    <span class="c1">#pprint(filtered_data)</span>
    <span class="k">for</span> <span class="n">data</span> <span class="ow">in</span> <span class="n">filtered_data</span><span class="p">:</span>
        <span class="c1">#pprint(data)</span>
        <span class="c1">#creat a dictionary of columns and values for each row.  Combine them all into a df when we are done</span>
        <span class="c1"># each dictionary must be a row.... which makes perfect sense, but they can not be nested... </span>
        <span class="n">item</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;item&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="n">resources</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;resources&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="n">index</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;index&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="n">language</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;language&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="n">online_format</span><span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;online_format&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="n">original_format</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;original_format&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="n">kind</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;type&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="n">image_url</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;image_url&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="n">hassegments</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;hassegments&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="n">extract_timestamp</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;extract_timestamp&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="n">timestampe</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;timestamp&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="n">mimetype</span><span class="o">=</span><span class="n">data</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;mime_type&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">pdf</span> <span class="o">=</span> <span class="n">resources</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;pdf&#39;</span><span class="p">]</span>
        <span class="k">except</span><span class="p">:</span> 
            <span class="n">pdf</span> <span class="o">=</span> <span class="s2">&#34;noPdf&#34;</span>
        <span class="n">data</span><span class="p">[</span><span class="s2">&#34;pdf&#34;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pdf</span>
        <span class="n">data</span><span class="p">[</span><span class="s1">&#39;search_index&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">index</span>
    


    <span class="c1"># convert to strings maybe move into another function to be called.  Actually will definitely move to a nother function </span>

    <span class="k">return</span> <span class="n">filtered_data</span>
    <span class="c1">#uid = UniqueIdProperty()</span>
    <span class="c1">##date = date</span>
    <span class="c1">#dates = dates</span>
    <span class="c1">#group = group</span>
    <span class="c1">#id = id </span>
    <span class="c1">#pdf = pdf </span>
    <span class="c1">#shelf_id = shelf_id</span>
    <span class="c1">#subject = subject</span>
    <span class="c1">#primary_topic = primary_topic</span>
    <span class="c1">#title = title</span>
    <span class="c1">#url = url</span>
    <span class="c1">#description = description</span>
    <span class="c1">#source_collection = source_collection</span>




<span class="k">def</span> <span class="nf">filter_json_data</span><span class="p">(</span><span class="n">json_data</span><span class="p">,</span> <span class="nb">filter</span><span class="p">):</span>
    <span class="c1"># Using dict()</span>
    <span class="c1"># Extracting specific keys from dictionary</span>

    <span class="nb">filter</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;contributor&#39;</span><span class="p">,</span><span class="s1">&#39;date&#39;</span><span class="p">,</span> <span class="s1">&#39;dates&#39;</span><span class="p">,</span> <span class="s1">&#39;digitized&#39;</span><span class="p">]</span>
    <span class="n">res</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">((</span><span class="n">k</span><span class="p">,</span> <span class="n">json_data</span><span class="p">[</span><span class="n">k</span><span class="p">])</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">filter</span> <span class="k">if</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">json_data</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">res</span>

<span class="k">def</span> <span class="nf">create_master_subject_table</span><span class="p">():</span>
    <span class="n">table</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">()</span>
    <span class="n">table</span><span class="p">[</span><span class="s1">&#39;subject&#39;</span><span class="p">]</span><span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>
    <span class="n">table</span><span class="p">[</span><span class="s1">&#39;transaction&#39;</span><span class="p">]</span><span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>
    <span class="n">table</span><span class="p">[</span><span class="s1">&#39;submitted&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>
    <span class="k">return</span><span class="p">(</span><span class="n">table</span><span class="p">)</span>

<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&#34;__main__&#34;</span><span class="p">:</span>
    <span class="n">neo_applified</span> <span class="o">=</span> <span class="n">instantiate_neo_model_api</span><span class="p">()</span>
    <span class="n">cwd</span> <span class="o">=</span> <span class="n">get_cwd</span><span class="p">()</span>
    <span class="n">file_list</span> <span class="o">=</span> <span class="n">get_files</span><span class="p">(</span><span class="n">cwd</span> <span class="o">=</span> <span class="n">cwd</span><span class="p">)</span>
    <span class="n">master_subject_table</span> <span class="o">=</span> <span class="n">create_master_subject_table</span><span class="p">()</span>
    <span class="n">json_pipeline</span><span class="p">(</span><span class="n">file_list</span><span class="o">=</span><span class="n">file_list</span><span class="p">,</span> <span class="n">master_subject_table</span><span class="o">=</span><span class="n">master_subject_table</span><span class="p">)</span>
    
    <span class="c1">#neo_sandbox_app = instantiate_neo_sandbox_app()</span>
    <span class="c1">#google_creds = load_google_creds()</span>
    <span class="c1">#sheets_app = instantiate_sheets_app(google_creds.credentials)</span>
    <span class="c1">#drive_app = instantiate_drive_app(google_creds.credentials)</span>
    <span class="c1">#googleAPI = instantiate_google_API()</span>
    <span class="c1">#sparkAPI = instantiate_spark_API()</span>
    <span class="c1">#neoAPI = NeoAPI()</span>
    <span class="c1">#nodified_df = pandas_functions.nodify_dataframe()</span>
    <span class="c1">#test()</span>
    <span class="c1">#google_api = googleServices.GoogleAPI()</span>
    <span class="c1">###neo_model_api = instantiate_neo_model_api()</span>
    <span class="c1">###df_pipeline_dictionary = prepare_data_pipeline()</span>
    <span class="c1">#final_df_dictionary = upload_data_pipeline_to_neo(df_pipeline_dictionary)</span>
    <span class="c1">#for k,v in final_df_dictionary.items():</span>
    <span class="c1">#    cwd = os.getcwd()</span>
    <span class="c1">#    path = str(k) +&#34;Final&#34;</span>
    <span class="c1">#    path = os.sep.join([cwd,path])</span>

     <span class="c1">#   with open(path, &#34;w&#34;) as file:</span>
     <span class="c1">#       v.to_csv(path, index=False)</span>

    <span class="c1">#prepared_dfs = prepare_pandas_df()</span>
    <span class="c1">#pprint(prepared_df)</span>
    <span class="c1">#upload_df_to_db(df = prepared_df, neo_model_api = neo_model_api)</span>

</code></pre></div>]]></content>
			<postid> 195b62a4cb89d78174066484e6330741</postid>
			<author>Justin Napolitano</author>
			<author_name>Justin Napolitano</author_name>
			<author_email>personal.jnapolitano@gmail.com</author_email>
			<author_id>87654367b2fca109e7dc9d3ea8a1ebbaf0bfe374773b148c2c20d278479add99</author_id>			
		</item>
		
		<item>
			<title>Conduct Legal Research with AI: Part 0</title>
			<link>jnapolitano.com/posts/legal-research-part-0/</link>
			<pubDate>Mon, 16 May 2022 13:40:32 +0000</pubDate>
			<guid>jnapolitano.com/posts/legal-research-part-0/</guid>
			<description><![CDATA[Crawl the Library of Congress API to automate your next research project.]]></description>
			<content type="html"><![CDATA[<h1 id="crawling-the-library-of-congress-api">Crawling the Library of Congress API</h1>
<h2 id="introduction">Introduction</h2>
<p>The United States Library of Congress maintains a rest api for developers to crawl their collections.  It is an open source tool that anyone can access in order to conduct research. Check out the documenation at <a href="https://libraryofcongress.github.io/data-exploration/">https://libraryofcongress.github.io/data-exploration/</a>.</p>
<h2 id="creating-a-crawler">Creating a crawler</h2>
<p>I took the approach of writing a generator that produces a search result page object that can be operated upon with each iteration.</p>
<p>The first step is to create a search result page object.</p>
<p>The code below documents the search_result page.  It contains a number of helper functions to convert the nodes within the result to json or graphml.  The code can also be used to generate a networkx in memory graph.</p>
<h3 id="the-search-result-object">The Search Result Object</h3>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="k">class</span> <span class="nc">search_results_page</span><span class="p">():</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">base_url</span> <span class="o">=</span> <span class="s2">&#34;https://www.loc.gov/collections&#34;</span><span class="p">,</span><span class="n">collection</span> <span class="o">=</span> <span class="s2">&#34;united-states-reports&#34;</span><span class="p">,</span><span class="n">json_parameter</span> <span class="o">=</span> <span class="s2">&#34;fo=json&#34;</span><span class="p">,</span><span class="n">results_per_page</span> <span class="o">=</span> <span class="s2">&#34;c=79&#34;</span><span class="p">,</span><span class="n">query_param</span> <span class="o">=</span> <span class="s2">&#34;?&#34;</span><span class="p">,</span><span class="n">page_param</span> <span class="o">=</span><span class="s2">&#34;sp=&#34;</span><span class="p">,</span><span class="n">page_num</span> <span class="o">=</span> <span class="mi">1</span><span class="p">):</span>
        <span class="c1">#pprint(num_columns)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">search_url</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">create_search_url</span><span class="p">(</span><span class="n">base_url</span><span class="p">,</span><span class="n">collection</span><span class="p">,</span><span class="n">json_parameter</span><span class="p">,</span><span class="n">results_per_page</span><span class="p">,</span><span class="n">query_param</span><span class="p">,</span><span class="n">page_param</span><span class="p">,</span><span class="n">page_num</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">request_data</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">response_json</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">response_to_json</span><span class="p">()</span>
        <span class="c1">#self.soup_html = self.html_parse()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">next_url</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_next_url</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">page_num</span> <span class="o">=</span> <span class="n">page_num</span>

    <span class="k">def</span> <span class="nf">to_json</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">file_name</span> <span class="o">=</span> <span class="s1">&#39;result_&#39;</span><span class="p">,</span><span class="n">file_num</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">extension</span> <span class="o">=</span><span class="s2">&#34;.json&#34;</span><span class="p">):</span>
        <span class="n">output_name</span> <span class="o">=</span> <span class="n">file_name</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">file_num</span><span class="p">)</span>
        <span class="n">output_name</span> <span class="o">=</span> <span class="n">output_name</span> <span class="o">+</span> <span class="n">extension</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">output_name</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">outfile</span><span class="p">:</span>
            <span class="n">json</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">response_json</span><span class="p">,</span> <span class="n">outfile</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">to_pandas</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">df</span> <span class="o">=</span> <span class="n">nx</span><span class="o">.</span><span class="n">to_pandas_edgelist</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="p">)</span>
        <span class="k">return</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">to_csv</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">file_name</span> <span class="o">=</span> <span class="s1">&#39;result_&#39;</span><span class="p">,</span><span class="n">file_num</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">extension</span> <span class="o">=</span><span class="s2">&#34;.csv&#34;</span><span class="p">):</span>
        <span class="n">output_name</span> <span class="o">=</span> <span class="n">file_name</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">file_num</span><span class="p">)</span>
        <span class="n">output_name</span> <span class="o">=</span> <span class="n">output_name</span> <span class="o">+</span> <span class="n">extension</span>
        <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">to_pandas</span><span class="p">()</span>
        <span class="n">df</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="n">output_name</span><span class="p">)</span>


    <span class="k">def</span> <span class="nf">write_graphml</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">file_name</span> <span class="o">=</span> <span class="s1">&#39;result_&#39;</span><span class="p">,</span> <span class="n">file_num</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">extension</span> <span class="o">=</span> <span class="s2">&#34;.graphml&#34;</span><span class="p">):</span>
        <span class="n">output_name</span> <span class="o">=</span> <span class="n">file_name</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">file_num</span><span class="p">)</span>
        <span class="n">output_name</span> <span class="o">=</span> <span class="n">output_name</span> <span class="o">+</span> <span class="n">extension</span>
        <span class="n">nx</span><span class="o">.</span><span class="n">write_graphml</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="p">,</span> <span class="n">output_name</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">write_to_file</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">data</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">file_name</span> <span class="o">=</span> <span class="s1">&#39;result_&#39;</span><span class="p">,</span><span class="n">file_num</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">extension</span> <span class="o">=</span> <span class="s2">&#34;.json&#34;</span><span class="p">):</span>
        <span class="n">output_name</span> <span class="o">=</span> <span class="n">file_name</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">file_num</span><span class="p">)</span>
        <span class="n">output_name</span> <span class="o">=</span> <span class="n">output_name</span> <span class="o">+</span> <span class="n">extension</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">output_name</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">outfile</span><span class="p">:</span>
            <span class="n">json</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">outfile</span><span class="p">)</span>


    <span class="k">def</span> <span class="nf">node_gen_2</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">root</span> <span class="o">=</span><span class="s1">&#39;result&#39;</span><span class="p">,</span> <span class="n">node_list</span> <span class="o">=</span> <span class="p">[],</span> <span class="n">edge_list</span> <span class="o">=</span> <span class="p">[],</span> <span class="n">previous_k</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">previous_edge</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">graph</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
        <span class="c1">#root = root </span>
        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">data</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">dict</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">data</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="k">if</span> <span class="n">k</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">k</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">node_list</span><span class="p">:</span>
                    <span class="n">graph</span><span class="o">.</span><span class="n">add_node</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="nb">type</span> <span class="o">=</span> <span class="n">k</span><span class="p">)</span>
                    <span class="c1">#node_list.append((k, {&#39;type&#39; : k}))</span>
                    <span class="c1">#(1, 2, color=&#39;red&#39;, weight=0.84, size=300)\</span>
                    <span class="n">graph</span><span class="o">.</span><span class="n">add_edge</span><span class="p">(</span><span class="n">root</span><span class="p">,</span><span class="n">k</span><span class="p">,</span> <span class="n">relationship</span> <span class="o">=</span> <span class="s2">&#34;of&#34;</span><span class="p">,</span> <span class="nb">type</span> <span class="o">=</span> <span class="s2">&#34;root&#34;</span><span class="p">)</span>
                    <span class="c1">#edge_list.append((root , k, {&#34;relationship&#34; : &#34;of&#34;}, {&#34;type&#34; : &#39;root&#39;}))</span>
                <span class="c1">#pprint(&#39;passing_value&#39;)</span>
                <span class="c1">#save k</span>
                <span class="n">previous_k</span> <span class="o">=</span> <span class="n">k</span>
                <span class="n">previous_edge</span> <span class="o">=</span> <span class="p">(</span><span class="n">root</span> <span class="p">,</span> <span class="n">k</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">node_gen_2</span><span class="p">(</span><span class="n">v</span><span class="p">,</span><span class="n">root</span> <span class="o">=</span> <span class="n">root</span><span class="p">,</span> <span class="n">node_list</span> <span class="o">=</span> <span class="n">node_list</span><span class="p">,</span><span class="n">edge_list</span> <span class="o">=</span> <span class="n">edge_list</span><span class="p">,</span> <span class="n">previous_k</span> <span class="o">=</span> <span class="n">k</span><span class="p">,</span> <span class="n">previous_edge</span> <span class="o">=</span> <span class="n">previous_edge</span><span class="p">,</span> <span class="n">graph</span> <span class="o">=</span> <span class="n">graph</span><span class="p">)</span>

        <span class="k">elif</span> <span class="nb">type</span><span class="p">(</span><span class="n">data</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">list</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">data</span><span class="p">:</span>
                <span class="c1">#pprint(&#39;passing_data&#39;)</span>

                <span class="bp">self</span><span class="o">.</span><span class="n">node_gen_2</span><span class="p">(</span><span class="n">item</span><span class="p">,</span><span class="n">root</span> <span class="o">=</span> <span class="n">root</span><span class="p">,</span> <span class="n">node_list</span> <span class="o">=</span> <span class="n">node_list</span><span class="p">,</span><span class="n">edge_list</span> <span class="o">=</span> <span class="n">edge_list</span><span class="p">,</span><span class="n">previous_k</span> <span class="o">=</span> <span class="n">previous_k</span><span class="p">,</span> <span class="n">previous_edge</span><span class="o">=</span> <span class="n">previous_edge</span><span class="p">,</span> <span class="n">graph</span> <span class="o">=</span> <span class="n">graph</span><span class="p">)</span>
                <span class="c1">#create_edge to k</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="c1">#this item is no longer a dictionary or list</span>
            <span class="n">pprint</span><span class="p">(</span><span class="s1">&#39;appending_data&#39;</span><span class="p">)</span>
            <span class="c1">#create edge to k</span>
            <span class="k">if</span> <span class="n">data</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">graph</span><span class="o">.</span><span class="n">add_node</span><span class="p">(</span><span class="n">data</span><span class="p">,</span><span class="nb">type</span> <span class="o">=</span> <span class="n">data</span><span class="p">)</span>
                <span class="c1">#node_list.append((data, {&#34;type&#34; : data}))</span>
                <span class="n">graph</span><span class="o">.</span><span class="n">add_edge</span><span class="p">(</span><span class="n">previous_k</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">relationship</span> <span class="o">=</span> <span class="s2">&#34;is&#34;</span><span class="p">,</span> <span class="nb">type</span> <span class="o">=</span> <span class="n">previous_k</span><span class="p">)</span>
                <span class="c1">#edge_list.append((previous_k ,data,{&#39;relationship&#39;: &#34;is&#34;}, {&#39;type&#39; : data}))</span>
                <span class="c1">#edge_list.append((root,data))</span>

    <span class="c1">#flatten(hierarchak)_dict)</span>
        <span class="k">return</span> <span class="n">graph</span> 

    
    <span class="k">def</span> <span class="nf">node_runner</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">data</span><span class="p">,</span><span class="n">graph</span><span class="p">):</span>
        
        <span class="n">node_list</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">edge_list</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">data</span><span class="p">:</span>
            <span class="c1">#root = item[&#39;title&#39;]</span>
            <span class="n">graph</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">node_gen_2</span><span class="p">(</span><span class="n">data</span> <span class="o">=</span> <span class="n">item</span><span class="p">,</span> <span class="n">node_list</span> <span class="o">=</span> <span class="n">node_list</span><span class="p">,</span> <span class="n">graph</span> <span class="o">=</span> <span class="n">graph</span><span class="p">)</span>
        <span class="c1">#pprint(edge_list)</span>
        <span class="k">return</span> <span class="n">graph</span>

    <span class="k">def</span> <span class="nf">node_generator</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">root</span> <span class="o">=</span><span class="s1">&#39;title_testing&#39;</span><span class="p">,</span> <span class="n">node_list</span> <span class="o">=</span> <span class="p">[],</span> <span class="n">edge_list</span> <span class="o">=</span> <span class="p">[],</span> <span class="n">previous_k</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">previous_edge</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
        <span class="c1">#pprint(data)</span>
        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">data</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">dict</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">data</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="k">if</span> <span class="n">k</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">k</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">node_list</span><span class="p">:</span>
                    <span class="n">node_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">k</span><span class="p">)</span>
                    <span class="n">edge_list</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">root</span> <span class="p">,</span> <span class="n">k</span><span class="p">))</span>
                <span class="c1">#pprint(&#39;passing_value&#39;)</span>
                <span class="c1">#save k</span>
                <span class="n">previous_k</span> <span class="o">=</span> <span class="n">k</span>
                <span class="n">previous_edge</span> <span class="o">=</span> <span class="p">(</span><span class="n">root</span> <span class="p">,</span> <span class="n">k</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">node_generator</span><span class="p">(</span><span class="n">v</span><span class="p">,</span><span class="n">root</span> <span class="o">=</span> <span class="n">root</span><span class="p">,</span> <span class="n">node_list</span> <span class="o">=</span> <span class="n">node_list</span><span class="p">,</span><span class="n">edge_list</span> <span class="o">=</span> <span class="n">edge_list</span><span class="p">,</span> <span class="n">previous_k</span> <span class="o">=</span> <span class="n">k</span><span class="p">,</span> <span class="n">previous_edge</span> <span class="o">=</span> <span class="n">previous_edge</span><span class="p">)</span>

        <span class="k">elif</span> <span class="nb">type</span><span class="p">(</span><span class="n">data</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">list</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">data</span><span class="p">:</span>
                <span class="c1">#pprint(&#39;passing_data&#39;)</span>

                <span class="bp">self</span><span class="o">.</span><span class="n">node_generator</span><span class="p">(</span><span class="n">item</span><span class="p">,</span><span class="n">root</span> <span class="o">=</span> <span class="n">root</span><span class="p">,</span> <span class="n">node_list</span> <span class="o">=</span> <span class="n">node_list</span><span class="p">,</span><span class="n">edge_list</span> <span class="o">=</span> <span class="n">edge_list</span><span class="p">,</span><span class="n">previous_k</span> <span class="o">=</span> <span class="n">previous_k</span><span class="p">,</span> <span class="n">previous_edge</span><span class="o">=</span> <span class="n">previous_edge</span><span class="p">)</span>
                <span class="c1">#create_edge to k</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="c1">#this item is no longer a dictionary or list</span>
            <span class="n">pprint</span><span class="p">(</span><span class="s1">&#39;appending_data&#39;</span><span class="p">)</span>
            <span class="c1">#create edge to k</span>
            <span class="k">if</span> <span class="n">data</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">node_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
                <span class="n">edge_list</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">previous_k</span> <span class="p">,</span><span class="n">data</span><span class="p">))</span>
                <span class="n">edge_list</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">root</span><span class="p">,</span><span class="n">data</span><span class="p">))</span>

    <span class="c1">#flatten(hierarchak)_dict)</span>
        <span class="k">return</span> <span class="n">node_list</span><span class="p">,</span> <span class="n">edge_list</span> 
        <span class="c1">#self.json_graph = self.create_json_graph()</span>


    <span class="k">def</span> <span class="nf">create_json_graph</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1">#graph = nx.Graph(self.response_json)</span>
        <span class="n">graph</span> <span class="o">=</span> <span class="n">nx</span><span class="o">.</span><span class="n">from_dict_of_dicts</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">response_json</span><span class="p">)</span>
        <span class="c1">#graph = json_graph.node_link_graph(self.response_json)</span>
        <span class="n">nx</span><span class="o">.</span><span class="n">draw</span><span class="p">(</span><span class="n">graph</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">graph</span>
        
        <span class="c1">#self.node_list = self.node_generator`</span>



    <span class="k">def</span> <span class="nf">create_search_result_node</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
     
        <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">response_json_flat</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">k</span><span class="p">,</span><span class="n">v</span> <span class="ow">in</span> <span class="n">item</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="k">if</span> <span class="n">k</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">column_lookup_table</span><span class="p">:</span>
                    <span class="n">column_string</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">colnum_string</span><span class="p">()</span>

                    <span class="bp">self</span><span class="o">.</span><span class="n">column_lookup_table</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">colnum_string</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">num_columns</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">num_columns</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">continue</span>

    <span class="k">def</span> <span class="nf">append_to_data_list</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">rnge</span><span class="p">,</span><span class="n">d</span><span class="p">):</span><span class="c1">#rename to _data_list</span>
        <span class="n">request_body</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;range&#39;</span><span class="p">:</span> <span class="n">rnge</span><span class="p">,</span>
            <span class="s2">&#34;majorDimension&#34;</span><span class="p">:</span> <span class="s2">&#34;COLUMNS&#34;</span><span class="p">,</span>
            <span class="s2">&#34;values&#34;</span><span class="p">:</span> <span class="p">[</span><span class="n">d</span><span class="p">]</span>
        <span class="p">}</span>
        <span class="k">return</span> <span class="n">request_body</span>
        <span class="c1">#data_list.append(request_body_tmp)</span>

    <span class="k">def</span> <span class="nf">map_column_to_range</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">column_key</span><span class="p">):</span>
        
        <span class="n">rnge</span> <span class="o">=</span> <span class="s2">&#34;&#39;Sheet1&#39;&#34;</span> <span class="o">+</span> <span class="s2">&#34;!&#34;</span> <span class="o">+</span> <span class="n">column_key</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">rnge</span>
                

    <span class="k">def</span> <span class="nf">colnum_string</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">num_columns</span><span class="p">):</span>
        <span class="n">string</span> <span class="o">=</span> <span class="s2">&#34;&#34;</span>
        <span class="c1">#pprint(&#34;conlum_string&#34;)</span>
        <span class="c1">#pprint(num_columns)</span>
        <span class="k">while</span> <span class="n">num_columns</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">num_columns</span><span class="p">,</span> <span class="n">remainder</span> <span class="o">=</span> <span class="nb">divmod</span><span class="p">(</span><span class="n">num_columns</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">26</span><span class="p">)</span>
            <span class="n">string</span> <span class="o">=</span> <span class="nb">chr</span><span class="p">(</span><span class="mi">65</span> <span class="o">+</span> <span class="n">remainder</span><span class="p">)</span> <span class="o">+</span> <span class="n">string</span>
            <span class="c1">#pprint(string)</span>
        <span class="k">return</span> <span class="n">string</span>

    <span class="k">def</span> <span class="nf">map_columns_to_lookup_table</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="c1">#print(&#39;first_map_columns_print&#39;)</span>
        <span class="c1">#num_columns_tmp = self.num_columns</span>
        <span class="c1">#pprint(num_columns_tmp)</span>
        <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">response_json_flat</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">item</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                <span class="n">num_columns_tmp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">num_columns</span>
                <span class="k">if</span> <span class="n">k</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">column_lookup_table</span><span class="p">:</span>
                    <span class="c1">#print(&#39;second_map_Columns_print&#39;)</span>
                    <span class="c1">#pprint(num_columns_tmp)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">column_lookup_table</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">colnum_string</span><span class="p">(</span><span class="n">num_columns</span> <span class="o">=</span> <span class="n">num_columns_tmp</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">num_columns</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">num_columns</span> <span class="o">+</span> <span class="mi">1</span>
       
                    <span class="c1">#append range to request... </span>
                    <span class="c1">#append collumn to batch lookup</span>
                

                <span class="k">else</span><span class="p">:</span>
                    <span class="k">continue</span>
    
    <span class="k">def</span> <span class="nf">column_request_list_generator</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">request_list</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">k</span><span class="p">,</span><span class="n">v</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">column_lookup_table</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">rnge</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">map_column_to_range</span><span class="p">(</span><span class="n">k</span><span class="p">)</span>
            <span class="n">request_body</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">append_to_data_list</span><span class="p">(</span><span class="n">rnge</span><span class="p">,</span><span class="n">v</span><span class="p">)</span>
            <span class="c1">#pprint(request_body)</span>
            <span class="n">request_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">request_body</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">request_list</span>





        <span class="c1">#return column_lookup_table</span>

    <span class="k">def</span> <span class="nf">get_next_url</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">response_json</span><span class="p">[</span><span class="s1">&#39;pagination&#39;</span><span class="p">][</span><span class="s1">&#39;next&#39;</span><span class="p">])</span>

    <span class="k">def</span> <span class="nf">create_search_url</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">base_url</span><span class="p">,</span><span class="n">collection</span><span class="p">,</span><span class="n">json_parameter</span><span class="p">,</span><span class="n">results_per_page</span><span class="p">,</span><span class="n">query_param</span><span class="p">,</span><span class="n">page_param</span><span class="p">,</span><span class="n">page_num</span><span class="p">):</span>
        <span class="n">url_sep</span> <span class="o">=</span><span class="s2">&#34;/&#34;</span>
        <span class="n">page_param</span> <span class="o">=</span> <span class="n">page_param</span> <span class="o">+</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">page_num</span><span class="p">))</span>
        <span class="n">query</span> <span class="o">=</span> <span class="s2">&#34;&amp;&#34;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">json_parameter</span><span class="p">,</span><span class="n">results_per_page</span><span class="p">,</span><span class="n">page_param</span><span class="p">])</span>
        <span class="n">query</span> <span class="o">=</span> <span class="n">query_param</span> <span class="o">+</span> <span class="n">query</span>
        <span class="n">search_url</span> <span class="o">=</span> <span class="n">url_sep</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">base_url</span><span class="p">,</span><span class="n">collection</span><span class="p">,</span><span class="n">query</span><span class="p">])</span>
        <span class="c1">#pprint(search_url)</span>
        
        <span class="k">return</span> <span class="n">search_url</span>

    <span class="k">def</span> <span class="nf">say_hello</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">pprint</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">base_url</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">request_data</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">headers</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;User-Agent&#39;</span><span class="p">:</span><span class="s1">&#39;Mozilla/5.0 (Macintosh; Intel Mac OS X 10_11_2) AppleWebKit/601.3.11 (KHTML, like Gecko) Version/9.0.2 Safari/601.3.9&#39;</span><span class="p">,</span>
                    <span class="s1">&#39;Accept-Encoding&#39;</span><span class="p">:</span> <span class="s1">&#39;identity&#39;</span>
                <span class="p">}</span>
        <span class="k">return</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">search_url</span><span class="p">,</span><span class="n">headers</span><span class="o">=</span><span class="n">headers</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">response_to_json</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">response</span><span class="o">.</span><span class="n">json</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">html_parse</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">soup</span><span class="o">=</span><span class="n">BeautifulSoup</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">response</span><span class="o">.</span><span class="n">content</span><span class="p">,</span><span class="s1">&#39;lxml&#39;</span><span class="p">)</span>
        <span class="c1">#pprint(soup)</span>
        <span class="k">return</span> <span class="n">soup</span>

    <span class="k">def</span> <span class="nf">flatten_result</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">flat_result_list</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">response_json</span><span class="p">[</span><span class="s1">&#39;results&#39;</span><span class="p">]:</span>
            <span class="n">flat_json</span> <span class="o">=</span> <span class="n">flatten</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>
            <span class="n">flat_result_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">flat_json</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">flat_result_list</span>

</code></pre></div><h2 id="the-generator">The Generator</h2>
<p>The generator yields a search result page if the pagination link included in the response is valid.</p>
<p>Depending on your use case you could pass the page_num and collection you would like to crawl.</p>
<p>The api is limited to 80 results per minute.  The sleep function limits calls to the desired rate.  The amount of results returned can be passed to the search result page_object.  Review the code above to see which values can be passed.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="k">def</span> <span class="nf">search_result_generator</span><span class="p">(</span><span class="n">condition</span> <span class="o">=</span> <span class="kc">True</span><span class="p">):</span>
    <span class="c1">#column_lookup_table = {}</span>
    <span class="c1">#pprint(num_columns)</span>
    <span class="n">page_num</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="n">column_lookup_table</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">while</span> <span class="n">condition</span> <span class="o">==</span><span class="kc">True</span><span class="p">:</span>
        <span class="c1">#pprint(num_columns)</span>
        <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">61</span><span class="p">)</span>
        <span class="n">search_results_page_object</span> <span class="o">=</span> <span class="n">create_search_results_page_object</span><span class="p">(</span><span class="n">page_num</span> <span class="o">=</span> <span class="n">page_num</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">search_results_page_object</span><span class="o">.</span><span class="n">next_url</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">condition</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="n">page_num</span> <span class="o">=</span> <span class="n">page_num</span> <span class="o">+</span> <span class="mi">1</span>            
            <span class="k">yield</span> <span class="p">(</span><span class="n">search_results_page_object</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">condition</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="k">yield</span> <span class="p">(</span><span class="n">search_results_page_object</span><span class="p">)</span>
</code></pre></div><h2 id="the-runner-function">The Runner Function</h2>
<p>To initiate the crawl simply run the algorithm below.  It writes each result page to json.</p>
<p>As a follow up project, I will post how to integrate the data returned into a neo4j database.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="k">for</span> <span class="n">obj</span> <span class="ow">in</span> <span class="n">search_result_generator</span><span class="p">():</span>   
        <span class="n">page_num</span> <span class="o">=</span> <span class="n">obj</span><span class="o">.</span><span class="n">page_num</span>
        <span class="k">with</span> <span class="n">cd</span><span class="p">(</span><span class="s2">&#34;output_2&#34;</span><span class="p">):</span>
            <span class="c1">#print(&#39;hahaha&#39;)</span>
            <span class="n">obj</span><span class="o">.</span><span class="n">to_json</span><span class="p">(</span><span class="n">file_num</span> <span class="o">=</span> <span class="n">page_num</span><span class="p">)</span>
            <span class="c1">#obj.write_graphml(file_num= page_num)</span>
            <span class="c1">#obj.to_pandas()</span>
            <span class="c1">#obj.write_to_file(data = obj.dict_of_dicts, file_num = page_num)</span>
            <span class="c1">#obj.to_csv()</span>
        <span class="n">write_last_page_num</span><span class="p">(</span><span class="n">page_num</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&#34;</span><span class="si">{}</span><span class="s2"> Search Results Crawled&#34;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">page_num</span><span class="p">))</span>

</code></pre></div><h2 id="putting-everything-together">Putting Everything Together</h2>
<p>The code below is the entire program as it stands.  There is built in functionality to upload the results to a google sheet if that is what you desire using an extension of the google api.   That code can be found at <a href="https://github.com/justin-napolitano/GoogleAPI">https://github.com/justin-napolitano/GoogleAPI</a></p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="c1">#library_of_congress_scraper.py</span>
<span class="kn">from</span> <span class="nn">__future__</span> <span class="kn">import</span> <span class="n">print_function</span>
<span class="kn">from</span> <span class="nn">bs4</span> <span class="kn">import</span> <span class="n">BeautifulSoup</span>
<span class="kn">import</span> <span class="nn">requests</span>
<span class="kn">import</span> <span class="nn">lxml.etree</span> <span class="k">as</span> <span class="nn">etree</span>
<span class="kn">import</span> <span class="nn">xml.etree.ElementTree</span> <span class="k">as</span> <span class="nn">ET</span>
<span class="kn">import</span> <span class="nn">json</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">time</span>
<span class="kn">import</span> <span class="nn">random</span>
<span class="kn">import</span> <span class="nn">math</span>
<span class="kn">from</span> <span class="nn">pprint</span> <span class="kn">import</span> <span class="n">pprint</span>
<span class="c1">#import load_vars as lv</span>
<span class="kn">import</span> <span class="nn">html</span>
<span class="kn">import</span> <span class="nn">yaml</span>
<span class="kn">from</span> <span class="nn">yaml</span> <span class="kn">import</span> <span class="n">Loader</span><span class="p">,</span> <span class="n">Dumper</span>
<span class="kn">import</span> <span class="nn">glob</span>
<span class="kn">import</span> <span class="nn">datetime</span>
<span class="kn">import</span> <span class="nn">os.path</span>
<span class="kn">from</span> <span class="nn">googleapiclient.discovery</span> <span class="kn">import</span> <span class="n">build</span>
<span class="kn">from</span> <span class="nn">google_auth_oauthlib.flow</span> <span class="kn">import</span> <span class="n">InstalledAppFlow</span>
<span class="kn">from</span> <span class="nn">google.auth.transport.requests</span> <span class="kn">import</span> <span class="n">Request</span>
<span class="kn">from</span> <span class="nn">google.oauth2.credentials</span> <span class="kn">import</span> <span class="n">Credentials</span>
<span class="kn">from</span> <span class="nn">google.oauth2</span> <span class="kn">import</span> <span class="n">service_account</span>
<span class="kn">from</span> <span class="nn">googleapiclient.http</span> <span class="kn">import</span> <span class="n">MediaIoBaseDownload</span><span class="p">,</span> <span class="n">MediaFileUpload</span>
<span class="kn">from</span> <span class="nn">flatten_json</span> <span class="kn">import</span> <span class="n">flatten</span>
<span class="kn">import</span> <span class="nn">networkx</span> <span class="k">as</span> <span class="nn">nx</span>
<span class="kn">import</span> <span class="nn">matplotlib</span>
<span class="kn">from</span> <span class="nn">networkx.readwrite</span> <span class="kn">import</span> <span class="n">json_graph</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">tracemalloc</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="c1">#from ratelimiter import RateLimiter</span>


<span class="k">class</span> <span class="nc">cd</span><span class="p">:</span>
    <span class="s2">&#34;&#34;&#34;Context manager for changing the current working directory&#34;&#34;&#34;</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">newPath</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">newPath</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">expanduser</span><span class="p">(</span><span class="n">newPath</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__enter__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">savedPath</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">()</span>
        <span class="n">os</span><span class="o">.</span><span class="n">chdir</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">newPath</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__exit__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">etype</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">traceback</span><span class="p">):</span>
        <span class="n">os</span><span class="o">.</span><span class="n">chdir</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">savedPath</span><span class="p">)</span>

<span class="k">class</span> <span class="nc">search_results_page</span><span class="p">():</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">base_url</span> <span class="o">=</span> <span class="s2">&#34;https://www.loc.gov/collections&#34;</span><span class="p">,</span><span class="n">collection</span> <span class="o">=</span> <span class="s2">&#34;united-states-reports&#34;</span><span class="p">,</span><span class="n">json_parameter</span> <span class="o">=</span> <span class="s2">&#34;fo=json&#34;</span><span class="p">,</span><span class="n">results_per_page</span> <span class="o">=</span> <span class="s2">&#34;c=79&#34;</span><span class="p">,</span><span class="n">query_param</span> <span class="o">=</span> <span class="s2">&#34;?&#34;</span><span class="p">,</span><span class="n">page_param</span> <span class="o">=</span><span class="s2">&#34;sp=&#34;</span><span class="p">,</span><span class="n">page_num</span> <span class="o">=</span> <span class="mi">1</span><span class="p">):</span>
        <span class="c1">#pprint(num_columns)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">search_url</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">create_search_url</span><span class="p">(</span><span class="n">base_url</span><span class="p">,</span><span class="n">collection</span><span class="p">,</span><span class="n">json_parameter</span><span class="p">,</span><span class="n">results_per_page</span><span class="p">,</span><span class="n">query_param</span><span class="p">,</span><span class="n">page_param</span><span class="p">,</span><span class="n">page_num</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">request_data</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">response_json</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">response_to_json</span><span class="p">()</span>
        <span class="c1">#self.soup_html = self.html_parse()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">next_url</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_next_url</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">page_num</span> <span class="o">=</span> <span class="n">page_num</span>

    <span class="k">def</span> <span class="nf">to_json</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">file_name</span> <span class="o">=</span> <span class="s1">&#39;result_&#39;</span><span class="p">,</span><span class="n">file_num</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">extension</span> <span class="o">=</span><span class="s2">&#34;.json&#34;</span><span class="p">):</span>
        <span class="n">output_name</span> <span class="o">=</span> <span class="n">file_name</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">file_num</span><span class="p">)</span>
        <span class="n">output_name</span> <span class="o">=</span> <span class="n">output_name</span> <span class="o">+</span> <span class="n">extension</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">output_name</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">outfile</span><span class="p">:</span>
            <span class="n">json</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">response_json</span><span class="p">,</span> <span class="n">outfile</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">to_pandas</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">df</span> <span class="o">=</span> <span class="n">nx</span><span class="o">.</span><span class="n">to_pandas_edgelist</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="p">)</span>
        <span class="k">return</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">to_csv</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">file_name</span> <span class="o">=</span> <span class="s1">&#39;result_&#39;</span><span class="p">,</span><span class="n">file_num</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">extension</span> <span class="o">=</span><span class="s2">&#34;.csv&#34;</span><span class="p">):</span>
        <span class="n">output_name</span> <span class="o">=</span> <span class="n">file_name</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">file_num</span><span class="p">)</span>
        <span class="n">output_name</span> <span class="o">=</span> <span class="n">output_name</span> <span class="o">+</span> <span class="n">extension</span>
        <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">to_pandas</span><span class="p">()</span>
        <span class="n">df</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="n">output_name</span><span class="p">)</span>


    <span class="k">def</span> <span class="nf">write_graphml</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">file_name</span> <span class="o">=</span> <span class="s1">&#39;result_&#39;</span><span class="p">,</span> <span class="n">file_num</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">extension</span> <span class="o">=</span> <span class="s2">&#34;.graphml&#34;</span><span class="p">):</span>
        <span class="n">output_name</span> <span class="o">=</span> <span class="n">file_name</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">file_num</span><span class="p">)</span>
        <span class="n">output_name</span> <span class="o">=</span> <span class="n">output_name</span> <span class="o">+</span> <span class="n">extension</span>
        <span class="n">nx</span><span class="o">.</span><span class="n">write_graphml</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="p">,</span> <span class="n">output_name</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">write_to_file</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">data</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">file_name</span> <span class="o">=</span> <span class="s1">&#39;result_&#39;</span><span class="p">,</span><span class="n">file_num</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">extension</span> <span class="o">=</span> <span class="s2">&#34;.json&#34;</span><span class="p">):</span>
        <span class="n">output_name</span> <span class="o">=</span> <span class="n">file_name</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">file_num</span><span class="p">)</span>
        <span class="n">output_name</span> <span class="o">=</span> <span class="n">output_name</span> <span class="o">+</span> <span class="n">extension</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">output_name</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">outfile</span><span class="p">:</span>
            <span class="n">json</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">outfile</span><span class="p">)</span>


    <span class="k">def</span> <span class="nf">node_gen_2</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">root</span> <span class="o">=</span><span class="s1">&#39;result&#39;</span><span class="p">,</span> <span class="n">node_list</span> <span class="o">=</span> <span class="p">[],</span> <span class="n">edge_list</span> <span class="o">=</span> <span class="p">[],</span> <span class="n">previous_k</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">previous_edge</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">graph</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
        <span class="c1">#root = root </span>
        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">data</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">dict</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">data</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="k">if</span> <span class="n">k</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">k</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">node_list</span><span class="p">:</span>
                    <span class="n">graph</span><span class="o">.</span><span class="n">add_node</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="nb">type</span> <span class="o">=</span> <span class="n">k</span><span class="p">)</span>
                    <span class="c1">#node_list.append((k, {&#39;type&#39; : k}))</span>
                    <span class="c1">#(1, 2, color=&#39;red&#39;, weight=0.84, size=300)\</span>
                    <span class="n">graph</span><span class="o">.</span><span class="n">add_edge</span><span class="p">(</span><span class="n">root</span><span class="p">,</span><span class="n">k</span><span class="p">,</span> <span class="n">relationship</span> <span class="o">=</span> <span class="s2">&#34;of&#34;</span><span class="p">,</span> <span class="nb">type</span> <span class="o">=</span> <span class="s2">&#34;root&#34;</span><span class="p">)</span>
                    <span class="c1">#edge_list.append((root , k, {&#34;relationship&#34; : &#34;of&#34;}, {&#34;type&#34; : &#39;root&#39;}))</span>
                <span class="c1">#pprint(&#39;passing_value&#39;)</span>
                <span class="c1">#save k</span>
                <span class="n">previous_k</span> <span class="o">=</span> <span class="n">k</span>
                <span class="n">previous_edge</span> <span class="o">=</span> <span class="p">(</span><span class="n">root</span> <span class="p">,</span> <span class="n">k</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">node_gen_2</span><span class="p">(</span><span class="n">v</span><span class="p">,</span><span class="n">root</span> <span class="o">=</span> <span class="n">root</span><span class="p">,</span> <span class="n">node_list</span> <span class="o">=</span> <span class="n">node_list</span><span class="p">,</span><span class="n">edge_list</span> <span class="o">=</span> <span class="n">edge_list</span><span class="p">,</span> <span class="n">previous_k</span> <span class="o">=</span> <span class="n">k</span><span class="p">,</span> <span class="n">previous_edge</span> <span class="o">=</span> <span class="n">previous_edge</span><span class="p">,</span> <span class="n">graph</span> <span class="o">=</span> <span class="n">graph</span><span class="p">)</span>

        <span class="k">elif</span> <span class="nb">type</span><span class="p">(</span><span class="n">data</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">list</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">data</span><span class="p">:</span>
                <span class="c1">#pprint(&#39;passing_data&#39;)</span>

                <span class="bp">self</span><span class="o">.</span><span class="n">node_gen_2</span><span class="p">(</span><span class="n">item</span><span class="p">,</span><span class="n">root</span> <span class="o">=</span> <span class="n">root</span><span class="p">,</span> <span class="n">node_list</span> <span class="o">=</span> <span class="n">node_list</span><span class="p">,</span><span class="n">edge_list</span> <span class="o">=</span> <span class="n">edge_list</span><span class="p">,</span><span class="n">previous_k</span> <span class="o">=</span> <span class="n">previous_k</span><span class="p">,</span> <span class="n">previous_edge</span><span class="o">=</span> <span class="n">previous_edge</span><span class="p">,</span> <span class="n">graph</span> <span class="o">=</span> <span class="n">graph</span><span class="p">)</span>
                <span class="c1">#create_edge to k</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="c1">#this item is no longer a dictionary or list</span>
            <span class="n">pprint</span><span class="p">(</span><span class="s1">&#39;appending_data&#39;</span><span class="p">)</span>
            <span class="c1">#create edge to k</span>
            <span class="k">if</span> <span class="n">data</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">graph</span><span class="o">.</span><span class="n">add_node</span><span class="p">(</span><span class="n">data</span><span class="p">,</span><span class="nb">type</span> <span class="o">=</span> <span class="n">data</span><span class="p">)</span>
                <span class="c1">#node_list.append((data, {&#34;type&#34; : data}))</span>
                <span class="n">graph</span><span class="o">.</span><span class="n">add_edge</span><span class="p">(</span><span class="n">previous_k</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">relationship</span> <span class="o">=</span> <span class="s2">&#34;is&#34;</span><span class="p">,</span> <span class="nb">type</span> <span class="o">=</span> <span class="n">previous_k</span><span class="p">)</span>
                <span class="c1">#edge_list.append((previous_k ,data,{&#39;relationship&#39;: &#34;is&#34;}, {&#39;type&#39; : data}))</span>
                <span class="c1">#edge_list.append((root,data))</span>

    <span class="c1">#flatten(hierarchak)_dict)</span>
        <span class="k">return</span> <span class="n">graph</span> 

    
    <span class="k">def</span> <span class="nf">node_runner</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">data</span><span class="p">,</span><span class="n">graph</span><span class="p">):</span>
        
        <span class="n">node_list</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">edge_list</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">data</span><span class="p">:</span>
            <span class="c1">#root = item[&#39;title&#39;]</span>
            <span class="n">graph</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">node_gen_2</span><span class="p">(</span><span class="n">data</span> <span class="o">=</span> <span class="n">item</span><span class="p">,</span> <span class="n">node_list</span> <span class="o">=</span> <span class="n">node_list</span><span class="p">,</span> <span class="n">graph</span> <span class="o">=</span> <span class="n">graph</span><span class="p">)</span>
        <span class="c1">#pprint(edge_list)</span>
        <span class="k">return</span> <span class="n">graph</span>

    <span class="k">def</span> <span class="nf">node_generator</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">root</span> <span class="o">=</span><span class="s1">&#39;title_testing&#39;</span><span class="p">,</span> <span class="n">node_list</span> <span class="o">=</span> <span class="p">[],</span> <span class="n">edge_list</span> <span class="o">=</span> <span class="p">[],</span> <span class="n">previous_k</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">previous_edge</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
        <span class="c1">#pprint(data)</span>
        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">data</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">dict</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">data</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="k">if</span> <span class="n">k</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">k</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">node_list</span><span class="p">:</span>
                    <span class="n">node_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">k</span><span class="p">)</span>
                    <span class="n">edge_list</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">root</span> <span class="p">,</span> <span class="n">k</span><span class="p">))</span>
                <span class="c1">#pprint(&#39;passing_value&#39;)</span>
                <span class="c1">#save k</span>
                <span class="n">previous_k</span> <span class="o">=</span> <span class="n">k</span>
                <span class="n">previous_edge</span> <span class="o">=</span> <span class="p">(</span><span class="n">root</span> <span class="p">,</span> <span class="n">k</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">node_generator</span><span class="p">(</span><span class="n">v</span><span class="p">,</span><span class="n">root</span> <span class="o">=</span> <span class="n">root</span><span class="p">,</span> <span class="n">node_list</span> <span class="o">=</span> <span class="n">node_list</span><span class="p">,</span><span class="n">edge_list</span> <span class="o">=</span> <span class="n">edge_list</span><span class="p">,</span> <span class="n">previous_k</span> <span class="o">=</span> <span class="n">k</span><span class="p">,</span> <span class="n">previous_edge</span> <span class="o">=</span> <span class="n">previous_edge</span><span class="p">)</span>

        <span class="k">elif</span> <span class="nb">type</span><span class="p">(</span><span class="n">data</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">list</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">data</span><span class="p">:</span>
                <span class="c1">#pprint(&#39;passing_data&#39;)</span>

                <span class="bp">self</span><span class="o">.</span><span class="n">node_generator</span><span class="p">(</span><span class="n">item</span><span class="p">,</span><span class="n">root</span> <span class="o">=</span> <span class="n">root</span><span class="p">,</span> <span class="n">node_list</span> <span class="o">=</span> <span class="n">node_list</span><span class="p">,</span><span class="n">edge_list</span> <span class="o">=</span> <span class="n">edge_list</span><span class="p">,</span><span class="n">previous_k</span> <span class="o">=</span> <span class="n">previous_k</span><span class="p">,</span> <span class="n">previous_edge</span><span class="o">=</span> <span class="n">previous_edge</span><span class="p">)</span>
                <span class="c1">#create_edge to k</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="c1">#this item is no longer a dictionary or list</span>
            <span class="n">pprint</span><span class="p">(</span><span class="s1">&#39;appending_data&#39;</span><span class="p">)</span>
            <span class="c1">#create edge to k</span>
            <span class="k">if</span> <span class="n">data</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">node_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
                <span class="n">edge_list</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">previous_k</span> <span class="p">,</span><span class="n">data</span><span class="p">))</span>
                <span class="n">edge_list</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">root</span><span class="p">,</span><span class="n">data</span><span class="p">))</span>

    <span class="c1">#flatten(hierarchak)_dict)</span>
        <span class="k">return</span> <span class="n">node_list</span><span class="p">,</span> <span class="n">edge_list</span> 
        <span class="c1">#self.json_graph = self.create_json_graph()</span>


    <span class="k">def</span> <span class="nf">create_json_graph</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1">#graph = nx.Graph(self.response_json)</span>
        <span class="n">graph</span> <span class="o">=</span> <span class="n">nx</span><span class="o">.</span><span class="n">from_dict_of_dicts</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">response_json</span><span class="p">)</span>
        <span class="c1">#graph = json_graph.node_link_graph(self.response_json)</span>
        <span class="n">nx</span><span class="o">.</span><span class="n">draw</span><span class="p">(</span><span class="n">graph</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">graph</span>
        
        <span class="c1">#self.node_list = self.node_generator`</span>



    <span class="k">def</span> <span class="nf">create_search_result_node</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
     
        <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">response_json_flat</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">k</span><span class="p">,</span><span class="n">v</span> <span class="ow">in</span> <span class="n">item</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="k">if</span> <span class="n">k</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">column_lookup_table</span><span class="p">:</span>
                    <span class="n">column_string</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">colnum_string</span><span class="p">()</span>

                    <span class="bp">self</span><span class="o">.</span><span class="n">column_lookup_table</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">colnum_string</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">num_columns</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">num_columns</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">continue</span>

    <span class="k">def</span> <span class="nf">append_to_data_list</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">rnge</span><span class="p">,</span><span class="n">d</span><span class="p">):</span><span class="c1">#rename to _data_list</span>
        <span class="n">request_body</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;range&#39;</span><span class="p">:</span> <span class="n">rnge</span><span class="p">,</span>
            <span class="s2">&#34;majorDimension&#34;</span><span class="p">:</span> <span class="s2">&#34;COLUMNS&#34;</span><span class="p">,</span>
            <span class="s2">&#34;values&#34;</span><span class="p">:</span> <span class="p">[</span><span class="n">d</span><span class="p">]</span>
        <span class="p">}</span>
        <span class="k">return</span> <span class="n">request_body</span>
        <span class="c1">#data_list.append(request_body_tmp)</span>

    <span class="k">def</span> <span class="nf">map_column_to_range</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">column_key</span><span class="p">):</span>
        
        <span class="n">rnge</span> <span class="o">=</span> <span class="s2">&#34;&#39;Sheet1&#39;&#34;</span> <span class="o">+</span> <span class="s2">&#34;!&#34;</span> <span class="o">+</span> <span class="n">column_key</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">rnge</span>
                

    <span class="k">def</span> <span class="nf">colnum_string</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">num_columns</span><span class="p">):</span>
        <span class="n">string</span> <span class="o">=</span> <span class="s2">&#34;&#34;</span>
        <span class="c1">#pprint(&#34;conlum_string&#34;)</span>
        <span class="c1">#pprint(num_columns)</span>
        <span class="k">while</span> <span class="n">num_columns</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">num_columns</span><span class="p">,</span> <span class="n">remainder</span> <span class="o">=</span> <span class="nb">divmod</span><span class="p">(</span><span class="n">num_columns</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">26</span><span class="p">)</span>
            <span class="n">string</span> <span class="o">=</span> <span class="nb">chr</span><span class="p">(</span><span class="mi">65</span> <span class="o">+</span> <span class="n">remainder</span><span class="p">)</span> <span class="o">+</span> <span class="n">string</span>
            <span class="c1">#pprint(string)</span>
        <span class="k">return</span> <span class="n">string</span>

    <span class="k">def</span> <span class="nf">map_columns_to_lookup_table</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="c1">#print(&#39;first_map_columns_print&#39;)</span>
        <span class="c1">#num_columns_tmp = self.num_columns</span>
        <span class="c1">#pprint(num_columns_tmp)</span>
        <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">response_json_flat</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">item</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                <span class="n">num_columns_tmp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">num_columns</span>
                <span class="k">if</span> <span class="n">k</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">column_lookup_table</span><span class="p">:</span>
                    <span class="c1">#print(&#39;second_map_Columns_print&#39;)</span>
                    <span class="c1">#pprint(num_columns_tmp)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">column_lookup_table</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">colnum_string</span><span class="p">(</span><span class="n">num_columns</span> <span class="o">=</span> <span class="n">num_columns_tmp</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">num_columns</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">num_columns</span> <span class="o">+</span> <span class="mi">1</span>
       
                    <span class="c1">#append range to request... </span>
                    <span class="c1">#append collumn to batch lookup</span>
                

                <span class="k">else</span><span class="p">:</span>
                    <span class="k">continue</span>
    
    <span class="k">def</span> <span class="nf">column_request_list_generator</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">request_list</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">k</span><span class="p">,</span><span class="n">v</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">column_lookup_table</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">rnge</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">map_column_to_range</span><span class="p">(</span><span class="n">k</span><span class="p">)</span>
            <span class="n">request_body</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">append_to_data_list</span><span class="p">(</span><span class="n">rnge</span><span class="p">,</span><span class="n">v</span><span class="p">)</span>
            <span class="c1">#pprint(request_body)</span>
            <span class="n">request_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">request_body</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">request_list</span>





        <span class="c1">#return column_lookup_table</span>

    <span class="k">def</span> <span class="nf">get_next_url</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">response_json</span><span class="p">[</span><span class="s1">&#39;pagination&#39;</span><span class="p">][</span><span class="s1">&#39;next&#39;</span><span class="p">])</span>

    <span class="k">def</span> <span class="nf">create_search_url</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">base_url</span><span class="p">,</span><span class="n">collection</span><span class="p">,</span><span class="n">json_parameter</span><span class="p">,</span><span class="n">results_per_page</span><span class="p">,</span><span class="n">query_param</span><span class="p">,</span><span class="n">page_param</span><span class="p">,</span><span class="n">page_num</span><span class="p">):</span>
        <span class="n">url_sep</span> <span class="o">=</span><span class="s2">&#34;/&#34;</span>
        <span class="n">page_param</span> <span class="o">=</span> <span class="n">page_param</span> <span class="o">+</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">page_num</span><span class="p">))</span>
        <span class="n">query</span> <span class="o">=</span> <span class="s2">&#34;&amp;&#34;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">json_parameter</span><span class="p">,</span><span class="n">results_per_page</span><span class="p">,</span><span class="n">page_param</span><span class="p">])</span>
        <span class="n">query</span> <span class="o">=</span> <span class="n">query_param</span> <span class="o">+</span> <span class="n">query</span>
        <span class="n">search_url</span> <span class="o">=</span> <span class="n">url_sep</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">base_url</span><span class="p">,</span><span class="n">collection</span><span class="p">,</span><span class="n">query</span><span class="p">])</span>
        <span class="c1">#pprint(search_url)</span>
        
        <span class="k">return</span> <span class="n">search_url</span>

    <span class="k">def</span> <span class="nf">say_hello</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">pprint</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">base_url</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">request_data</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">headers</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;User-Agent&#39;</span><span class="p">:</span><span class="s1">&#39;Mozilla/5.0 (Macintosh; Intel Mac OS X 10_11_2) AppleWebKit/601.3.11 (KHTML, like Gecko) Version/9.0.2 Safari/601.3.9&#39;</span><span class="p">,</span>
                    <span class="s1">&#39;Accept-Encoding&#39;</span><span class="p">:</span> <span class="s1">&#39;identity&#39;</span>
                <span class="p">}</span>
        <span class="k">return</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">search_url</span><span class="p">,</span><span class="n">headers</span><span class="o">=</span><span class="n">headers</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">response_to_json</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">response</span><span class="o">.</span><span class="n">json</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">html_parse</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">soup</span><span class="o">=</span><span class="n">BeautifulSoup</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">response</span><span class="o">.</span><span class="n">content</span><span class="p">,</span><span class="s1">&#39;lxml&#39;</span><span class="p">)</span>
        <span class="c1">#pprint(soup)</span>
        <span class="k">return</span> <span class="n">soup</span>

    <span class="k">def</span> <span class="nf">flatten_result</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">flat_result_list</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">response_json</span><span class="p">[</span><span class="s1">&#39;results&#39;</span><span class="p">]:</span>
            <span class="n">flat_json</span> <span class="o">=</span> <span class="n">flatten</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>
            <span class="n">flat_result_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">flat_json</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">flat_result_list</span>



<span class="k">class</span> <span class="nc">search_result</span><span class="p">():</span>
    
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">dict_item</span><span class="p">,</span><span class="n">num_columns</span><span class="p">,</span><span class="n">colnum_string</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">key</span> <span class="o">=</span> <span class="n">dict_item</span><span class="o">.</span><span class="n">key</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="n">dict_item</span><span class="o">.</span><span class="n">value</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">column_string</span> <span class="o">=</span> <span class="n">colnum_string</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">index</span> <span class="o">=</span> <span class="n">num_columns</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">range</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">create_column_range_string</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">request_body</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">create_column_request</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">create_column_request</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">request_body</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;range&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">range</span><span class="p">,</span>
            <span class="s2">&#34;majorDimension&#34;</span><span class="p">:</span> <span class="s2">&#34;COLUMNS&#34;</span><span class="p">,</span>
            <span class="s2">&#34;values&#34;</span><span class="p">:</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">value</span><span class="p">]</span>
        <span class="p">}</span>
        <span class="k">return</span> <span class="n">request_body</span>

    
    <span class="k">def</span> <span class="nf">create_column_range_string</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="n">rnge</span> <span class="o">=</span> <span class="s2">&#34;&#39;Sheet1&#39;&#34;</span> <span class="o">+</span> <span class="s2">&#34;!&#34;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">column_string</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">rnge</span>
    <span class="k">def</span> <span class="nf">colnum_string</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">num_columns</span><span class="p">):</span>
        <span class="n">string</span> <span class="o">=</span> <span class="s2">&#34;&#34;</span>
        <span class="k">while</span> <span class="n">num_columns</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">num_columns</span><span class="p">,</span> <span class="n">remainder</span> <span class="o">=</span> <span class="nb">divmod</span><span class="p">(</span><span class="n">num_columns</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">26</span><span class="p">)</span>
            <span class="n">string</span> <span class="o">=</span> <span class="nb">chr</span><span class="p">(</span><span class="mi">65</span> <span class="o">+</span> <span class="n">remainder</span><span class="p">)</span> <span class="o">+</span> <span class="n">string</span>
        <span class="k">return</span> <span class="n">string</span>

<span class="k">class</span> <span class="nc">google_drive</span><span class="p">:</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">creds</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">service</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_drive_service</span><span class="p">(</span><span class="n">creds</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">test</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">pprint</span><span class="p">(</span><span class="s2">&#34;hello I exist&#34;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">get_drive_service</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">creds</span><span class="p">):</span>
        <span class="s2">&#34;&#34;&#34;Shows basic usage of the Drive v3 API.
</span><span class="s2">        Prints the names and ids of the first 10 files the user has access to.
</span><span class="s2">        &#34;&#34;&#34;</span>
        <span class="n">SCOPES</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="c1">#creds = None</span>
        <span class="c1"># The file token.json stores the user&#39;s access and refresh tokens, and is</span>
        <span class="c1"># created automatically when the authorization flow completes for the first</span>
        <span class="c1"># time.</span>

        <span class="n">service</span> <span class="o">=</span> <span class="n">build</span><span class="p">(</span><span class="s1">&#39;drive&#39;</span><span class="p">,</span> <span class="s1">&#39;v3&#39;</span><span class="p">,</span> <span class="n">credentials</span><span class="o">=</span><span class="n">creds</span><span class="p">)</span>

        <span class="c1"># Call the Drive v3 API</span>
        <span class="n">results</span> <span class="o">=</span> <span class="n">service</span><span class="o">.</span><span class="n">files</span><span class="p">()</span><span class="o">.</span><span class="n">list</span><span class="p">(</span>
            <span class="n">pageSize</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">fields</span><span class="o">=</span><span class="s2">&#34;nextPageToken, files(id, name)&#34;</span><span class="p">)</span><span class="o">.</span><span class="n">execute</span><span class="p">()</span>
        <span class="n">items</span> <span class="o">=</span> <span class="n">results</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;files&#39;</span><span class="p">,</span> <span class="p">[])</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">items</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;No files found.&#39;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Files:&#39;</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">items</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="sa">u</span><span class="s1">&#39;</span><span class="si">{0}</span><span class="s1"> (</span><span class="si">{1}</span><span class="s1">)&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">item</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">],</span> <span class="n">item</span><span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">]))</span>

        <span class="k">return</span> <span class="n">service</span>
    
    

    <span class="k">def</span> <span class="nf">create_folder</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">title</span><span class="p">):</span>
        <span class="n">drive_service</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">service</span>
        <span class="n">file_metadata</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;</span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">title</span><span class="p">),</span>
            <span class="s1">&#39;mimeType&#39;</span><span class="p">:</span> <span class="s1">&#39;application/vnd.google-apps.folder&#39;</span>
        <span class="p">}</span>
        <span class="n">file</span> <span class="o">=</span> <span class="n">drive_service</span><span class="o">.</span><span class="n">files</span><span class="p">()</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">body</span><span class="o">=</span><span class="n">file_metadata</span><span class="p">,</span>
                                            <span class="n">fields</span><span class="o">=</span><span class="s1">&#39;id&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">execute</span><span class="p">()</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Folder ID: </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">file</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;id&#39;</span><span class="p">))</span>



    <span class="k">def</span> <span class="nf">add_spreadsheet_to_folder</span><span class="p">(</span><span class="bp">self</span> <span class="p">,</span><span class="n">folder_id</span><span class="p">,</span><span class="n">title</span><span class="p">):</span>
        <span class="n">drive_service</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">service</span>
    
        <span class="n">file_metadata</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;</span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">title</span><span class="p">),</span>
        <span class="s1">&#39;parents&#39;</span><span class="p">:</span> <span class="p">[</span><span class="n">folder_id</span><span class="p">],</span>
        <span class="s1">&#39;mimeType&#39;</span><span class="p">:</span> <span class="s1">&#39;application/vnd.google-apps.spreadsheet&#39;</span><span class="p">,</span>
        <span class="p">}</span>

        <span class="n">res</span> <span class="o">=</span> <span class="n">drive_service</span><span class="o">.</span><span class="n">files</span><span class="p">()</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">body</span><span class="o">=</span><span class="n">file_metadata</span><span class="p">)</span><span class="o">.</span><span class="n">execute</span><span class="p">()</span>
        <span class="c1">#print(res)</span>

        <span class="k">return</span> <span class="n">res</span>

<span class="k">class</span> <span class="nc">google_sheet</span><span class="p">():</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">creds</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">service</span> <span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">get_sheet_service</span><span class="p">(</span><span class="n">creds</span><span class="p">)</span>


    <span class="k">def</span> <span class="nf">get_sheet_service</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">creds</span><span class="p">):</span>
        <span class="n">service</span> <span class="o">=</span> <span class="n">build</span><span class="p">(</span><span class="s1">&#39;sheets&#39;</span><span class="p">,</span> <span class="s1">&#39;v4&#39;</span><span class="p">,</span> <span class="n">credentials</span><span class="o">=</span><span class="n">creds</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">service</span><span class="o">.</span><span class="n">spreadsheets</span><span class="p">()</span>

<span class="k">class</span> <span class="nc">google_creds</span><span class="p">():</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">creds_path</span><span class="p">):</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">creds</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_creds</span><span class="p">(</span><span class="n">creds_path</span><span class="p">)</span>
   
    <span class="k">def</span> <span class="nf">get_creds</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">creds_path</span><span class="p">):</span>

        <span class="n">creds</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="c1"># The file token.json stores the user&#39;s access and refresh tokens, and is</span>
        <span class="c1"># created automatically when the authorization flow completes for the first</span>
        <span class="c1"># time.</span>
        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="s1">&#39;token.json&#39;</span><span class="p">):</span>
            <span class="n">creds</span> <span class="o">=</span> <span class="n">Credentials</span><span class="o">.</span><span class="n">from_authorized_user_file</span><span class="p">(</span><span class="s1">&#39;token.json&#39;</span><span class="p">,</span> <span class="n">SCOPES</span><span class="p">)</span>
        <span class="c1"># If there are no (valid) credentials available, let the user log in.</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">creds</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">creds</span><span class="o">.</span><span class="n">valid</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">creds</span> <span class="ow">and</span> <span class="n">creds</span><span class="o">.</span><span class="n">expired</span> <span class="ow">and</span> <span class="n">creds</span><span class="o">.</span><span class="n">refresh_token</span><span class="p">:</span>
                <span class="n">creds</span><span class="o">.</span><span class="n">refresh</span><span class="p">(</span><span class="n">Request</span><span class="p">())</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&#34;no creds&#34;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">creds</span> <span class="o">=</span> <span class="n">service_account</span><span class="o">.</span><span class="n">Credentials</span><span class="o">.</span><span class="n">from_service_account_file</span><span class="p">(</span><span class="n">creds_path</span><span class="p">)</span>
                <span class="c1">#creds = ServiceAccountCredentials.from_json_keyfile_name(&#39;add_json_file_here.json&#39;, SCOPES)</span>
                <span class="c1">#flow = InstalledAppFlow.from_client_secrets_file(</span>
                <span class="c1">#    &#39;credentials.json&#39;, SCOPES)</span>
                <span class="c1">#creds = flow.run_local_server(port=0)</span>
            <span class="c1"># Save the credentials for the next run</span>
            <span class="c1">#with open(&#39;token.json&#39;, &#39;w&#39;) as token:</span>
            <span class="c1">#    token.write(creds.to_json())</span>
        <span class="k">return</span> <span class="n">creds</span>

<span class="k">class</span> <span class="nc">config</span><span class="p">():</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">file_path</span><span class="p">):</span>
        <span class="c1">#self.yaml_stream = file(&#34;config.yaml&#34;, &#39;r&#39;)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">load_config</span><span class="p">(</span><span class="n">file_path</span><span class="p">)</span>


    <span class="k">def</span> <span class="nf">load_config</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">file_path</span><span class="p">):</span>
        <span class="c1">#print(&#34;test&#34;)</span>
        <span class="n">stream</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">file_path</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">yaml</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">stream</span><span class="p">,</span><span class="n">Loader</span> <span class="o">=</span> <span class="n">Loader</span><span class="p">)</span>
        <span class="c1">#pprint(data)</span>
        <span class="k">return</span> <span class="n">data</span>

<span class="k">def</span> <span class="nf">create_google_credentials_object</span><span class="p">(</span><span class="n">creds_path</span> <span class="o">=</span> <span class="s1">&#39;credentials.json&#39;</span><span class="p">):</span>
    <span class="n">google_credentials_object</span> <span class="o">=</span> <span class="n">google_creds</span><span class="p">(</span><span class="n">creds_path</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">google_credentials_object</span>
    
<span class="k">def</span> <span class="nf">create_config_object</span><span class="p">(</span><span class="n">file_path</span> <span class="o">=</span> <span class="s1">&#39;config.yaml&#39;</span><span class="p">):</span>
    <span class="n">config_object</span> <span class="o">=</span> <span class="n">config</span><span class="p">(</span><span class="n">file_path</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">config_object</span>


<span class="k">def</span> <span class="nf">search_result_generator</span><span class="p">(</span><span class="n">condition</span> <span class="o">=</span> <span class="kc">True</span><span class="p">):</span>
    <span class="c1">#column_lookup_table = {}</span>
    <span class="c1">#pprint(num_columns)</span>
    <span class="n">page_num</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="n">column_lookup_table</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">while</span> <span class="n">condition</span> <span class="o">==</span><span class="kc">True</span><span class="p">:</span>
        <span class="c1">#pprint(num_columns)</span>
        <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">61</span><span class="p">)</span>
        <span class="n">search_results_page_object</span> <span class="o">=</span> <span class="n">create_search_results_page_object</span><span class="p">(</span><span class="n">page_num</span> <span class="o">=</span> <span class="n">page_num</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">search_results_page_object</span><span class="o">.</span><span class="n">next_url</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">condition</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="n">page_num</span> <span class="o">=</span> <span class="n">page_num</span> <span class="o">+</span> <span class="mi">1</span>            
            <span class="k">yield</span> <span class="p">(</span><span class="n">search_results_page_object</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">condition</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="k">yield</span> <span class="p">(</span><span class="n">search_results_page_object</span><span class="p">)</span>
        
<span class="k">def</span> <span class="nf">create_search_results_page_object</span><span class="p">(</span><span class="n">base_url</span> <span class="o">=</span> <span class="s2">&#34;https://www.loc.gov/collections&#34;</span><span class="p">,</span><span class="n">collection</span> <span class="o">=</span> <span class="s2">&#34;united-states-reports&#34;</span><span class="p">,</span><span class="n">json_parameter</span> <span class="o">=</span> <span class="s2">&#34;fo=json&#34;</span><span class="p">,</span><span class="n">results_per_page</span> <span class="o">=</span> <span class="s2">&#34;c=70&#34;</span><span class="p">,</span><span class="n">query_param</span> <span class="o">=</span> <span class="s2">&#34;?&#34;</span><span class="p">,</span><span class="n">page_param</span> <span class="o">=</span><span class="s2">&#34;sp=&#34;</span><span class="p">,</span><span class="n">page_num</span> <span class="o">=</span> <span class="mi">1</span><span class="p">):</span>
    <span class="c1">#search = search_results(base_url,collection,json_parameter,results_per_page,query_param,page_param,page_num)</span>
    <span class="c1">#pprint(search.search_url)</span>
    <span class="c1">#pprint(num_columns)</span>
    <span class="k">return</span> <span class="n">search_results_page</span><span class="p">(</span><span class="n">base_url</span><span class="p">,</span><span class="n">collection</span><span class="p">,</span><span class="n">json_parameter</span><span class="p">,</span><span class="n">results_per_page</span><span class="p">,</span><span class="n">query_param</span><span class="p">,</span><span class="n">page_param</span><span class="p">,</span><span class="n">page_num</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">create_google_drive_object</span><span class="p">(</span><span class="n">google_creds</span><span class="p">):</span>
    <span class="n">drive_service_object</span> <span class="o">=</span> <span class="n">google_drive</span><span class="p">(</span><span class="n">google_creds</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">drive_service_object</span>

<span class="k">def</span> <span class="nf">create_google_sheet_object</span><span class="p">(</span><span class="n">google_creds</span><span class="p">):</span>
    <span class="n">sheet_service_object</span> <span class="o">=</span> <span class="n">google_sheet</span><span class="p">(</span><span class="n">google_creds</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">sheet_service_object</span>

<span class="k">def</span> <span class="nf">create_new_google_sheet</span><span class="p">(</span><span class="n">google_drive_object</span><span class="p">,</span><span class="n">folder_id</span><span class="p">,</span><span class="n">title</span><span class="p">):</span>
    <span class="n">sheet_meta_data</span> <span class="o">=</span> <span class="n">google_drive_object</span><span class="o">.</span><span class="n">add_spreadsheet_to_folder</span><span class="p">(</span><span class="n">folder_id</span><span class="p">,</span> <span class="n">title</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">sheet_meta_data</span>

<span class="k">def</span> <span class="nf">flatten_result</span><span class="p">(</span><span class="n">result_json</span><span class="p">):</span>
    <span class="n">flat_json</span> <span class="o">=</span> <span class="n">flatten</span><span class="p">(</span><span class="n">result_json</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">flat_json</span>

<span class="k">def</span> <span class="nf">write_last_page_num</span><span class="p">(</span><span class="n">page_num</span><span class="p">):</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;last_page_num.txt&#39;</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
        <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">page_num</span><span class="p">))</span>

<span class="k">def</span> <span class="nf">main</span><span class="p">():</span>
    <span class="n">tracemalloc</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>
    <span class="c1">#rate_limiter = RateLimiter(max_calls=1, period=60)</span>
    <span class="c1">#cd to output</span>
    <span class="c1">#result = create_search_results_page_object()</span>
    <span class="c1">#with cd(&#34;output&#34;):</span>
    <span class="c1">#    result.write_to_file(data = result.dict_of_dicts, file_num = 1)</span>

    <span class="k">for</span> <span class="n">obj</span> <span class="ow">in</span> <span class="n">search_result_generator</span><span class="p">():</span>   
        <span class="n">page_num</span> <span class="o">=</span> <span class="n">obj</span><span class="o">.</span><span class="n">page_num</span>
        <span class="k">with</span> <span class="n">cd</span><span class="p">(</span><span class="s2">&#34;output_2&#34;</span><span class="p">):</span>
            <span class="c1">#print(&#39;hahaha&#39;)</span>
            <span class="n">obj</span><span class="o">.</span><span class="n">to_json</span><span class="p">(</span><span class="n">file_num</span> <span class="o">=</span> <span class="n">page_num</span><span class="p">)</span>
            <span class="c1">#obj.write_graphml(file_num= page_num)</span>
            <span class="c1">#obj.to_pandas()</span>
            <span class="c1">#obj.write_to_file(data = obj.dict_of_dicts, file_num = page_num)</span>
            <span class="c1">#obj.to_csv()</span>
        <span class="n">write_last_page_num</span><span class="p">(</span><span class="n">page_num</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&#34;</span><span class="si">{}</span><span class="s2"> Search Results Crawled&#34;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">page_num</span><span class="p">))</span>


    
    <span class="n">snapshot</span> <span class="o">=</span> <span class="n">tracemalloc</span><span class="o">.</span><span class="n">take_snapshot</span><span class="p">()</span>
    <span class="n">top_stats</span> <span class="o">=</span> <span class="n">snapshot</span><span class="o">.</span><span class="n">statistics</span><span class="p">(</span><span class="s1">&#39;lineno&#39;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&#34;[ Top 10 ]&#34;</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">stat</span> <span class="ow">in</span> <span class="n">top_stats</span><span class="p">[:</span><span class="mi">10</span><span class="p">]:</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">stat</span><span class="p">)</span>


<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&#34;__main__&#34;</span><span class="p">:</span>
    <span class="n">main</span><span class="p">()</span>

        
        

    
</code></pre></div>]]></content>
			<postid> 4be1e9ba594e3327f7e5a515c1f03950</postid>
			<author>Justin Napolitano</author>
			<author_name>Justin Napolitano</author_name>
			<author_email>personal.jnapolitano@gmail.com</author_email>
			<author_id>87654367b2fca109e7dc9d3ea8a1ebbaf0bfe374773b148c2c20d278479add99</author_id>			
		</item>
		
		<item>
			<title>Feasibility of Transatlantic Carbon Shipping</title>
			<link>jnapolitano.com/posts/feasibility_study_shipping_carbon/</link>
			<pubDate>Sat, 07 May 2022 18:40:32 +0000</pubDate>
			<guid>jnapolitano.com/posts/feasibility_study_shipping_carbon/</guid>
			<description><![CDATA[A feasibility study of shipping carbon from Europe to the United States]]></description>
			<content type="html"><![CDATA[<h1 id="feasibility-of-shipping-carbon-across-the-atlantic">Feasibility of Shipping Carbon Across the Atlantic</h1>
<h2 id="methodology">Methodology</h2>
<p>Please review the my <a href="https://blog.jnapolitano.io/carbon-shipping-projections/">previous post</a> which details the design of my model.</p>
<p>The major difference in this report is the sampling of the mean price per voyage.</p>
<p>The conversion error has been corrected.</p>
<h2 id="findings">Findings</h2>
<h3 id="distance-of-transport">Distance of Transport</h3>
<p>The standard deviation in mean price per voyage was found to be less than 0.  This suggests that the distance of travel within Europe is marginal.  The major obstacle is crossing the Atlantic to access the Gulf of Mexico.  It is possible that an import/export port located in the Chesapeake, New England, Willmington, or Savannah could reduce the cost of navigating through the Caribbean to access Gulf based ports.</p>
<p>This would present a secondary problem piping the co2 to the interior of the Country to access the spent wells located in the Rust Belt.</p>
<h3 id="price-of-transport">Price of Transport</h3>
<p>The price of transport is fixed at $12.00 USD per 100 km per tonne as suggested by this <a href="https://ieaghg.org/docs/General_Docs/Reports/PH4-30%20Ship%20Transport.pdf">source</a>.  A rough estimate for the total cost per tonne from London to Houston is about USD $936.00. For reference the cost to transport standard freight from China to the United States ranges from $5,000 to $8,000 USD in total per tonne; or $5.00 to $8.00 USD per kilo in total.</p>
<h3 id="industrial-applications">Industrial Applications</h3>
<p>Another study must be completed to calculate value of super critical CO2 to industrial applications in order to attempt to justify shipping CO2 such large distances.  Shipping large quantities of CO2 to  store is most likely unreasonable, however, at only about $316,665 USD average cost per voyage it is a reasonable figure if proper incentives are in place.</p>
<h3 id="carbon-storage">Carbon Storage</h3>
<p>Based on this model, it is somewhat reasonable to transport CO2, especially if the US incentivises companies that do so.  Nonetheless, at $50-$60 carbon tax credits per tonne captured (verify this data), it would be unfeasible to account for the estimated 936 per tonne cost of shipping across the Atlantic under current programs.</p>
<h2 id="limitations-of-the-model">Limitations of the Model</h2>
<h3 id="accounting-for-the-return-trip-to-port">Accounting for the Return Trip to Port</h3>
<p>It is important to note that I did not account for the differential costs for the return trip to a european port.  Though, the cost of shipping per ton was fixed at 12.00 USD, doubling distance of travel may double pricing. That said, it would be unlikely for ships to return to port empty. I would expect tankers to be refilled with LNG for return.  Nonetheless, this is a slight methodological issue that should be improved upon.</p>
<h3 id="cost-to-transport">Cost to Transport</h3>
<p>The cost to transport per 100 km is fixed at 12.00 USD as suggested by this <a href="https://ieaghg.org/docs/General_Docs/Reports/PH4-30%20Ship%20Transport.pdf">source</a>.  It accounts for the cost of liquification, shipping costs, and port fees.  The source however, was published in 2004.  The costs may have been reduced by technological advance and demand for super critical CO2.</p>
<h3 id="volumes-of-transport">Volumes of Transport</h3>
<p>I simply converted the volumes of standard LNG ships to liquifed CO2.  There may be data available for tankers dedicated to carbon, but I was not aware of any when performing this analysis.  Tankers may also not completely dedicate their capacity to CO2.  Armed with a proper probability distribution, I could improve the model by randomly choosing volumes based on historical data.</p>
<h2 id="conclusion">Conclusion</h2>
<p>It is unlikely that CO2 will be shipped to the United States simply for storage unless companies are incentivized to do so. A transatlantic trade may develop, but I would assume in order to meet demands for the industrial applications of super critical CO2.</p>
<h2 id="mean-voyage-data-analysis">Mean Voyage Data Analysis</h2>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="n">mean_price_per_cycle_df</span><span class="o">.</span><span class="n">describe</span><span class="p">()</span>
</code></pre></div><!-- raw HTML omitted -->
<pre><code>.dataframe tbody tr th {
    vertical-align: top;
}

.dataframe thead th {
    text-align: right;
}
</code></pre>
<p><!-- raw HTML omitted --></p>
<!-- raw HTML omitted -->
<h3 id="calculating-the-confidence-interval-for-mean-voyage">Calculating the Confidence Interval For Mean Voyage</h3>
<p>The data is nearly normal.  I could test for normality, but that would be beyond the scope of this analysis.  Also, by design the Monte Carlo model should produce a normal distribution with sufficient samples.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python">
<span class="n">st</span><span class="o">.</span><span class="n">norm</span><span class="o">.</span><span class="n">interval</span><span class="p">(</span><span class="n">alpha</span><span class="o">=</span><span class="mf">0.90</span><span class="p">,</span> <span class="n">loc</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">mean_price_per_cycle_df</span><span class="p">[</span><span class="s1">&#39;Voyage Cost USD&#39;</span><span class="p">]),</span> <span class="n">scale</span><span class="o">=</span><span class="n">st</span><span class="o">.</span><span class="n">sem</span><span class="p">(</span><span class="n">mean_price_per_cycle_df</span><span class="p">[</span><span class="s1">&#39;Voyage Cost USD&#39;</span><span class="p">]))</span>
</code></pre></div><pre><code>(316665.2057796428, 316665.2057796428)
</code></pre>
<p>It is safe to assume that 90 percent of the time we would see an annual cost 316,665 dollars USD with the assumptions of the model taken into account.  As the price per 100 km is fixed, the standard deviations is minimal.  The distances as well to port seem to be fairly consistent.  The cost of transport through Europe is minimal.</p>
<h3 id="histogram-of-mean-voyage-price-samples">Histogram of Mean Voyage Price Samples</h3>
<p>The price does not deviate.  It is so concentrated in fact, that I worry that the model is not correctly randomizing European ports of origin.  If the model is operating correctly, then it is apparent that the Atlantic is the only barrier to trade.  Partners such as the UK, France, Portugal, The Netherlands, Spain, or any other nation relatively close to the United States are equally unlikely.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="n">mean_price_per_cycle_df</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">grid</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">bins</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span> <span class="n">rwidth</span><span class="o">=</span><span class="mf">0.9</span><span class="p">,</span>
                   <span class="n">color</span><span class="o">=</span><span class="s1">&#39;#607c8e&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Mean Price Distribution Per Voyage&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Mean Voyage Price USD&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Frequency&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="s1">&#39;y&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.75</span><span class="p">)</span>
</code></pre></div><p><img src="shipping_carbon_feasibility_files/shipping_carbon_feasibility_8_0.png" alt="png"></p>
<h2 id="annual-data-analysis">Annual Data Analysis</h2>
<p>This is a reprint of the findings from <a href="https://blog.jnapolitano.io/carbon-shipping-projections/">my previous report</a></p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="n">annual_price_samples_df</span><span class="o">.</span><span class="n">describe</span><span class="p">()</span>
</code></pre></div><!-- raw HTML omitted -->
<pre><code>.dataframe tbody tr th {
    vertical-align: top;
}

.dataframe thead th {
    text-align: right;
}
</code></pre>
<p><!-- raw HTML omitted --></p>
<!-- raw HTML omitted -->
<h2 id="calculating-the-confidence-interval">Calculating the Confidence Interval</h2>
<p>The data is nearly normal.  I could test for normality, but that would be beyond the scope of this analysis.  Also, by design the Monte Carlo model should produce a normal distribution with sufficient samples.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python">
<span class="n">st</span><span class="o">.</span><span class="n">norm</span><span class="o">.</span><span class="n">interval</span><span class="p">(</span><span class="n">alpha</span><span class="o">=</span><span class="mf">0.90</span><span class="p">,</span> <span class="n">loc</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">annual_price_samples_df</span><span class="p">[</span><span class="s1">&#39;cost_in_usd&#39;</span><span class="p">]),</span> <span class="n">scale</span><span class="o">=</span><span class="n">st</span><span class="o">.</span><span class="n">sem</span><span class="p">(</span><span class="n">annual_price_samples_df</span><span class="p">[</span><span class="s1">&#39;cost_in_usd&#39;</span><span class="p">]))</span>
</code></pre></div><pre><code>(57355047.61667279, 57525821.6547037)
</code></pre>
<p>It is safe to assume that 90 percent of the time we would see an annual cost of 57.36 to 57.52 million dollars USD with the assumptions of the model taken into account.</p>
<h3 id="histogram-of-annual-price-distribution">Histogram of Annual Price Distribution</h3>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="n">annual_price_samples_df</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">grid</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">bins</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span> <span class="n">rwidth</span><span class="o">=</span><span class="mf">0.9</span><span class="p">,</span>
                   <span class="n">color</span><span class="o">=</span><span class="s1">&#39;#607c8e&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Annual Price Distribution for Shipping Carbon&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Annual Price in USD&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Frequency&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="s1">&#39;y&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.75</span><span class="p">)</span>
</code></pre></div><p><img src="shipping_carbon_feasibility_files/shipping_carbon_feasibility_15_0.png" alt="png"></p>
<h2 id="data-imports-and-manipulation">Data Imports and Manipulation</h2>
<h3 id="the-shipping-dataframe">The Shipping Dataframe</h3>
<p>The shipping dataframe is the basis of the simulation.  It is used to tabulate total cost and to record the values of variables.</p>
<h4 id="capacity-distribution-and-number-of-ships-calculation">Capacity Distribution and Number of Ships Calculation</h4>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="c1"># Capacity range</span>
<span class="c1"># 40,000 m3 71,500 to 210,000</span>

<span class="c1">#Susanna Dorigoni, Luigi Mazzei, Federico Pontoni, and Antonio Sileo</span>
<span class="c1">#IEFE – Centre for Research on Energy and Environmental Economics and Policy,</span>
<span class="c1">#Università Bocconi, Milan, Italy</span>

<span class="c1"># I&#39;m sure a better report is available but this is a start</span>
<span class="c1"># cubic meters unit</span>

<span class="c1">### a rough estimate of global suplly dedicated to co2 shipping</span>

<span class="c1"># I will probably need a better metric but this is a good start that can be modified later when necessary</span>

<span class="n">ships</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="mi">63</span><span class="o">*</span><span class="mf">.25</span><span class="p">)</span>
<span class="n">ships</span>


<span class="n">conversion_factor</span> <span class="o">=</span> <span class="mf">2.21</span><span class="o">/</span><span class="mf">2.65</span>
<span class="n">conversion_factor</span>

<span class="n">lower_bound</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="mi">40000</span> <span class="o">*</span> <span class="n">conversion_factor</span><span class="p">)</span>
<span class="n">upper_bound</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="mi">210000</span> <span class="o">*</span> <span class="n">conversion_factor</span><span class="p">)</span>

<span class="n">median</span> <span class="o">=</span> <span class="mi">137564</span> <span class="o">*</span> <span class="n">conversion_factor</span>
<span class="n">standard_dev</span> <span class="o">=</span> <span class="mf">6.63</span> <span class="o">*</span> <span class="n">conversion_factor</span>  <span class="c1">#file:///Users/jnapolitano/Downloads/LNG_Shipping_a_Descriptive_Analysis.pdf</span>

<span class="n">cap_range</span> <span class="o">=</span> <span class="nb">range</span><span class="p">(</span><span class="n">lower_bound</span><span class="p">,</span> <span class="n">upper_bound</span><span class="p">)</span>

<span class="n">cap_distribution</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">normal</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="n">median</span> <span class="p">,</span> <span class="n">scale</span><span class="o">=</span><span class="n">standard_dev</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="n">ships</span><span class="p">)</span>


</code></pre></div><h4 id="the-shipping-df">The Shipping Df</h4>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="n">shipping_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">cap_distribution</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;co2_capacity_cubic_meters&#39;</span><span class="p">])</span>
<span class="n">shipping_df</span><span class="p">[</span><span class="s1">&#39;days_to_port&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
<span class="n">shipping_df</span><span class="p">[</span><span class="s1">&#39;europe_port&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
<span class="n">shipping_df</span><span class="p">[</span><span class="s2">&#34;us_port&#34;</span><span class="p">]</span> <span class="o">=</span><span class="s1">&#39;&#39;</span>
<span class="n">shipping_df</span><span class="p">[</span><span class="s1">&#39;distance&#39;</span><span class="p">]</span> <span class="o">=</span><span class="s1">&#39;&#39;</span>
<span class="n">shipping_df</span><span class="p">[</span><span class="s1">&#39;price&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
<span class="n">shipping_df</span><span class="p">[</span><span class="s1">&#39;cost_per_day&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
<span class="n">shipping_df</span><span class="p">[</span><span class="s1">&#39;co2_capacity_tonnes&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">shipping_df</span><span class="p">[</span><span class="s1">&#39;co2_capacity_cubic_meters&#39;</span><span class="p">]</span><span class="o">/</span><span class="mf">544.66</span> <span class="c1">## Verify this factor.  It seems to high</span>
<span class="n">shipping_df</span>
</code></pre></div><!-- raw HTML omitted -->
<pre><code>.dataframe tbody tr th {
    vertical-align: top;
}

.dataframe thead th {
    text-align: right;
}
</code></pre>
<p><!-- raw HTML omitted --></p>
<!-- raw HTML omitted -->
<h3 id="the-european-ports-df">The European Ports Df</h3>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python">
<span class="n">gisfilepath</span> <span class="o">=</span> <span class="s2">&#34;/Users/jnapolitano/Projects/data/energy/PORT_2013_SH/Data/PORT_PT_2013.shp&#34;</span>


<span class="n">ports_df</span> <span class="o">=</span> <span class="n">gpd</span><span class="o">.</span><span class="n">read_file</span><span class="p">(</span><span class="n">gisfilepath</span><span class="p">)</span>

<span class="n">ports_df</span> <span class="o">=</span> <span class="n">ports_df</span><span class="o">.</span><span class="n">to_crs</span><span class="p">(</span><span class="n">epsg</span><span class="o">=</span><span class="mi">3857</span><span class="p">)</span>
</code></pre></div><h3 id="filtered-wells-dataframe">Filtered Wells DataFrame</h3>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="c1">## Importing our DataFrames</span>

<span class="n">gisfilepath</span> <span class="o">=</span> <span class="s2">&#34;/Users/jnapolitano/Projects/data/energy/filtered-wells.geojson&#34;</span>


<span class="n">filtered_df</span> <span class="o">=</span> <span class="n">gpd</span><span class="o">.</span><span class="n">read_file</span><span class="p">(</span><span class="n">gisfilepath</span><span class="p">)</span>

<span class="n">filtered_df</span> <span class="o">=</span> <span class="n">filtered_df</span><span class="o">.</span><span class="n">to_crs</span><span class="p">(</span><span class="n">epsg</span><span class="o">=</span><span class="mi">3857</span><span class="p">)</span>


</code></pre></div><h4 id="getting-map-conditions-for-us-port-filtering">Getting Map Conditions for Us Port Filtering</h4>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="n">map_conditions</span> <span class="o">=</span> <span class="n">filtered_df</span><span class="o">.</span><span class="n">TERMID</span><span class="o">.</span><span class="n">unique</span><span class="p">()</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
</code></pre></div><h3 id="us-ports-dataframes">US Ports Dataframes</h3>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="c1">## Importing our DataFrames</span>

<span class="n">gisfilepath</span> <span class="o">=</span> <span class="s2">&#34;/Users/jnapolitano/Projects/data/energy/Liquified_Natural_Gas_Import_Exports_and_Terminals.geojson&#34;</span>


<span class="n">terminal_df</span> <span class="o">=</span> <span class="n">gpd</span><span class="o">.</span><span class="n">read_file</span><span class="p">(</span><span class="n">gisfilepath</span><span class="p">)</span>

<span class="n">terminal_df</span> <span class="o">=</span> <span class="n">terminal_df</span><span class="o">.</span><span class="n">to_crs</span><span class="p">(</span><span class="n">epsg</span><span class="o">=</span><span class="mi">3857</span><span class="p">)</span>


</code></pre></div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="n">terminal_df</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">terminal_df</span><span class="p">[</span><span class="n">terminal_df</span><span class="p">[</span><span class="s1">&#39;STATUS&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;SUSPENDED&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="n">inplace</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>
<span class="n">terminal_df</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="s2">&#34;NAME&#34;</span><span class="p">:</span> <span class="s2">&#34;TERMINAL_NAME&#34;</span><span class="p">})</span>
<span class="n">terminal_df</span><span class="p">[</span><span class="s1">&#39;TERMINAL_GEO&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">terminal_df</span><span class="p">[</span><span class="s1">&#39;geometry&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>

</code></pre></div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="n">port_terminals_df</span> <span class="o">=</span> <span class="n">terminal_df</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s1">&#39;TERMID in @map_conditions&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<span class="n">port_terminals_df</span><span class="p">[</span><span class="s1">&#39;co2_capacity_mmta&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">port_terminals_df</span><span class="p">[</span><span class="s1">&#39;CURRENTCAP&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="n">conversion_factor</span>
<span class="n">port_terminals_df</span><span class="p">[</span><span class="s1">&#39;co2_capacity_metric_tons&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">port_terminals_df</span><span class="p">[</span><span class="s1">&#39;co2_capacity_mmta&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="mi">1000000</span>
<span class="n">port_terminals_df</span><span class="p">[</span><span class="s1">&#39;available&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
</code></pre></div><h2 id="random-distribution-distance-and-pricing-functions">Random Distribution, Distance and Pricing Functions</h2>
<h3 id="accounting-for-random-days-at-sea">Accounting for Random Days at Sea</h3>
<p>As days at sea is variable I created a range between 20 and 40 days to account for a round trip to every major port in Europe.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python">
<span class="k">def</span> <span class="nf">random_day</span><span class="p">():</span>
    <span class="n">lower_bound</span> <span class="o">=</span> <span class="mi">20</span>
    <span class="n">upper_bound</span> <span class="o">=</span> <span class="mi">40</span>

    <span class="n">median</span> <span class="o">=</span> <span class="mi">30</span>
    <span class="n">standard_dev</span> <span class="o">=</span> <span class="mi">2</span>

    <span class="n">days_range</span> <span class="o">=</span> <span class="nb">range</span><span class="p">(</span><span class="n">lower_bound</span><span class="p">,</span> <span class="n">upper_bound</span><span class="p">)</span>

    <span class="n">days_distribution</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">normal</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="n">median</span> <span class="p">,</span> <span class="n">scale</span><span class="o">=</span><span class="n">standard_dev</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="n">ships</span><span class="p">)</span>


    <span class="n">days_randomized</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="n">days_distribution</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>


    <span class="k">return</span> <span class="p">(</span><span class="n">days_randomized</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">int64</span><span class="p">))</span>

</code></pre></div><h3 id="accounting-for-random-european-ports">Accounting for Random European Ports</h3>
<p>I randomized the port selection process with the following function.  The data provided by EuroStat did not filter according to type of port.  Nonetheless, the distance recorded should be very similiar to those of actual LNG ports.  A better data set could be substituded directly into the function.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python">
<span class="k">def</span> <span class="nf">random_europe_port</span><span class="p">():</span>
    <span class="c1">#select a random number along the index of the ports df.  Return the value of hte geometry at the index.  </span>
    <span class="c1">#select indices from the dataframe that are valid.  ie capacity has not yet been met.  </span>
    <span class="n">ports_randomized</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="n">ports_df</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">index_location</span> <span class="o">=</span> <span class="n">ports_randomized</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">ports_df</span><span class="o">.</span><span class="n">geometry</span><span class="p">[</span><span class="n">index_location</span><span class="p">]</span>

</code></pre></div><h3 id="accounting-for-random-us-ports">Accounting for Random US Ports</h3>
<p>I was able to filter import/export ports in the United States in to a dataset of about 15.  Like the European dataset, I randomized selection.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python">
<span class="k">def</span> <span class="nf">random_us_port</span><span class="p">():</span>
    <span class="c1">#select a random number along the index of the ports df.  Return the value of hte geometry at the index.  </span>

    <span class="n">ports_randomized</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="n">port_terminals_df</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">index_location</span> <span class="o">=</span> <span class="n">ports_randomized</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">port_terminals_df</span><span class="o">.</span><span class="n">geometry</span><span class="p">[</span><span class="n">index_location</span><span class="p">]</span>

</code></pre></div><h3 id="calculating-distance-between-ports">Calculating Distance Between Ports</h3>
<p>I calculated the shortest distance between ports based on their geographic locations with the shapley.distance function.  It returns distance in meters.  I divide by 1000 to convert into Km.   The algorithm could be improved by using official shipping data to randomize a distribution of distances between ports.  Unfortunately, I do not have that data available to me.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python">
<span class="k">def</span> <span class="nf">geo_distance</span><span class="p">(</span><span class="n">dist1</span><span class="p">,</span><span class="n">dist2</span><span class="p">):</span>
    <span class="c1"># return distance in km</span>
    <span class="n">distance</span> <span class="o">=</span> <span class="n">dist1</span><span class="o">.</span><span class="n">distance</span><span class="p">(</span><span class="n">dist2</span><span class="p">)</span><span class="o">/</span><span class="mi">1000</span>
    <span class="k">return</span><span class="p">(</span><span class="n">distance</span><span class="p">)</span>

    

</code></pre></div><h3 id="calculating-price-of-transport">Calculating Price of Transport</h3>
<p>The cost of transport accounts for port fees, liquification, and transport.   Unfortunately, my data is from a paper published in 2004.  I would like to find a more recent paper.   I did not convert the value of 2004 USD to 2022 because I am not sure of the validity of the conversion factors available online.  I would need a better source to correctly model the true cost of transport.</p>
<p><a href="https://ieaghg.org/docs/General_Docs/Reports/PH4-30%20Ship%20Transport.pdf">source</a></p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python">
<span class="k">def</span> <span class="nf">price_to_transport</span><span class="p">(</span><span class="n">distance</span><span class="p">,</span><span class="n">tonnes</span><span class="p">):</span>
    <span class="n">price</span> <span class="o">=</span> <span class="p">(</span><span class="n">distance</span><span class="o">/</span><span class="mi">100</span><span class="p">)</span> <span class="o">*</span> <span class="mi">12</span> <span class="o">*</span> <span class="n">tonnes</span>
    <span class="k">return</span> <span class="n">price</span>

</code></pre></div><h3 id="calculating-cost-per-day">Calculating Cost Per Day</h3>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="k">def</span> <span class="nf">cost_per_day</span><span class="p">(</span><span class="n">price</span><span class="p">,</span><span class="n">distance</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">price</span><span class="o">/</span><span class="n">distance</span>
</code></pre></div><h2 id="costs-per-annum-algorithm">Costs Per Annum Algorithm</h2>
<p>The algorithm I used calculates the daily status of ships transporting CO2 across the Atlantic from a random European port to a random port in the United States.  It will run for 365 iterations or until the total carbon capacity of the US ports is reached.  This value could and probably should be dynamically allocated via a similiar algorithm, but I do not yet have historical probability distributions of carbon imports to determime a valid price allocation function.</p>
<p>When the daily counter reaches zero for a tanker:</p>
<ul>
<li>The capacity is refilled to full.</li>
<li>A random us port is assigned.</li>
<li>A random European port is assigned.</li>
<li>The distance between ports is calculated.</li>
<li>The cost of transport over that distance is calculated per 100 km.</li>
<li>The total shipping price of that cycle is tabulated.</li>
<li>The total tonnage of that cycle is tabulated.</li>
<li>The mean price per voyage is tabulated</li>
</ul>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python">
<span class="n">days</span> <span class="o">=</span> <span class="mi">365</span>
<span class="n">day_counter</span> <span class="o">=</span> <span class="mi">0</span> 
<span class="n">carbon_total_millions_metric_tons</span> <span class="o">=</span> <span class="mi">300000000</span>
<span class="n">total_tons_shipped</span> <span class="o">=</span> <span class="mi">0</span>
<span class="n">total_price</span> <span class="o">=</span> <span class="mi">0</span>
<span class="n">cycle_mean_price_samples</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">shape</span><span class="o">=</span><span class="n">days</span><span class="p">)</span>

<span class="c1">#deduction = capacity of empty ships</span>
<span class="k">for</span> <span class="n">day</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">days</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">carbon_total_millions_metric_tons</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">:</span>
        <span class="c1"># must use apply to account for multiple 0 conditions.  If i simply vectorized the function across the dataframe in a single call i would assign the the same values each day </span>
        <span class="n">shipping_df</span><span class="p">[</span><span class="s1">&#39;days_to_port&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">shipping_df</span><span class="p">[</span><span class="s1">&#39;days_to_port&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="mi">1</span>
        <span class="n">shipping_df</span><span class="p">[</span><span class="s1">&#39;us_port&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">shipping_df</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span>  <span class="n">random_us_port</span><span class="p">()</span> <span class="k">if</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;days_to_port&#39;</span><span class="p">]</span><span class="o">&lt;=</span><span class="mi">0</span> <span class="k">else</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;us_port&#39;</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">shipping_df</span><span class="p">[</span><span class="s1">&#39;europe_port&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">shipping_df</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span>  <span class="n">random_europe_port</span><span class="p">()</span> <span class="k">if</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;days_to_port&#39;</span><span class="p">]</span><span class="o">&lt;=</span><span class="mi">0</span> <span class="k">else</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;europe_port&#39;</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">shipping_df</span><span class="p">[</span><span class="s1">&#39;distance&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">shipping_df</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span>  <span class="n">geo_distance</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;us_port&#39;</span><span class="p">],</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;europe_port&#39;</span><span class="p">])</span> <span class="k">if</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;days_to_port&#39;</span><span class="p">]</span><span class="o">&lt;=</span><span class="mi">0</span> <span class="k">else</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;distance&#39;</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">shipping_df</span><span class="p">[</span><span class="s1">&#39;price&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">shipping_df</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span>  <span class="n">price_to_transport</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;distance&#39;</span><span class="p">],</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;co2_capacity_tonnes&#39;</span><span class="p">])</span> <span class="k">if</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;days_to_port&#39;</span><span class="p">]</span><span class="o">&lt;=</span><span class="mi">0</span> <span class="k">else</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;price&#39;</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="c1">#calculate cost per day for fun...</span>
        <span class="c1"># query all that are = o.  Summate the capacities deduct the total </span>
        <span class="n">tmp_df</span><span class="o">=</span><span class="n">shipping_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">shipping_df</span><span class="p">[</span><span class="s1">&#39;days_to_port&#39;</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">]</span>
        <span class="n">sum_of_capacity</span> <span class="o">=</span> <span class="n">tmp_df</span><span class="p">[</span><span class="s1">&#39;co2_capacity_tonnes&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
        <span class="n">sum_of_price</span> <span class="o">=</span> <span class="n">tmp_df</span><span class="p">[</span><span class="s1">&#39;price&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
        <span class="n">mean_of_price</span> <span class="o">=</span> <span class="n">tmp_df</span><span class="p">[</span><span class="s1">&#39;price&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
        <span class="n">cycle_mean_price_samples</span><span class="p">[</span><span class="n">day</span><span class="p">]</span> <span class="o">=</span> <span class="n">mean_of_price</span>
        <span class="n">shipping_df</span><span class="p">[</span><span class="s1">&#39;days_to_port&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">shipping_df</span><span class="p">[</span><span class="s1">&#39;days_to_port&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">random_day</span><span class="p">()</span> <span class="k">if</span> <span class="n">x</span><span class="o">&lt;=</span><span class="mi">0</span> <span class="k">else</span> <span class="n">x</span><span class="p">)</span>
        <span class="n">total_tons_shipped</span> <span class="o">=</span> <span class="n">total_tons_shipped</span> <span class="o">+</span> <span class="n">sum_of_capacity</span>
        <span class="n">total_price</span> <span class="o">=</span> <span class="n">total_price</span> <span class="o">+</span> <span class="n">sum_of_price</span>
        <span class="n">carbon_total_millions_metric_tons</span> <span class="o">=</span> <span class="n">carbon_total_millions_metric_tons</span> <span class="o">-</span> <span class="n">sum_of_capacity</span>
        <span class="c1">#print(carbon_total_millions_metric_tons)</span>
        <span class="n">day_counter</span> <span class="o">=</span> <span class="n">day_counter</span><span class="o">+</span><span class="mi">1</span>
    <span class="k">else</span><span class="p">:</span> 
        <span class="k">break</span>

    
    
<span class="nb">print</span><span class="p">(</span><span class="n">day_counter</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">total_tons_shipped</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">total_price</span><span class="p">)</span>
<span class="c1">#Drop the nan, ie empty samples</span>
<span class="n">cycle_mean_price</span> <span class="o">=</span> <span class="n">cycle_mean_price_samples</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">logical_not</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">cycle_mean_price_samples</span><span class="p">))]</span>
<span class="c1">#Calculate mean price of filling a ship (around a billion according to the data i have if filled to capacity.  Ridiculous.)</span>
<span class="n">cycle_mean_price</span> <span class="o">=</span> <span class="n">cycle_mean_price</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="n">cycle_mean_price</span><span class="p">)</span>

</code></pre></div><pre><code>365
41072.53151865029
62067313.75358563
316665.2057796429
</code></pre>
<h2 id="monte-carlo-simulation-with-500-iterations">Monte Carlo Simulation with 500 Iterations</h2>
<p>The annual rate of shipping can be variable according to shifting dynamics. I account for that by modeling the per annum algorithm 500 times.  Modeling would improve as n increases, but for the sake of time I limited the computation to 500 iterations</p>
<p>The only difference between this algorithm and the previous one is an extra for loop.  The algorithmic efficiency is surprisingly good as the I was able to vectorize tabulations with lambda functions across the dataframes.  On my laptop, I was able to complete the algorithm in about 16 minutes of run time.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python">
<span class="n">nsamples</span> <span class="o">=</span> <span class="mi">500</span>
<span class="n">price_samples</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">shape</span><span class="o">=</span><span class="n">nsamples</span><span class="p">)</span>
<span class="n">cycle_mean_price_annual_samples</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">shape</span><span class="o">=</span><span class="n">nsamples</span><span class="p">)</span>

<span class="k">for</span> <span class="n">sample</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nsamples</span><span class="p">):</span>

    <span class="n">days</span> <span class="o">=</span> <span class="mi">365</span>
    <span class="n">day_counter</span> <span class="o">=</span> <span class="mi">0</span> 
    <span class="n">carbon_total_millions_metric_tons</span> <span class="o">=</span> <span class="mi">300000000</span> <span class="c1"># could randomize.  Need a probability distribution based on historial data. </span>
    <span class="n">total_tons_shipped</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">total_price</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">cycle_mean_price_daily_samples</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">shape</span><span class="o">=</span><span class="n">days</span><span class="p">)</span>


    <span class="c1">#deduction = capacity of empty ships</span>
    <span class="k">for</span> <span class="n">day</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">days</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">carbon_total_millions_metric_tons</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="c1"># must use apply to account for multiple 0 conditions.  If i simply vectorized the function across the dataframe in a single call i would assign the the same values each day </span>
            <span class="n">shipping_df</span><span class="p">[</span><span class="s1">&#39;days_to_port&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">shipping_df</span><span class="p">[</span><span class="s1">&#39;days_to_port&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="mi">1</span>
            <span class="n">shipping_df</span><span class="p">[</span><span class="s1">&#39;us_port&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">shipping_df</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span>  <span class="n">random_us_port</span><span class="p">()</span> <span class="k">if</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;days_to_port&#39;</span><span class="p">]</span><span class="o">&lt;=</span><span class="mi">0</span> <span class="k">else</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;us_port&#39;</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
            <span class="n">shipping_df</span><span class="p">[</span><span class="s1">&#39;europe_port&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">shipping_df</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span>  <span class="n">random_europe_port</span><span class="p">()</span> <span class="k">if</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;days_to_port&#39;</span><span class="p">]</span><span class="o">&lt;=</span><span class="mi">0</span> <span class="k">else</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;europe_port&#39;</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
            <span class="n">shipping_df</span><span class="p">[</span><span class="s1">&#39;distance&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">shipping_df</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span>  <span class="n">geo_distance</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;us_port&#39;</span><span class="p">],</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;europe_port&#39;</span><span class="p">])</span> <span class="k">if</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;days_to_port&#39;</span><span class="p">]</span><span class="o">&lt;=</span><span class="mi">0</span> <span class="k">else</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;distance&#39;</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
            <span class="n">shipping_df</span><span class="p">[</span><span class="s1">&#39;price&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">shipping_df</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span>  <span class="n">price_to_transport</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;distance&#39;</span><span class="p">],</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;co2_capacity_tonnes&#39;</span><span class="p">])</span> <span class="k">if</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;days_to_port&#39;</span><span class="p">]</span><span class="o">&lt;=</span><span class="mi">0</span> <span class="k">else</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;price&#39;</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
            <span class="c1"># query all that are = o.  Summate the capacities deduct the total </span>
            <span class="n">tmp_df</span><span class="o">=</span><span class="n">shipping_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">shipping_df</span><span class="p">[</span><span class="s1">&#39;days_to_port&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">]</span>
            <span class="n">sum_of_capacity</span> <span class="o">=</span> <span class="n">tmp_df</span><span class="p">[</span><span class="s1">&#39;co2_capacity_tonnes&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
            <span class="n">sum_of_price</span> <span class="o">=</span> <span class="n">tmp_df</span><span class="p">[</span><span class="s1">&#39;price&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
            <span class="n">mean_of_price</span> <span class="o">=</span> <span class="n">tmp_df</span><span class="p">[</span><span class="s1">&#39;price&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
            <span class="n">cycle_mean_price_daily_samples</span><span class="p">[</span><span class="n">day</span><span class="p">]</span> <span class="o">=</span> <span class="n">mean_of_price</span>
            <span class="n">shipping_df</span><span class="p">[</span><span class="s1">&#39;days_to_port&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">shipping_df</span><span class="p">[</span><span class="s1">&#39;days_to_port&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">random_day</span><span class="p">()</span> <span class="k">if</span> <span class="n">x</span><span class="o">&lt;=</span><span class="mi">0</span> <span class="k">else</span> <span class="n">x</span><span class="p">)</span>
            <span class="n">total_tons_shipped</span> <span class="o">=</span> <span class="n">total_tons_shipped</span> <span class="o">+</span> <span class="n">sum_of_capacity</span>
            <span class="n">total_price</span> <span class="o">=</span> <span class="n">total_price</span> <span class="o">+</span> <span class="n">sum_of_price</span>
            <span class="n">carbon_total_millions_metric_tons</span> <span class="o">=</span> <span class="n">carbon_total_millions_metric_tons</span> <span class="o">-</span> <span class="n">sum_of_capacity</span>
            <span class="c1">#print(carbon_total_millions_metric_tons)</span>
            <span class="n">day_counter</span> <span class="o">=</span> <span class="n">day_counter</span><span class="o">+</span><span class="mi">1</span>
        <span class="k">else</span><span class="p">:</span> 
            <span class="k">break</span>

    <span class="c1">#Drop the nan, ie empty samples</span>
    <span class="n">cycle_mean_price</span> <span class="o">=</span> <span class="n">cycle_mean_price_samples</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">logical_not</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">cycle_mean_price_samples</span><span class="p">))]</span>
    <span class="c1">#Calculate mean price of filling a ship (around a billion according to the data i have if filled to capacity.  Ridiculous.)</span>
    <span class="n">cycle_mean_price</span> <span class="o">=</span> <span class="n">cycle_mean_price</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
    <span class="n">cycle_mean_price_annual_samples</span><span class="p">[</span><span class="n">sample</span><span class="p">]</span> <span class="o">=</span><span class="n">cycle_mean_price</span>
        
    

    <span class="n">price_samples</span><span class="p">[</span><span class="n">sample</span><span class="p">]</span> <span class="o">=</span> <span class="n">total_price</span>

        

</code></pre></div><h3 id="creating-the-annual-price-samples-df">Creating the Annual Price Samples DF</h3>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="n">annual_price_samples_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">price_samples</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;cost_in_usd&#39;</span><span class="p">])</span>
</code></pre></div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="n">annual_price_samples_df</span><span class="p">[</span><span class="s1">&#39;cost_in_usd&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">annual_price_samples_df</span><span class="o">.</span><span class="n">cost_in_usd</span>

</code></pre></div><h3 id="creating-the-mean-price-per-round-trip-df">Creating the Mean Price Per Round Trip Df</h3>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="n">mean_price_per_cycle_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">cycle_mean_price_annual_samples</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;Voyage Cost USD&#39;</span><span class="p">])</span>
<span class="n">mean_price_per_cycle_df</span><span class="p">[</span><span class="s1">&#39;Voyage Cost USD&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">mean_price_per_cycle_df</span><span class="p">[</span><span class="s1">&#39;Voyage Cost USD&#39;</span><span class="p">]</span> 

</code></pre></div><h2 id="imports">Imports</h2>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">geopandas</span> <span class="k">as</span> <span class="nn">gpd</span>
<span class="kn">import</span> <span class="nn">folium</span>
<span class="kn">import</span> <span class="nn">contextily</span> <span class="k">as</span> <span class="nn">cx</span>
<span class="kn">import</span> <span class="nn">rtree</span>
<span class="kn">from</span> <span class="nn">zlib</span> <span class="kn">import</span> <span class="n">crc32</span>
<span class="kn">import</span> <span class="nn">hashlib</span>
<span class="kn">from</span> <span class="nn">shapely.geometry</span> <span class="kn">import</span> <span class="n">Point</span><span class="p">,</span> <span class="n">LineString</span><span class="p">,</span> <span class="n">Polygon</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">from</span> <span class="nn">scipy.spatial</span> <span class="kn">import</span> <span class="n">cKDTree</span>
<span class="kn">import</span> <span class="nn">scipy.stats</span> <span class="k">as</span> <span class="nn">st</span>
<span class="kn">from</span> <span class="nn">shapely.geometry</span> <span class="kn">import</span> <span class="n">Point</span>
<span class="kn">from</span> <span class="nn">haversine</span> <span class="kn">import</span> <span class="n">Unit</span>
<span class="kn">from</span> <span class="nn">geopy.distance</span> <span class="kn">import</span> <span class="n">distance</span>

<span class="kn">import</span> <span class="nn">warnings</span>

<span class="n">warnings</span><span class="o">.</span><span class="n">filterwarnings</span><span class="p">(</span><span class="s1">&#39;ignore&#39;</span><span class="p">)</span>

</code></pre></div><pre><code>/Users/jnapolitano/venvs/finance/lib/python3.9/site-packages/geopandas/_compat.py:111: UserWarning: The Shapely GEOS version (3.10.2-CAPI-1.16.0) is incompatible with the GEOS version PyGEOS was compiled with (3.10.1-CAPI-1.16.0). Conversions between both will be slow.
  warnings.warn(
</code></pre>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python">
</code></pre></div>]]></content>
			<postid> 3123e99b5f952de3022e704482b40f6a</postid>
			<author>Justin Napolitano</author>
			<author_name>Justin Napolitano</author_name>
			<author_email>personal.jnapolitano@gmail.com</author_email>
			<author_id>87654367b2fca109e7dc9d3ea8a1ebbaf0bfe374773b148c2c20d278479add99</author_id>			
		</item>
		
		<item>
			<title>Monte Carlo Projection of the Annual Cost of Shipping Carbon from Europe to the United States</title>
			<link>jnapolitano.com/posts/carbon-shipping-projections/</link>
			<pubDate>Sat, 07 May 2022 18:40:32 +0000</pubDate>
			<guid>jnapolitano.com/posts/carbon-shipping-projections/</guid>
			<description><![CDATA[Monte Carlo Carbon Shipping Projections]]></description>
			<content type="html"><![CDATA[<h1 id="a-monte-carlo-projection-of-the-annual-cost-of-shipping-carbon-from-europe-to-us-ports">A Monte Carlo Projection of the Annual Cost of Shipping Carbon from Europe to US Ports</h1>
<h2 id="revision">Revision</h2>
<p>An earlier version of this report had reported values that were erroneously elevated by a decimal error in the meters to km conversion of distances between ports.  I apologize for unintentionally publishing misleading information.</p>
<p>Situations like this one, are why I always publish with code.  Transparency is the key to rigor.</p>
<h2 id="introduction">Introduction</h2>
<p>I produced an earlier <a href="https://blog.jnapolitano.io/wells-near-ports/">report</a> that identified potential ports that may be suitable terminals for carbon imports into the United States for storage or industrial applications.</p>
<p>Following that report, I became interested in what could be the annual economic value of shipping CO2.  In this report, I analyze the results of a Monte Carlo simulation I developed in Python (documented at the end of this page) that projects the annual cost of shipping carbon across the Atlantic from Europe to the United States.</p>
<h2 id="methodology">Methodology</h2>
<h3 id="modeling-dynamic-variables">Modeling Dynamic Variables</h3>
<p>To account for dynamic variables I designed a Monte Carlo simulation that randomly selected variables across normal distributions bounded by minima and maxima.</p>
<p>The current simulation includes:</p>
<ul>
<li>Variable shipping distances</li>
<li>Variable shipping capacity</li>
<li>Variable ports of origin</li>
<li>Variable terminal ports</li>
<li>Variable round trip shipping duration</li>
</ul>
<p>Fixed variables include:</p>
<ul>
<li>Cost of Transport per ton (though this will be converted to a random distribution as soon as I find a better data source)</li>
</ul>
<h3 id="modeling-the-shipping-infrastructure">Modeling the Shipping Infrastructure</h3>
<h4 id="source">Source</h4>
<p>Susanna Dorigoni, Luigi Mazzei, Federico Pontoni, and Antonio Sileo
IEFE – Centre for Research on Energy and Environmental Economics and Policy,
Università Bocconi, Milan, Italy</p>
<h4 id="modeling-the-capacity-of-tankers">Modeling the Capacity of Tankers</h4>
<p>To complete this analysis, I converted values found for lng shipping to super critical co2.  To do this,  I converted LNG capacties to super critical Co2 with the following conversion factors:</p>
<ul>
<li>1 tonne co2 super critical = 2.64812 meter cubed super critical co</li>
<li>1 tonnes LNG = 2.21 m3 LNG (liquid)</li>
<li>1 tonne co2 super critical = 544.66 m^3 gaseous</li>
</ul>
<p>The capacity range:</p>
<ul>
<li>The lower bound of the distribution is 33358 cubic meteres</li>
<li>The upper bound is 175132</li>
<li>The median provided is 114723</li>
<li>The standard deviation is 5 (surprisingly homogeneous)</li>
</ul>
<h4 id="modeling-the-number-of-tankers">Modeling the Number of Tankers</h4>
<p>The number of tankers in the Atlantic basin dedicated to LNG transort recorded in 2008 was 63.  I calculated a rough estimate of 25 percent of these being used to transport carbon annually.  A better source is needed to accurately model.  If ships are used to transport both lng and carbon a random distribution designed according to a CO2 carrying probability distribution would suitably model the data.</p>
<p>A total of 15 tankers were modeled in this example.</p>
<h2 id="findings">Findings</h2>
<p>Carbon capture is likely a billion dollar industry at scale.</p>
<p>Across 500 iterations of modeling we see about $57.5 million dollars worth of economic activity annualy.</p>
<h3 id="the-take-away">The Take Away</h3>
<p>The Carbon capture and storage economiy is likely a billion dollar economy at scale.  In just reviewing shipping super critical CO2 from Europe to the United States, a $57.5 million USD annual industry could develop as nations move towards a net carbon zero economy.</p>
<h2 id="limitations-of-the-model">Limitations of the Model</h2>
<p>The model as it is presented in this report is unconstrained.  A more accurate portrayal of what would be possible with current systems in place could be designed with better data.  It is also important to note that I have not included incentives into the model.  It is entirely possible that government subsidies could prove the carbon shipping industry to be more expansive than presented here.</p>
<h2 id="data-analysis">Data Analysis</h2>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="n">annual_price_samples_df</span><span class="o">.</span><span class="n">describe</span><span class="p">()</span>
</code></pre></div><!-- raw HTML omitted -->
<pre><code>.dataframe tbody tr th {
    vertical-align: top;
}

.dataframe thead th {
    text-align: right;
}
</code></pre>
<p><!-- raw HTML omitted --></p>
<!-- raw HTML omitted -->
<h2 id="calculating-the-confidence-interval">Calculating the Confidence Interval</h2>
<p>The data is nearly normal.  I could test for normality, but that would be beyond the scope of this analysis.  Also, by design the Monte Carlo model should produce a normal distribution with sufficient samples.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python">
<span class="n">st</span><span class="o">.</span><span class="n">norm</span><span class="o">.</span><span class="n">interval</span><span class="p">(</span><span class="n">alpha</span><span class="o">=</span><span class="mf">0.90</span><span class="p">,</span> <span class="n">loc</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">annual_price_samples_df</span><span class="p">[</span><span class="s1">&#39;cost_in_usd&#39;</span><span class="p">]),</span> <span class="n">scale</span><span class="o">=</span><span class="n">st</span><span class="o">.</span><span class="n">sem</span><span class="p">(</span><span class="n">annual_price_samples_df</span><span class="p">[</span><span class="s1">&#39;cost_in_usd&#39;</span><span class="p">]))</span>
</code></pre></div><pre><code>(57355794.336350285, 57531108.50357006)
</code></pre>
<p>It is safe to assume that 90 percent of the time we would see an annual cost of $57,355,794 to $57,531,109 USD with the assumptions of the model taken into account.</p>
<h3 id="monte-carlo-histogram">Monte Carlo Histogram</h3>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="n">annual_price_samples_df</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">grid</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">bins</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span> <span class="n">rwidth</span><span class="o">=</span><span class="mf">0.9</span><span class="p">,</span>
                   <span class="n">color</span><span class="o">=</span><span class="s1">&#39;#607c8e&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Annual Price Distribution for Shipping Carbon&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Annual Price in Billions USD&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Frequency&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="s1">&#39;y&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.75</span><span class="p">)</span>
</code></pre></div><p><img src="shipping_projections_files/shipping_projections_10_0.png" alt="png"></p>
<h2 id="data-imports-and-manipulation">Data Imports and Manipulation</h2>
<h3 id="the-shipping-dataframe">The Shipping Dataframe</h3>
<p>The shipping dataframe is the basis of the simulation.  It is used to tabulate total cost and to record the values of variables.</p>
<h4 id="capacity-distribution-and-number-of-ships-calculation">Capacity Distribution and Number of Ships Calculation</h4>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="c1"># Capacity range</span>
<span class="c1"># 40,000 m3 71,500 to 210,000</span>

<span class="c1">#Susanna Dorigoni, Luigi Mazzei, Federico Pontoni, and Antonio Sileo</span>
<span class="c1">#IEFE – Centre for Research on Energy and Environmental Economics and Policy,</span>
<span class="c1">#Università Bocconi, Milan, Italy</span>

<span class="c1"># I&#39;m sure a better report is available but this is a start</span>
<span class="c1"># cubic meters unit</span>

<span class="c1">### a rough estimate of global suplly dedicated to co2 shipping</span>

<span class="c1"># I will probably need a better metric but this is a good start that can be modified later when necessary</span>

<span class="n">ships</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="mi">63</span><span class="o">*</span><span class="mf">.25</span><span class="p">)</span>
<span class="n">ships</span>


<span class="n">conversion_factor</span> <span class="o">=</span> <span class="mf">2.21</span><span class="o">/</span><span class="mf">2.65</span>
<span class="n">conversion_factor</span>

<span class="n">lower_bound</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="mi">40000</span> <span class="o">*</span> <span class="n">conversion_factor</span><span class="p">)</span>
<span class="n">upper_bound</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="mi">210000</span> <span class="o">*</span> <span class="n">conversion_factor</span><span class="p">)</span>

<span class="n">median</span> <span class="o">=</span> <span class="mi">137564</span> <span class="o">*</span> <span class="n">conversion_factor</span>
<span class="n">standard_dev</span> <span class="o">=</span> <span class="mf">6.63</span> <span class="o">*</span> <span class="n">conversion_factor</span>  <span class="c1">#file:///Users/jnapolitano/Downloads/LNG_Shipping_a_Descriptive_Analysis.pdf</span>

<span class="n">cap_range</span> <span class="o">=</span> <span class="nb">range</span><span class="p">(</span><span class="n">lower_bound</span><span class="p">,</span> <span class="n">upper_bound</span><span class="p">)</span>

<span class="n">cap_distribution</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">normal</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="n">median</span> <span class="p">,</span> <span class="n">scale</span><span class="o">=</span><span class="n">standard_dev</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="n">ships</span><span class="p">)</span>


</code></pre></div><h4 id="the-shipping-df">The Shipping Df</h4>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="n">shipping_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">cap_distribution</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;co2_capacity_cubic_meters&#39;</span><span class="p">])</span>
<span class="n">shipping_df</span><span class="p">[</span><span class="s1">&#39;days_to_port&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
<span class="n">shipping_df</span><span class="p">[</span><span class="s1">&#39;europe_port&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
<span class="n">shipping_df</span><span class="p">[</span><span class="s2">&#34;us_port&#34;</span><span class="p">]</span> <span class="o">=</span><span class="s1">&#39;&#39;</span>
<span class="n">shipping_df</span><span class="p">[</span><span class="s1">&#39;distance&#39;</span><span class="p">]</span> <span class="o">=</span><span class="s1">&#39;&#39;</span>
<span class="n">shipping_df</span><span class="p">[</span><span class="s1">&#39;price&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
<span class="n">shipping_df</span><span class="p">[</span><span class="s1">&#39;cost_per_day&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
<span class="n">shipping_df</span><span class="p">[</span><span class="s1">&#39;co2_capacity_tonnes&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">shipping_df</span><span class="p">[</span><span class="s1">&#39;co2_capacity_cubic_meters&#39;</span><span class="p">]</span><span class="o">/</span><span class="mf">544.66</span> <span class="c1">## Verify this factor.  It seems to high</span>
<span class="n">shipping_df</span>
</code></pre></div><!-- raw HTML omitted -->
<pre><code>.dataframe tbody tr th {
    vertical-align: top;
}

.dataframe thead th {
    text-align: right;
}
</code></pre>
<p><!-- raw HTML omitted --></p>
<!-- raw HTML omitted -->
<h3 id="the-european-ports-df">The European Ports Df</h3>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python">
<span class="n">gisfilepath</span> <span class="o">=</span> <span class="s2">&#34;/Users/jnapolitano/Projects/data/energy/PORT_2013_SH/Data/PORT_PT_2013.shp&#34;</span>


<span class="n">ports_df</span> <span class="o">=</span> <span class="n">gpd</span><span class="o">.</span><span class="n">read_file</span><span class="p">(</span><span class="n">gisfilepath</span><span class="p">)</span>

<span class="n">ports_df</span> <span class="o">=</span> <span class="n">ports_df</span><span class="o">.</span><span class="n">to_crs</span><span class="p">(</span><span class="n">epsg</span><span class="o">=</span><span class="mi">3857</span><span class="p">)</span>
</code></pre></div><h3 id="filtered-wells-dataframe">Filtered Wells DataFrame</h3>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="c1">## Importing our DataFrames</span>

<span class="n">gisfilepath</span> <span class="o">=</span> <span class="s2">&#34;/Users/jnapolitano/Projects/data/energy/filtered-wells.geojson&#34;</span>


<span class="n">filtered_df</span> <span class="o">=</span> <span class="n">gpd</span><span class="o">.</span><span class="n">read_file</span><span class="p">(</span><span class="n">gisfilepath</span><span class="p">)</span>

<span class="n">filtered_df</span> <span class="o">=</span> <span class="n">filtered_df</span><span class="o">.</span><span class="n">to_crs</span><span class="p">(</span><span class="n">epsg</span><span class="o">=</span><span class="mi">3857</span><span class="p">)</span>


</code></pre></div><h4 id="getting-map-conditions-for-us-port-filtering">Getting Map Conditions for Us Port Filtering</h4>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="n">map_conditions</span> <span class="o">=</span> <span class="n">filtered_df</span><span class="o">.</span><span class="n">TERMID</span><span class="o">.</span><span class="n">unique</span><span class="p">()</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
</code></pre></div><h3 id="us-ports-dataframes">US Ports Dataframes</h3>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="c1">## Importing our DataFrames</span>

<span class="n">gisfilepath</span> <span class="o">=</span> <span class="s2">&#34;/Users/jnapolitano/Projects/data/energy/Liquified_Natural_Gas_Import_Exports_and_Terminals.geojson&#34;</span>


<span class="n">terminal_df</span> <span class="o">=</span> <span class="n">gpd</span><span class="o">.</span><span class="n">read_file</span><span class="p">(</span><span class="n">gisfilepath</span><span class="p">)</span>

<span class="n">terminal_df</span> <span class="o">=</span> <span class="n">terminal_df</span><span class="o">.</span><span class="n">to_crs</span><span class="p">(</span><span class="n">epsg</span><span class="o">=</span><span class="mi">3857</span><span class="p">)</span>


</code></pre></div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="n">terminal_df</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">terminal_df</span><span class="p">[</span><span class="n">terminal_df</span><span class="p">[</span><span class="s1">&#39;STATUS&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;SUSPENDED&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="n">inplace</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>
<span class="n">terminal_df</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="s2">&#34;NAME&#34;</span><span class="p">:</span> <span class="s2">&#34;TERMINAL_NAME&#34;</span><span class="p">})</span>
<span class="n">terminal_df</span><span class="p">[</span><span class="s1">&#39;TERMINAL_GEO&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">terminal_df</span><span class="p">[</span><span class="s1">&#39;geometry&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>

</code></pre></div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="n">port_terminals_df</span> <span class="o">=</span> <span class="n">terminal_df</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s1">&#39;TERMID in @map_conditions&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<span class="n">port_terminals_df</span><span class="p">[</span><span class="s1">&#39;co2_capacity_mmta&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">port_terminals_df</span><span class="p">[</span><span class="s1">&#39;CURRENTCAP&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="n">conversion_factor</span>
<span class="n">port_terminals_df</span><span class="p">[</span><span class="s1">&#39;co2_capacity_metric_tons&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">port_terminals_df</span><span class="p">[</span><span class="s1">&#39;co2_capacity_mmta&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="mi">1000000</span>
<span class="n">port_terminals_df</span><span class="p">[</span><span class="s1">&#39;available&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
</code></pre></div><h2 id="random-distribution-distance-and-pricing-functions">Random Distribution, Distance and Pricing Functions</h2>
<h3 id="accounting-for-random-days-at-sea">Accounting for Random Days at Sea</h3>
<p>As days at sea is variable I created a range between 20 and 40 days to account for a round trip to every major port in Europe.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python">
<span class="k">def</span> <span class="nf">random_day</span><span class="p">():</span>
    <span class="n">lower_bound</span> <span class="o">=</span> <span class="mi">20</span>
    <span class="n">upper_bound</span> <span class="o">=</span> <span class="mi">40</span>

    <span class="n">median</span> <span class="o">=</span> <span class="mi">30</span>
    <span class="n">standard_dev</span> <span class="o">=</span> <span class="mi">2</span>

    <span class="n">days_range</span> <span class="o">=</span> <span class="nb">range</span><span class="p">(</span><span class="n">lower_bound</span><span class="p">,</span> <span class="n">upper_bound</span><span class="p">)</span>

    <span class="n">days_distribution</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">normal</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="n">median</span> <span class="p">,</span> <span class="n">scale</span><span class="o">=</span><span class="n">standard_dev</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="n">ships</span><span class="p">)</span>


    <span class="n">days_randomized</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="n">days_distribution</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>


    <span class="k">return</span> <span class="p">(</span><span class="n">days_randomized</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">int64</span><span class="p">))</span>

</code></pre></div><h3 id="accounting-for-random-european-ports">Accounting for Random European Ports</h3>
<p>I randomized the port selection process with the following function.  The data provided by EuroStat did not filter according to type of port.  Nonetheless, the distance recorded should be very similiar to those of actual LNG ports.  A better data set could be substituded directly into the function.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python">
<span class="k">def</span> <span class="nf">random_europe_port</span><span class="p">():</span>
    <span class="c1">#select a random number along the index of the ports df.  Return the value of hte geometry at the index.  </span>
    <span class="c1">#select indices from the dataframe that are valid.  ie capacity has not yet been met.  </span>
    <span class="n">ports_randomized</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="n">ports_df</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">index_location</span> <span class="o">=</span> <span class="n">ports_randomized</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">ports_df</span><span class="o">.</span><span class="n">geometry</span><span class="p">[</span><span class="n">index_location</span><span class="p">]</span>

</code></pre></div><h3 id="accounting-for-random-us-ports">Accounting for Random US Ports</h3>
<p>I was able to filter import/export ports in the United States in to a dataset of about 15.  Like the European dataset, I randomized selection.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python">
<span class="k">def</span> <span class="nf">random_us_port</span><span class="p">():</span>
    <span class="c1">#select a random number along the index of the ports df.  Return the value of hte geometry at the index.  </span>

    <span class="n">ports_randomized</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="n">port_terminals_df</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">index_location</span> <span class="o">=</span> <span class="n">ports_randomized</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">port_terminals_df</span><span class="o">.</span><span class="n">geometry</span><span class="p">[</span><span class="n">index_location</span><span class="p">]</span>

</code></pre></div><h3 id="calculating-distance-between-ports">Calculating Distance Between Ports</h3>
<p>I calculated the shortest distance between ports based on their geographic locations with the shapley.distance function.  It returns distance in meters.  I divide by 1000 to convert into Km.   The algorithm could be improved by using official shipping data to randomize a distribution of distances between ports.  Unfortunately, I do not have that data available to me.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python">
<span class="k">def</span> <span class="nf">geo_distance</span><span class="p">(</span><span class="n">dist1</span><span class="p">,</span><span class="n">dist2</span><span class="p">):</span>
    <span class="c1"># return distance in km</span>
    <span class="n">distance</span> <span class="o">=</span> <span class="n">dist1</span><span class="o">.</span><span class="n">distance</span><span class="p">(</span><span class="n">dist2</span><span class="p">)</span><span class="o">/</span><span class="mi">1000</span>
    <span class="k">return</span><span class="p">(</span><span class="n">distance</span><span class="p">)</span>

</code></pre></div><h4 id="calculating-price-of-transport">Calculating Price of Transport</h4>
<p>The cost of transport accounts for port fees, liquification, and transport.   Unfortunately, my data is from a paper published in 2004.  I would like to find a more recent paper.   I did not convert the value of 2004 USD to 2022 because I am not sure of the validity of the conversion factors available online.  I would need a better source to correctly model the true cost of transport.</p>
<p><a href="https://ieaghg.org/docs/General_Docs/Reports/PH4-30%20Ship%20Transport.pdf">source</a></p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python">
<span class="k">def</span> <span class="nf">price_to_transport</span><span class="p">(</span><span class="n">distance</span><span class="p">,</span><span class="n">tonnes</span><span class="p">):</span>
    <span class="n">price</span> <span class="o">=</span> <span class="p">(</span><span class="n">distance</span><span class="o">/</span><span class="mi">100</span><span class="p">)</span> <span class="o">*</span> <span class="mi">12</span> <span class="o">*</span> <span class="n">tonnes</span>
    <span class="k">return</span> <span class="n">price</span>

</code></pre></div><h3 id="calculating-cost-per-day">Calculating Cost Per Day</h3>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="k">def</span> <span class="nf">cost_per_day</span><span class="p">(</span><span class="n">price</span><span class="p">,</span><span class="n">distance</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">price</span><span class="o">/</span><span class="n">distance</span>
</code></pre></div><h2 id="costs-per-annum-algorithm">Costs Per Annum Algorithm</h2>
<p>The algorithm I used calculates the daily status of ships transporting CO2 across the Atlantic from a random European port to a random port in the United States.  It will run for 365 iterations or until the total carbon capacity of the US ports is reached.  This value could and probably should be dynamically allocated via a similiar algorithm, but I do not yet have historical probability distributions of carbon imports to determime a valid price allocation function.</p>
<p>When the daily counter reaches zero for a tanker:</p>
<ul>
<li>The capacity is refilled to full.</li>
<li>A random us port is assigned.</li>
<li>A random European port is assigned.</li>
<li>The distance between ports is calculated.</li>
<li>The cost of transport over that distance is calculated per 100 km.</li>
<li>The total shipping price of that cycle is tabulated.</li>
<li>The total tonnage of that cycle is tabulated.</li>
</ul>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python">
<span class="n">days</span> <span class="o">=</span> <span class="mi">365</span>
<span class="n">day_counter</span> <span class="o">=</span> <span class="mi">0</span> 
<span class="n">carbon_total_millions_metric_tons</span> <span class="o">=</span> <span class="mi">300000000</span>
<span class="n">total_tons_shipped</span> <span class="o">=</span> <span class="mi">0</span>
<span class="n">total_price</span> <span class="o">=</span> <span class="mi">0</span>
<span class="n">cycle_mean_price_samples</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">shape</span><span class="o">=</span><span class="n">days</span><span class="p">)</span>

<span class="c1">#deduction = capacity of empty ships</span>
<span class="k">for</span> <span class="n">day</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">days</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">carbon_total_millions_metric_tons</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">:</span>
        <span class="c1"># must use apply to account for multiple 0 conditions.  If i simply vectorized the function across the dataframe in a single call i would assign the the same values each day </span>
        <span class="n">shipping_df</span><span class="p">[</span><span class="s1">&#39;days_to_port&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">shipping_df</span><span class="p">[</span><span class="s1">&#39;days_to_port&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="mi">1</span>
        <span class="n">shipping_df</span><span class="p">[</span><span class="s1">&#39;us_port&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">shipping_df</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span>  <span class="n">random_us_port</span><span class="p">()</span> <span class="k">if</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;days_to_port&#39;</span><span class="p">]</span><span class="o">&lt;=</span><span class="mi">0</span> <span class="k">else</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;us_port&#39;</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">shipping_df</span><span class="p">[</span><span class="s1">&#39;europe_port&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">shipping_df</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span>  <span class="n">random_europe_port</span><span class="p">()</span> <span class="k">if</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;days_to_port&#39;</span><span class="p">]</span><span class="o">&lt;=</span><span class="mi">0</span> <span class="k">else</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;europe_port&#39;</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">shipping_df</span><span class="p">[</span><span class="s1">&#39;distance&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">shipping_df</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span>  <span class="n">geo_distance</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;us_port&#39;</span><span class="p">],</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;europe_port&#39;</span><span class="p">])</span> <span class="k">if</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;days_to_port&#39;</span><span class="p">]</span><span class="o">&lt;=</span><span class="mi">0</span> <span class="k">else</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;distance&#39;</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">shipping_df</span><span class="p">[</span><span class="s1">&#39;price&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">shipping_df</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span>  <span class="n">price_to_transport</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;distance&#39;</span><span class="p">],</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;co2_capacity_tonnes&#39;</span><span class="p">])</span> <span class="k">if</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;days_to_port&#39;</span><span class="p">]</span><span class="o">&lt;=</span><span class="mi">0</span> <span class="k">else</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;price&#39;</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="c1">#calculate cost per day for fun...</span>
        <span class="c1"># query all that are = o.  Summate the capacities deduct the total </span>
        <span class="n">tmp_df</span><span class="o">=</span><span class="n">shipping_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">shipping_df</span><span class="p">[</span><span class="s1">&#39;days_to_port&#39;</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">]</span>
        <span class="n">sum_of_capacity</span> <span class="o">=</span> <span class="n">tmp_df</span><span class="p">[</span><span class="s1">&#39;co2_capacity_tonnes&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
        <span class="n">sum_of_price</span> <span class="o">=</span> <span class="n">tmp_df</span><span class="p">[</span><span class="s1">&#39;price&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
        <span class="n">mean_of_price</span> <span class="o">=</span> <span class="n">tmp_df</span><span class="p">[</span><span class="s1">&#39;price&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
        <span class="n">cycle_mean_price_samples</span><span class="p">[</span><span class="n">day</span><span class="p">]</span> <span class="o">=</span> <span class="n">mean_of_price</span>
        <span class="n">shipping_df</span><span class="p">[</span><span class="s1">&#39;days_to_port&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">shipping_df</span><span class="p">[</span><span class="s1">&#39;days_to_port&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">random_day</span><span class="p">()</span> <span class="k">if</span> <span class="n">x</span><span class="o">&lt;=</span><span class="mi">0</span> <span class="k">else</span> <span class="n">x</span><span class="p">)</span>
        <span class="n">total_tons_shipped</span> <span class="o">=</span> <span class="n">total_tons_shipped</span> <span class="o">+</span> <span class="n">sum_of_capacity</span>
        <span class="n">total_price</span> <span class="o">=</span> <span class="n">total_price</span> <span class="o">+</span> <span class="n">sum_of_price</span>
        <span class="n">carbon_total_millions_metric_tons</span> <span class="o">=</span> <span class="n">carbon_total_millions_metric_tons</span> <span class="o">-</span> <span class="n">sum_of_capacity</span>
        <span class="c1">#print(carbon_total_millions_metric_tons)</span>
        <span class="n">day_counter</span> <span class="o">=</span> <span class="n">day_counter</span><span class="o">+</span><span class="mi">1</span>
    <span class="k">else</span><span class="p">:</span> 
        <span class="k">break</span>

    
    
<span class="nb">print</span><span class="p">(</span><span class="n">day_counter</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">total_tons_shipped</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">total_price</span><span class="p">)</span>
<span class="c1">#Drop the nan, ie empty samples</span>
<span class="n">cycle_mean_price</span> <span class="o">=</span> <span class="n">cycle_mean_price_samples</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">logical_not</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">cycle_mean_price_samples</span><span class="p">))]</span>
<span class="c1">#Calculate mean price of filling a ship (around a billion according to the data i have if filled to capacity.  Ridiculous.)</span>
<span class="n">cycle_mean_price</span> <span class="o">=</span> <span class="n">cycle_mean_price</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="n">cycle_mean_price</span><span class="p">)</span>

</code></pre></div><pre><code>365
41073.187985943456
60039059.413350895
308098.2720296601
</code></pre>
<h2 id="monte-carlo-simulation-with-500-iterations">Monte Carlo Simulation with 500 iterations</h2>
<p>The annual rate of shipping can be variable according to shifting dynamics. I account for that by modeling the per annum algorithm 500 times.  Modeling would improve as n increases, but for the sake of time I limited the computation to 500 iterations</p>
<p>The only difference between this algorithm and the previous one is an extra for loop.  The algorithmic efficiency is surprisingly good as the I was able to vectorize tabulations with lambda functions across the dataframes.  On my laptop, I was able to complete the algorithm in about 16 minutes of run time.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python">
<span class="n">nsamples</span> <span class="o">=</span> <span class="mi">500</span>
<span class="n">price_samples</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">shape</span><span class="o">=</span><span class="n">nsamples</span><span class="p">)</span>
<span class="n">cycle_mean_price_annual_samples</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">shape</span><span class="o">=</span><span class="n">nsamples</span><span class="p">)</span>

<span class="k">for</span> <span class="n">sample</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nsamples</span><span class="p">):</span>

    <span class="n">days</span> <span class="o">=</span> <span class="mi">365</span>
    <span class="n">day_counter</span> <span class="o">=</span> <span class="mi">0</span> 
    <span class="n">carbon_total_millions_metric_tons</span> <span class="o">=</span> <span class="mi">300000000</span> <span class="c1"># could randomize.  Need a probability distribution based on historial data. </span>
    <span class="n">total_tons_shipped</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">total_price</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">cycle_mean_price_daily_samples</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">shape</span><span class="o">=</span><span class="n">days</span><span class="p">)</span>


    <span class="c1">#deduction = capacity of empty ships</span>
    <span class="k">for</span> <span class="n">day</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">days</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">carbon_total_millions_metric_tons</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="c1"># must use apply to account for multiple 0 conditions.  If i simply vectorized the function across the dataframe in a single call i would assign the the same values each day </span>
            <span class="n">shipping_df</span><span class="p">[</span><span class="s1">&#39;days_to_port&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">shipping_df</span><span class="p">[</span><span class="s1">&#39;days_to_port&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="mi">1</span>
            <span class="n">shipping_df</span><span class="p">[</span><span class="s1">&#39;us_port&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">shipping_df</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span>  <span class="n">random_us_port</span><span class="p">()</span> <span class="k">if</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;days_to_port&#39;</span><span class="p">]</span><span class="o">&lt;=</span><span class="mi">0</span> <span class="k">else</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;us_port&#39;</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
            <span class="n">shipping_df</span><span class="p">[</span><span class="s1">&#39;europe_port&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">shipping_df</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span>  <span class="n">random_europe_port</span><span class="p">()</span> <span class="k">if</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;days_to_port&#39;</span><span class="p">]</span><span class="o">&lt;=</span><span class="mi">0</span> <span class="k">else</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;europe_port&#39;</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
            <span class="n">shipping_df</span><span class="p">[</span><span class="s1">&#39;distance&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">shipping_df</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span>  <span class="n">geo_distance</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;us_port&#39;</span><span class="p">],</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;europe_port&#39;</span><span class="p">])</span> <span class="k">if</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;days_to_port&#39;</span><span class="p">]</span><span class="o">&lt;=</span><span class="mi">0</span> <span class="k">else</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;distance&#39;</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
            <span class="n">shipping_df</span><span class="p">[</span><span class="s1">&#39;price&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">shipping_df</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span>  <span class="n">price_to_transport</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;distance&#39;</span><span class="p">],</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;co2_capacity_tonnes&#39;</span><span class="p">])</span> <span class="k">if</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;days_to_port&#39;</span><span class="p">]</span><span class="o">&lt;=</span><span class="mi">0</span> <span class="k">else</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;price&#39;</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
            <span class="c1"># query all that are = o.  Summate the capacities deduct the total </span>
            <span class="n">tmp_df</span><span class="o">=</span><span class="n">shipping_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">shipping_df</span><span class="p">[</span><span class="s1">&#39;days_to_port&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">]</span>
            <span class="n">sum_of_capacity</span> <span class="o">=</span> <span class="n">tmp_df</span><span class="p">[</span><span class="s1">&#39;co2_capacity_tonnes&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
            <span class="n">sum_of_price</span> <span class="o">=</span> <span class="n">tmp_df</span><span class="p">[</span><span class="s1">&#39;price&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
            <span class="n">mean_of_price</span> <span class="o">=</span> <span class="n">tmp_df</span><span class="p">[</span><span class="s1">&#39;price&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
            <span class="n">cycle_mean_price_daily_samples</span><span class="p">[</span><span class="n">day</span><span class="p">]</span> <span class="o">=</span> <span class="n">mean_of_price</span>
            <span class="n">shipping_df</span><span class="p">[</span><span class="s1">&#39;days_to_port&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">shipping_df</span><span class="p">[</span><span class="s1">&#39;days_to_port&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">random_day</span><span class="p">()</span> <span class="k">if</span> <span class="n">x</span><span class="o">&lt;=</span><span class="mi">0</span> <span class="k">else</span> <span class="n">x</span><span class="p">)</span>
            <span class="n">total_tons_shipped</span> <span class="o">=</span> <span class="n">total_tons_shipped</span> <span class="o">+</span> <span class="n">sum_of_capacity</span>
            <span class="n">total_price</span> <span class="o">=</span> <span class="n">total_price</span> <span class="o">+</span> <span class="n">sum_of_price</span>
            <span class="n">carbon_total_millions_metric_tons</span> <span class="o">=</span> <span class="n">carbon_total_millions_metric_tons</span> <span class="o">-</span> <span class="n">sum_of_capacity</span>
            <span class="c1">#print(carbon_total_millions_metric_tons)</span>
            <span class="n">day_counter</span> <span class="o">=</span> <span class="n">day_counter</span><span class="o">+</span><span class="mi">1</span>
        <span class="k">else</span><span class="p">:</span> 
            <span class="k">break</span>

    <span class="c1">#Drop the nan, ie empty samples</span>
    <span class="n">cycle_mean_price</span> <span class="o">=</span> <span class="n">cycle_mean_price_samples</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">logical_not</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">cycle_mean_price_samples</span><span class="p">))]</span>
    <span class="c1">#Calculate mean price of filling a ship (around a billion according to the data i have if filled to capacity.  Ridiculous.)</span>
    <span class="n">cycle_mean_price</span> <span class="o">=</span> <span class="n">cycle_mean_price</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
    <span class="n">cycle_mean_price_annual_samples</span><span class="p">[</span><span class="n">sample</span><span class="p">]</span> <span class="o">=</span><span class="n">cycle_mean_price</span>
        
    

    <span class="n">price_samples</span><span class="p">[</span><span class="n">sample</span><span class="p">]</span> <span class="o">=</span> <span class="n">total_price</span>

        

</code></pre></div><h3 id="creating-the-annual-price-samples-df">Creating the Annual Price Samples DF</h3>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="n">annual_price_samples_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">price_samples</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;cost_in_usd&#39;</span><span class="p">])</span>
</code></pre></div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="n">annual_price_samples_df</span><span class="p">[</span><span class="s1">&#39;cost_in_usd_billions&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">annual_price_samples_df</span><span class="o">.</span><span class="n">cost_in_usd</span> 
</code></pre></div><h2 id="imports">Imports</h2>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">geopandas</span> <span class="k">as</span> <span class="nn">gpd</span>
<span class="kn">import</span> <span class="nn">folium</span>
<span class="kn">import</span> <span class="nn">contextily</span> <span class="k">as</span> <span class="nn">cx</span>
<span class="kn">import</span> <span class="nn">rtree</span>
<span class="kn">from</span> <span class="nn">zlib</span> <span class="kn">import</span> <span class="n">crc32</span>
<span class="kn">import</span> <span class="nn">hashlib</span>
<span class="kn">from</span> <span class="nn">shapely.geometry</span> <span class="kn">import</span> <span class="n">Point</span><span class="p">,</span> <span class="n">LineString</span><span class="p">,</span> <span class="n">Polygon</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">from</span> <span class="nn">scipy.spatial</span> <span class="kn">import</span> <span class="n">cKDTree</span>
<span class="kn">import</span> <span class="nn">scipy.stats</span> <span class="k">as</span> <span class="nn">st</span>
<span class="kn">from</span> <span class="nn">shapely.geometry</span> <span class="kn">import</span> <span class="n">Point</span>
<span class="kn">from</span> <span class="nn">haversine</span> <span class="kn">import</span> <span class="n">Unit</span>
<span class="kn">from</span> <span class="nn">geopy.distance</span> <span class="kn">import</span> <span class="n">distance</span>

<span class="kn">import</span> <span class="nn">warnings</span>

<span class="n">warnings</span><span class="o">.</span><span class="n">filterwarnings</span><span class="p">(</span><span class="s1">&#39;ignore&#39;</span><span class="p">)</span>

</code></pre></div><pre><code>/Users/jnapolitano/venvs/finance/lib/python3.9/site-packages/geopandas/_compat.py:111: UserWarning: The Shapely GEOS version (3.10.2-CAPI-1.16.0) is incompatible with the GEOS version PyGEOS was compiled with (3.10.1-CAPI-1.16.0). Conversions between both will be slow.
  warnings.warn(
</code></pre>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python">
</code></pre></div>]]></content>
			<postid> d0547a51c0ff8492b0c1be4c8f830192</postid>
			<author>Justin Napolitano</author>
			<author_name>Justin Napolitano</author_name>
			<author_email>personal.jnapolitano@gmail.com</author_email>
			<author_id>87654367b2fca109e7dc9d3ea8a1ebbaf0bfe374773b148c2c20d278479add99</author_id>			
		</item>
		
		<item>
			<title>Potential Carbon and Hydrogen Storage Facilities Near Import/Export Ports</title>
			<link>jnapolitano.com/posts/wells-near-ports/</link>
			<pubDate>Fri, 06 May 2022 08:30:32 +0000</pubDate>
			<guid>jnapolitano.com/posts/wells-near-ports/</guid>
			<description><![CDATA[Identifying potential carbon and hydrogen storage facilities near lng ports.]]></description>
			<content type="html"><![CDATA[<h1 id="potential-carbon-storage-facilities-near-importexport-ports">Potential Carbon Storage Facilities Near Import/Export Ports</h1>
<h2 id="import-and-procedural-functions">Import and Procedural Functions</h2>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">geopandas</span> <span class="k">as</span> <span class="nn">gpd</span>
<span class="kn">import</span> <span class="nn">folium</span>
<span class="kn">import</span> <span class="nn">contextily</span> <span class="k">as</span> <span class="nn">cx</span>
<span class="kn">import</span> <span class="nn">rtree</span>
<span class="kn">from</span> <span class="nn">zlib</span> <span class="kn">import</span> <span class="n">crc32</span>
<span class="kn">import</span> <span class="nn">hashlib</span>
<span class="kn">from</span> <span class="nn">shapely.geometry</span> <span class="kn">import</span> <span class="n">Point</span><span class="p">,</span> <span class="n">LineString</span><span class="p">,</span> <span class="n">Polygon</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">from</span> <span class="nn">scipy.spatial</span> <span class="kn">import</span> <span class="n">cKDTree</span>
<span class="kn">from</span> <span class="nn">shapely.geometry</span> <span class="kn">import</span> <span class="n">Point</span>
<span class="kn">from</span> <span class="nn">haversine</span> <span class="kn">import</span> <span class="n">Unit</span>
<span class="kn">from</span> <span class="nn">geopy.distance</span> <span class="kn">import</span> <span class="n">distance</span>
</code></pre></div><h2 id="restrictions">Restrictions</h2>
<ul>
<li>Must be near a pipeline terminal</li>
<li>Must be Near a petrolium Port</li>
</ul>
<h3 id="query-plan">Query Plan</h3>
<p>Imports</p>
<ul>
<li>Import LNG terminal Data</li>
<li>Import well data</li>
</ul>
<p>Filtering</p>
<ul>
<li>for each well calculate nearest terminal</li>
<li>for each well calculate distance from nearest terminal</li>
<li>eliminate wells further than 15 miles from a terminal</li>
</ul>
<h2 id="data-frame-import">Data Frame Import</h2>
<h3 id="wells-dataframe">Wells DataFrame</h3>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="c1">## Importing our DataFrames</span>

<span class="n">gisfilepath</span> <span class="o">=</span> <span class="s2">&#34;/Users/jnapolitano/Projects/data/energy/non-active-wells.geojson&#34;</span>


<span class="n">wells_df</span> <span class="o">=</span> <span class="n">gpd</span><span class="o">.</span><span class="n">read_file</span><span class="p">(</span><span class="n">gisfilepath</span><span class="p">)</span>

<span class="n">wells_df</span> <span class="o">=</span> <span class="n">wells_df</span><span class="o">.</span><span class="n">to_crs</span><span class="p">(</span><span class="n">epsg</span><span class="o">=</span><span class="mi">3857</span><span class="p">)</span>


</code></pre></div><h3 id="terminal-dataframe">Terminal DataFrame</h3>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="c1">## Importing our DataFrames</span>

<span class="n">gisfilepath</span> <span class="o">=</span> <span class="s2">&#34;/Users/jnapolitano/Projects/data/energy/Liquified_Natural_Gas_Import_Exports_and_Terminals.geojson&#34;</span>


<span class="n">terminal_df</span> <span class="o">=</span> <span class="n">gpd</span><span class="o">.</span><span class="n">read_file</span><span class="p">(</span><span class="n">gisfilepath</span><span class="p">)</span>

<span class="n">terminal_df</span> <span class="o">=</span> <span class="n">terminal_df</span><span class="o">.</span><span class="n">to_crs</span><span class="p">(</span><span class="n">epsg</span><span class="o">=</span><span class="mi">3857</span><span class="p">)</span>


</code></pre></div><h3 id="eliminating-suspended-terminal-from-the-dataframe">Eliminating SUSPENDED Terminal from the DataFrame</h3>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="n">terminal_df</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">terminal_df</span><span class="p">[</span><span class="n">terminal_df</span><span class="p">[</span><span class="s1">&#39;STATUS&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;SUSPENDED&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="n">inplace</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>
<span class="n">terminal_df</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="s2">&#34;NAME&#34;</span><span class="p">:</span> <span class="s2">&#34;TERMINAL_NAME&#34;</span><span class="p">})</span>
<span class="n">terminal_df</span><span class="p">[</span><span class="s1">&#39;TERMINAL_GEO&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">terminal_df</span><span class="p">[</span><span class="s1">&#39;geometry&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<span class="n">terminal_df</span><span class="o">.</span><span class="n">columns</span>
</code></pre></div><pre><code>Index(['OBJECTID', 'TERMID', 'NAME', 'ADDRESS', 'CITY', 'STATE', 'ZIP', 'ZIP4',
       'TELEPHONE', 'TYPE', 'STATUS', 'POPULATION', 'COUNTY', 'COUNTYFIPS',
       'COUNTRY', 'LATITUDE', 'LONGITUDE', 'NAICS_CODE', 'NAICS_DESC',
       'SOURCE', 'SOURCEDATE', 'VAL_METHOD', 'VAL_DATE', 'WEBSITE', 'EPA_ID',
       'ALT_NAME', 'OWNER', 'POSREL', 'JRSDCTN', 'CONTYPE', 'IE_PORT',
       'BERTHS', 'STORAGE', 'STORCAP', 'CURRENTCAP', 'APPCAP', 'OPYEAR',
       'IMPEXPCTRY', 'VOLUME', 'PRICE', 'geometry', 'TERMINAL_GEO'],
      dtype='object')
</code></pre>
<h3 id="plotting-terminal-by-type">Plotting Terminal by TYPE</h3>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="n">terminal_map</span> <span class="o">=</span><span class="n">terminal_df</span><span class="o">.</span><span class="n">explore</span><span class="p">(</span>
    <span class="n">column</span><span class="o">=</span><span class="s2">&#34;TYPE&#34;</span><span class="p">,</span> <span class="c1"># make choropleth based on &#34;PORT_NAME&#34; column</span>
     <span class="n">popup</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="c1"># show all values in popup (on click)</span>
     <span class="n">tiles</span><span class="o">=</span><span class="s2">&#34;Stamen Terrain&#34;</span><span class="p">,</span> <span class="c1"># use &#34;CartoDB positron&#34; tiles</span>
     <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;Set1&#39;</span><span class="p">,</span> <span class="c1"># use &#34;Set1&#34; matplotlib colormap</span>
     <span class="c1">#style_kwds=dict(color=&#34;black&#34;),</span>
     <span class="n">marker_kwds</span><span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">radius</span><span class="o">=</span><span class="mi">6</span><span class="p">),</span>
     <span class="c1">#tooltip=[&#39;NAICS_DESC&#39;,&#39;REGION&#39;, &#39;COMMODITY&#39; ],</span>
     <span class="n">legend</span> <span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="c1"># use black outline)</span>
     <span class="n">categorical</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="p">)</span>


<span class="n">terminal_map</span>
</code></pre></div><!-- raw HTML omitted -->
<h3 id="terminal-impressions">Terminal Impressions</h3>
<p>According to the data there is not an export nor import location on The Western Side of the United States.</p>
<p>East Asian import or carbon capture export demands could justfity port development.  Another study must be conducted.</p>
<h2 id="filtering-wells-by-terminal-distance-in-scipy">Filtering Wells by Terminal Distance in Scipy</h2>
<h3 id="edit">Edit</h3>
<p>This method does not accuraletly calculate distance.  The algorith used below calculates distance on a euclidan plane.  In order to calculate a correct answer we must account for sphericity.</p>
<p>I include the code below as reference and a learning opportunity</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="k">def</span> <span class="nf">ckdnearest</span><span class="p">(</span><span class="n">gdA</span><span class="p">,</span> <span class="n">gdB</span><span class="p">):</span>

    <span class="n">nA</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">gdA</span><span class="o">.</span><span class="n">geometry</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="n">x</span><span class="o">.</span><span class="n">y</span><span class="p">))))</span>
    <span class="n">nB</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">gdB</span><span class="o">.</span><span class="n">geometry</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="n">x</span><span class="o">.</span><span class="n">y</span><span class="p">))))</span>
    <span class="n">btree</span> <span class="o">=</span> <span class="n">cKDTree</span><span class="p">(</span><span class="n">nB</span><span class="p">)</span>
    <span class="n">dist</span><span class="p">,</span> <span class="n">idx</span> <span class="o">=</span> <span class="n">btree</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">nA</span><span class="p">,</span> <span class="n">k</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">gdB_nearest</span> <span class="o">=</span> <span class="n">gdB</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="s2">&#34;geometry&#34;</span><span class="p">)</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">gdf</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span>
        <span class="p">[</span>
            <span class="n">gdA</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">),</span>
            <span class="n">gdB_nearest</span><span class="p">,</span>
            <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">dist</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;dist&#39;</span><span class="p">)</span>
        <span class="p">],</span> 
        <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">gdf</span>

<span class="n">c</span> <span class="o">=</span> <span class="n">ckdnearest</span><span class="p">(</span><span class="n">wells_df</span><span class="p">,</span> <span class="n">terminal_df</span><span class="p">)</span>

</code></pre></div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="n">c</span><span class="o">.</span><span class="n">describe</span><span class="p">()</span>
</code></pre></div><!-- raw HTML omitted -->
<pre><code>.dataframe tbody tr th {
    vertical-align: top;
}

.dataframe thead th {
    text-align: right;
}
</code></pre>
<p><!-- raw HTML omitted --></p>
<!-- raw HTML omitted -->
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="n">nearest_wells_df</span><span class="o">=</span> <span class="n">wells_df</span><span class="o">.</span><span class="n">sjoin_nearest</span><span class="p">(</span><span class="n">terminal_df</span><span class="p">,</span> <span class="n">distance_col</span><span class="o">=</span><span class="s2">&#34;distance_euclidian&#34;</span><span class="p">)</span>
</code></pre></div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="n">nearest_wells_df</span><span class="o">.</span><span class="n">describe</span><span class="p">()</span>
</code></pre></div><!-- raw HTML omitted -->
<pre><code>.dataframe tbody tr th {
    vertical-align: top;
}

.dataframe thead th {
    text-align: right;
}
</code></pre>
<p><!-- raw HTML omitted --></p>
<!-- raw HTML omitted -->
<h3 id="calculating-distance-in-kilometers-from-importexport-terminal">Calculating Distance in Kilometers from Import/Export Terminal</h3>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="c1">#df.geopy.distance.distance(coords_1, coords_2).km</span>
<span class="c1">#df.apply(lambda row: distance(row[&#39;point&#39;], row[&#39;point_next&#39;]).km if row[&#39;point_next&#39;] is not None else float(&#39;nan&#39;), axis=1)</span>
<span class="c1"># Thanks to https://stackoverflow.com/questions/55909305/using-geopy-in-a-dataframe-to-get-distances</span>

<span class="n">nearest_wells_df</span><span class="p">[</span><span class="s1">&#39;true_distance_km&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">nearest_wells_df</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">row</span><span class="p">:</span> <span class="n">distance</span><span class="p">((</span><span class="n">row</span><span class="p">[</span><span class="s1">&#39;LATITUDE_left&#39;</span><span class="p">],</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;LONGITUDE_left&#39;</span><span class="p">]),</span> <span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="s1">&#39;LATITUDE_right&#39;</span><span class="p">],</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;LONGITUDE_right&#39;</span><span class="p">]))</span><span class="o">.</span><span class="n">km</span> <span class="k">if</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;geometry&#39;</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="nb">float</span><span class="p">(</span><span class="s1">&#39;nan&#39;</span><span class="p">),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

</code></pre></div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="n">nearest_wells_df</span><span class="o">.</span><span class="n">describe</span><span class="p">()</span>
</code></pre></div><!-- raw HTML omitted -->
<pre><code>.dataframe tbody tr th {
    vertical-align: top;
}

.dataframe thead th {
    text-align: right;
}
</code></pre>
<p><!-- raw HTML omitted --></p>
<!-- raw HTML omitted -->
<h3 id="filtering-wells-within-50-km-of-a-terminal">Filtering Wells within 50 KM of a Terminal</h3>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="n">filtered_wells</span> <span class="o">=</span> <span class="n">nearest_wells_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">nearest_wells_df</span><span class="p">[</span><span class="s1">&#39;true_distance_km&#39;</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mi">50</span><span class="p">]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</code></pre></div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="n">filtered_wells</span><span class="o">.</span><span class="n">describe</span><span class="p">()</span>
</code></pre></div><!-- raw HTML omitted -->
<pre><code>.dataframe tbody tr th {
    vertical-align: top;
}

.dataframe thead th {
    text-align: right;
}
</code></pre>
<p><!-- raw HTML omitted --></p>
<!-- raw HTML omitted -->
<h3 id="map-of-wells-within-50-km-of-an-importexport-terminal-by-type">Map of Wells within 50 km of an Import/Export Terminal by Type</h3>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="n">filtered_wells</span><span class="o">.</span><span class="n">explore</span><span class="p">(</span>
    <span class="n">column</span><span class="o">=</span><span class="s2">&#34;STATUS_left&#34;</span><span class="p">,</span> <span class="c1"># make choropleth based on &#34;PORT_NAME&#34; column</span>
     <span class="n">popup</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="c1"># show all values in popup (on click)</span>
     <span class="n">tiles</span><span class="o">=</span><span class="s2">&#34;Stamen Terrain&#34;</span><span class="p">,</span> <span class="c1"># use &#34;CartoDB positron&#34; tiles</span>
     <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;Set1&#39;</span><span class="p">,</span> <span class="c1"># use &#34;Set1&#34; matplotlib colormap</span>
     <span class="c1">#style_kwds=dict(color=&#34;black&#34;),</span>
     <span class="n">marker_kwds</span><span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">radius</span><span class="o">=</span><span class="mi">6</span><span class="p">),</span>
     <span class="c1">#tooltip=[&#39;NAICS_DESC&#39;,&#39;REGION&#39;, &#39;COMMODITY&#39; ],</span>
     <span class="n">legend</span> <span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="c1"># use black outline)</span>
     <span class="n">categorical</span><span class="o">=</span><span class="kc">True</span><span class="p">,)</span>
</code></pre></div><!-- raw HTML omitted -->
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python">
</code></pre></div>]]></content>
			<postid> 8c061e5781494b7cf69ce174f8d317bb</postid>
			<author>Justin Napolitano</author>
			<author_name>Justin Napolitano</author_name>
			<author_email>personal.jnapolitano@gmail.com</author_email>
			<author_id>87654367b2fca109e7dc9d3ea8a1ebbaf0bfe374773b148c2c20d278479add99</author_id>			
		</item>
		
		<item>
			<title>Potential Carbon and Hydrogen Storage Wells Near Pipelines</title>
			<link>jnapolitano.com/posts/wells-near-pipelines/</link>
			<pubDate>Fri, 06 May 2022 05:30:32 +0000</pubDate>
			<guid>jnapolitano.com/posts/wells-near-pipelines/</guid>
			<description><![CDATA[Identifying potential carbon and hydrogen storage facilities from spent well data.]]></description>
			<content type="html"><![CDATA[<h1 id="potential-carbon-storage-wells-near-pipelines">Potential Carbon Storage Wells Near Pipelines</h1>
<h2 id="import-and-procedural-functions">Import and Procedural Functions</h2>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">geopandas</span> <span class="k">as</span> <span class="nn">gpd</span>
<span class="kn">import</span> <span class="nn">folium</span>
<span class="kn">import</span> <span class="nn">contextily</span> <span class="k">as</span> <span class="nn">cx</span>
<span class="kn">import</span> <span class="nn">rtree</span>
<span class="kn">from</span> <span class="nn">zlib</span> <span class="kn">import</span> <span class="n">crc32</span>
<span class="kn">import</span> <span class="nn">hashlib</span>
<span class="kn">from</span> <span class="nn">shapely.geometry</span> <span class="kn">import</span> <span class="n">Point</span><span class="p">,</span> <span class="n">LineString</span><span class="p">,</span> <span class="n">Polygon</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">from</span> <span class="nn">scipy.spatial</span> <span class="kn">import</span> <span class="n">cKDTree</span>
<span class="kn">from</span> <span class="nn">shapely.geometry</span> <span class="kn">import</span> <span class="n">Point</span>
<span class="kn">from</span> <span class="nn">haversine</span> <span class="kn">import</span> <span class="n">Unit</span>
<span class="kn">from</span> <span class="nn">geopy.distance</span> <span class="kn">import</span> <span class="n">distance</span>
</code></pre></div><h2 id="query-plan">Query Plan</h2>
<h3 id="restrictions">Restrictions</h3>
<ul>
<li>Must be near a pipeline terminal</li>
</ul>
<h3 id="imports">Imports</h3>
<ul>
<li>Pipeline Data</li>
<li>Well Data</li>
</ul>
<h3 id="filtering">Filtering</h3>
<ul>
<li>
<p>For each well calculate nearest pipeline</p>
</li>
<li>
<p>For each well calculate geographic distance from pipeline</p>
</li>
<li>
<p>eliminate wells further than 2 km from a pipeline</p>
</li>
</ul>
<h2 id="data-frame-import">Data Frame Import</h2>
<h3 id="wells-dataframe">Wells Dataframe</h3>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="c1">## Importing our DataFrames</span>

<span class="n">gisfilepath</span> <span class="o">=</span> <span class="s2">&#34;/Users/jnapolitano/Projects/data/energy/non-active-wells.geojson&#34;</span>


<span class="n">wells_df</span> <span class="o">=</span> <span class="n">gpd</span><span class="o">.</span><span class="n">read_file</span><span class="p">(</span><span class="n">gisfilepath</span><span class="p">)</span>

<span class="n">wells_df</span> <span class="o">=</span> <span class="n">wells_df</span><span class="o">.</span><span class="n">to_crs</span><span class="p">(</span><span class="n">epsg</span><span class="o">=</span><span class="mi">3857</span><span class="p">)</span>
</code></pre></div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="n">wells_df</span><span class="o">.</span><span class="n">columns</span>
</code></pre></div><pre><code>Index(['index', 'OBJECTID', 'ID', 'NAME', 'STATE', 'TYPE', 'STATUS', 'COUNTY',
       'COUNTYFIPS', 'COUNTRY', 'LATITUDE', 'LONGITUDE', 'NAICS_CODE',
       'NAICS_DESC', 'SOURCE', 'SOURCEDATE', 'VAL_METHOD', 'VAL_DATE',
       'WEBSITE', 'WELLIDNO', 'API', 'PERMITNO', 'OPERATOR', 'OPERATORID',
       'PRODTYPE', 'COORDTYPE', 'SURF_LAT', 'SURF_LONG', 'BOT_LAT', 'BOT_LONG',
       'POSREL', 'FIELD', 'COMPDATE', 'TOTDEPTH', 'STAUTS_CAT', 'geometry'],
      dtype='object')
</code></pre>
<h3 id="pipeline-dataframe">Pipeline DataFrame</h3>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="c1">## Importing Pipeline Dataframe</span>

<span class="n">gisfilepath</span> <span class="o">=</span> <span class="s2">&#34;/Users/jnapolitano/Projects/data/energy/Natural_Gas_Pipelines.geojson&#34;</span>


<span class="n">pipeline_df</span> <span class="o">=</span> <span class="n">gpd</span><span class="o">.</span><span class="n">read_file</span><span class="p">(</span><span class="n">gisfilepath</span><span class="p">)</span>

<span class="n">pipeline_df</span> <span class="o">=</span> <span class="n">pipeline_df</span><span class="o">.</span><span class="n">to_crs</span><span class="p">(</span><span class="n">epsg</span><span class="o">=</span><span class="mi">3857</span><span class="p">)</span>
</code></pre></div><h4 id="removing-gathering-pipes-from-the-data">Removing Gathering Pipes from the Data</h4>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="n">pipeline_df</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">pipeline_df</span><span class="p">[</span><span class="n">pipeline_df</span><span class="p">[</span><span class="s1">&#39;TYPEPIPE&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;Gathering&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="n">inplace</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>
</code></pre></div><h4 id="adding-pipegeometry-column">Adding PipeGeometry Column</h4>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="n">pipeline_df</span><span class="p">[</span><span class="s1">&#39;PipeGeometry&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pipeline_df</span><span class="p">[</span><span class="s1">&#39;geometry&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</code></pre></div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="n">pipeline_df</span><span class="o">.</span><span class="n">columns</span>
</code></pre></div><pre><code>Index(['FID', 'TYPEPIPE', 'Operator', 'Shape_Leng', 'Shape__Length',
       'geometry', 'PipeGeometry'],
      dtype='object')
</code></pre>
<h2 id="joining-well-and-pipeline-data">Joining Well and Pipeline Data</h2>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="n">nearest_wells_df</span><span class="o">=</span> <span class="n">wells_df</span><span class="o">.</span><span class="n">sjoin_nearest</span><span class="p">(</span><span class="n">pipeline_df</span><span class="p">,</span> <span class="n">how</span> <span class="o">=</span> <span class="s1">&#39;left&#39;</span><span class="p">,</span> <span class="n">distance_col</span><span class="o">=</span><span class="s2">&#34;distance_euclidian&#34;</span><span class="p">)</span>
<span class="n">nearest_wells_df</span><span class="o">.</span><span class="n">columns</span>

</code></pre></div><pre><code>Index(['index', 'OBJECTID', 'ID', 'NAME', 'STATE', 'TYPE', 'STATUS', 'COUNTY',
       'COUNTYFIPS', 'COUNTRY', 'LATITUDE', 'LONGITUDE', 'NAICS_CODE',
       'NAICS_DESC', 'SOURCE', 'SOURCEDATE', 'VAL_METHOD', 'VAL_DATE',
       'WEBSITE', 'WELLIDNO', 'API', 'PERMITNO', 'OPERATOR', 'OPERATORID',
       'PRODTYPE', 'COORDTYPE', 'SURF_LAT', 'SURF_LONG', 'BOT_LAT', 'BOT_LONG',
       'POSREL', 'FIELD', 'COMPDATE', 'TOTDEPTH', 'STAUTS_CAT', 'geometry',
       'index_right', 'FID', 'TYPEPIPE', 'Operator', 'Shape_Leng',
       'Shape__Length', 'PipeGeometry', 'distance_euclidian'],
      dtype='object')
</code></pre>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="n">nearest_wells_df</span>
</code></pre></div><!-- raw HTML omitted -->
<pre><code>.dataframe tbody tr th {
    vertical-align: top;
}

.dataframe thead th {
    text-align: right;
}
</code></pre>
<p><!-- raw HTML omitted --></p>
<!-- raw HTML omitted -->
<h3 id="adding-a-distance-km-column">Adding a Distance Km Column</h3>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="n">nearest_wells_df</span><span class="p">[</span><span class="s1">&#39;distance_km&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">nearest_wells_df</span><span class="o">.</span><span class="n">distance_euclidian</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span> <span class="o">/</span> <span class="mi">1000</span><span class="p">)</span>
</code></pre></div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="n">filtered_wells</span> <span class="o">=</span> <span class="n">nearest_wells_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">nearest_wells_df</span><span class="p">[</span><span class="s1">&#39;distance_km&#39;</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</code></pre></div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="n">filtered_wells</span><span class="o">.</span><span class="n">describe</span><span class="p">()</span>
</code></pre></div><!-- raw HTML omitted -->
<pre><code>.dataframe tbody tr th {
    vertical-align: top;
}

.dataframe thead th {
    text-align: right;
}
</code></pre>
<p><!-- raw HTML omitted --></p>
<!-- raw HTML omitted -->
<h2 id="wells-base-map">Wells Base Map</h2>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="n">well_map_ax</span> <span class="o">=</span> <span class="n">filtered_wells</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">15</span><span class="p">,</span> <span class="mi">15</span><span class="p">),</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">edgecolor</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span> <span class="n">markersize</span> <span class="o">=</span> <span class="mf">.5</span><span class="p">)</span>
<span class="n">cx</span><span class="o">.</span><span class="n">add_basemap</span><span class="p">(</span><span class="n">well_map_ax</span><span class="p">,</span> <span class="n">zoom</span><span class="o">=</span><span class="mi">6</span><span class="p">)</span>
<span class="c1">#filtered_wells.plot()</span>
</code></pre></div><p><img src="wells_near_pipelines_files/wells_near_pipelines_23_0.png" alt="png"></p>
<h2 id="pipelines-base-map">Pipelines Base Map</h2>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="n">pipeline_map</span> <span class="o">=</span> <span class="n">pipeline_df</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">figsize</span> <span class="o">=</span> <span class="p">(</span><span class="mi">15</span><span class="p">,</span><span class="mi">15</span><span class="p">),</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,)</span>
<span class="n">cx</span><span class="o">.</span><span class="n">add_basemap</span><span class="p">(</span><span class="n">pipeline_map</span><span class="p">,</span> <span class="n">zoom</span><span class="o">=</span><span class="mi">6</span><span class="p">)</span>
</code></pre></div><p><img src="wells_near_pipelines_files/wells_near_pipelines_25_0.png" alt="png"></p>
<h2 id="pipeline-and-potential-carbon-storage-well-map">Pipeline and Potential Carbon Storage Well Map</h2>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="n">combined_map</span> <span class="o">=</span> <span class="n">wells_df</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span> <span class="o">=</span> <span class="n">pipeline_map</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">figsize</span> <span class="o">=</span> <span class="p">(</span><span class="mi">20</span><span class="p">,</span><span class="mi">20</span><span class="p">),</span> <span class="n">edgecolor</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span> <span class="n">markersize</span> <span class="o">=</span> <span class="mf">.5</span><span class="p">)</span>

<span class="c1">#cx.add_basemap(well_map, zoom=6)</span>
<span class="c1">#plt.show()</span>
</code></pre></div><pre><code>&lt;Figure size 432x288 with 0 Axes&gt;
</code></pre>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="n">combined_map</span><span class="o">.</span><span class="n">figure</span>
</code></pre></div><p><img src="wells_near_pipelines_files/wells_near_pipelines_28_0.png" alt="png"></p>
]]></content>
			<postid> f281eaf448d0735ce644be2acbbd7451</postid>
			<author>Justin Napolitano</author>
			<author_name>Justin Napolitano</author_name>
			<author_email>personal.jnapolitano@gmail.com</author_email>
			<author_id>87654367b2fca109e7dc9d3ea8a1ebbaf0bfe374773b148c2c20d278479add99</author_id>			
		</item>
		
		<item>
			<title>EuroZone Gas Imports and Exports</title>
			<link>jnapolitano.com/posts/european-gas-imports/</link>
			<pubDate>Thu, 05 May 2022 00:00:00 +0000</pubDate>
			<guid>jnapolitano.com/posts/european-gas-imports/</guid>
			<description><![CDATA[EuroZone Gas Imports and Exports.]]></description>
			<content type="html"><![CDATA[<h1 id="eurozone-gas-imports-and-exports">EuroZone Gas Imports and Exports</h1>
<h2 id="import-and-procedural-functions">Import and Procedural Functions</h2>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">from</span> <span class="nn">geopy.distance</span> <span class="kn">import</span> <span class="n">distance</span>
<span class="kn">import</span> <span class="nn">re</span> 
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">from</span> <span class="nn">IPython.core.display</span> <span class="kn">import</span> <span class="n">HTML</span>
<span class="c1">#import IPython.core.display as display</span>
</code></pre></div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="k">def</span> <span class="nf">hugo_safe_render</span><span class="p">(</span><span class="n">styler</span><span class="p">):</span>
    <span class="s2">&#34;&#34;&#34; Removes spacing from HTML output of df.style to prevent rendering issues in Hugo. &#34;&#34;&#34;</span>

    <span class="n">raw_html</span> <span class="o">=</span> <span class="n">styler</span><span class="o">.</span><span class="n">to_html</span><span class="p">()</span>
    <span class="n">clean_html</span> <span class="o">=</span> <span class="s1">&#39; &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">raw_html</span><span class="o">.</span><span class="n">split</span><span class="p">())</span>
    
    <span class="k">return</span> <span class="n">HTML</span><span class="p">(</span><span class="n">clean_html</span><span class="p">)</span>
    
</code></pre></div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="k">def</span> <span class="nf">magnify</span><span class="p">():</span>
    <span class="k">return</span> <span class="p">[</span><span class="nb">dict</span><span class="p">(</span><span class="n">selector</span><span class="o">=</span><span class="s2">&#34;th&#34;</span><span class="p">,</span>
                 <span class="n">props</span><span class="o">=</span><span class="p">[(</span><span class="s2">&#34;font-size&#34;</span><span class="p">,</span> <span class="s2">&#34;4pt&#34;</span><span class="p">)]),</span>
            <span class="nb">dict</span><span class="p">(</span><span class="n">selector</span><span class="o">=</span><span class="s2">&#34;td&#34;</span><span class="p">,</span>
                 <span class="n">props</span><span class="o">=</span><span class="p">[(</span><span class="s1">&#39;padding&#39;</span><span class="p">,</span> <span class="s2">&#34;0em 0em&#34;</span><span class="p">)]),</span>
            <span class="nb">dict</span><span class="p">(</span><span class="n">selector</span><span class="o">=</span><span class="s2">&#34;th:hover&#34;</span><span class="p">,</span>
                 <span class="n">props</span><span class="o">=</span><span class="p">[(</span><span class="s2">&#34;font-size&#34;</span><span class="p">,</span> <span class="s2">&#34;12pt&#34;</span><span class="p">)]),</span>
            <span class="nb">dict</span><span class="p">(</span><span class="n">selector</span><span class="o">=</span><span class="s2">&#34;tr:hover td:hover&#34;</span><span class="p">,</span>
                 <span class="n">props</span><span class="o">=</span><span class="p">[(</span><span class="s1">&#39;max-width&#39;</span><span class="p">,</span> <span class="s1">&#39;200px&#39;</span><span class="p">),</span>
                        <span class="p">(</span><span class="s1">&#39;font-size&#39;</span><span class="p">,</span> <span class="s1">&#39;12pt&#39;</span><span class="p">)])</span>
<span class="p">]</span>
</code></pre></div><h2 id="query-strategy">Query Strategy</h2>
<h3 id="imports">Imports</h3>
<p>TO many to list&hellip; I&rsquo;ll ad them as I go below</p>
<h2 id="glossary">Glossary</h2>
<h3 id="units">Units</h3>
<p>Data should be reported in Terajoules (TJ) on the basis of Gross calorific values (GCV) and in million
cubic metres (at 15oC and 760 mm Hg, i.e. Standard Conditions)</p>
<h4 id="source">Source</h4>
<p><a href="https://ec.europa.eu/eurostat/documents/38154/10015688/Gas-Instructions-2018.pdf/2c78ed79-88fe-47ce-91f6-6069081755fb">https://ec.europa.eu/eurostat/documents/38154/10015688/Gas-Instructions-2018.pdf/2c78ed79-88fe-47ce-91f6-6069081755fb</a></p>
<h2 id="data">Data</h2>
<h2 id="converting-all-tsv-to-csv-documents">Converting all tsv to csv documents</h2>
<h3 id="building-tsv-file-list">Building tsv file list</h3>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="kn">import</span> <span class="nn">glob</span>
 
<span class="c1"># assign directory</span>
<span class="n">directory</span> <span class="o">=</span> <span class="s1">&#39;/Users/jnapolitano/Projects/data/EuropeanEnergyData/ng&#39;</span>
 

<span class="n">tsv_list</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">glob</span><span class="o">.</span><span class="n">iglob</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">directory</span><span class="si">}</span><span class="s1">/*.tsv&#39;</span><span class="p">)]</span>

<span class="nb">print</span><span class="p">(</span><span class="n">tsv_list</span><span class="p">)</span>


</code></pre></div><pre><code>['/Users/jnapolitano/Projects/data/EuropeanEnergyData/ng/imports_montth.tsv', '/Users/jnapolitano/Projects/data/EuropeanEnergyData/ng/ng_imports.tsv', '/Users/jnapolitano/Projects/data/EuropeanEnergyData/ng/ng_exports.tsv', '/Users/jnapolitano/Projects/data/EuropeanEnergyData/ng/supply_transformation_consumption.tsv', '/Users/jnapolitano/Projects/data/EuropeanEnergyData/ng/non_house_consumption.tsv', '/Users/jnapolitano/Projects/data/EuropeanEnergyData/ng/ng_stocks.tsv', '/Users/jnapolitano/Projects/data/EuropeanEnergyData/ng/gas_prices.tsv', '/Users/jnapolitano/Projects/data/EuropeanEnergyData/ng/house_hold_consumption.tsv', '/Users/jnapolitano/Projects/data/EuropeanEnergyData/ng/exports_month.tsv', '/Users/jnapolitano/Projects/data/EuropeanEnergyData/ng/transport_costs.tsv']
</code></pre>
<h3 id="converting-to-csv">Converting to CSV</h3>
<p>The columns of this data are ugly. Some are in csv format and others are in tab.</p>
<p>I&rsquo;ll convert the entire document to csv to simplify our work.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="k">for</span> <span class="n">tsv_file</span> <span class="ow">in</span> <span class="n">tsv_list</span><span class="p">:</span>
  <span class="n">filepath</span> <span class="o">=</span> <span class="n">tsv_file</span>
  <span class="n">outfile</span> <span class="o">=</span> <span class="n">filepath</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;tsv&#39;</span><span class="p">,</span><span class="s1">&#39;csv&#39;</span><span class="p">)</span>
    
  <span class="c1"># reading given tsv file </span>
  <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">filepath</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">myfile</span><span class="p">:</span>   
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">outfile</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">csv_file</span><span class="p">:</span> 
      <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">myfile</span><span class="p">:</span> 
          
        <span class="c1"># Replace every tab with comma </span>
        <span class="n">fileContent</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="s2">&#34;</span><span class="se">\t</span><span class="s2">&#34;</span><span class="p">,</span> <span class="s2">&#34;,&#34;</span><span class="p">,</span> <span class="n">line</span><span class="p">)</span> 
          
        <span class="c1"># Writing into csv file </span>
        <span class="n">csv_file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">fileContent</span><span class="p">)</span> 
    
  <span class="c1"># output </span>
  <span class="nb">print</span><span class="p">(</span><span class="n">outfile</span><span class="p">)</span>
</code></pre></div><pre><code>/Users/jnapolitano/Projects/data/EuropeanEnergyData/ng/imports_montth.csv
/Users/jnapolitano/Projects/data/EuropeanEnergyData/ng/ng_imports.csv
/Users/jnapolitano/Projects/data/EuropeanEnergyData/ng/ng_exports.csv
/Users/jnapolitano/Projects/data/EuropeanEnergyData/ng/supply_transformation_consumption.csv
/Users/jnapolitano/Projects/data/EuropeanEnergyData/ng/non_house_consumption.csv
/Users/jnapolitano/Projects/data/EuropeanEnergyData/ng/ng_stocks.csv
/Users/jnapolitano/Projects/data/EuropeanEnergyData/ng/gas_prices.csv
/Users/jnapolitano/Projects/data/EuropeanEnergyData/ng/house_hold_consumption.csv
/Users/jnapolitano/Projects/data/EuropeanEnergyData/ng/exports_month.csv
/Users/jnapolitano/Projects/data/EuropeanEnergyData/ng/transport_costs.csv
</code></pre>
<h2 id="natural-gas-imports-data">Natural Gas Imports Data</h2>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="c1">## Importing our DataFrames</span>

<span class="n">filepath</span> <span class="o">=</span> <span class="s2">&#34;/Users/jnapolitano/Projects/data/EuropeanEnergyData/ng/ng_imports.csv&#34;</span>


<span class="c1">## Reading the CSV Columns</span>

<span class="n">ng_imports_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">filepath</span><span class="p">,</span> <span class="n">skipinitialspace</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">low_memory</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

<span class="c1"># Repacing NA&#39;s</span>
<span class="n">ng_imports_df</span> <span class="o">=</span> <span class="n">ng_imports_df</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">to_replace</span><span class="o">=</span><span class="s1">&#39;: &#39;</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

<span class="c1">#coverting to float</span>
<span class="n">ng_imports_df</span><span class="p">[</span><span class="s1">&#39;1990 &#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">ng_imports_df</span><span class="p">[</span><span class="s1">&#39;1990 &#39;</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">float</span><span class="p">)</span>
<span class="n">ng_imports_df</span><span class="p">[</span><span class="s1">&#39;1991 &#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">ng_imports_df</span><span class="p">[</span><span class="s1">&#39;1991 &#39;</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">float</span><span class="p">)</span>
<span class="n">ng_imports_df</span><span class="p">[</span><span class="s1">&#39;1992 &#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">ng_imports_df</span><span class="p">[</span><span class="s1">&#39;1992 &#39;</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">float</span><span class="p">)</span>
<span class="n">ng_imports_df</span><span class="p">[</span><span class="s1">&#39;1993 &#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">ng_imports_df</span><span class="p">[</span><span class="s1">&#39;1993 &#39;</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">float</span><span class="p">)</span>
<span class="n">ng_imports_df</span><span class="p">[</span><span class="s1">&#39;1994 &#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">ng_imports_df</span><span class="p">[</span><span class="s1">&#39;1994 &#39;</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">float</span><span class="p">)</span>
<span class="n">ng_imports_df</span><span class="p">[</span><span class="s1">&#39;1995 &#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">ng_imports_df</span><span class="p">[</span><span class="s1">&#39;1995 &#39;</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">float</span><span class="p">)</span>
<span class="n">ng_imports_df</span><span class="p">[</span><span class="s1">&#39;1996 &#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">ng_imports_df</span><span class="p">[</span><span class="s1">&#39;1996 &#39;</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">float</span><span class="p">)</span>
<span class="n">ng_imports_df</span><span class="p">[</span><span class="s1">&#39;1997 &#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">ng_imports_df</span><span class="p">[</span><span class="s1">&#39;1997 &#39;</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">float</span><span class="p">)</span>
<span class="n">ng_imports_df</span><span class="p">[</span><span class="s1">&#39;1998 &#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">ng_imports_df</span><span class="p">[</span><span class="s1">&#39;1998 &#39;</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">float</span><span class="p">)</span>
<span class="n">ng_imports_df</span><span class="p">[</span><span class="s1">&#39;1999 &#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">ng_imports_df</span><span class="p">[</span><span class="s1">&#39;1999 &#39;</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">float</span><span class="p">)</span>
<span class="n">ng_imports_df</span><span class="p">[</span><span class="s1">&#39;2000 &#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">ng_imports_df</span><span class="p">[</span><span class="s1">&#39;2000 &#39;</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">float</span><span class="p">)</span>
<span class="n">ng_imports_df</span><span class="p">[</span><span class="s1">&#39;2001 &#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">ng_imports_df</span><span class="p">[</span><span class="s1">&#39;2001 &#39;</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">float</span><span class="p">)</span>
<span class="n">ng_imports_df</span><span class="p">[</span><span class="s1">&#39;2002 &#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">ng_imports_df</span><span class="p">[</span><span class="s1">&#39;2002 &#39;</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">float</span><span class="p">)</span>
<span class="n">ng_imports_df</span><span class="p">[</span><span class="s1">&#39;2003 &#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">ng_imports_df</span><span class="p">[</span><span class="s1">&#39;2003 &#39;</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">float</span><span class="p">)</span>
<span class="n">ng_imports_df</span><span class="p">[</span><span class="s1">&#39;2004 &#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">ng_imports_df</span><span class="p">[</span><span class="s1">&#39;2004 &#39;</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">float</span><span class="p">)</span>
<span class="n">ng_imports_df</span><span class="p">[</span><span class="s1">&#39;2005 &#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">ng_imports_df</span><span class="p">[</span><span class="s1">&#39;2005 &#39;</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">float</span><span class="p">)</span>
<span class="n">ng_imports_df</span><span class="p">[</span><span class="s1">&#39;2006 &#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">ng_imports_df</span><span class="p">[</span><span class="s1">&#39;2006 &#39;</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">float</span><span class="p">)</span>
<span class="n">ng_imports_df</span><span class="p">[</span><span class="s1">&#39;2007 &#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">ng_imports_df</span><span class="p">[</span><span class="s1">&#39;2007 &#39;</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">float</span><span class="p">)</span>
<span class="n">ng_imports_df</span><span class="p">[</span><span class="s1">&#39;2008 &#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">ng_imports_df</span><span class="p">[</span><span class="s1">&#39;2008 &#39;</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">float</span><span class="p">)</span>
<span class="n">ng_imports_df</span><span class="p">[</span><span class="s1">&#39;2009 &#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">ng_imports_df</span><span class="p">[</span><span class="s1">&#39;2009 &#39;</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">float</span><span class="p">)</span>
<span class="n">ng_imports_df</span><span class="p">[</span><span class="s1">&#39;2010 &#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">ng_imports_df</span><span class="p">[</span><span class="s1">&#39;2010 &#39;</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">float</span><span class="p">)</span>
<span class="n">ng_imports_df</span><span class="p">[</span><span class="s1">&#39;2011 &#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">ng_imports_df</span><span class="p">[</span><span class="s1">&#39;2011 &#39;</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">float</span><span class="p">)</span>
<span class="n">ng_imports_df</span><span class="p">[</span><span class="s1">&#39;2012 &#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">ng_imports_df</span><span class="p">[</span><span class="s1">&#39;2012 &#39;</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">float</span><span class="p">)</span>
<span class="n">ng_imports_df</span><span class="p">[</span><span class="s1">&#39;2013 &#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">ng_imports_df</span><span class="p">[</span><span class="s1">&#39;2013 &#39;</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">float</span><span class="p">)</span>
<span class="n">ng_imports_df</span><span class="p">[</span><span class="s1">&#39;2014 &#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">ng_imports_df</span><span class="p">[</span><span class="s1">&#39;2014 &#39;</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">float</span><span class="p">)</span>
<span class="n">ng_imports_df</span><span class="p">[</span><span class="s1">&#39;2015 &#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">ng_imports_df</span><span class="p">[</span><span class="s1">&#39;2015 &#39;</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">float</span><span class="p">)</span>
<span class="n">ng_imports_df</span><span class="p">[</span><span class="s1">&#39;2016 &#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">ng_imports_df</span><span class="p">[</span><span class="s1">&#39;2016 &#39;</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">float</span><span class="p">)</span>
<span class="n">ng_imports_df</span><span class="p">[</span><span class="s1">&#39;2017 &#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">ng_imports_df</span><span class="p">[</span><span class="s1">&#39;2017 &#39;</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">float</span><span class="p">)</span>
<span class="n">ng_imports_df</span><span class="p">[</span><span class="s1">&#39;2018 &#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">ng_imports_df</span><span class="p">[</span><span class="s1">&#39;2018 &#39;</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">float</span><span class="p">)</span>
<span class="n">ng_imports_df</span><span class="p">[</span><span class="s1">&#39;2019 &#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">ng_imports_df</span><span class="p">[</span><span class="s1">&#39;2019 &#39;</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">float</span><span class="p">)</span>
<span class="n">ng_imports_df</span><span class="p">[</span><span class="s1">&#39;2020 &#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">ng_imports_df</span><span class="p">[</span><span class="s1">&#39;2020 &#39;</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">float</span><span class="p">)</span>

<span class="n">ng_imports_df</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>

<span class="c1">## This data set has spaces at the end of the years... Be aware of this when trying to findd keys</span>

</code></pre></div><pre><code>Index(['siec', 'partner', 'unit', 'geo', '2020 ', '2019 ', '2018 ', '2017 ',
       '2016 ', '2015 ', '2014 ', '2013 ', '2012 ', '2011 ', '2010 ', '2009 ',
       '2008 ', '2007 ', '2006 ', '2005 ', '2004 ', '2003 ', '2002 ', '2001 ',
       '2000 ', '1999 ', '1998 ', '1997 ', '1996 ', '1995 ', '1994 ', '1993 ',
       '1992 ', '1991 ', '1990 '],
      dtype='object')
</code></pre>
<h3 id="natural-gas-imports-descriptive-statistics">Natural Gas Imports Descriptive Statistics</h3>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="c1">#ng_imports_df.describe()</span>
<span class="n">ng_imports_df</span><span class="o">.</span><span class="n">describe</span><span class="p">()</span><span class="o">.</span><span class="n">style</span><span class="o">.</span><span class="n">set_caption</span><span class="p">(</span><span class="s1">&#39;Natural Gas Imports Descriptive Statistics&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">set_sticky</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">set_properties</span><span class="p">(</span><span class="o">**</span><span class="p">{</span><span class="s1">&#39;max-width&#39;</span><span class="p">:</span> <span class="s1">&#39;80px&#39;</span><span class="p">,</span> <span class="s1">&#39;font-size&#39;</span><span class="p">:</span> <span class="s1">&#39;1pt&#39;</span><span class="p">})</span><span class="o">.</span><span class="n">set_caption</span><span class="p">(</span><span class="s2">&#34;Hover to magnify&#34;</span><span class="p">)</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">precision</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">set_table_styles</span><span class="p">(</span><span class="n">magnify</span><span class="p">())</span>
<span class="c1">#bigdf.style.set_sticky(axis=&#34;index&#34;)</span>
<span class="c1">#.describe().style</span>
<span class="c1">#create table</span>

<span class="c1">#bigdf.style</span>
<span class="c1">#    .set_properties(**{&#39;max-width&#39;: &#39;80px&#39;, &#39;font-size&#39;: &#39;1pt&#39;})\</span>
<span class="c1">#    .set_caption(&#34;Hover to magnify&#34;)\</span>
<span class="c1">#    .format(precision=2)\</span>
<span class="c1">##    .set_table_styles(magnify())</span>

<span class="c1">#define figure and axes</span>
<span class="c1">#ng_imports_df.style.set_caption(&#34;testing&#34;)</span>

</code></pre></div><!-- raw HTML omitted -->
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</code></pre></div><h3 id="replace-0s-with-numpy-nan">Replace 0&rsquo;s with Numpy NAN</h3>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="n">ng_imports_df</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</code></pre></div><h3 id="remove-nan-rows-for-the-dataframe">Remove NAN Rows for the dataframe</h3>
<p>I remove rows where all of the rows are 0 to reduce the size of the dataframe for analysis.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="c1">## There are 30 years of data in the set. If there are 30 columns per row with nan values that row will be dropped.</span>
<span class="n">ng_imports_df</span><span class="o">.</span><span class="n">dropna</span><span class="p">(</span><span class="n">thresh</span><span class="o">=</span><span class="mi">30</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="c1">#df.dropna(thresh=2)</span>
</code></pre></div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="n">ng_imports_df</span><span class="o">.</span><span class="n">describe</span><span class="p">()</span><span class="o">.</span><span class="n">style</span><span class="o">.</span><span class="n">set_caption</span><span class="p">(</span><span class="s1">&#39;Natural Gas Imports Descriptive Statistics&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">set_sticky</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">pipe</span><span class="p">(</span><span class="n">hugo_safe_render</span><span class="p">)</span>
</code></pre></div><!-- raw HTML omitted -->
<!-- raw HTML omitted -->
<!-- raw HTML omitted -->
<h3 id="grouping-totals-by-geostate">Grouping Totals by Geo/State</h3>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="n">geo_imports_df</span> <span class="o">=</span> <span class="n">ng_imports_df</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s1">&#39;geo&#39;</span><span class="p">,</span> <span class="s1">&#39;partner&#39;</span><span class="p">,</span><span class="s1">&#39;unit&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>

</code></pre></div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="n">geo_imports_df</span><span class="o">.</span><span class="n">head</span><span class="p">()</span><span class="o">.</span><span class="n">style</span><span class="o">.</span><span class="n">set_caption</span><span class="p">(</span><span class="s1">&#39;Grouped By State, Partern and Unit&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">pipe</span><span class="p">(</span><span class="n">hugo_safe_render</span><span class="p">)</span>
</code></pre></div><!-- raw HTML omitted -->
<!-- raw HTML omitted -->
<p>With the tables compiled we can now look more in depthly at the imports of natural gas in europe.</p>
<h2 id="state-code-reference-sheet-source">State Code Reference Sheet Source</h2>
<p><a href="https://ec.europa.eu/eurostat/statistics-explained/index.php?title=Glossary:Country_codes">https://ec.europa.eu/eurostat/statistics-explained/index.php?title=Glossary:Country_codes</a></p>
<h3 id="german-totals">German Totals</h3>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="n">german_totals_df</span> <span class="o">=</span> <span class="n">geo_imports_df</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s1">&#39;geo==&#34;DE&#34;&#39;</span><span class="p">)</span>
<span class="c1">#geo_imports_df.loc[pd.IndexSlice[:,&#39;DE&#39;],:]</span>

</code></pre></div><p>German Totals Bar Chart</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="n">german_totals_df</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">legend</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">15</span><span class="p">,</span><span class="mi">15</span><span class="p">),</span> <span class="n">kind</span> <span class="o">=</span> <span class="s1">&#39;bar&#39;</span><span class="p">)</span>
</code></pre></div><pre><code>&lt;AxesSubplot:xlabel='geo,partner,unit'&gt;
</code></pre>
<p><img src="european-gas-imports_files/european-gas-imports_31_1.png" alt="png"></p>
<h3 id="german-totals-line">German Totals Line</h3>
<p>Only including long term partners</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="n">german_totals_df</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">legend</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">15</span><span class="p">,</span><span class="mi">15</span><span class="p">),</span> <span class="n">kind</span> <span class="o">=</span> <span class="s1">&#39;line&#39;</span><span class="p">)</span>
</code></pre></div><pre><code>&lt;AxesSubplot:xlabel='geo,partner,unit'&gt;
</code></pre>
<p><img src="european-gas-imports_files/european-gas-imports_33_1.png" alt="png"></p>
<h3 id="french-totals">French Totals</h3>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="n">french_totals_df</span><span class="o">=</span><span class="n">geo_imports_df</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s1">&#39;geo==&#34;FR&#34;&#39;</span><span class="p">)</span>
<span class="n">french_totals_df</span><span class="o">.</span><span class="n">style</span><span class="o">.</span><span class="n">set_caption</span><span class="p">(</span><span class="s1">&#39;French Totals Data&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">pipe</span><span class="p">(</span><span class="n">hugo_safe_render</span><span class="p">)</span>
<span class="c1">#geo_imports_df.loc[pd.IndexSlice[:,&#39;DE&#39;],:]</span>

</code></pre></div><!-- raw HTML omitted -->
<!-- raw HTML omitted -->
<!-- raw HTML omitted -->
<h3 id="french-totals-bar-chart">French Totals Bar Chart</h3>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="n">french_totals_df</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">legend</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">20</span><span class="p">,</span><span class="mi">15</span><span class="p">),</span> <span class="n">kind</span> <span class="o">=</span> <span class="s1">&#39;bar&#39;</span><span class="p">)</span>
</code></pre></div><pre><code>&lt;AxesSubplot:xlabel='geo,partner,unit'&gt;
</code></pre>
<p><img src="european-gas-imports_files/european-gas-imports_37_1.png" alt="png"></p>
<h3 id="french-totals-line">French Totals Line</h3>
<p>Only long term partners</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="n">french_totals_df</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">legend</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">15</span><span class="p">,</span><span class="mi">15</span><span class="p">),</span> <span class="n">kind</span> <span class="o">=</span> <span class="s1">&#39;line&#39;</span><span class="p">)</span>
</code></pre></div><pre><code>&lt;AxesSubplot:xlabel='geo,partner,unit'&gt;
</code></pre>
<p><img src="european-gas-imports_files/european-gas-imports_39_1.png" alt="png"></p>
<h2 id="max-importers-per-year">Max Importers Per Year</h2>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="n">max_imports_df</span> <span class="o">=</span> <span class="n">ng_imports_df</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s1">&#39;geo&#39;</span><span class="p">,</span> <span class="s1">&#39;partner&#39;</span><span class="p">,</span><span class="s1">&#39;unit&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>
</code></pre></div><h3 id="french-maximums">French Maximums</h3>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="n">french_max_df</span><span class="o">=</span><span class="n">max_imports_df</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s1">&#39;geo==&#34;FR&#34;&#39;</span><span class="p">)</span>
<span class="n">french_max_df</span><span class="o">.</span><span class="n">style</span><span class="o">.</span><span class="n">set_caption</span><span class="p">(</span><span class="s1">&#39;French Maximums&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">pipe</span><span class="p">(</span><span class="n">hugo_safe_render</span><span class="p">)</span>

</code></pre></div><!-- raw HTML omitted -->
<!-- raw HTML omitted -->
<!-- raw HTML omitted -->
<h3 id="french-max-bar-chart">French Max Bar Chart</h3>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="n">french_max_df</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">legend</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">15</span><span class="p">,</span><span class="mi">15</span><span class="p">),</span><span class="n">kind</span> <span class="o">=</span> <span class="s1">&#39;bar&#39;</span><span class="p">)</span>
</code></pre></div><pre><code>&lt;AxesSubplot:xlabel='geo,partner,unit'&gt;
</code></pre>
<p><img src="european-gas-imports_files/european-gas-imports_45_1.png" alt="png"></p>
<h3 id="french-max-line">French Max Line</h3>
<p>** Only long term partners</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="n">french_max_df</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">legend</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">15</span><span class="p">,</span><span class="mi">15</span><span class="p">))</span>

</code></pre></div><pre><code>&lt;AxesSubplot:xlabel='geo,partner,unit'&gt;
</code></pre>
<p><img src="european-gas-imports_files/european-gas-imports_47_1.png" alt="png"></p>
<h2 id="german-maximums">German Maximums</h2>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="n">german_max_df</span> <span class="o">=</span> <span class="n">max_imports_df</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s1">&#39;geo==&#34;DE&#34;&#39;</span><span class="p">)</span>
<span class="n">german_max_df</span><span class="o">.</span><span class="n">style</span><span class="o">.</span><span class="n">set_caption</span><span class="p">(</span><span class="s1">&#39;German Maximums&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">pipe</span><span class="p">(</span><span class="n">hugo_safe_render</span><span class="p">)</span>
</code></pre></div><!-- raw HTML omitted -->
<!-- raw HTML omitted -->
<!-- raw HTML omitted -->
<h3 id="german-max-bar-chart">German Max Bar Chart</h3>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="n">german_max_df</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">legend</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">15</span><span class="p">,</span><span class="mi">15</span><span class="p">),</span><span class="n">kind</span> <span class="o">=</span> <span class="s1">&#39;bar&#39;</span><span class="p">)</span>
</code></pre></div><pre><code>&lt;AxesSubplot:xlabel='geo,partner,unit'&gt;
</code></pre>
<p><img src="european-gas-imports_files/european-gas-imports_51_1.png" alt="png"></p>
<h3 id="german-max-line">German Max Line</h3>
<p>** Only long term partners</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="n">german_max_df</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">legend</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">15</span><span class="p">,</span><span class="mi">15</span><span class="p">))</span>

</code></pre></div><pre><code>&lt;AxesSubplot:xlabel='geo,partner,unit'&gt;
</code></pre>
<p><img src="european-gas-imports_files/european-gas-imports_53_1.png" alt="png"></p>
<h2 id="gas-partners">Gas Partners</h2>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="n">partners_sum_df</span> <span class="o">=</span> <span class="n">ng_imports_df</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s1">&#39;partner&#39;</span><span class="p">,</span> <span class="s1">&#39;geo&#39;</span><span class="p">,</span><span class="s1">&#39;unit&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
</code></pre></div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="n">partners_sum_df</span><span class="o">.</span><span class="n">style</span><span class="o">.</span><span class="n">set_caption</span><span class="p">(</span><span class="s1">&#39;Partner_Totals&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">pipe</span><span class="p">(</span><span class="n">hugo_safe_render</span><span class="p">)</span>
</code></pre></div><!-- raw HTML omitted -->
<!-- raw HTML omitted -->
<h3 id="russian-partners">Russian Partners</h3>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="n">russian_partners_sum_df</span><span class="o">=</span> <span class="n">partners_sum_df</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s1">&#39;partner==&#34;RU&#34;&#39;</span><span class="p">)</span>
<span class="n">russian_partners_sum_df</span><span class="o">.</span><span class="n">style</span><span class="o">.</span><span class="n">set_caption</span><span class="p">(</span><span class="s1">&#39;Russian Partners Data&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">pipe</span><span class="p">(</span><span class="n">hugo_safe_render</span><span class="p">)</span>
</code></pre></div><!-- raw HTML omitted -->
<!-- raw HTML omitted -->
<h3 id="russian-partner-bar-plot">Russian Partner Bar Plot</h3>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="n">russian_partners_sum_df</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">kind</span><span class="o">=</span><span class="s1">&#39;bar&#39;</span><span class="p">,</span> <span class="n">figsize</span> <span class="o">=</span> <span class="p">(</span><span class="mi">20</span><span class="p">,</span><span class="mi">10</span><span class="p">))</span>
</code></pre></div><pre><code>&lt;AxesSubplot:xlabel='partner,geo,unit'&gt;
</code></pre>
<p><img src="european-gas-imports_files/european-gas-imports_60_1.png" alt="png"></p>
<h3 id="russian-partner-line-graph">Russian Partner Line Graph</h3>
<p>Only will include partners that hvae traded for 30 years.  This is a good indicator of long term fossil fuel dependency.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="n">russian_partners_sum_df</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">kind</span><span class="o">=</span><span class="s1">&#39;line&#39;</span><span class="p">,</span> <span class="n">figsize</span> <span class="o">=</span> <span class="p">(</span><span class="mi">20</span><span class="p">,</span><span class="mi">10</span><span class="p">))</span>
</code></pre></div><pre><code>&lt;AxesSubplot:xlabel='partner,geo,unit'&gt;
</code></pre>
<p><img src="european-gas-imports_files/european-gas-imports_62_1.png" alt="png"></p>
]]></content>
			<postid> 699a654ac2ef0c47b42912e400b333ee</postid>
			<author>Justin Napolitano</author>
			<author_name>Justin Napolitano</author_name>
			<author_email>personal.jnapolitano@gmail.com</author_email>
			<author_id>87654367b2fca109e7dc9d3ea8a1ebbaf0bfe374773b148c2c20d278479add99</author_id>			
		</item>
		
		<item>
			<title>The World Trade Organization, Governments, and International Trade</title>
			<link>jnapolitano.com/posts/project-evolution-of-ngos/</link>
			<pubDate>Wed, 04 May 2022 14:40:32 +0000</pubDate>
			<guid>jnapolitano.com/posts/project-evolution-of-ngos/</guid>
			<description><![CDATA[Integrate JSON data from a rest API into your Neo4j Stack]]></description>
			<content type="html"><![CDATA[<h1 id="the-world-trade-organization-governments-and-international-trade">The World Trade Organization, Governments, and International Trade</h1>
<h2 id="intro">Intro</h2>
<p>International Organizations are vital to the operation of International
politics. They regulate behaviors, facilitate communication, and promote
cooperation between states. The process by which International
Organizations come into being is well discussed in the literature,
however, not equally well debated is the process by which International
Organizations come to modify their operating procedure. Or in other
words, when the member states renegotiate the terms of their membership.</p>
<h2 id="the-question">The Question</h2>
<p>International Organizations are vital to the operation of International
politics. They regulate behaviors, facilitate communication, and promote
cooperation between states. The process by which International
Organizations come into being is well discussed in the literature,
however, not equally well debated is the process by which International
Organizations come to modify their operating procedure. Or in other
words, when the member states renegotiate the terms of their membership.</p>
<h2 id="literature-review">Literature Review</h2>
<p>Kenneth Waltz argues that domestic politics is irrelevant to the
calculus of states. He argues primarily that states act according to the
actions of other states. The bureaucracy, the public, and the legal
systems are all factors not considered in his framework. He does however
take the position that &ldquo;politics determines economics (Waltz 2010)&rdquo;, but
does not further his sociological analyses. In other words, he accepts
that the behavior of states is derive from the socially constructed
political process, but does not analyze human systems to other than the
state when attempting to predict state behavior. (Waltz 2010)</p>
<p>Robert Keohane builds upon Waltz. He takes the assumption that there are
inherent common interests between states seeking wealth and power, and
the maximization of absolute gains. States are then presumed to possess
preferences dependent on the division of resources and information
within the international system. To accomplish goals and to minimize
insecurity states then cooperate by forming international regimes
defined to be, &ldquo;sets of implicit or explicit principles, norms, rules,
and decision-making procedures around which actor&rsquo;s expectations
converge in a given area of international relations&rdquo; (Keohane, 2005, p
57). In bargaining for international trade deals, states seek to
maximize power and wealth for all states involved in the process.
(Keohane, 2005)</p>
<p>Fearon also adopts this position, however also assumes that states seek
when bargaining the maximization of gains across time. Therefore the
logic of the iterated prisoners dilemma is used to explain cooperation.
Because of the shadow of the future, or the expectations of further
interaction between states, the most rational choice to maximize gains
across time is for states to cooperate and to normalize rules in the
form of a legalistic International Organizations. (Fearon 1998)</p>
<p>Moravsic adopts a liberal stance, breaking from the neorealist, as well
as the regime theorist position that the factors of the international
system determines state behavior. He argues that the preferences of
powerful coalitions within states and the combined societal will to
carry them out are the basis for state behavior. His theory rests upon
three core assumptions. 1. State actors primarily define state
preference. 2. Domestic institutions and their structure exert influence
on the realization of coalition preferences. 3. &ldquo;The configuration of
interdependent state preferences determines state behavior (Moravsic,
1997).&rdquo; Thus, powerful social coalitions pressure representative
governments, controlling for regime type, to bargain on the behalf of
their interests in the international game. This &ldquo;two stage model&rdquo; of
state behavior accounts for both regime theorist and realist
assumptions.</p>
<p>Putnam further formulizes the process with the application of the
two-level game metaphor (1988). Level 1 is considered the domestic game
played by representative leaders to appease the domestic interests of
individuals, groups, and political coalitions. Level 2 is the
international game in which states compete to appease domestic
posturing. The win-set, the possible set of actions considered
acceptable to both the domestic coalition and the international
coalition, is dependent upon three major factors. 1. The distribution of
power, preferences, and possible coalitions among level 2 constituents.
2. The size of the representative body of political institutions. 3. The
strategies of the level 1 negotiators. The net effect of the three
limiting factors results in a win-set most probable to be ratified by
the domestic institutions. In other words, representatives bargaining on
behalf of powerful domestic coalitions must negotiate trade packages
acceptable to their domestic handlers. To apply principal-agent theory
to the intuition, the coalitions are the principle handling the
representative, their agent.</p>
<p>Dahl&rsquo;s work on bureaucratic politics and policy networks within the city
of New Haven Connecticut is the foundation on which I will build to
identify the process of preferences becoming the action of a state. The
basis of his argument rests on the fact that certain actors possess the
authority to draft and to pass legislation. The units are the most
important actors within the policy network. All of those actors that
depend on the actor with authority must lobby to institute policy. The
power of the policy network is defined by their expertise, their social
standing, and their ability to satisfy the interests of the person or
persons in positions of authority. Depending on the issue at hand and
those actors mobilized the policy network is highly dynamic. (Dahl,
2005); (Dahl, 1957)</p>
<p>Finnemore explores the ways in which international institutions acquire
a degree of autonomy and then may influence the states in the system by
creating rules and regulation to serve the interests of the organization
itself. Her work relies heavily on sociological analysis of human
systems. At both the international level and the domestic level of
politics Finnemore&rsquo;s work argues that as organizations are comprised of
social actors the legal and social rules by which the institutions
operate by serve primarily to benefit the preservation of the group.
However, their legitimacy is dependent upon &ldquo;external recognition&rdquo; by
those ruled over (Finnemore 1999). In order, then to retain authority
and legitimacy, the government bureaucracy must development effective
methods of socialization to convince the public of its legitimacy.
Scaled up to International Organizations bureaucratic legitimacy is
equally dependent upon external validity. But as states are the only
units capable of effectively providing that validity, International
Organizations are wholly dependent on powerful states to enforce norms.
(Finnemore 1999); (Finnemore 1993); Finnemore 2001)</p>
<h2 id="theoretical-intuition">Theoretical Intuition</h2>
<p>Ultimately one must put forth a state centric argument in order to best
explain the operation of International Organizations and the
International System more generally. This heart of this paper will rest
on the assumption that the state as an organization is most responsible
for influencing the character of the International System, and
ultimately the modification of International Organizations. It does not
however, assume the state to be a rational entity capable of responding
to external stimuli in a way that maximizes its gains. Rather, as all
states depend on domestic legitimacy in order to exist, states
ultimately operate in order to appease the demands of powerful domestic
constituencies, often without regard to the actions of other states.</p>
<p>The structure of state can be thought of as a pyramidal hierarchy built
upon increasing levels of authority within the state. The base of which
is comprised of all of those people without any employment by the state.
Moving up from there may be civil servants of the state bureaucracy.
Ultimately the pinnacle of which is the institution or institutions
responsible for the management of all lower levels. The most important
factor binding the structure is legitimacy as each level is inherently
dependent on the external recognition of its legitimacy by the levels
beneath it. For instance, the Executive of the United States is
essentially without power, except for that power which is recognized
Congress and by extension the general public. A similar argument example
could be drawn for the military, the police, or any other institution
within a state.</p>
<p>The actual codification of this social process is by definition the law
of a state. It may be thought of as the enforcement mechanism by which
the social structure is maintained and behavior standardized. Those
within the state with the authority to create law are those with the
power to socially reinforce their position of authority.[1] Thus it is
paramount that a leader once in a position of authority also has the
means of the state available to him in order to buttress his status.
Otherwise law will be ignored and the state will devolve into anarchy.</p>
<p>At the international the same processes occurs. Powerful states, be it
military power, or economic power, reinforce norms among weaker states
in order to standardize behavioral outcomes. Great state in of
themselves may be able to accomplish this by force, but the legitimacy
of those actions will always be perceived by lesser states as entirely
illegitimate. Unless a legal institution comprised of members is
developed in order to give the lesser states the appearance of
influence, all attempts to institute norms from a position of absolute
power will surely fail. Hence the breakup of the English Empire. If
nations, with distinct identities from that of the hegemon are to be
managed a legal structure accepted to be legitimate must be created.</p>
<p>Thus, International Organizations come into being. They are an attempt
to institute a legal order binding to member states in order to minimize
risk ultimately at the behest of powerful states. The process by which
weak states join the organization is straightforward. They do so because
the powerful coalitions within their state seek to acquire the resources
available to them when entering an International Organization. Such
states will adapt to the rules of the IO, but only to the extent that
the IO serves their interest. Otherwise they will refuse to join. Once
they have joined, they will recognize the legitimacy of the powerful
state, and the IO only if the disciplinary measures are effective, and
threaten their ability to rule domestically. There is also the option to
join the Organization established by another powerful state in the
International System. If such an option is available, something like the
order prior to the first world war, and that of the cold war will come
into being.</p>
<p>For an IO then to be successful in setting the standards of the entire
international system, all powerful states must be able to converge about
a set of common interests. In other words for an international
organization to truly standardize norms throughout the international
system all great powers must act in collaboration with one another to
reinforce agreements to avoid undermining the legitimacy of the
institution. The difficulty in achieving this is found in the fact the
dictates of the international order do not determine great power
behavior, but rather the domestic forces which challenge the authority
of its leaders do. The prime example of which is the United States war
in Iraq under President George W. Bush. Despite the protests of the UN
member states, the government was forced to act under fear of losing
popularity among its base.</p>
<p>Only in highly technical and rather nonpolitical areas of international
affairs does it appear that coalitions of powerful states can manage to
converge about a set of interests. Especially is this true when it comes
to renegotiating the terms of membership.</p>
<h2 id="hypothesis">Hypothesis</h2>
<p>Therefore, I argue that international organizations modify the terms of
their agreements only when it is in the interest of the powerful
domestic constituencies of a coalition of powerful member states. A
state cannot go it alone at the international level, nor will it
successfully ratify the agreement if it is not in the interest of the
domestic camp.</p>
<h2 id="design-of-the-test">Design of the Test</h2>
<p>I adopt the intuition of the two-level game, but avoid the calculus by
way of preferences. Instead I adopt a calculus by way of expectations.
Preferences are unbounded. Expectations however are the set of expected
outcomes bounded by law and authority. In other words, expectations are
preferences bounded by the exercise of a state&rsquo;s institutions. As
institutions are expected to act in such a way as to maintain
legitimacy, their free exercise is not unbounded. As opposed to the
convergence about preferences, I expect that win-sets will converge
about a common set of expectations that arise from the internal process
of maintaining political legitimacy. To test my hypothesis then, I first
analyze the international organization. I then discern which states are
the most powerful. I then look to the issue, to see whether it is an
issue is supported by domestic coalitions of the powerful states. If
that issue is agreed upon by the most influential states within the
organization it is likely that new agreements will be signed, and the
policy of the organization will change.</p>
<h2 id="case-study">Case Study</h2>
<p>The transition of the GATT (the General Agreement on Tariffs and Trade)
to the World Trade Organization will serve as the case study of
analysis. I will analyze the foundations of the GATT, the basic terms
under which the states agreed to enter into the agreement. Then I will
look to the World Trade Organization, and seek to explain why the most
powerful states in the organization sought to expand the GATT and why
they agreed to the terms.</p>
<p>The GATT, formed after the Second World War, spearheaded by the efforts
of the United States and the United Kingdom, was the only multilateral
instrument governing international trade from 1948 until 1995 (Cite WTO
website). The point of its development was to liberalize trade and
reduce tariffs between members. Interestingly within less than a month
if its signing, the United States sought to expand the agreement to
govern all of international trade. The Havana conference of 1947 was to
do just that and to develop the International Trade Organization. The
deal proved to be incapable of ratification in the legislatures of many
member states, notable the Congress of the United States the leader of
the movement. Thus, marking the first in a series of failed attempts to
create a multilateral body regulating trade.</p>
<p>The GATT however was not an unsuccessful agreement. Periodic rounds of
negotiation, and subsequent agreements expanded the jurisdiction of the
organization and granted to it greater legitimacy as the years passed.
The agreements eight round of agreements, the Uruguay Round of 1986-94
is the most instrumental as it established the World Trade Organization.
Why is it that previous attempts to develop the body failed, but in this
one instance it came into being?</p>
<p>The question is ultimately answered by identifying the expectations of
the domestic structures of the most powerful states attempting to
renegotiate the deal. Or what was it that the domestic structure
pressured the leaders of the state to do? This type of analysis will
vary between states as it is dependent upon the institutional
organization of the state. To simplify the process for this analysis, I
look primarily to who is responsible for ratifying the trade deal, and
who is it they are responsible to.</p>
<p>The most powerful states at the time of the creation of the World Trade
Organization were in order the United States, Japan, Germany, France,
Italy, the United Kingdom, Canada, China, Brazil, and then Spain.[2] I
can further reduce the important states to the United States, the
European Union, Japan, and Canada, collectively known as the quad, as
they together account for most of international trade and the largest
share of international GDP (Databank: World Development Indicators).</p>
<p>In the United States its Senate is officially responsible for the
ratification of international treaties. However, due to legislative
enactments the process of ratification at the time the Uruguay rounds
was modified to require a majority vote in each of house of its Congress
and the approval of the President. The President and his staff were
responsible for the negotiation of the deal. Thus, the expectations to
analyze are those of the constituencies which the members of the
Congress and president rely on for appointment to their office. This
differs between each group and is thus a very difficult process to
determine. It is dependent upon the perceptions of the Congressman, and
the advice of their most important allies. They will vote for a deal
only if it is perceived to be a political win. A thorough analysis would
require reviewing the vote of each senator and then inferring the
constituents responsible for their appointment and the expectations of
each group. As this is untenable, reviewing the actions of the president
is actually a valid point of view to determine the aggregate
expectations of those within the domestic structure as the ratification
of the bill is dependent upon their support. Thus, the president is
negotiating on their behalf. (Trade Act of 1974, 19 U.S.C. Chapter 12);
(U.S. Constitution, Article 1 Sect. 3); (U.S. Constitution, Amendment
17)</p>
<p>The European Union is comprised of a very different political structure
of hierarchal authority. Individual states do not negotiate trade deals.
Rather the European Commission comprised of appointed members negotiate
deals on the behalf of the entire union. These deals must be approved by
the European Parliament which is comprised of elected representatives
from each of the members states, but the ultimate power to ratify the
agreements falls with the council. Members of the council are the heads
of state each EU member state. Their position in power is dependent upon
the domestic structures of their individual states. Nonetheless, when
bargaining internationally, they are doing so in order to maintain their
position as leader. Thus, they will not agree to a deal that will
compromise their domestic coalitions. (The European Council, 2018); (The
European Parliament: About Parliament).</p>
<p>The Japanese &ldquo;Diet&rdquo;, the state&rsquo;s version of parliament is responsible
for the ratification of treaties and international trade deals. The
executive cabinet is solely responsible for the negotiation of the deals
aided by its bureaucracy. However, as Japan is a parliamentary state,
unlike the United States, the prime minister, the executive of the
country, possesses almost free ability to institute law. This is due to
party discipline, and the fact that as the head of the government, the
prime minister is also the head of the party in possession of the
majority seats in the parliament. What then the executive negotiates
will most likely be passed. There is surely an internal bargaining
process, but it is not as crucial to the process as that of the United
States. (Fundamental Structure of the Government of Japan, 2007);
(Structure of the National Diet, 2014).</p>
<p>Canada is also structured around a Parliamentary government. The
executive committee like that of japan is centered around the prime
minister. The prime minister and his cabinet negotiate the trade deals
and then put it to parliament for ratification. The same rules of party
discipline apply here as in Japan. The likelihood of a trade deal
negotiated by the executive cabinet being ratified is very high.
(Parliamentary Primer).</p>
<p>According to my hypothesis then, these states will renegotiate the GATT
agreements when it is in the domestic interests of the heads of states
responsible for the ratification of the trade deal. The most difficult
state to accomplish in would be the United States as the greatest number
of individuals are responsible for ratification. And, because the
possible domestic win-set is the smallest in relationship to the other
powers. It is then expected that the United States will find it most
difficult to ratify the World Trade Organization agreement.</p>
<h2 id="findings">Findings</h2>
<p>As expected the Quad States (United States, Canada, Japan, EU) were by
far the most important states involved in the process of negotiation.
Their economic power and political clout were necessary to develop an
international organization with actual effect on international trade.
Thus, the states with economic value were essentially ignored in this
process. (VanGrasstek, 2013).</p>
<p>Ratification of the deals also depended on the perceptions of the
domestic coalitions of states engaged in talks. Dispute resolutions,
agricultural subsidies, and auto tariffs were the most contentious
issues between the Quad. Each sate feared primarily the delegitimizing
their domestic governments. The United States and the EU for instance
disputed over pork tariffs seriously enough to threaten the deal
outright. The United States senators and the president were concerned
that a deal that lifted subsidies would put a large number of their
constituencies out of a job. If this were to occur they thought their
positions of authority would be compromised. (VanGrasstek, 2013).</p>
<p>The solution to the problem came about in the form of substantial
dispute resolution mechanisms to solve the enforcement problem. The
United States as the most influential member of the organization most
likely assumed that it could use the Dispute Settlement Body to its own
end. The other states in the system perceived it to be capable enough to
bind the United States to internationally agreed to norms and
consensuses on trade. The goal of course to put an end to politically
disruptive tariff spikes targeted at politically relevant sectors of
economies. Or in other words to regulate international trade in order to
put an end to trade wards. This to all states at the time seemed to be
vital to securing the domestic expectations of their constituencies. The
intent of all measures is to ensure a domestic win at the time of
signing, but also to ensure ongoing win-sets across time (Fearon, 1998).
The World Trade Organization embodies that it is inherently an
organization designed to satisfy the demands of the members states not
to act as an independent body. (VanGrasstek, 2013).</p>
<h2 id="discussion">Discussion</h2>
<p>Regarding when international organizations likely to modify their
agreements, they appear to do so when a coalition of powerful states can
agree to do so. Such a straightforward answer to the question seems
obvious however, in the process of research many questions arose as to
if this is actually true. I began this research from an entirely
different point of view. I sought to answer whether Non-Governmental
Organizations (NGO) could influence Inter-Governmental organization to
adopt new policy.</p>
<p>The answer to that question led me to study states as opposed NGO&rsquo;s
because in order for an NGO to influence an IGO powerful states must be
recruited to the cause. The global civil society literature is fairly
adamant about this. Thus, I led astray from studying only NGO&rsquo;s and
instead sought to understand why states may modify existing IGO&rsquo;s or
develop new ones.</p>
<p>States are a far more interesting unit of analyses as all forms of
influence within the state could be studied to determine if domestic
politics really does lead to international politics. To this I would say
that there is no doubt that international politics begins at home. The
Logic of the Two Level Game cannot be ignored. Leaders dependent upon
domestic coalitions must act accordingly to realize their expectations
or risk losing office. From this one could see how domestic perceptions
of economic conditions, human rights, or any other issue can influence a
state&rsquo;s behavior.</p>
<p>Thus, when approaching IGO&rsquo;s and the forces which influence their
operation, not only is it more interesting look to states, but also far
more functional than attempting to discern the influence of NGO&rsquo;s
operating within states. Such an analysis requires testimony from policy
makers, meeting minutes, extensive media analysis, and a harmonious
relationship with an NGO, an IGO, and a state bureaucracy. Frankly
speaking these resources were not available, nor was I able to establish
contact with any of the important players. Therefore, one had to default
to observation from the point of view of a neutral observer.</p>
<p>In so doing it became evident that states, whether one likes it or not,
solely possess the legal authority and material capability to influence
IGO&rsquo;s. Civil society on the other hand, while influential, is without
the authority or means to actually bring about legitimate change.
Institutions trusted by citizens, or even possibly willed into being by
military force, are those with the legitimate power to actually enforce
laws and norms. As such, I adopted Dahl&rsquo;s intuition into decision making
that institutions with legal authority regulate and standardize decision
making procedures and also patterns of influence. These institutions are
the field in which those seeking to acquire influence play, and
therefore adapt to the rules. Without then needing to further delve into
this process I chose to instead analyze relationships between states, as
opposed to analyzing the operations of NGO&rsquo;s.</p>
<p>This paper is in need of expansion however in one crucial category. It
assumes wholeheartedly that the leaders of states are entirely dependent
on the whims of their domestic coalitions and that they are incapable of
employing any tactics to manipulate them. A new research project that
explores the topic in depth is in need. To make the assumption that the
preferences of influential leaders do not play a role in international
politics is too great a pill to swallow.</p>
<h2 id="conclusion">Conclusion</h2>
<p>When do International Organizations renegotiate the terms of their
agreements? They do so when powerful states within the organization
compel it do so. The logic of the Two-Level game though indicates that
the process is dependent on the expectations of domestic coalitions.
Also, the relative power between states makes it so that only a minority
of powerful states are actually important when attempting to renegotiate
deals. A win-set is achieved when the expectations of the domestic
coalitions of the most relevant states converge about a deal. The
transition of the GATT to the World Trade Organization as case study
demonstrates this process. The Quad states, the most relevant state in
the international economy Rather, it is apparent that the need for
politicians to maintain their domestic coalitions was more important to
the calculus of the leaders than the acquisition of power or wealth.</p>
<h2 id="works-cited">Works Cited</h2>
<p>Dahl, Robert Alan. &ldquo;Who Governs? Democracy and power in an American
city.&rdquo; (2005).</p>
<p>Dahl, Robert A. &ldquo;The concept of power.&rdquo; Systems Research and Behavioral
Science 2, no. 3 (1957): 201-215.</p>
<p>&ldquo;Databank: World Development Indicators&rdquo;
<a href="http://databank.worldbank.org/data/reports.aspx?source=2&amp;series=NY.GDP.PCAP.PP.CD">http://databank.worldbank.org/data/reports.aspx?source=2&amp;series=NY.GDP.PCAP.PP.CD</a></p>
<p>&ldquo;European Council: Council of the European Union&rdquo;.
<a href="http://www.consilium.europa.eu/en/">http://www.consilium.europa.eu/en/</a>. (2018)</p>
<p>Fearon, James D. &ldquo;Bargaining, enforcement, and international
cooperation.&rdquo; International organization 52, no. 2 (1998): 269-305</p>
<p>Finnemore, Martha. &ldquo;Norms, culture, and world politics: insights from
sociology&rsquo;s institutionalism.&rdquo; International organization 50, no. 2
(1996): 325-347</p>
<p>Finnemore, Martha, and Stephen J. Toope. &ldquo;Alternatives to
&ldquo;legalization&rdquo;: richer views of law and politics.&rdquo; International
Organization 55, no. 3 (2001): 743-758.</p>
<p>Finnemore, Martha. &ldquo;International organizations as teachers of norms:
the United Nations Educational, Scientific, and Cutural Organization and
science policy.&rdquo; International Organization47, no. 4 (1993): 565-597.</p>
<p>&ldquo;Fundamental Structure of the Government of Japan&rdquo;.
<a href="http://japan.kantei.go.jp/constitution_and_government_of_japan/fundamental_e.html">http://japan.kantei.go.jp/constitution_and_government_of_japan/fundamental_e.html</a>.
(2007)</p>
<p>Keohane, Robert. After Hegemony: Cooperation and Discord in the World
Political Economy. Princeton University Press. (2005)</p>
<p>Moravcsik, Andrew. &ldquo;Taking preferences seriously: A liberal theory of
international politics.&rdquo; International organization 51, no. 4 (1997):
513-553.</p>
<p>&ldquo;Parliamentary Primer&rdquo;.
<a href="https://lop.parl.ca/About/Parliament/Publications/index-e.html">https://lop.parl.ca/About/Parliament/Publications/index-e.html</a></p>
<p>Putnam, Robert D. &ldquo;Diplomacy and domestic politics: the logic of
two-level games.&rdquo; International organization 42, no. 3 (1988): 427-460.</p>
<p>&ldquo;The European Parliament about Parliament&rdquo;
<a href="http://www.europarl.europa.eu/aboutparliament/en">http://www.europarl.europa.eu/aboutparliament/en</a></p>
<p>&ldquo;Structure of the National Diet&rdquo;
<a href="http://www.shugiin.go.jp/internet/itdb_english.nsf/html/statics/guide/structure.htm">http://www.shugiin.go.jp/internet/itdb_english.nsf/html/statics/guide/structure.htm</a>.
(2014)</p>
<p>VanGrasstek, Craig. The History and Future of the World Trade
Organization. World Trade Organization Publication.
<a href="https://www.wto.org/english/res_e/booksp_e/historywto_e.pdf">https://www.wto.org/english/res_e/booksp_e/historywto_e.pdf</a>.</p>
<p>(2013)</p>
<p>Waltz, Kenneth N. Theory of international politics. Waveland Press.
(2010)</p>
<p>[1] Power is to be defined as the ability to make someone do what they
otherwise would not do.</p>
<p>[2] The European Union is officially a signee of the WTO. It is
important to note that five of the top ten states are EU members. As
trade regulation must be uniform throughout the EU, the European Union
representatives negotiated on behalf of their member. For the purpose of
this paper I will treat the EU as a single state to avoid greatly
complicating the analysis</p>
]]></content>
			<postid> 64db5d49835973203d6a017aceac1131</postid>
			<author>Justin Napolitano</author>
			<author_name>Justin Napolitano</author_name>
			<author_email>personal.jnapolitano@gmail.com</author_email>
			<author_id>87654367b2fca109e7dc9d3ea8a1ebbaf0bfe374773b148c2c20d278479add99</author_id>			
		</item>
		
	</channel>
</rss>
